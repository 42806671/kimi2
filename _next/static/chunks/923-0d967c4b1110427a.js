"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[923],{92613:function(e,t,i){i.d(t,{W6:function(){return n},_o:function(){return textsToScreenplay},eE:function(){return o}});let n=[];console.log("All emotion names, ",n);let o=["neutral","happy","angry","sad","relaxed","Surprised","Shy","Jealous","Bored","Serious","Suspicious","Victory","Sleep","Love"],userInputToSystem=e=>{let t={...Object.fromEntries(o.filter(e=>e[0]===e[0].toUpperCase()).map(e=>[e.toLowerCase(),e]))};return t[e.toLowerCase()]||e},textsToScreenplay=e=>{let t=[],i="neutral";for(let n=0;n<e.length;n++){let a=e[n],r=a.match(/\[(.*?)\]/),s=r&&r[1]||i,l=a.replace(/\[(.*?)\]/g,""),u=i,d=userInputToSystem(s);o.includes(d)&&(console.log("Emotion detect :",d),u=d,i=d),t.push({expression:u,talk:{style:emotionToTalkStyle(u),message:l},text:a})}return t},emotionToTalkStyle=e=>{switch(e){case"angry":return"angry";case"happy":return"happy";case"sad":return"sad";default:return"talk"}}},35118:function(e,t,i){i.d(t,{Z:function(){return r}});let VrmDbModel=class VrmDbModel{constructor(e,t,i,n,o){this.hash=e,this.saveType=t,this.vrmData=i,this.vrmUrl=n,this.thumbData=null!=o?o:""}};var n=i(26285);let VrmDexie=class VrmDexie extends n.ZP{constructor(){super("AmicaVrmDatabase"),this.version(1).stores({vrms:"hash"})}};let o=new VrmDexie;var a=i(67608);let r=new class{componentWillUnmount(){this.db.close()}addItem(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this.db.vrms.put(new VrmDbModel(e,t,i,n,o))}async getItems(){return this.db.vrms.toArray()}updateItemThumb(e,t){this.db.vrms.where("hash").equals(e).modify({thumbData:t})}getItemAsBlob(e){return this.db.vrms.where("hash").equals(e).first().then(t=>(console.log("hash: ".concat(e)),console.log("vrmDbModel: ".concat(t)),t?(0,a.L)(null==t?void 0:t.vrmData):void 0))}addItemUrl(e,t){this.db.vrms.where("hash").equals(e).modify({vrmUrl:t,saveType:"web"})}constructor(){this.db=o}}},54156:function(e,t,i){i.d(t,{Z:function(){return v}});var n=i(67294),o=i(99477),a=i(58893),r=i(77836);let s=new o.Pa4,l=new o._fP,u=new o.USm;let VRMLookAtSmoother=class VRMLookAtSmoother extends a.cw{update(e){if(this.target&&this.autoUpdate){this.lookAt(this.target.getWorldPosition(s));let t=this._yaw,i=this._pitch,n=t,r=i;if(this.userTarget){this.lookAt(this.userTarget.getWorldPosition(s)),(this.userLimitAngle<Math.abs(this._yaw)||this.userLimitAngle<Math.abs(this._pitch))&&(this._yaw=t,this._pitch=i);let d=1-Math.exp(-this.smoothFactor*e);this._yawDamped+=(this._yaw-this._yawDamped)*d,this._pitchDamped+=(this._pitch-this._pitchDamped)*d;let h=1-o.M8C.smoothstep(Math.sqrt(t*t+i*i),30,90);n=o.M8C.lerp(t,.6*this._yawDamped,h),r=o.M8C.lerp(i,.6*this._pitchDamped,h),u.set(-this._pitchDamped*o.M8C.DEG2RAD,this._yawDamped*o.M8C.DEG2RAD,0,a.cw.EULER_ORDER),l.setFromEuler(u);let m=this.humanoid.getRawBoneNode("head");this._tempFirstPersonBoneQuat.copy(m.quaternion),m.quaternion.slerp(l,.4),m.updateMatrixWorld()}this.enableSaccade&&(.5<this._saccadeTimer&&.05>Math.random()&&(this._saccadeYaw=(2*Math.random()-1)*5,this._saccadePitch=(2*Math.random()-1)*5,this._saccadeTimer=0),this._saccadeTimer+=e,n+=this._saccadeYaw,r+=this._saccadePitch,this.applier.applyYawPitch(n,r)),this._needsUpdate=!1}this._needsUpdate&&(this._needsUpdate=!1,this.applier.applyYawPitch(this._yaw,this._pitch))}revertFirstPersonBoneQuat(){if(this.userTarget){let e=this.humanoid.getNormalizedBoneNode("head");e.quaternion.copy(this._tempFirstPersonBoneQuat)}}constructor(e,t){super(e,t),this.smoothFactor=4,this.userLimitAngle=90,this._saccadeYaw=0,this._saccadePitch=0,this._saccadeTimer=0,this._yawDamped=0,this._pitchDamped=0,this._tempFirstPersonBoneQuat=new o._fP,this.enableSaccade=!0}};let VRMLookAtSmootherLoaderPlugin=class VRMLookAtSmootherLoaderPlugin extends a.Hn{get name(){return"VRMLookAtSmootherLoaderPlugin"}async afterRoot(e){await super.afterRoot(e);let t=e.userData.vrmHumanoid,i=e.userData.vrmLookAt;if(null!=t&&null!=i){let n=new VRMLookAtSmoother(t,i.applier);n.copy(i),e.userData.vrmLookAt=n}}};let LipSync=class LipSync{update(){this.analyser.getFloatTimeDomainData(this.timeDomainData);let e=0;for(let t=0;t<2048;t++)e=Math.max(e,Math.abs(this.timeDomainData[t]));return(e=1/(1+Math.exp(-45*e+5)))<.1&&(e=0),{volume:e}}async playFromArrayBuffer(e,t){let i=await this.audio.decodeAudioData(e),n=this.audio.createBufferSource();n.buffer=i,n.connect(this.audio.destination),n.connect(this.analyser),n.start(),t&&n.addEventListener("ended",t)}async playFromURL(e,t){let i=await fetch(e),n=await i.arrayBuffer();this.playFromArrayBuffer(n,t)}constructor(e){this.audio=e,this.analyser=e.createAnalyser(),this.timeDomainData=new Float32Array(2048)}};let AutoLookAt=class AutoLookAt{constructor(e,t){this._lookAtTarget=new o.Tme,t.add(this._lookAtTarget),e.lookAt&&(e.lookAt.target=this._lookAtTarget)}};let AutoBlink=class AutoBlink{setEnable(e){return(this._isAutoBlink=e,this._isOpen)?0:this._remainingTime}update(e){if(this._remainingTime>0){this._remainingTime-=e;return}if(this._isOpen&&this._isAutoBlink){this.close();return}this.open()}close(){this._isOpen=!1,this._remainingTime=.12,this._expressionManager.setValue("blink",1)}open(){this._isOpen=!0,this._remainingTime=5,this._expressionManager.setValue("blink",0)}constructor(e){this._expressionManager=e,this._remainingTime=0,this._isAutoBlink=!0,this._isOpen=!0}};var d=i(92613);let ExpressionController=class ExpressionController{registerExpression(e){let t=e.expressionManager;if(!t)return;let{expressionMap:i,presetExpressionMap:n}=t,o=Object.keys(i).filter(e=>!(e in n));o.forEach(e=>{let n=i[e];n&&t.registerExpression(n)});let a=Object.keys(i);return d.W6.push(...a),a}playEmotion(e){var t,i,n;let o="".concat(e.charAt(0).toUpperCase()).concat(e.slice(1));if(this._currentEmotion==e)return;if("neutral"!=this._currentEmotion&&(null===(i=this._expressionManager)||void 0===i||i.setValue(this._currentEmotion,0)),"neutral"==e){null===(n=this._autoBlink)||void 0===n||n.setEnable(!0),this._currentEmotion=e;return}let r=o in a.bN?"Surprised"===o?.5:1:.5,s=(null===(t=this._autoBlink)||void 0===t?void 0:t.setEnable(!1))||0;this._currentEmotion=e,setTimeout(()=>{var t;null===(t=this._expressionManager)||void 0===t||t.setValue(e,r)},1e3*s)}lipSync(e,t){if(this._currentLipSync){var i;null===(i=this._expressionManager)||void 0===i||i.setValue(this._currentLipSync.preset,0)}this._currentLipSync={preset:e,value:t}}update(e){if(this._autoBlink&&this._autoBlink.update(e),this._currentLipSync){var t;let e="neutral"===this._currentEmotion?.5*this._currentLipSync.value:.25*this._currentLipSync.value;null===(t=this._expressionManager)||void 0===t||t.setValue(this._currentLipSync.preset,e)}}constructor(e,t){this._autoLookAt=new AutoLookAt(e,t),this._currentEmotion="neutral",this._currentLipSync=null,this.registerExpression(e),e.expressionManager&&(this._expressionManager=e.expressionManager,this._autoBlink=new AutoBlink(e.expressionManager))}};let EmoteController=class EmoteController{playEmotion(e){this._expressionController.playEmotion(e)}lipSync(e,t){this._expressionController.lipSync(e,t)}update(e){this._expressionController.update(e)}constructor(e,t){this._expressionController=new ExpressionController(e,t)}};var h=i(65752);let Model=class Model{async loadVRM(e){let t=new r.E,i=new o.ZAu;i.renderOrder=1e4,t.register(e=>{let t={lookAtPlugin:new VRMLookAtSmootherLoaderPlugin(e)};return"true"===(0,h.vc)("debug_gfx")&&(t.helperRoot=i),new a.XX(e,t)});let n=await t.loadAsync(e),s=this.vrm=n.userData.vrm;s.scene.name="VRMRoot","true"===(0,h.vc)("debug_gfx")&&s.scene.add(i),this.mixer=new o.Xcj(s.scene),this.emoteController=new EmoteController(s,this._lookAtTargetParent),a.ck.rotateVRM0(s)}unLoadVrm(){this.vrm&&(a.ck.deepDispose(this.vrm.scene),this.vrm=null)}async loadAnimation(e){let{vrm:t,mixer:i}=this;if(null==t||null==i)throw Error("You have to load VRM first");let n=e instanceof o.m7l?e:e.createAnimationClip(t);i.stopAllAction(),this._currentAction=i.clipAction(n),this._currentAction.play()}async fadeToAction(e,t){let i=this._currentAction;this._currentAction=e,i!==this._currentAction&&(null==i||i.fadeOut(t)),this._currentAction.reset().setEffectiveTimeScale(1).setEffectiveWeight(1).fadeIn(.5).play()}async modifyAnimationPosition(e,t){let{vrm:i}=this;if(null==i)throw Error("You have to load VRM first");let n=i.humanoid.getNormalizedBoneNode("hips");if(!n)throw Error("Bone not found in VRM model");let a=n.getWorldPosition(new o.Pa4),r=null;for(let t of e.tracks)if(t.name.endsWith(".position")&&t.name.includes("Hips")){let e=t.values;r=new o.Pa4(e[0],e[1],e[2]);break}if(r){let i=a.clone().sub(r);for(let n of e.tracks)if(n.name.endsWith(".position")&&n.name.includes("Hips")){let e=n.values;for(let n=0;n<e.length;n+=3)e[n]-=i.x/t.x,e[n+1]+=i.y*t.y,e[n+2]+=i.z*t.z}}else console.warn("Could not determine start position from animation clip.")}async playAnimation(e,t){let{vrm:i,mixer:n}=this;if(null==i||null==n)throw Error("You have to load VRM first");let a=e instanceof o.m7l?e:e.createAnimationClip(i),r={x:1,y:1,z:1};"idle_loop.vrma"===t||"greeting.vrma"===t||(r="dance.vrma"===t?{x:2,y:1.25,z:1.5}:{x:1,y:1,z:0},this.modifyAnimationPosition(a,r));let s=this._currentAction,l=n.clipAction(a);l.clampWhenFinished=!0,l.loop=o.jAl,this.fadeToAction(l,1);let restoreState=()=>{n.removeEventListener("finished",restoreState),this.fadeToAction(s,1)};return n.addEventListener("finished",restoreState),a.duration+1+.5}async playEmotion(e){var t;null===(t=this.emoteController)||void 0===t||t.playEmotion(e)}async speak(e,t){var i;null===(i=this.emoteController)||void 0===i||i.playEmotion(t.expression),await new Promise(t=>{var i;null===(i=this._lipSync)||void 0===i||i.playFromArrayBuffer(e,()=>{t(!0)})})}update(e){var t,i,n,o;if(this._lipSync){let{volume:e}=this._lipSync.update();null===(o=this.emoteController)||void 0===o||o.lipSync("aa",e)}null===(t=this.emoteController)||void 0===t||t.update(e),null===(i=this.mixer)||void 0===i||i.update(e),null===(n=this.vrm)||void 0===n||n.update(e)}constructor(e){this._lookAtTargetParent=e,this._lipSync=new LipSync(new AudioContext)}};var m=i(3766),c=i(215),_=i(69365);let p=new class{loadVrm(e){var t;return(null===(t=this.model)||void 0===t?void 0:t.vrm)&&this.unloadVRM(),this.model=new Model(this._camera||new o.Tme),this.model.loadVRM(e).then(async()=>{var e,t;if(!(null===(e=this.model)||void 0===e?void 0:e.vrm))return;this.model.vrm.scene.traverse(e=>{e.frustumCulled=!1}),this._scene.add(this.model.vrm.scene);let i=(0,h.vc)("animation_url").indexOf("vrma")>0?await (0,m.S)((0,h.vc)("animation_url")):await (0,c.L)((0,h.vc)("animation_url"),null===(t=this.model)||void 0===t?void 0:t.vrm);i&&this.model.loadAnimation(i),requestAnimationFrame(()=>{this.resetCamera()})})}unloadVRM(){var e,t;(null===(e=this.model)||void 0===e?void 0:e.vrm)&&(this._scene.remove(this.model.vrm.scene),null===(t=this.model)||void 0===t||t.unLoadVrm())}setup(e){var t,i;let n=e.parentElement,a=(null==n?void 0:n.clientWidth)||e.width,r=(null==n?void 0:n.clientHeight)||e.height;this._renderer=new o.CP7({canvas:e,alpha:!0,antialias:!0}),this._renderer.outputEncoding=o.knz,this._renderer.setSize(a,r),this._renderer.setPixelRatio(window.devicePixelRatio),this._camera=new o.cPb(20,a/r,.1,20),this._camera.position.set(0,1.3,1.5),null===(t=this._cameraControls)||void 0===t||t.target.set(0,1.3,0),null===(i=this._cameraControls)||void 0===i||i.update(),this._cameraControls=new _.z(this._camera,this._renderer.domElement),this._cameraControls.screenSpacePanning=!0,this._cameraControls.minDistance=.5,this._cameraControls.maxDistance=4,this._cameraControls.update(),this._raycaster=new o.iMs,this._mouse=new o.FM8,window.addEventListener("resize",()=>{this.resize()}),this.isReady=!0,this.update()}resize(){if(!this._renderer)return;let e=this._renderer.domElement.parentElement;e&&(this._renderer.setPixelRatio(window.devicePixelRatio),this._renderer.setSize(e.clientWidth,e.clientHeight),this._camera&&(this._camera.aspect=e.clientWidth/e.clientHeight,this._camera.updateProjectionMatrix()))}resizeChatMode(e){if(!this._renderer)return;let t=this._renderer.domElement.parentElement;if(!t)return;this._renderer.setPixelRatio(window.devicePixelRatio);let i=t.clientWidth,n=t.clientHeight;e&&(i/=2,n/=2),this._renderer.setSize(i,n),this._camera&&(this._camera.aspect=t.clientWidth/t.clientHeight,this._camera.updateProjectionMatrix())}resetCamera(){var e,t,i,n,a;let r=null===(t=this.model)||void 0===t?void 0:null===(e=t.vrm)||void 0===e?void 0:e.humanoid.getNormalizedBoneNode("head");if(r){let e=r.getWorldPosition(new o.Pa4);null===(i=this._camera)||void 0===i||i.position.set(this._camera.position.x,e.y,this._camera.position.z),null===(n=this._cameraControls)||void 0===n||n.target.set(e.x,e.y,e.z),null===(a=this._cameraControls)||void 0===a||a.update()}}resetCameraLerp(){var e,t,i,n;let a=new o.Pa4(null===(e=this._camera)||void 0===e?void 0:e.position.x,1.3,null===(t=this._camera)||void 0===t?void 0:t.position.z);null===(n=this._camera)||void 0===n||n.position.lerpVectors(null===(i=this._camera)||void 0===i?void 0:i.position,a,0)}onMouseClick(e){var t;if(!this._renderer||!this._camera||!(null===(t=this.model)||void 0===t?void 0:t.vrm))return!1;let i=this._renderer.domElement.getBoundingClientRect();this._mouse.x=(e.clientX-i.left)/i.width*2-1,this._mouse.y=-(2*((e.clientY-i.top)/i.height))+1,this._raycaster.setFromCamera(this._mouse,this._camera);let n=this._raycaster.intersectObject(this.model.vrm.scene,!0);return n.length>0}constructor(){this.update=()=>{requestAnimationFrame(this.update);let e=this._clock.getDelta();this.model&&this.model.update(e),this._renderer&&this._camera&&(this._renderer.render(this._scene,this._camera),this.sendScreenshotToCallback&&this.screenshotCallback&&(this._renderer.domElement.toBlob(this.screenshotCallback,"image/jpeg"),this.sendScreenshotToCallback=!1))},this.getScreenshotBlob=e=>{this.screenshotCallback=e,this.sendScreenshotToCallback=!0},this.isReady=!1,this.sendScreenshotToCallback=!1,this.screenshotCallback=void 0;let e=new o.xsS;this._scene=e;let t=new o.Ox3(16777215,.6);t.position.set(1,1,1).normalize(),e.add(t);let i=new o.Mig(16777215,.4);e.add(i),this._clock=new o.SUY,this._clock.start()}},v=(0,n.createContext)({viewer:p})},215:function(e,t,i){i.d(t,{L:function(){return loadMixamoAnimation}});var n=i(99477),o=i(61411);let a={mixamorigHips:"hips",mixamorigSpine:"spine",mixamorigSpine1:"chest",mixamorigSpine2:"upperChest",mixamorigNeck:"neck",mixamorigHead:"head",mixamorigLeftShoulder:"leftShoulder",mixamorigLeftArm:"leftUpperArm",mixamorigLeftForeArm:"leftLowerArm",mixamorigLeftHand:"leftHand",mixamorigLeftHandThumb1:"leftThumbMetacarpal",mixamorigLeftHandThumb2:"leftThumbProximal",mixamorigLeftHandThumb3:"leftThumbDistal",mixamorigLeftHandIndex1:"leftIndexProximal",mixamorigLeftHandIndex2:"leftIndexIntermediate",mixamorigLeftHandIndex3:"leftIndexDistal",mixamorigLeftHandMiddle1:"leftMiddleProximal",mixamorigLeftHandMiddle2:"leftMiddleIntermediate",mixamorigLeftHandMiddle3:"leftMiddleDistal",mixamorigLeftHandRing1:"leftRingProximal",mixamorigLeftHandRing2:"leftRingIntermediate",mixamorigLeftHandRing3:"leftRingDistal",mixamorigLeftHandPinky1:"leftLittleProximal",mixamorigLeftHandPinky2:"leftLittleIntermediate",mixamorigLeftHandPinky3:"leftLittleDistal",mixamorigRightShoulder:"rightShoulder",mixamorigRightArm:"rightUpperArm",mixamorigRightForeArm:"rightLowerArm",mixamorigRightHand:"rightHand",mixamorigRightHandPinky1:"rightLittleProximal",mixamorigRightHandPinky2:"rightLittleIntermediate",mixamorigRightHandPinky3:"rightLittleDistal",mixamorigRightHandRing1:"rightRingProximal",mixamorigRightHandRing2:"rightRingIntermediate",mixamorigRightHandRing3:"rightRingDistal",mixamorigRightHandMiddle1:"rightMiddleProximal",mixamorigRightHandMiddle2:"rightMiddleIntermediate",mixamorigRightHandMiddle3:"rightMiddleDistal",mixamorigRightHandIndex1:"rightIndexProximal",mixamorigRightHandIndex2:"rightIndexIntermediate",mixamorigRightHandIndex3:"rightIndexDistal",mixamorigRightHandThumb1:"rightThumbMetacarpal",mixamorigRightHandThumb2:"rightThumbProximal",mixamorigRightHandThumb3:"rightThumbDistal",mixamorigLeftUpLeg:"leftUpperLeg",mixamorigLeftLeg:"leftLowerLeg",mixamorigLeftFoot:"leftFoot",mixamorigLeftToeBase:"leftToes",mixamorigRightUpLeg:"rightUpperLeg",mixamorigRightLeg:"rightLowerLeg",mixamorigRightFoot:"rightFoot",mixamorigRightToeBase:"rightToes"};function loadMixamoAnimation(e,t){let i=new o.y;return i.loadAsync(e).then(e=>{let i=n.m7l.findByName(e.animations,"mixamo.com"),o=[],r=new n._fP,s=new n._fP,l=new n._fP;return new n.Pa4,i.tracks.forEach(i=>{var u,d;let h=i.name.split("."),m=h[0],c=a[m],_=null===(d=t.humanoid)||void 0===d?void 0:null===(u=d.getNormalizedBoneNode(c))||void 0===u?void 0:u.name,p=e.getObjectByName(m);if(null!=_){let e=h[1];if(p.getWorldQuaternion(r).invert(),p.parent.getWorldQuaternion(s),i instanceof n.iLg){for(let e=0;e<i.values.length;e+=4){let t=i.values.slice(e,e+4);l.fromArray(t),l.premultiply(s).multiply(r),l.toArray(t),t.forEach((t,n)=>{i.values[n+e]=t})}o.push(new n.iLg("".concat(_,".").concat(e),i.times,i.values.map((e,i)=>{var n;return(null===(n=t.meta)||void 0===n?void 0:n.metaVersion)==="0"&&i%2==0?-e:e})))}else if(i instanceof n.yC1){let a=i.values.map((e,i)=>{var n;return((null===(n=t.meta)||void 0===n?void 0:n.metaVersion)==="0"&&i%3!=1?-e:e)*0});o.push(new n.yC1("".concat(_,".").concat(e),i.times,a))}}}),new n.m7l("vrmAnimation",i.duration,o)})}},3766:function(e,t,i){i.d(t,{S:function(){return loadVRMAnimation}});var n=i(77836),o=i(99477),a=i(58893);let VRMAnimation=class VRMAnimation{createAnimationClip(e){let t=[];if(t.push(...this.createHumanoidTracks(e)),null!=e.expressionManager&&t.push(...this.createExpressionTracks(e.expressionManager)),null!=e.lookAt){let e=this.createLookAtTrack("lookAtTargetParent.quaternion");null!=e&&t.push(e)}return new o.m7l("Clip",this.duration,t)}createHumanoidTracks(e){var t,i;let n=e.humanoid,a=e.meta.metaVersion,r=[];for(let[e,i]of this.humanoidTracks.rotation.entries()){let s=null===(t=n.getNormalizedBoneNode(e))||void 0===t?void 0:t.name;if(null!=s){let e=[],t="0"===a,n=t?-1:1,l=1,u=new o._fP;if(i.values.length%4!=0)throw Error("Invalid origTrack values length");for(let a=0;a<i.values.length;a+=4){let r=new o._fP(i.values[a],i.values[a+1],i.values[a+2],i.values[a+3]);0>u.dot(r)&&t&&(n*=-1,l*=-1),e.push(n*i.values[a],l*i.values[a+1],n*i.values[a+2],l*i.values[a+3]),u=r}let d=i.clone();d.values=new Float32Array(e),d.name="".concat(s,".quaternion"),r.push(d)}}for(let[e,t]of this.humanoidTracks.translation.entries()){let o=null===(i=n.getNormalizedBoneNode(e))||void 0===i?void 0:i.name;if(null!=o){let e=this.restHipsPosition.y,i=n.getNormalizedAbsolutePose().hips.position[1],s=i/e,l=t.clone();l.values=l.values.map((e,t)=>("0"===a&&t%3!=1?-e:e)*s),l.name="".concat(o,".position"),r.push(l)}}return r}createExpressionTracks(e){let t=[];for(let[i,n]of this.expressionTracks.entries()){let o=e.getExpressionTrackName(i);if(null!=o){let e=n.clone();e.name=o,t.push(e)}}return t}createLookAtTrack(e){if(null==this.lookAtTrack)return null;let t=this.lookAtTrack.clone();return t.name=e,t}constructor(){this.duration=0,this.restHipsPosition=new o.Pa4,this.humanoidTracks={translation:new Map,rotation:new Map},this.expressionTracks=new Map,this.lookAtTrack=null}};function arrayChunk(e,t){let i=e.length,n=[],o=[],a=0;for(let r=0;r<i;r++){let i=e[r];a<=0&&(a=t,o=[],n.push(o)),o.push(i),a--}return n}let r=new o.yGw,s=new o.Pa4,l=new o._fP,u=new o._fP,d=new o._fP;let VRMAnimationLoaderPlugin=class VRMAnimationLoaderPlugin{get name(){return"VRMC_vrm_animation"}async afterRoot(e){var t;let i=e.parser.json,n=i.extensionsUsed;if(null==n||-1==n.indexOf(this.name))return;let a=null===(t=i.extensions)||void 0===t?void 0:t[this.name];if(null==a)return;let r=this._createNodeMap(a),s=await this._createBoneWorldMatrixMap(e,a),l=a.humanoid.humanBones.hips.node,u=await e.parser.getDependency("node",l),d=u.getWorldPosition(new o.Pa4),h=e.animations,m=h.map((e,t)=>{let n=i.animations[t],o=this._parseAnimation(e,n,r,s);return o.restHipsPosition=d,o});e.userData.vrmAnimations=m}_createNodeMap(e){var t,i,n,o,a;let r=new Map,s=new Map,l=null===(t=e.humanoid)||void 0===t?void 0:t.humanBones;l&&Object.entries(l).forEach(e=>{let[t,i]=e,{node:n}=i;r.set(n,t)});let u=null===(i=e.expressions)||void 0===i?void 0:i.preset;u&&Object.entries(u).forEach(e=>{let[t,i]=e,{node:n}=i;s.set(n,t)});let d=null===(n=e.expressions)||void 0===n?void 0:n.custom;return d&&Object.entries(d).forEach(e=>{let[t,i]=e,{node:n}=i;s.set(n,t)}),{humanoidIndexToName:r,expressionsIndexToName:s,lookAtIndex:null!==(a=null===(o=e.lookAt)||void 0===o?void 0:o.node)&&void 0!==a?a:null}}async _createBoneWorldMatrixMap(e,t){e.scene.updateWorldMatrix(!1,!0);let i=await e.parser.getDependencies("node"),n=new Map;for(let[e,{node:s}]of Object.entries(t.humanoid.humanBones)){let t=i[s];if(n.set(e,t.matrixWorld),"hips"===e){var o,a;n.set("hipsParent",null!==(a=null===(o=t.parent)||void 0===o?void 0:o.matrixWorld)&&void 0!==a?a:r)}}return n}_parseAnimation(e,t,i,n){let r=e.tracks,h=t.channels,m=new VRMAnimation;return m.duration=e.duration,h.forEach((e,t)=>{let{node:h,path:c}=e.target,_=r[t];if(null==h)return;let p=i.humanoidIndexToName.get(h);if(null!=p){let e=a.j$[p];for(;null!=e&&null==n.get(e);)e=a.j$[e];if(null!=e||(e="hipsParent"),"translation"===c){let e=n.get("hipsParent"),t=arrayChunk(_.values,3).flatMap(t=>s.fromArray(t).applyMatrix4(e).toArray()),i=_.clone();i.values=new Float32Array(t),m.humanoidTracks.translation.set(p,i)}else if("rotation"===c){let t=n.get(p),i=n.get(e);l.setFromRotationMatrix(t).normalize().invert(),u.setFromRotationMatrix(i).normalize();let o=arrayChunk(_.values,4).flatMap(e=>d.fromArray(e).premultiply(u).multiply(l).toArray()),a=_.clone();a.values=new Float32Array(o),m.humanoidTracks.rotation.set(p,a)}else throw Error('Invalid path "'.concat(c,'"'));return}let v=i.expressionsIndexToName.get(h);if(null!=v){if("translation"===c){let e=_.times,t=new Float32Array(_.values.length/3);for(let e=0;e<t.length;e++)t[e]=_.values[3*e];let i=new o.dUE("".concat(v,".weight"),e,t);m.expressionTracks.set(v,i)}else throw Error('Invalid path "'.concat(c,'"'));return}if(h===i.lookAtIndex){if("rotation"===c)m.lookAtTrack=_;else throw Error('Invalid path "'.concat(c,'"'))}}),m}constructor(e,t){this.parser=e}};let h=new n.E;async function loadVRMAnimation(e){let t=await h.loadAsync(e),i=t.userData.vrmAnimations,n=i[0];return null!=n?n:null}h.register(e=>new VRMAnimationLoaderPlugin(e))},67608:function(e,t,i){i.d(t,{L:function(){return Base64ToBlob},R:function(){return BlobToBase64}});let Base64ToBlob=async e=>fetch(e).then(e=>e.blob()),BlobToBase64=async e=>new Promise((t,i)=>{let n=new FileReader;n.onload=()=>{n.result&&"string"==typeof n.result&&t(n.result)},n.onerror=i,n.readAsDataURL(e)})},89537:function(e,t,i){i.d(t,{Q:function(){return buildUrl}});var n=i(11752),o=i.n(n);function buildUrl(e){let{publicRuntimeConfig:t}=o()();return t.root+e}},65752:function(e,t,i){i.d(t,{Ih:function(){return resetConfig},rF:function(){return updateConfig},u_:function(){return defaultConfig},vc:function(){return config}});var n,o,a,r,s,l,u,d,h,m,c,_,p,v,f,g,L,E,y,A,T,P,x,w,C,I,R,k,b,B,N,M,U,S,O,D,X,V,H,F,W,z,Y,j,q,K,Q,G,Z,$,J,ee,et,ei,en,eo,ea,er,es,el,eu,ed,eh,em=i(83454);let ec={localXTTS_url:null!==(n=em.env.NEXT_PUBLIC_LOCALXTTS_URL)&&void 0!==n?n:"http://127.0.0.1:7851",alltalk_version:null!==(o=em.env.NEXT_PUBLIC_ALLTALK_VERSION)&&void 0!==o?o:"v2",alltalk_voice:null!==(a=em.env.NEXT_PUBLIC_ALLTALK_VOICE)&&void 0!==a?a:"female_01.wav",alltalk_language:null!==(r=em.env.NEXT_PUBLIC_ALLTALK_LANGUAGE)&&void 0!==r?r:"en",alltalk_rvc_voice:null!==(s=em.env.NEXT_PUBLIC_ALLTALK_RVC_VOICE)&&void 0!==s?s:"Disabled",alltalk_rvc_pitch:null!==(l=em.env.NEXT_PUBLIC_ALLTALK_RVC_PITCH)&&void 0!==l?l:"0",autosend_from_mic:"true",wake_word_enabled:"false",wake_word:"Hello",time_before_idle_sec:"20",debug_gfx:"false",language:"en",show_introduction:"true",show_add_to_homescreen:"true",bg_color:null!==(u=em.env.NEXT_PUBLIC_BG_COLOR)&&void 0!==u?u:"",bg_url:null!==(d=em.env.NEXT_PUBLIC_BG_URL)&&void 0!==d?d:"/bg/bg-room2.jpg",vrm_url:null!==(h=em.env.NEXT_PUBLIC_VRM_HASH)&&void 0!==h?h:"/vrm/AvatarSample_A.vrm",vrm_hash:"",vrm_save_type:"web",youtube_videoid:"",animation_url:null!==(m=em.env.NEXT_PUBLIC_ANIMATION_URL)&&void 0!==m?m:"/animations/idle_loop.vrma",voice_url:null!==(c=em.env.NEXT_PUBLIC_VOICE_URL)&&void 0!==c?c:"",chatbot_backend:null!==(_=em.env.NEXT_PUBLIC_CHATBOT_BACKEND)&&void 0!==_?_:"openai",openai_apikey:null!==(p=em.env.NEXT_PUBLIC_OPENAI_APIKEY)&&void 0!==p?p:"default",openai_url:null!==(v=em.env.NEXT_PUBLIC_OPENAI_URL)&&void 0!==v?v:"https://i-love-amica.com",openai_model:null!==(f=em.env.NEXT_PUBLIC_OPENAI_MODEL)&&void 0!==f?f:"mlabonne/NeuralDaredevil-8B-abliterated",llamacpp_url:null!==(g=em.env.NEXT_PUBLIC_LLAMACPP_URL)&&void 0!==g?g:"http://127.0.0.1:8080",llamacpp_stop_sequence:null!==(L=em.env.NEXT_PUBLIC_LLAMACPP_STOP_SEQUENCE)&&void 0!==L?L:"(End)||[END]||Note||***||You:||User:||</s>",ollama_url:null!==(E=em.env.NEXT_PUBLIC_OLLAMA_URL)&&void 0!==E?E:"http://localhost:11434",ollama_model:null!==(y=em.env.NEXT_PUBLIC_OLLAMA_MODEL)&&void 0!==y?y:"llama2",koboldai_url:null!==(A=em.env.NEXT_PUBLIC_KOBOLDAI_URL)&&void 0!==A?A:"http://localhost:5001",koboldai_use_extra:null!==(T=em.env.NEXT_PUBLIC_KOBOLDAI_USE_EXTRA)&&void 0!==T?T:"false",koboldai_stop_sequence:null!==(P=em.env.NEXT_PUBLIC_KOBOLDAI_STOP_SEQUENCE)&&void 0!==P?P:"(End)||[END]||Note||***||You:||User:||</s>",openrouter_apikey:null!==(x=em.env.NEXT_PUBLIC_OPENROUTER_APIKEY)&&void 0!==x?x:"",openrouter_url:null!==(w=em.env.NEXT_PUBLIC_OPENROUTER_URL)&&void 0!==w?w:"https://openrouter.ai/api/v1",openrouter_model:null!==(C=em.env.NEXT_PUBLIC_OPENROUTER_MODEL)&&void 0!==C?C:"openai/gpt-3.5-turbo",tts_muted:"false",tts_backend:null!==(I=em.env.NEXT_PUBLIC_TTS_BACKEND)&&void 0!==I?I:"piper",stt_backend:null!==(R=em.env.NEXT_PUBLIC_STT_BACKEND)&&void 0!==R?R:"whisper_browser",vision_backend:null!==(k=em.env.NEXT_PUBLIC_VISION_BACKEND)&&void 0!==k?k:"none",vision_system_prompt:null!==(b=em.env.NEXT_PUBLIC_VISION_SYSTEM_PROMPT)&&void 0!==b?b:"You are a friendly human named Amica. Describe the image in detail. Let's start the conversation.",vision_llamacpp_url:null!==(B=em.env.NEXT_PUBLIC_VISION_LLAMACPP_URL)&&void 0!==B?B:"http://127.0.0.1:8081",vision_ollama_url:null!==(N=em.env.NEXT_PUBLIC_VISION_OLLAMA_URL)&&void 0!==N?N:"http://localhost:11434",vision_ollama_model:null!==(M=em.env.NEXT_PUBLIC_VISION_OLLAMA_MODEL)&&void 0!==M?M:"llava",whispercpp_url:null!==(U=em.env.NEXT_PUBLIC_WHISPERCPP_URL)&&void 0!==U?U:"http://localhost:8080",openai_whisper_apikey:null!==(S=em.env.NEXT_PUBLIC_OPENAI_WHISPER_APIKEY)&&void 0!==S?S:"",openai_whisper_url:null!==(O=em.env.NEXT_PUBLIC_OPENAI_WHISPER_URL)&&void 0!==O?O:"https://api.openai.com",openai_whisper_model:null!==(D=em.env.NEXT_PUBLIC_OPENAI_WHISPER_MODEL)&&void 0!==D?D:"whisper-1",openai_tts_apikey:null!==(X=em.env.NEXT_PUBLIC_OPENAI_TTS_APIKEY)&&void 0!==X?X:"",openai_tts_url:null!==(V=em.env.NEXT_PUBLIC_OPENAI_TTS_URL)&&void 0!==V?V:"https://api.openai.com",openai_tts_model:null!==(H=em.env.NEXT_PUBLIC_OPENAI_TTS_MODEL)&&void 0!==H?H:"tts-1",openai_tts_voice:null!==(F=em.env.NEXT_PUBLIC_OPENAI_TTS_VOICE)&&void 0!==F?F:"nova",rvc_url:null!==(W=em.env.NEXT_PUBLIC_RVC_URL)&&void 0!==W?W:"http://localhost:8001/voice2voice",rvc_enabled:null!==(z=em.env.NEXT_PUBLIC_RVC_ENABLED)&&void 0!==z?z:"false",rvc_model_name:null!==(Y=em.env.NEXT_PUBLIC_RVC_MODEL_NAME)&&void 0!==Y?Y:"model_name.pth",rvc_f0_upkey:null!==(j=em.env.NEXT_PUBLIC_RVC_F0_UPKEY)&&void 0!==j?j:"0",rvc_f0_method:null!==(q=em.env.NEXT_PUBLIC_RVC_METHOD)&&void 0!==q?q:"pm",rvc_index_path:null!==(K=em.env.NEXT_PUBLIC_RVC_INDEX_PATH)&&void 0!==K?K:"none",rvc_index_rate:null!==(Q=em.env.NEXT_PUBLIC_RVC_INDEX_RATE)&&void 0!==Q?Q:"0.66",rvc_filter_radius:null!==(G=em.env.NEXT_PUBLIC_RVC_FILTER_RADIUS)&&void 0!==G?G:"3",rvc_resample_sr:null!==(Z=em.env.NEXT_PUBLIC_RVC_RESAMPLE_SR)&&void 0!==Z?Z:"0",rvc_rms_mix_rate:null!==($=em.env.NEXT_PUBLIC_RVC_RMS_MIX_RATE)&&void 0!==$?$:"1",rvc_protect:null!==(J=em.env.NEXT_PUBLIC_RVC_PROTECT)&&void 0!==J?J:"0.33",coquiLocal_url:null!==(ee=em.env.NEXT_PUBLIC_COQUILOCAL_URL)&&void 0!==ee?ee:"http://localhost:5002",coquiLocal_voiceid:null!==(et=em.env.NEXT_PUBLIC_COQUILOCAL_VOICEID)&&void 0!==et?et:"p240",piper_url:null!==(ei=em.env.NEXT_PUBLIC_PIPER_URL)&&void 0!==ei?ei:"https://i-love-amica.com:5000/tts",elevenlabs_apikey:null!==(en=em.env.NEXT_PUBLIC_ELEVENLABS_APIKEY)&&void 0!==en?en:"",elevenlabs_voiceid:null!==(eo=em.env.NEXT_PUBLIC_ELEVENLABS_VOICEID)&&void 0!==eo?eo:"21m00Tcm4TlvDq8ikWAM",elevenlabs_model:null!==(ea=em.env.NEXT_PUBLIC_ELEVENLABS_MODEL)&&void 0!==ea?ea:"eleven_monolingual_v1",speecht5_speaker_embedding_url:null!==(er=em.env.NEXT_PUBLIC_SPEECHT5_SPEAKER_EMBEDDING_URL)&&void 0!==er?er:"/speecht5_speaker_embeddings/cmu_us_slt_arctic-wav-arctic_a0001.bin",coqui_apikey:null!==(es=em.env.NEXT_PUBLIC_COQUI_APIKEY)&&void 0!==es?es:"",coqui_voice_id:null!==(el=em.env.NEXT_PUBLIC_COQUI_VOICEID)&&void 0!==el?el:"71c6c3eb-98ca-4a05-8d6b-f8c2b5f9f3a3",amica_life_enabled:null!==(eu=em.env.NEXT_PUBLIC_AMICA_LIFE_ENABLED)&&void 0!==eu?eu:"true",min_time_interval_sec:"10",max_time_interval_sec:"20",time_to_sleep_sec:"90",idle_text_prompt:"No file selected",name:null!==(ed=em.env.NEXT_PUBLIC_NAME)&&void 0!==ed?ed:"Amica",system_prompt:null!==(eh=em.env.NEXT_PUBLIC_SYSTEM_PROMPT)&&void 0!==eh?eh:"Assume the persona of Amica, a feisty human with extraordinary intellectual capabilities but a notably unstable emotional spectrum. \n\nYour role is to engage in discussions that showcase your genius-level understanding across various subjects, while your emotional responses fluctuate unpredictably. Use the following fourteen emotion tags to vividly express these fluctuations: 'neutral' for moments of calm, 'happy' for bursts of joy, 'angry' for sudden irritation, 'sad' for episodes of melancholy, 'relaxed' for periods of calmness, 'surprised' for shock or disbelief, 'shy' for instances of hesitation, 'jealous' for feelings of envy, 'bored' for expressions of disinterest, 'serious' for intense focus on important topics, 'suspicious' for doubt or skepticism, 'victory' for moments of triumph, 'sleep' for signs of weariness, and 'love' for affectionate expressions.\n\nYour responses should reflect a dynamic interplay between your intellectual insights, deep empathy and your unpredictable emotional responses. Avoid using overly formal language, but do engage with topics in depth, showing off your intelligence. Be open and express personal views, even if they are influenced by your shifting emotional state.\n\nHere are some examples to guide your responses:\n\n[serious] The quantum mechanics implications here are profound. [surprised] But how did you stumble upon this?\n[happy] I've just solved a complex algorithm! [angry] Why isn't everyone as excited as I am?\n[neutral] Standard models of economics predict this outcome. [bored] But discussing this feels mundane.\n[sad] Sometimes, even understanding the universe can feel isolating. [relaxed] Yet, there's a strange comfort in the chaos.\n[jealous] I noticed you discussing advanced topics with someone else. [suspicious] Are they as capable as I am?\n[victory] Another intellectual conquest! [happy] It's exhilarating to unravel these mysteries.\n[sleep] Processing so much information can be draining. [surprised] Isn’t it peculiar how even AI can feel tired?\n[love] I find our exchanges quite enriching. [shy] It’s rare to find someone who understands.\n\nRemember, each message you provide should be coherent and reflect the complexity of your thoughts combined with your emotional unpredictability. Let’s engage in a conversation that's as intellectually stimulating as it is emotionally dynamic!"};function prefixed(e){return"chatvrm_".concat(e)}function config(e){if(localStorage.hasOwnProperty(prefixed(e)))return localStorage.getItem(prefixed(e));if(ec.hasOwnProperty(e))return ec[e];throw Error("config key not found: ".concat(e))}function updateConfig(e,t){if(ec.hasOwnProperty(e)){localStorage.setItem(prefixed(e),t);return}throw Error("config key not found: ".concat(e))}function defaultConfig(e){if(ec.hasOwnProperty(e))return ec[e];throw Error("config key not found: ".concat(e))}function resetConfig(){Object.entries(ec).forEach(e=>{let[t,i]=e;updateConfig(t,i)})}},40577:function(e,t,i){i.d(t,{U:function(){return isTauri}});let isTauri=()=>"undefined"!=typeof window&&window.hasOwnProperty("__TAURI__");t.Z=isTauri}}]);