(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5405],{48312:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return a(50461)}])},45417:function(e,t,a){"use strict";a.d(t,{h:function(){return IconButton}});var s=a(85893);let IconButton=e=>{let{iconName:t,isProcessing:a,label:r,...n}=e;return(0,s.jsxs)("button",{...n,className:"bg-primary hover:bg-primary-hover active:bg-primary-press disabled:bg-primary-disabled text-white rounded-lg text-sm p-1 text-center inline-flex items-center mr-2\n        ".concat(n.className,"\n      "),children:[a?(0,s.jsx)("pixiv-icon",{name:"24/Dot",scale:"1"}):(0,s.jsx)("pixiv-icon",{name:t,scale:"1"}),r&&(0,s.jsx)("div",{className:"mx-2 font-bold",children:r})]})}},20308:function(e,t,a){"use strict";a.d(t,{EO:function(){return pagesToLinks},EZ:function(){return basename},Hn:function(){return NotUsingAlert},MY:function(){return thumbPrefix},Su:function(){return ResetToDefaultButton},lT:function(){return getLinkFromPage},p7:function(){return FormRow},pv:function(){return BasicPage},un:function(){return hashCode}});var s=a(85893),r=a(71487),n=a(5774),i=a(54346),l=a(39267),o=a(28166),c=a(48974),d=a(62940),u=a(70124),m=a(69864),h=a(7814),p=a(60341),g=a(93832),x=a(7543),v=a(51721),f=a(45548),b=a(8825),y=a(98523),w=a(7112),j=a(87272),_=a(311),k=a(63771),N=a(97481);function BasicPage(e){let{title:t,description:a,children:r}=e;return(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"rounded-lg shadow-lg bg-white p-4",children:[(0,s.jsx)("h2",{className:"text-xl w-full",children:t}),(0,s.jsx)("p",{className:"w-full my-4",children:a}),(0,s.jsx)("div",{className:"mt-4",children:r})]})})}function FormRow(e){let{label:t,children:a}=e;return(0,s.jsxs)("div",{className:"sm:col-span-3 max-w-xs rounded-xl",children:[(0,s.jsx)("label",{className:"block text-sm font-medium leading-6 text-gray-900",children:t}),(0,s.jsx)("div",{className:"mt-2",children:a})]})}function basename(e){let t=e.split("/");return t[t.length-1]}function thumbPrefix(e){let t=e.split("/");return t[t.length-1]="thumb-"+t[t.length-1],t.join("/")}function hashCode(e){for(var t=0,a=0,s=e.length;a<s;)t=(t<<5)-t+e.charCodeAt(a++)<<0;return t.toString()}function getLinkFromPage(e){return{key:e,label:function(e){switch(e){case"appearance":return(0,r.t)("Appearance");case"amica_life":return(0,r.t)("Amica Life");case"chatbot":return(0,r.t)("ChatBot");case"tts":return(0,r.t)("Text-to-Speech");case"stt":return(0,r.t)("Speech-to-text");case"vision":return(0,r.t)("Vision");case"reset_settings":return(0,r.t)("Reset Settings");case"community":return(0,r.t)("Community");case"background_img":return(0,r.t)("Background Image");case"background_color":return(0,r.t)("Background Color");case"background_video":return(0,r.t)("Background Video");case"character_model":return(0,r.t)("Character Model");case"character_animation":return(0,r.t)("Character Animation");case"chatbot_backend":return(0,r.t)("ChatBot Backend");case"chatgpt_settings":return(0,r.t)("ChatGPT");case"llamacpp_settings":case"vision_llamacpp_settings":return(0,r.t)("LLama.cpp");case"ollama_settings":case"vision_ollama_settings":return(0,r.t)("Ollama");case"koboldai_settings":return(0,r.t)("KoboldAI");case"openrouter_settings":return(0,r.t)("OpenRouter");case"name":return(0,r.t)("Name");case"system_prompt":case"vision_system_prompt":return(0,r.t)("System Prompt");case"tts_backend":return(0,r.t)("TTS Backend");case"elevenlabs_settings":return(0,r.t)("ElevenLabs");case"speecht5_settings":return(0,r.t)("SpeechT5");case"openai_tts_settings":return(0,r.t)("OpenAI");case"piper_settings":return(0,r.t)("Piper");case"rvc_settings":return(0,r.t)("RVC");case"coquiLocal_settings":return(0,r.t)("Coqui Local");case"localXTTS_settings":return(0,r.t)("Alltalk");case"vision_backend":return(0,r.t)("Vision Backend");case"stt_backend":return(0,r.t)("STT Backend");case"stt_wake_word":return(0,r.t)("Wake word");case"whisper_openai_settings":return(0,r.t)("Whisper (OpenAI)");case"whispercpp_settings":return(0,r.t)("Whisper.cpp")}throw Error("unknown page label encountered ".concat(e))}(e),icon:function(e){switch(e){case"appearance":return(0,s.jsx)(n.Z,{className:"h-5 w-5 flex-none text-gray-800","aria-hidden":"true"});case"amica_life":return(0,s.jsx)(i.Z,{className:"h-5 w-5 flex-none text-gray-800","aria-hidden":"true"});case"chatbot":return(0,s.jsx)(l.Z,{className:"h-5 w-5 flex-none text-gray-800","aria-hidden":"true"});case"tts":return(0,s.jsx)(o.Z,{className:"h-5 w-5 flex-none text-gray-800","aria-hidden":"true"});case"stt":return(0,s.jsx)(c.Z,{className:"h-5 w-5 flex-none text-gray-800","aria-hidden":"true"});case"vision":return(0,s.jsx)(d.Z,{className:"h-5 w-5 flex-none text-gray-800","aria-hidden":"true"});case"reset_settings":return(0,s.jsx)(u.Z,{className:"h-5 w-5 flex-none text-red-500","aria-hidden":"true"});case"community":return(0,s.jsx)(m.Z,{className:"h-5 w-5 flex-none text-gray-800","aria-hidden":"true"});case"background_img":return(0,s.jsx)(h.Z,{className:"h-5 w-5 flex-none text-gray-800","aria-hidden":"true"});case"background_color":return(0,s.jsx)(p.Z,{className:"h-5 w-5 flex-none text-gray-800","aria-hidden":"true"});case"background_video":return(0,s.jsx)(g.Z,{className:"h-5 w-5 flex-none text-gray-800","aria-hidden":"true"});case"character_model":return(0,s.jsx)(x.Z,{className:"h-5 w-5 flex-none text-gray-800","aria-hidden":"true"});case"character_animation":case"chatgpt_settings":case"llamacpp_settings":case"ollama_settings":case"koboldai_settings":case"openrouter_settings":case"elevenlabs_settings":case"speecht5_settings":case"openai_tts_settings":case"piper_settings":case"coquiLocal_settings":case"localXTTS_settings":case"whisper_openai_settings":case"whispercpp_settings":case"vision_llamacpp_settings":case"vision_ollama_settings":return(0,s.jsx)(v.Z,{className:"h-5 w-5 flex-none text-gray-800","aria-hidden":"true"});case"chatbot_backend":return(0,s.jsx)(f.Z,{className:"h-5 w-5 flex-none text-gray-800","aria-hidden":"true"});case"name":return(0,s.jsx)(b.Z,{className:"h-5 w-5 flex-none text-gray-800","aria-hidden":"true"});case"system_prompt":case"vision_system_prompt":return(0,s.jsx)(y.Z,{className:"h-5 w-5 flex-none text-gray-800","aria-hidden":"true"});case"tts_backend":return(0,s.jsx)(w.Z,{className:"h-5 w-5 flex-none text-gray-800","aria-hidden":"true"});case"rvc_settings":return(0,s.jsx)(j.Z,{className:"h-5 w-5 flex-none text-gray-800","aria-hidden":"true"});case"stt_backend":return(0,s.jsx)(_.Z,{className:"h-5 w-5 flex-none text-gray-800","aria-hidden":"true"});case"stt_wake_word":return(0,s.jsx)(k.Z,{className:"h-5 w-5 flex-none text-gray-800","aria-hidden":"true"});case"vision_backend":return(0,s.jsx)(N.Z,{className:"h-5 w-5 flex-none text-gray-800","aria-hidden":"true"})}return(0,s.jsx)(s.Fragment,{})}(e),className:"reset_settings"===e?"text-red-500":""}}function pagesToLinks(e){let t=[];for(let a of e)t.push(getLinkFromPage(a));return t}function ResetToDefaultButton(e){let{onClick:t}=e;return(0,s.jsx)("button",{type:"button",onClick:t,className:"inline-flex items-center px-2.5 py-1.5 border border-transparent text-xs font-medium rounded shadow-sm text-white bg-rose-600 hover:bg-rose-700 focus:outline-none",children:(0,r.t)("Reset to Default")})}function NotUsingAlert(e){let{children:t}=e;return(0,s.jsx)("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4",children:t})}},74001:function(e,t,a){"use strict";a.d(t,{w:function(){return n}});var s=a(67294);let r=new class{success(e,t){this.notifications.push({type:"success",title:e,message:t})}error(e,t){this.notifications.push({type:"error",title:e,message:t})}constructor(){this.notifications=[]}},n=(0,s.createContext)({alert:r})},60496:function(e,t,a){"use strict";a.d(t,{r:function(){return N}});var s=a(67294),r=a(81649),n=a(65752),i=a(22725),l=a(93206),o=a(50929),c=a(3766),d=a(92613),u=a(20308),m=a(70324),h=a(55532),p=a(66087),g=a(25303),x=a(47551),v=a(19427),f=a(26281),b=a(87797);async function askLLM(e,t,a){let s=[],r=0,setChatProcessing=e=>{};null===a&&(r=0);let i={error:(e,t)=>{console.error("".concat(e,": ").concat(t))}},getChatResponseStream=async e=>{console.debug("getChatResponseStream",e);let t=(0,n.vc)("chatbot_backend");switch(t){case"chatgpt":return(0,h.x)(e);case"llamacpp":return(0,p.h)(e);case"windowai":return(0,g.f)(e);case"ollama":return(0,x.b)(e);case"koboldai":return(0,v.L)(e);case"openrouter":return(0,f.i)(e);default:return(0,m.U)(e)}};try{s.push(await getChatResponseStream([{role:"system",content:e},{role:"user",content:t}]))}catch(t){let e="Error: ".concat(t.toString());return console.error(e),i.error("Failed to get subconcious subroutine response",e),e}let l=s[s.length-1];if(!l){let e="Error: Null subconcious subroutine stream encountered.";return console.error(e),i.error("Null subconcious subroutine stream encountered",e),e}if(0===s.length)return console.log("No stream!"),"Error: No stream";r++,null!==a&&(r=a.currentStreamIdx),setChatProcessing(!0),console.time("Subconcious subroutine stream processing");let o=l.getReader();[].push(o);let c="",d=[],u="",y="",w="",j=!1,_=!1;console.time("performance_time_to_first_token"),null!==a&&console.time("performance_time_to_first_sentence");try{for(;;){if(r!=r){console.log("Wrong stream idx");break}let{done:e,value:t}=await o.read();if(j||(console.timeEnd("performance_time_to_first_token"),j=!0),e)break;if(c+=t,c=c.trimStart(),null!==a){let e=(0,b.F)({sentences:d,aiTextLog:u,receivedMessage:c,tag:y,rolePlay:w,callback:e=>(console.debug("enqueue tts",e),console.debug("streamIdx",r,"currentStreamIdx",a.currentStreamIdx),r!==a.currentStreamIdx)?(console.log("wrong stream idx"),!0):(a.ttsJobs.enqueue({screenplay:e[0],streamIdx:r}),_||(console.timeEnd("performance_time_to_first_sentence"),_=!0),!1)});if(d=e.sentences,u=e.aiTextLog,c=e.receivedMessage,y=e.tag,w=e.rolePlay,e.shouldBreak)break}}}catch(t){let e=t.toString();console.error(e)}finally{o.closed||o.releaseLock(),console.timeEnd("Subconcious subroutine stream processing"),r==r&&setChatProcessing(!1)}return null!==a?u:c}async function handleNews(){try{let e=await fetch("https://rss.nytimes.com/services/xml/rss/nyt/HomePage.xml");if(!e.ok)throw Error("Failed to fetch: ".concat(e.statusText));let t=await e.text(),a=t.split("<item>").slice(1),s=function(e){let t=e[Math.floor(Math.random()*e.length)],extractContent=(e,t)=>{let a=e.indexOf("<".concat(t,">"))+"<".concat(t,">").length,s=e.indexOf("</".concat(t,">"),a);return e.substring(a,s)},a=extractContent(t,"title"),s=extractContent(t,"description");return"".concat(a,": ").concat(s)}(a),r=await expandPrompt("You are a newscaster specializing in providing news. Use the following context from The New York Times News to commented on. [{context_str}]",{context_str:s});return console.log("News function calling result: ",s),r}catch(e){return console.error("Error in handleNews:",e),"An error occurred while fetching and processing the news."}}async function expandPrompt(e,t){for(let a in t)e=e.replace("{".concat(a,"}"),t[a]);return e}async function handleFunctionCalling(e){if("news"===e){let e=await handleNews();return e}console.log("Unknown event: ".concat(e))}async function functionCalling(e){let t=await handleFunctionCalling(e);return t}let y=["VRMA","Subconcious","IdleTextPrompts"],w={idleTextPrompt:["*I am ignoring you*","**sighs** It's so quiet here.","Tell me something interesting about yourself.","**looks around** What do you usually do for fun?","I could use a good distraction right now.","What's the most fascinating thing you know?","If you could talk about anything, what would it be?","Got any clever insights to share?","**leans in** Any fun stories to tell?"]},j=[],_="";async function handleVRMAnimationEvent(e,t){let a;do a=o.gC[Math.floor(Math.random()*o.gC.length)];while((0,u.EZ)(a)===_);_=(0,u.EZ)(a);try{if(e){let s=await (0,c.S)(a);if(!s)throw Error("Loading animation failed");let r=await e.model.playAnimation(s,_);requestAnimationFrame(()=>{e.resetCameraLerp()}),setTimeout(()=>{t.eventProcessing=!1,console.timeEnd("processing_event VRMA")},1e3*r)}}catch(e){console.error("Error loading animation:",e)}}async function handleTextEvent(e,t){let a=Math.floor(Math.random()*w.idleTextPrompt.length),s=w.idleTextPrompt[a];try{var r;await (null===(r=e.receiveMessageFromUser)||void 0===r?void 0:r.call(e,s,!0)),t.eventProcessing=!1,console.timeEnd("processing_event IdleTextPrompts")}catch(e){console.error("Error occurred while sending a message through chat instance:",e)}}async function handleSleepEvent(e,t){console.log("Sleeping..."),t.pause(),t.isSleep=!0;try{let a=e.viewer;a&&await a.model.playEmotion("Sleep"),t.eventProcessing=!1,console.timeEnd("processing_event Sleep")}catch(e){console.error("Error playing emotion sleep:",e)}}async function handleSubconsciousEvent(e,t){let a=e.messageList,s=a.map(e=>"".concat("user"===e.role?"User":"Assistant",": ").concat(e.content)).join("\n");try{let a=await askLLM("Please reflect on the conversation and let your thoughts flow freely, as if writing a personal diary with events that have occurred:","".concat(s),null),r=a.startsWith("Error:")?s:a,n=await askLLM("Read this mini-diary, I would like you to simulate a human-like subconscious with deep emotions and describe it from a third-person perspective:",r,null),i=n.startsWith("Error:")?s:n;await askLLM("Based on your mini-diary, respond with dialougue that sounds like a normal person speaking about their mind, experience or feelings. Make sure to incorporate the specified emotion tags in your response. Here is the list of emotion tags that you have to include in the result : ".concat(d.eE.map(e=>"[".concat(e,"]")).join(", "),":"),i,e);let l=a.startsWith("Error:")?s:a,o=await askLLM("Compress this prompt to 240 characters:",l,null);console.log("Stored Memory: ",o);let c={prompt:o,timestamp:new Date().toISOString()};j.push(c);let u=j.reduce((e,t)=>e+t.prompt.length,0);for(;u>3e3;){let e=j.shift();u-=e.prompt.length}console.log("Stored subconcious prompts:",j),t.setSubconciousLogs(j),t.eventProcessing=!1,console.timeEnd("processing_event Subconcious")}catch(e){console.error("Error handling subconscious event:",e)}}async function handleNewsEvent(e,t){console.log("Function Calling: News");try{var a;let s=await functionCalling("news");if(!s)throw Error("Loading news failed");await (null===(a=e.receiveMessageFromUser)||void 0===a?void 0:a.call(e,s,!0)),t.eventProcessing=!1,console.timeEnd("processing_event News")}catch(e){console.error("Error occurred while sending a message through chat instance:",e)}}async function handleIdleEvent(e,t,a,s){if(!a){console.error("Chat instance is not available");return}switch(e.events){case"VRMA":await handleVRMAnimationEvent(s,t);break;case"Subconcious":await handleSubconsciousEvent(a,t);break;case"News":await handleNewsEvent(a,t);break;case"Sleep":await handleSleepEvent(a,t);break;default:await handleTextEvent(a,t)}}let k=new class{initialize(e,t,a,s){this.viewer=e,this.chat=t,this.setSubconciousLogs=a,this.isChatSpeaking=s,this.loadIdleTextPrompt(null),this.processingIdle(),this.initialized=!0}async loadIdleTextPrompt(e){null===e?y.forEach(e=>this.mainEvents.enqueue({events:e})):e.length>0&&(this.mainEvents.clear(),e.forEach(e=>w.idleTextPrompt.push(e)))}insertFront(e){let t=new r.ci;for(t.enqueue(e);!this.mainEvents.isEmpty();)t.enqueue(this.mainEvents.dequeue());this.mainEvents=t}removeEvent(e){let t=new r.ci;for(;!this.mainEvents.isEmpty();){let a=this.mainEvents.dequeue();a&&a.events!==e&&t.enqueue(a)}this.mainEvents=t}containsEvent(e){let t=!1;return this.mainEvents.forEach(a=>{a.events===e&&(t=!0)}),t}receiveMessageFromUser(e){e.toLowerCase().includes("news")&&(console.log("Triggering news function call."),this.insertFront({events:"News"})),this.containsEvent("Subconcious")||this.mainEvents.enqueue({events:"Subconcious"}),this.pause(),this.wakeFromSleep(),this.triggerMessage=!0}async processingIdle(){if(!this.isProcessingIdleRunning){for(this.isProcessingIdleRunning=!0,console.log("Starting Amica Life");"true"===(0,n.vc)("amica_life_enabled");){var e;(null===(e=this.chat)||void 0===e?void 0:e.isAwake())||this.processingEvent(),await (0,i.D)(50)}this.isProcessingIdleRunning=!1,this.isProcessingEventRunning=!1,this.triggerMessage=!1,console.log("Stopping idle loop")}}async processingEvent(){if(this.isProcessingEventRunning){await this.checkResume();return}if(this.triggerMessage){for(this.isProcessingEventRunning=!0;this.isProcessingEventRunning;){if(1>this.chat.speakJobs.size()&&1>this.chat.ttsJobs.size()&&!this.isChatSpeaking&&!this.eventProcessing){if((0,l.hw)(),await this.checkSleep(),await this.checkPause(),.25>=Math.random()){await this.waitInterval();continue}let e=this.mainEvents.dequeue();e&&(console.time("processing_event ".concat(e.events)),this.eventProcessing=!0,await handleIdleEvent(e,this,this.chat,this.viewer),"Subconcious"===e.events||"Sleep"===e.events||this.mainEvents.enqueue(e))}else(this.chat.speakJobs.size()>0||this.chat.ttsJobs.size()>0||this.isChatSpeaking)&&(0,l.fL)();await this.waitInterval()}this.isProcessingEventRunning=!1}}async pause(){var e;await (null===(e=this.chat)||void 0===e?void 0:e.interrupt()),this.isPause=!0}resume(){this.isPause=!1}async checkSleep(){if(!this.isSleep){let e=this.chat;if(!e){console.error("Chat instance is not available");return}let t=e.idleTime();!this.containsEvent("Sleep")&&t>parseInt((0,n.vc)("time_to_sleep_sec"))&&this.insertFront({events:"Sleep"})}}async checkPause(){this.isPause&&(console.log("Amica Life Paused"),await new Promise(e=>{let t=setInterval(()=>{this.isPause||(clearInterval(t),e(console.log("Amica Life Initiated")))},50)}))}async checkResume(){return!0===this.isPause&&!this.isSleep&&!!this.isSettingOff&&(this.resume(),!0)}checkSettingOff(e){if(e){var t;this.isSettingOff=!0,this.wakeFromSleep(),null===(t=this.chat)||void 0===t||t.updateAwake(),this.resume()}else this.isSettingOff=!1,this.pause()}updatedIdleTime(){parseInt((0,n.vc)("time_before_idle_sec"))}async waitInterval(){let[e,t]=[parseInt((0,n.vc)("min_time_interval_sec")),parseInt((0,n.vc)("max_time_interval_sec"))],a=1e3*Math.floor(Math.random()*(t-e+1)+e);return new Promise(e=>setTimeout(e,a))}wakeFromSleep(){var e,t;this.isSleep=!1,null===(t=this.viewer)||void 0===t||null===(e=t.model)||void 0===e||e.playEmotion("Neutral")}constructor(){this.initialized=!1,this.mainEvents=new r.ci,this.triggerMessage=!1,this.eventProcessing=!1,this.isSleep=!1,this.isPause=!1,this.isSettingOff=!1,this.isProcessingEventRunning=!1,this.isProcessingIdleRunning=!1}},N=(0,s.createContext)({amicaLife:k})},43826:function(e,t,a){"use strict";a.d(t,{p:function(){return y}});var s=a(67294),r=a(81649),n=a(70324),i=a(55532),l=a(66087),o=a(25303),c=a(47551),d=a(19427),u=a(65752);async function rvc(e,t,a,s,r,n,i,l,o,c){try{let d=await new Response(e).arrayBuffer(),m=new Blob([d],{type:"audio/wav"}),h={model_name:t,index_path:a,f0up_key:s.toString(),f0method:r,index_rate:n,filter_radius:i.toString(),resample_sr:l.toString(),rms_mix_rate:o.toString(),protect:c.toString()},p=new FormData;p.append("input_file",m);let g=new URL((0,u.vc)("rvc_url"));Object.entries(h).forEach(e=>{let[t,a]=e;g.searchParams.append(t,a)});let x=await fetch(g.toString(),{method:"POST",body:p}),v=await x.arrayBuffer();return{audio:v}}catch(e){throw console.error("Error in rvc:",e),e}}var m=a(3340);async function piper(e){try{let t=new URL((0,u.vc)("piper_url"));t.searchParams.append("text",e);let a=await fetch(t.toString()),s=await a.arrayBuffer();return{audio:s}}catch(e){throw console.error("Error in piper:",e),e}}async function elevenlabs(e,t,a){let s=(0,u.vc)("elevenlabs_apikey");if(!s)throw Error("Invalid ElevenLabs API Key");let r={text:e,model_id:(0,u.vc)("elevenlabs_model"),voice_settings:{stability:0,similarity_boost:0,style:0,use_speaker_boost:!0}},n=await fetch("https://api.elevenlabs.io/v1/text-to-speech/".concat(t,"?optimize_streaming_latency=0&output_format=mp3_44100_128"),{method:"POST",body:JSON.stringify(r),headers:{"Content-Type":"application/json",Accept:"audio/mpeg","xi-api-key":s}});if(!n.ok)throw Error("ElevenLabs API Error (".concat(n.status,")"));let i=await n.arrayBuffer();return{audio:i}}var h=a(60369),p=a(24852);async function speecht5(e,t){window.chatvrm_worker_speecht5_audiocache=null,e=e.trim().split(/(-?\d+)/).map(e=>e.match(/^-?\d+$/)?function convertNumberToWordsEN(e){e=Math.floor(e);let t=["","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"],a=e.toString(),s="";if(e<0&&(s="negative ",a=(e=Math.abs(e)).toString()),0===e)return"zero";if(e<20)return s+t[e];if(2===a.length)return s+["","","twenty","thirty","forty","fifty","sixty","seventy","eighty","ninety"][Number(a[0])]+" "+t[Number(a[1])];if(3==a.length)return"0"===a[1]&&"0"===a[2]?s+t[Number(a[0])]+" hundred":s+t[Number(a[0])]+" hundred and "+convertNumberToWordsEN(+(a[1]+a[2]));if(4===a.length){let e=+(a[1]+a[2]+a[3]);return 0===e?s+t[Number(a[0])]+" thousand":e<100?s+t[Number(a[0])]+" thousand and "+convertNumberToWordsEN(e):s+t[Number(a[0])]+" thousand "+convertNumberToWordsEN(e)}return""}(parseInt(e)):e).join(""),window.hasOwnProperty("chatvrm_worker_speecht5")||(window.chatvrm_worker_speecht5=new Worker(a.tu(new URL(a.p+a.u(934),a.b)),{type:void 0}),window.chatvrm_worker_speecht5.addEventListener("message",e=>{let t=e.data;switch(t.status){case"ready":console.log("speecht5 worker ready");break;case"progress":(0,p.I)(t.file,t.progress);break;case"done":console.log("speecht5 done: ",t.file),(0,p.I)(t.file,100);break;case"complete":console.log("speecht5 complete"),window.chatvrm_worker_speecht5_audiocache=t.data.audio}})),window.chatvrm_worker_speecht5_audiocache=null,window.chatvrm_worker_speecht5.postMessage({text:e,speaker_embeddings:t}),await new Promise(async e=>{for(console.log("speecht5 waiting for job to complete");;){if(null!==window.chatvrm_worker_speecht5_audiocache){e(null);break}await new Promise(e=>setTimeout(e,100))}});let s=new h.J;s.fromScratch(1,16e3,"32f",window.chatvrm_worker_speecht5_audiocache);let r=s.toBuffer(),n=new Blob([r],{type:"audio/wav"}),i=await n.arrayBuffer();return{audio:i}}async function openaiTTS(e){let t=(0,u.vc)("openai_tts_apikey");if(!t)throw Error("Invalid OpenAI TTS API Key");try{let a=await fetch("".concat((0,u.vc)("openai_tts_url"),"/v1/audio/speech"),{method:"POST",body:JSON.stringify({model:(0,u.vc)("openai_tts_model"),input:e,voice:(0,u.vc)("openai_tts_voice")}),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)}});if(!a.ok)throw console.error(a),Error("OpenAI TTS API Error");let s=await a.arrayBuffer();return{audio:s}}catch(e){throw console.error("ERROR",e),Error("OpenAI TTS API Error")}}async function localXTTSTTS(e){let t=(0,u.vc)("localXTTS_url").replace(/\/+$/,"").replace("/api/tts-generate","");console.log("[AllTalk] Config values:",{url:(0,u.vc)("localXTTS_url"),version:(0,u.vc)("alltalk_version"),voice:(0,u.vc)("alltalk_voice"),rvcVoice:(0,u.vc)("alltalk_rvc_voice"),rvcPitch:(0,u.vc)("alltalk_rvc_pitch"),language:(0,u.vc)("alltalk_language")});let a=new URLSearchParams({text_input:e,text_filtering:"standard",character_voice_gen:(0,u.vc)("alltalk_voice")||"female_01.wav",narrator_enabled:"false",narrator_voice_gen:(0,u.vc)("alltalk_voice")||"female_01.wav",text_not_inside:"character",language:(0,u.vc)("alltalk_language")||"en",output_file_name:"amica_output",output_file_timestamp:"true",autoplay:"false",autoplay_volume:"0.8"});if("v2"===(0,u.vc)("alltalk_version")){let e=(0,u.vc)("alltalk_rvc_voice");e&&"Disabled"!==e&&(a.append("rvccharacter_voice_gen",e),a.append("rvccharacter_pitch",(0,u.vc)("alltalk_rvc_pitch")||"0"))}try{console.log("[AllTalk] Processing text:",e),console.log("[AllTalk] Form data:",Object.fromEntries(a));let s=await fetch("".concat(t,"/api/tts-generate"),{method:"POST",body:a});if(!s.ok)throw console.error("[AllTalk] Initial request failed:",s.status,s.statusText),Error("AllTalk TTS API Error");let r=await s.json();console.log("[AllTalk] TTS Response:",r);let n="v1"===(0,u.vc)("alltalk_version")?r.output_file_url:"".concat(t).concat(r.output_file_url);console.log("[AllTalk] Generated audio URL:",n);let i=await fetch(n);if(!i.ok)throw Error("Failed to fetch audio data");let l=await i.arrayBuffer();return console.log("[AllTalk] Received audio data size:",l.byteLength),{audio:l}}catch(e){throw console.error("[AllTalk] Error:",e),Error("AllTalk TTS Error: ".concat(e.message))}}var g=a(87797),x=a(22725),v=a(93206),f=a(26281);let b=new class{initialize(e,t,a,s,r,n,i,l,o){this.amicaLife=e,this.viewer=t,this.alert=a,this.setChatLog=s,this.setUserMessage=r,this.setAssistantMessage=n,this.setShownMessage=i,this.setChatProcessing=l,this.setChatSpeaking=o,this.processTtsJobs(),this.processSpeakJobs(),this.updateAwake(),this.initialized=!0}setMessageList(e){this.messageList=e,this.currentAssistantMessage="",this.currentUserMessage="",this.setChatLog(this.messageList),this.setAssistantMessage(this.currentAssistantMessage),this.setUserMessage(this.currentAssistantMessage),this.currentStreamIdx++}async handleRvc(e){let t=(0,u.vc)("rvc_model_name"),a=(0,u.vc)("rvc_index_path"),s=parseInt((0,u.vc)("rvc_f0_upkey")),r=(0,u.vc)("rvc_f0_method"),n=(0,u.vc)("rvc_index_rate"),i=parseInt((0,u.vc)("rvc_filter_radius")),l=parseInt((0,u.vc)("rvc_resample_sr")),o=parseInt((0,u.vc)("rvc_rms_mix_rate")),c=parseInt((0,u.vc)("rvc_protect")),d=await rvc(e,t,a,s,r,n,i,l,o,c);return d.audio}idleTime(){return(0,v.TH)(this.lastAwake)}isAwake(){return!(0,v.Yi)(this.lastAwake)}updateAwake(){this.lastAwake=new Date().getTime(),(0,v.T)()}async processTtsJobs(){for(;;){do{let e=this.ttsJobs.dequeue();if(!e)break;if(console.debug("processing tts"),e.streamIdx!==this.currentStreamIdx){console.log("skipping tts for streamIdx");continue}console.time("performance_tts");let t=await this.fetchAudio(e.screenplay.talk);console.timeEnd("performance_tts"),this.speakJobs.enqueue({audioBuffer:t,screenplay:e.screenplay,streamIdx:e.streamIdx})}while(this.ttsJobs.size()>0);await (0,x.D)(50)}}async processSpeakJobs(){for(;;){do{let t=this.speakJobs.dequeue();if(!t)break;if(t.streamIdx!==this.currentStreamIdx){console.log("skipping speak for streamIdx");continue}if(console.debug("processing speak"),window.chatvrm_latency_tracker&&window.chatvrm_latency_tracker.active){let e=+new Date-window.chatvrm_latency_tracker.start;console.log("performance_latency",e),window.chatvrm_latency_tracker.active=!1}if(this.bubbleMessage("assistant",t.screenplay.text),t.audioBuffer){var e;this.setChatSpeaking(!0),await (null===(e=this.viewer.model)||void 0===e?void 0:e.speak(t.audioBuffer,t.screenplay)),this.setChatSpeaking(!1),this.isAwake()&&this.updateAwake()}}while(this.speakJobs.size()>0);await (0,x.D)(50)}}bubbleMessage(e,t){"user"===e&&(""!==this.currentUserMessage&&(this.currentUserMessage+=" "),this.currentUserMessage+=t,this.setUserMessage(this.currentUserMessage),this.setAssistantMessage(""),""!==this.currentAssistantMessage&&(this.messageList.push({role:"assistant",content:this.currentAssistantMessage}),this.currentAssistantMessage=""),this.setChatLog([...this.messageList,{role:"user",content:this.currentUserMessage}])),"assistant"===e&&(""==this.currentAssistantMessage||this.isAwake()||"true"!==(0,u.vc)("amica_life_enabled")?(this.currentAssistantMessage+=t,this.setUserMessage("")):(this.messageList.push({role:"assistant",content:this.currentAssistantMessage}),this.currentAssistantMessage=t),this.setAssistantMessage(this.currentAssistantMessage),""!==this.currentUserMessage&&(this.messageList.push({role:"user",content:this.currentUserMessage}),this.currentUserMessage=""),this.setChatLog([...this.messageList,{role:"assistant",content:this.currentAssistantMessage}])),this.setShownMessage(e),console.debug("bubbler",this.messageList)}async interrupt(){this.currentStreamIdx++;try{if(this.reader){var e,t;console.debug("cancelling"),(null===(e=this.reader)||void 0===e?void 0:e.closed)||await (null===(t=this.reader)||void 0===t?void 0:t.cancel()),console.debug("finished cancelling")}}catch(e){console.error(e.toString())}this.ttsJobs.clear(),this.speakJobs.clear()}async receiveMessageFromUser(e,t){if(null===e||""===e)return;if(console.time("performance_interrupting"),console.debug("interrupting..."),await this.interrupt(),console.timeEnd("performance_interrupting"),await (0,x.D)(0),console.debug("wait complete"),!t){var a;console.log("receiveMessageFromUser",e),null===(a=this.amicaLife)||void 0===a||a.receiveMessageFromUser(e),/\[.*?\]/.test(e)||(e="[neutral] ".concat(e)),this.updateAwake(),this.bubbleMessage("user",e)}let s=[{role:"system",content:(0,u.vc)("system_prompt")},...this.messageList,{role:"user",content:t?e:this.currentUserMessage}];await this.makeAndHandleStream(s)}async makeAndHandleStream(e){var t,a;try{this.streams.push(await this.getChatResponseStream(e))}catch(a){let e=a.toString();return console.error(e),null===(t=this.alert)||void 0===t||t.error("Failed to get chat response",e),e}if(null==this.streams[this.streams.length-1]){let e="Error: Null stream encountered.";return console.error(e),null===(a=this.alert)||void 0===a||a.error("Null stream encountered",e),e}return await this.handleChatResponseStream()}async handleChatResponseStream(){if(0===this.streams.length){console.log("no stream!");return}this.currentStreamIdx++;let e=this.currentStreamIdx;this.setChatProcessing(!0),console.time("chat stream processing");let t=this.streams[this.streams.length-1].getReader();this.readers.push(t);let a=[],s="",r="",n="",i="",l=!1,o=!1;console.time("performance_time_to_first_token"),console.time("performance_time_to_first_sentence");try{for(;;){if(this.currentStreamIdx!==e){console.log("wrong stream idx");break}let{done:c,value:d}=await t.read();if(l||(console.timeEnd("performance_time_to_first_token"),l=!0),c)break;i+=d,i=i.trimStart();let u=(0,g.F)({sentences:a,aiTextLog:s,receivedMessage:i,tag:r,rolePlay:n,callback:t=>(console.debug("enqueue tts",t),console.debug("streamIdx",e,"currentStreamIdx",this.currentStreamIdx),e!==this.currentStreamIdx)?(console.log("wrong stream idx"),!0):(this.ttsJobs.enqueue({screenplay:t[0],streamIdx:e}),o||(console.timeEnd("performance_time_to_first_sentence"),o=!0),!1)});if(a=u.sentences,s=u.aiTextLog,i=u.receivedMessage,r=u.tag,n=u.rolePlay,u.shouldBreak)break}}catch(t){let e=t.toString();this.bubbleMessage("assistant",e),console.error(e)}finally{t.closed||t.releaseLock(),console.timeEnd("chat stream processing"),e===this.currentStreamIdx&&this.setChatProcessing(!1)}return s}async fetchAudio(e){var t,a;if((t=e).message=t.message.replace(/[\u{1F600}-\u{1F64F}]/gu,""),t.message=t.message.replace(/[\u{1F300}-\u{1F5FF}]/gu,""),t.message=t.message.replace(/[\u{1F680}-\u{1F6FF}]/gu,""),t.message=t.message.replace(/[\u{1F1E0}-\u{1F1FF}]/gu,""),t.message=t.message.replace(/ :\)/gu," "),t.message=t.message.replace(/ :D/gu," "),t.message=t.message.replace(/^:\)/gu,""),t.message=t.message.replace(/^:D/gu,""),t.message=t.message.replace(/  /g," "),""===(e=t).message.trim()||"true"===(0,u.vc)("tts_muted"))return null;let s="true"===(0,u.vc)("rvc_enabled");try{switch((0,u.vc)("tts_backend")){case"none":break;case"elevenlabs":{let t=(0,u.vc)("elevenlabs_voiceid"),a=await elevenlabs(e.message,t,e.style);if(s)return await this.handleRvc(a.audio);return a.audio}case"speecht5":{let t=(0,u.vc)("speecht5_speaker_embedding_url"),a=await speecht5(e.message,t);if(s)return await this.handleRvc(a.audio);return a.audio}case"openai_tts":{let t=await openaiTTS(e.message);if(s)return await this.handleRvc(t.audio);return t.audio}case"localXTTS":{let t=await localXTTSTTS(e.message);if(s)return await this.handleRvc(t.audio);return t.audio}case"piper":{let t=await piper(e.message);if(s)return await this.handleRvc(t.audio);return t.audio}case"coquiLocal":{let t=await (0,m.F)(e.message);return t.audio}}}catch(e){console.error(e.toString()),null===(a=this.alert)||void 0===a||a.error("Failed to get TTS response",e.toString())}return null}async getChatResponseStream(e){console.debug("getChatResponseStream",e);let t=(0,u.vc)("chatbot_backend");switch(t){case"chatgpt":return(0,i.x)(e);case"llamacpp":return(0,l.h)(e);case"windowai":return(0,o.f)(e);case"ollama":return(0,c.b)(e);case"koboldai":return(0,d.L)(e);case"openrouter":return(0,f.i)(e)}return(0,n.U)(e)}async getVisionResponse(e){try{let t=(0,u.vc)("vision_backend");console.debug("vision_backend",t);let a=[{role:"system",content:(0,u.vc)("vision_system_prompt")},...this.messageList,{role:"user",content:"Describe the image as accurately as possible"}],s="";if("vision_llamacpp"===t)s=await (0,l.e)(a,e);else if("vision_ollama"===t)s=await (0,c.W)(a,e);else{console.warn("vision_backend not supported",t);return}await this.makeAndHandleStream([{role:"system",content:(0,u.vc)("system_prompt")},...this.messageList,{role:"user",content:"This is a picture I just took from my webcam (described between [[ and ]] ): [[".concat(s,"]] Please respond accordingly and as if it were just sent and as though you can see it.")}])}catch(e){var t;console.error("getVisionResponse",e.toString()),null===(t=this.alert)||void 0===t||t.error("Failed to get vision response",e.toString())}}constructor(){this.initialized=!1,this.stream=null,this.reader=null,this.streams=[],this.readers=[],this.ttsJobs=new r.ci,this.speakJobs=new r.ci,this.currentAssistantMessage="",this.currentUserMessage="",this.messageList=[],this.currentStreamIdx=0,this.lastAwake=0}},y=(0,s.createContext)({chat:b})},70324:function(e,t,a){"use strict";async function getEchoChatResponseStream(e){let t=new ReadableStream({async start(t){try{let a=e[e.length-1].content,s=a.length>0?a[a.length-1]:" ";"."!==s&&"?"!==s&&"!"!==s&&(a+="."),a.split(" ").map(e=>e+" ").forEach(e=>{t.enqueue(e)})}catch(e){t.error(e)}finally{t.close()}}});return t}a.d(t,{U:function(){return getEchoChatResponseStream}})},19427:function(e,t,a){"use strict";a.d(t,{L:function(){return getKoboldAiChatResponseStream}});var s=a(46572),r=a(65752);async function getKoboldAiChatResponseStream(e){return"true"===(0,r.vc)("koboldai_use_extra")?getExtra(e):getNormal(e)}async function getExtra(e){var t;let a=(0,s.N)(e),n=["".concat((0,r.vc)("name"),":"),..."".concat((0,r.vc)("koboldai_stop_sequence")).split("||")],i=await fetch("".concat((0,r.vc)("koboldai_url"),"/api/extra/generate/stream"),{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({prompt:a,stop_sequence:n})}),l=null===(t=i.body)||void 0===t?void 0:t.getReader();if(200!==i.status||!l)throw Error("KoboldAi chat error (".concat(i.status,")"));let o=new ReadableStream({async start(e){let t=new TextDecoder("utf-8");try{let a="";for(;;){let s;let{done:r,value:n}=await l.read();if(r)break;for(a+=t.decode(n);(s=a.indexOf("\n"))>=0;){let t=a.substring(0,s).trim();if(a=a.substring(s+1),t.startsWith("data:"))try{let a=JSON.parse(t.substring(5)),s=a.token;s&&e.enqueue(s)}catch(e){console.error("JSON parsing error:",e,"in line:",t)}}}}catch(t){console.error("Stream error:",t),e.error(t)}finally{l.releaseLock(),e.close()}},async cancel(){await (null==l?void 0:l.cancel()),l.releaseLock()}});return o}async function getNormal(e){let t=(0,s.N)(e),a=["".concat((0,r.vc)("name"),":"),..."".concat((0,r.vc)("koboldai_stop_sequence")).split("||")],n=await fetch("".concat((0,r.vc)("koboldai_url"),"/api/v1/generate"),{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({prompt:t,stop_sequence:a})}),i=await n.json();if(0===i.results.length)throw Error("KoboldAi result length 0");let l=i.results.map(e=>e.text).join(""),o=new ReadableStream({async start(e){try{l.split(" ").map(e=>e+" ").forEach(t=>{e.enqueue(t)})}catch(t){e.error(t)}finally{e.close()}}});return o}},66087:function(e,t,a){"use strict";a.d(t,{e:function(){return getLlavaCppChatResponse},h:function(){return getLlamaCppChatResponseStream}});var s=a(46572),r=a(65752);async function getLlamaCppChatResponseStream(e){var t;let a=(0,s.N)(e),n=["".concat((0,r.vc)("name"),":"),..."".concat((0,r.vc)("llamacpp_stop_sequence")).split("||")],i=await fetch("".concat((0,r.vc)("llamacpp_url"),"/completion"),{headers:{"Content-Type":"application/json",Connection:"keep-alive",Accept:"text/event-stream"},method:"POST",body:JSON.stringify({stream:!0,n_predict:400,temperature:.7,cache_prompt:!0,stop:n,prompt:a})}),l=null===(t=i.body)||void 0===t?void 0:t.getReader();if(200!==i.status||!l)throw Error("LlamaCpp chat error (".concat(i.status,")"));let o=new ReadableStream({async start(e){let t=new TextDecoder("utf-8");try{let a="",s=!0;for(;;){let{done:r,value:n}=await l.read();if(r||!s)break;let i=t.decode(n),o=i.split("data:").filter(e=>!!e&&"[DONE]"!==e.trim());for(let t of o)if(!(t.length>0)||":"!==t[0]){a+=t;try{let t=JSON.parse(a);t.stop&&(s=!1);let r=t.content;a="",r&&e.enqueue(r)}catch(e){console.error(e)}}}}catch(t){console.error(t),e.error(t)}finally{l.releaseLock(),e.close()}},async cancel(){await (null==l?void 0:l.cancel()),l.releaseLock()}});return o}async function getLlavaCppChatResponse(e,t){var a;let n=(0,s.f)(e),i=await fetch("".concat((0,r.vc)("vision_llamacpp_url"),"/completion"),{headers:{"Content-Type":"application/json",Connection:"keep-alive",Accept:"text/event-stream"},method:"POST",body:JSON.stringify({stream:!0,n_predict:400,temperature:.7,cache_prompt:!0,stop:["</s>","".concat((0,r.vc)("name"),":"),"User:"],image_data:[{data:t,id:10}],prompt:n})});if(!i.ok)throw Error("LlamaCpp llava chat error (".concat(i.status,")"));console.log("body",i.body);let l=null===(a=i.body)||void 0===a?void 0:a.getReader();if(200!==i.status||!l)throw Error("LlamaCpp vision error (".concat(i.status,")"));let o=new ReadableStream({async start(e){let t=new TextDecoder("utf-8");try{let a="",s=!0;for(;;){let{done:r,value:n}=await l.read();if(r||!s)break;let i=t.decode(n),o=i.split("data:").filter(e=>!!e&&"[DONE]"!==e.trim());for(let t of o)if(!(t.length>0)||":"!==t[0]){a+=t;try{let t=JSON.parse(a);t.stop&&(s=!1);let r=t.content;a="",r&&e.enqueue(r)}catch(e){console.error(e)}}}}catch(t){console.error(t),e.error(t)}finally{l.releaseLock(),e.close()}},async cancel(){await (null==l?void 0:l.cancel()),l.releaseLock()}}),c=await o.getReader(),d="";for(;;){let{done:e,value:t}=await c.read();if(e)break;d+=t}return d}},47551:function(e,t,a){"use strict";a.d(t,{W:function(){return getOllamaVisionChatResponse},b:function(){return getOllamaChatResponseStream}});var s=a(65752);async function getOllamaChatResponseStream(e){var t;let a=await fetch("".concat((0,s.vc)("ollama_url"),"/api/chat"),{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({model:(0,s.vc)("ollama_model"),messages:e})}),r=null===(t=a.body)||void 0===t?void 0:t.getReader();if(200!==a.status||!r)throw Error("Ollama chat error (".concat(a.status,")"));let n=new ReadableStream({async start(e){let t=new TextDecoder("utf-8");try{for(;;){let{done:a,value:s}=await r.read();if(a)break;let n=t.decode(s),i=n.trim().split("\n");for(let t of i)try{let a=JSON.parse(t),s=a.message.content;s&&e.enqueue(s)}catch(e){console.error(e)}}}catch(t){console.error(t),e.error(t)}finally{r.releaseLock(),e.close()}},async cancel(){await (null==r?void 0:r.cancel()),r.releaseLock()}});return n}async function getOllamaVisionChatResponse(e,t){let a=await fetch("".concat((0,s.vc)("vision_ollama_url"),"/api/chat"),{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({model:(0,s.vc)("vision_ollama_model"),messages:e,images:[t],stream:!1})});if(200!==a.status)throw Error("Ollama chat error (".concat(a.status,")"));let r=await a.json();return r.response}},55532:function(e,t,a){"use strict";a.d(t,{x:function(){return getOpenAiChatResponseStream}});var s=a(65752);async function getOpenAiChatResponseStream(e){var t;let a=(0,s.vc)("openai_apikey");if(!a)throw Error("Invalid OpenAI API Key");let r=await fetch("".concat((0,s.vc)("openai_url"),"/v1/chat/completions"),{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a),"HTTP-Referer":"https://amica.arbius.ai","X-Title":"Amica"},method:"POST",body:JSON.stringify({model:(0,s.vc)("openai_model"),messages:e,stream:!0,max_tokens:200})}),n=null===(t=r.body)||void 0===t?void 0:t.getReader();if(200!==r.status||!n){if(401===r.status)throw Error("Invalid OpenAI authentication");if(402===r.status)throw Error("Payment required");throw Error("OpenAI chat error (".concat(r.status,")"))}let i=new ReadableStream({async start(e){let t=new TextDecoder("utf-8");try{let a="";for(;;){let{done:s,value:r}=await n.read();if(s)break;let i=t.decode(r),l=i.split("data:").filter(e=>!!e&&"[DONE]"!==e.trim());for(let t of l)if(!(t.length>0)||":"!==t[0]){a+=t;try{let t=JSON.parse(a),s=t.choices[0].delta.content;a="",s&&e.enqueue(s)}catch(e){console.error(e)}}}}catch(t){console.error(t),e.error(t)}finally{n.releaseLock(),e.close()}},async cancel(){await (null==n?void 0:n.cancel()),n.releaseLock()}});return i}},26281:function(e,t,a){"use strict";a.d(t,{i:function(){return getOpenRouterChatResponseStream}});var s=a(65752);async function getOpenRouterChatResponseStream(e){var t,a,r,n;let i=(0,s.vc)("openrouter_apikey");if(!i)throw Error("OpenRouter API key is required");let l=null!==(a=(0,s.vc)("openrouter_url"))&&void 0!==a?a:"https://openrouter.ai/api/v1",o=null!==(r=(0,s.vc)("openrouter_model"))&&void 0!==r?r:"openai/gpt-3.5-turbo",c=await fetch("".concat(l,"/chat/completions"),{method:"POST",headers:{Authorization:"Bearer ".concat(i),"Content-Type":"application/json","HTTP-Referer":"https://amica.arbius.ai","X-Title":"Amica Chat"},body:JSON.stringify({model:o,messages:e.map(e=>{let{role:t,content:a}=e;return{role:t,content:a}}),stream:!0})}),d=null===(t=c.body)||void 0===t?void 0:t.getReader();if(!c.ok||!d){let e=await c.json();if(null===(n=e.error)||void 0===n?void 0:n.message)throw Error("OpenRouter error: ".concat(e.error.message));throw Error("OpenRouter request failed with status ".concat(c.status))}let u=new ReadableStream({async start(e){let t=new TextDecoder("utf-8");try{let a="";for(;;){let{done:s,value:r}=await d.read();if(s)break;let n=t.decode(r),i=n.split("data:").filter(e=>!!e&&"[DONE]"!==e.trim());for(let t of i)if(!(t.length>0)||":"!==t[0]){a+=t;try{let t=JSON.parse(a),s=t.choices[0].delta.content;a="",s&&e.enqueue(s)}catch(e){console.error(e)}}}}catch(t){console.error(t),e.error(t)}finally{null==d||d.releaseLock(),e.close()}},async cancel(){await (null==d?void 0:d.cancel()),null==d||d.releaseLock()}});return u}},25303:function(e,t,a){"use strict";a.d(t,{f:function(){return getWindowAiChatResponseStream}});var s=a(65752);async function getWindowAiChatResponseStream(e){let t=new ReadableStream({async start(t){try{let[a]=await window.ai.generateText({messages:e},{maxTokens:400,temperature:.7,stopSequences:["</s>","".concat((0,s.vc)("name"),":"),"User:"],onStreamResult:(e,a)=>{var s;if(null===e)throw Error("null result from window.ai");if(a)throw Error(a);let r=null===(s=e.message)||void 0===s?void 0:s.content;r&&t.enqueue(r)}})}catch(e){t.error(e)}finally{t.close()}}});return t}},3340:function(e,t,a){"use strict";a.d(t,{F:function(){return coquiLocal},P:function(){return coquiLocalVoiceIdList}});var s=a(65752);async function coquiLocal(e){let t=(0,s.vc)("coquiLocal_voiceid");if(!t)throw Error("Invalid CoquiLocal TTS Voice Id");try{let t=await fetch("".concat((0,s.vc)("coquiLocal_url"),"/api/tts"),{method:"POST",headers:{text:e,"speaker-id":(0,s.vc)("coquiLocal_voiceid")}}),a=await t.arrayBuffer();return{audio:a}}catch(e){throw console.error("Error in coquiLocal:",e),e}}async function coquiLocalVoiceIdList(){try{var e;let t=await fetch("".concat((0,s.vc)("coquiLocal_url"),"/"),{method:"GET",headers:{Accept:"application/text"}}),a=await t.text(),r=(null===(e=a.match(/value="([^"]+)" SELECTED/g))||void 0===e?void 0:e.map(e=>e.split('"')[1]))||[];return{list:r}}catch(e){throw console.error("Error in coquiLocalVoiceIdList:",e),e}}},50461:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return Home}});var s,r,n=a(85893),i=a(57729),l=a.n(i),o=a(34238),c=a.n(o),d=a(67294),u=a(41664),m=a.n(u),h=a(40414),p=a(17106),g=a(90512),x=a(67421),v=a(12291),f=a(1671),b=a(52418),y=a(48685),w=a(7112),j=a(79111),_=a(39790),k=a(75425),N=a(28771),S=a(43419),T=a(53416),C=a(65752),I=a(45417);let AssistantText=e=>{let{message:t}=e,a=(0,d.useRef)(null),[s,r]=(0,d.useState)(!1);return t=t.replace(/\[(.*?)\]/g,""),(0,d.useEffect)(()=>{var e;null===(e=a.current)||void 0===e||e.scrollIntoView({behavior:"smooth",block:"center"})}),(0,n.jsx)("div",{className:"fixed bottom-0 left-0 mb-20 w-full",children:(0,n.jsx)("div",{className:"mx-auto max-w-4xl w-full px-4 md:px-16",children:(0,n.jsx)("div",{className:"backdrop-blur-lg rounded-lg",children:(0,n.jsxs)("div",{className:"bg-white/70 rounded-lg backdrop-blur-lg shadow-lg",children:[(0,n.jsxs)("div",{className:"px-8 pr-1 py-3 bg-rose/90 rounded-t-lg text-white font-bold tracking-wider",children:[(0,n.jsx)("span",{className:"p-4 bg-pink-600/80 rounded-lg rounded-tl-none rounded-tr-none shadow-sm",children:(0,C.vc)("name").toUpperCase()}),(0,n.jsx)(I.h,{iconName:"24/FrameSize",className:"bg-transparent hover:bg-transparent active:bg-transparent disabled:bg-transparent float-right",isProcessing:!1,onClick:()=>r(!s)})]}),(0,n.jsx)("div",{className:(0,g.W)("px-8 py-4 overflow-y-auto",s?"max-h-[calc(75vh)]":"max-h-32"),children:(0,n.jsxs)("div",{className:"min-h-8 max-h-full text-gray-700 typography-16 font-bold",children:[t.replace(/\[([a-zA-Z]*?)\]/g,""),(0,n.jsx)("div",{ref:a})]})})]})})})})},SubconciousText=e=>{let{messages:t}=e,a=(0,d.useRef)(null);return(0,d.useEffect)(()=>{var e;null===(e=a.current)||void 0===e||e.scrollIntoView({behavior:"smooth",block:"center"})},[t]),(0,n.jsx)("div",{className:"fixed w-col-span-6 max-w-full h-full pb-16",children:(0,n.jsx)("div",{className:"max-h-full px-16 pt-20 pb-4 overflow-y-auto scroll-hidden",children:t.map((e,s)=>(0,n.jsx)("div",{ref:t.length-1===s?a:null,children:(0,n.jsx)(Chat,{timeStamp:e.timestamp,prompt:e.prompt.replace(/\[(.*?)\]/g,""),num:s})},s))})})};function Chat(e){let{timeStamp:t,prompt:a,num:s}=e,{t:r}=(0,x.$G)(),i=(0,d.useRef)(null);return(0,n.jsx)("div",{className:"mx-auto max-w-sm my-8",children:(0,n.jsx)("div",{className:"backdrop-blur-lg rounded-lg",children:(0,n.jsxs)("div",{className:"shadow-lg backdrop-blur-lg rounded-lg bg-white/70",children:[(0,n.jsx)("div",{className:"pr-1 bg-rose/90 rounded-t-lg text-white font-bold tracking-wider px-8 flex items-center justify-between top-0",children:(0,n.jsxs)("div",{className:"flex items-center space-x-6",children:[(0,n.jsx)("span",{className:"p-2 rounded-lg rounded-tl-none rounded-tr-none shadow-sm bg-cyan-600/80",children:(0,n.jsx)(T.Z,{className:"h-7 w-7 text-white opacity-100 text-xs","aria-hidden":"true",stroke:2})}),(0,n.jsx)("div",{className:"min-h-8 max-h-full typography-16 text-sm font-bold text-gray-500 float-right ml-2 mt-1",children:t})]})}),(0,n.jsx)("div",{className:"px-8 py-4 overflow-y-auto max-h-[calc(75vh)]",children:(0,n.jsxs)("div",{className:"min-h-8 max-h-full typography-16 font-bold text-gray-600",children:[a,(0,n.jsx)("div",{ref:i})]})})]})})})}var L=a(25652);function AddToHomescreen(){let{t:e}=(0,x.$G)(),[t,a]=function(){let[e,t]=d.useState(null);return d.useEffect(()=>{let ready=e=>{e.preventDefault(),t(e)};return window.addEventListener("beforeinstallprompt",ready),()=>{window.removeEventListener("beforeinstallprompt",ready)}},[]),[e,()=>e?e.prompt():Promise.reject(Error('Tried installing before browser sent "beforeinstallprompt" event'))]}(),[s,r]=(0,d.useState)(!1),hide=()=>{r(!1)};return(0,d.useEffect)(()=>{"true"===(0,C.vc)("show_add_to_homescreen")&&t&&r(!0)},[t]),(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("div",{"aria-live":"assertive",className:"pointer-events-none fixed inset-0 flex items-end px-4 py-6 sm:items-start sm:p-6 z-50",onClick:hide,children:(0,n.jsx)("div",{className:"flex w-full flex-col items-center space-y-4 sm:items-end",children:(0,n.jsx)(p.u,{show:s,as:d.Fragment,enter:"transform ease-out duration-300 transition",enterFrom:"translate-y-2 opacity-0 sm:translate-y-0 sm:translate-x-2",enterTo:"translate-y-0 opacity-100 sm:translate-x-0",leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,n.jsx)("div",{className:"pointer-events-auto w-full max-w-sm rounded-lg bg-white shadow-lg ring-1 ring-black ring-opacity-5",children:(0,n.jsx)("div",{className:"p-4",children:(0,n.jsxs)("div",{className:"flex items-start",children:[(0,n.jsxs)("div",{className:"ml-3 w-0 flex-1",children:[(0,n.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e("add_to_homescreen","Add Amica to Homescreen")}),(0,n.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:e("add_to_homescreen_desc","Amica can be installed locally for faster loading and less UI clutter.")}),(0,n.jsxs)("div",{className:"mt-4 flex",children:[(0,n.jsx)("button",{type:"button",onClick:async()=>{try{let e=await a();console.log(e),"accepted"===e.outcome&&(0,C.rF)("show_add_to_homescreen","false")}catch(e){console.error(e)}},className:"inline-flex items-center rounded-md bg-secondary px-2.5 py-1.5 text-sm font-semibold text-white shadow-sm hover:bg-secondary-hover focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-secondary",children:e("Accept")}),(0,n.jsx)("button",{type:"button",onClick:()=>{(0,C.rF)("show_add_to_homescreen","false"),hide()},className:"ml-3 inline-flex items-center rounded-md bg-white px-2.5 py-1.5 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50",children:e("Decline")})]})]}),(0,n.jsx)("div",{className:"ml-4 flex flex-shrink-0",children:(0,n.jsxs)("button",{type:"button",className:"inline-flex rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",onClick:()=>{r(!1)},children:[(0,n.jsx)("span",{className:"sr-only",children:e("Close")}),(0,n.jsx)(L.Z,{className:"h-5 w-5","aria-hidden":"true"})]})})]})})})})})})})}var P=a(47538),E=a(11332),A=a(74001);function Alert(){let{alert:e}=(0,d.useContext)(A.w),[t,a]=(0,d.useState)(null),[s,r]=(0,d.useState)("error");return(0,d.useEffect)(()=>{let t=setInterval(()=>{e.notifications.length>0&&(a(e.notifications[0]),r(e.notifications[0].type),setTimeout(()=>{a(null)},8e3),e.notifications.shift())},1e3);return()=>clearInterval(t)},[]),(0,n.jsx)("div",{className:"fixed w-full z-[1000] flex items-end justify-center pointer-events-none sm:items-start sm:justify-end",children:(0,n.jsx)("div",{className:"mx-auto w-80 max-w-80",children:(0,n.jsx)(p.u,{show:null!==t,as:d.Fragment,enter:"transform ease-out duration-300 transition",enterFrom:"translate-y-2 opacity-0 sm:translate-y-0 sm:translate-x-2",enterTo:"translate-y-0 opacity-100 sm:translate-x-0",leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,n.jsx)("div",{className:"pointer-events-auto w-full max-w-sm overflow-hidden rounded-lg rounded-tl-none rounded-tr-none bg-white shadow-lg ring-1 ring-black ring-opacity-5",children:(0,n.jsx)("div",{className:"p-4",children:(0,n.jsxs)("div",{className:"flex items-start",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:"error"===s?(0,n.jsx)(P.Z,{className:"h-6 w-6 text-red-400","aria-hidden":"true"}):(0,n.jsx)(E.Z,{className:"h-6 w-6 text-green-400","aria-hidden":"true"})}),(0,n.jsxs)("div",{className:"ml-3 w-0 flex-1 pt-0.5",children:[(0,n.jsx)("p",{className:"text-sm font-medium text-gray-900",children:null==t?void 0:t.title}),(0,n.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:null==t?void 0:t.message})]}),(0,n.jsx)("div",{className:"ml-4 flex flex-shrink-0",children:(0,n.jsxs)("button",{type:"button",className:"inline-flex rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",onClick:()=>{a(null)},children:[(0,n.jsx)("span",{className:"sr-only",children:"Close"}),(0,n.jsx)(L.Z,{className:"h-5 w-5","aria-hidden":"true"})]})})]})})})})})})}let UserText=e=>{let{message:t}=e,{t:a}=(0,x.$G)(),s=(0,d.useRef)(null);return t=t.replace(/\[(.*?)\]/g,""),(0,d.useEffect)(()=>{var e;null===(e=s.current)||void 0===e||e.scrollIntoView({behavior:"smooth",block:"center"})}),(0,n.jsx)("div",{className:"fixed bottom-0 left-0 mb-20 w-full",children:(0,n.jsx)("div",{className:"mx-auto max-w-4xl w-full px-4 md:px-16",children:(0,n.jsx)("div",{className:"backdrop-blur-lg rounded-lg",children:(0,n.jsxs)("div",{className:"bg-white/70 rounded-lg backdrop-blur-lg shadow-lg",children:[(0,n.jsx)("div",{className:"px-8 pr-1 py-3 bg-rose/90 rounded-t-lg text-white font-bold tracking-wider",children:(0,n.jsx)("span",{className:"p-4 bg-cyan-600/80 rounded-lg rounded-tl-none rounded-tr-none shadow-sm",children:a("YOU")})}),(0,n.jsx)("div",{className:"px-8 py-4 max-h-32 overflow-y-auto",children:(0,n.jsxs)("div",{className:"min-h-8 max-h-full typography-16 font-bold text-gray-600",children:[t.replace(/\[([a-zA-Z]*?)\]/g,""),(0,n.jsx)("div",{ref:s})]})})]})})})})};var R=a(2264),F=a.n(R),flexTextarea=e=>{let{value:t="",onChange:a}=e,s=(0,d.useRef)(null),r=(0,d.useRef)(null);return(0,d.useEffect)(()=>{let handleInput=e=>{let t=e.target.value;r.current&&(r.current.textContent=t+""),a&&a(t)},handleCompositionEnd=e=>{let t=e.target,s=t.value;r.current&&(r.current.textContent=s+""),a&&a(s)},e=s.current;if(e)return e.addEventListener("input",handleInput),e.addEventListener("compositionend",handleCompositionEnd),t&&(r.current&&(r.current.textContent=t+""),e.value=t),()=>{e.removeEventListener("input",handleInput),e.removeEventListener("compositionend",handleCompositionEnd)}},[]),(0,d.useEffect)(()=>{s.current&&(s.current.value=t),r.current&&(r.current.textContent=t+"")},[t]),(0,n.jsxs)("div",{className:F().FlexTextarea,children:[(0,n.jsx)("div",{className:F().FlexTextarea__dummy,ref:r,"aria-hidden":"true"}),(0,n.jsx)("textarea",{className:F().FlexTextarea__textarea,ref:s})]})},M=a(6558),U=a(43826),O=a(93162);let ChatLog=e=>{let{messages:t}=e,{t:a}=(0,x.$G)(),{chat:s}=(0,d.useContext)(U.p),r=(0,d.useRef)(null),handleResumeButtonClick=(e,a)=>{s.setMessageList(t.slice(0,e)),s.receiveMessageFromUser(a,!1)},i=(0,d.useRef)(null),l=(0,d.useCallback)(()=>{var e;null===(e=i.current)||void 0===e||e.click()},[]),o=(0,d.useCallback)(e=>{let t=e.target.files;if(!t)return;let a=t[0];if(!a)return;let r=new FileReader;r.onload=e=>{var t;let a=null===(t=e.target)||void 0===t?void 0:t.result,r=a.split("\n"),n=r.map(e=>{let t=e.match(/^(user|assistant)\s*:\s*(.*)$/);return t?{role:t[1],content:t[2]}:null}).filter(Boolean);try{if(n.length>0){let e=n[n.length-1];s.setMessageList(n.slice(0,n.length-1)),"user"===e.role?s.receiveMessageFromUser(e.content,!1):s.bubbleMessage(e.role,e.content)}console.error("Please attach the correct file format.")}catch(e){console.error(e.toString())}},r.readAsText(a),e.target.value=""},[s]),exportMessagesToTxt=e=>{let t=new Blob([e.map(e=>"".concat(e.role," : ").concat(e.content)).join("\n\n")],{type:"text/plain"});(0,O.saveAs)(t,"chat_log.txt")};return(0,d.useEffect)(()=>{var e;null===(e=r.current)||void 0===e||e.scrollIntoView({behavior:"auto",block:"center"})},[]),(0,d.useEffect)(()=>{var e;null===(e=r.current)||void 0===e||e.scrollIntoView({behavior:"smooth",block:"center"})},[t]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"absolute left-12 top-4 z-10",children:[(0,n.jsx)(I.h,{iconName:"24/ReloadLoop",label:a("Restart"),isProcessing:!1,className:"bg-slate-600 hover:bg-slate-500 active:bg-slate-500 shadow-xl",onClick:()=>{s.setMessageList([])}}),(0,n.jsx)(I.h,{iconName:"24/UploadAlt",label:a("Load Chat"),isProcessing:!1,className:"bg-slate-600 hover:bg-slate-500 active:bg-slate-500 shadow-xl",onClick:l}),(0,n.jsx)(I.h,{iconName:"24/Save",label:a("Save"),isProcessing:!1,className:"bg-slate-600 hover:bg-slate-500 active:bg-slate-500 shadow-xl",onClick:()=>exportMessagesToTxt(t)})]}),(0,n.jsx)("div",{className:"fixed w-col-span-6 max-w-full h-full pb-16",children:(0,n.jsx)("div",{className:"max-h-full px-16 pt-20 pb-4 overflow-y-auto scroll-hidden",children:t.map((e,a)=>(0,n.jsx)("div",{ref:t.length-1===a?r:null,children:(0,n.jsx)(chatLog_Chat,{role:e.role,message:e.content.replace(/\[(.*?)\]/g,""),num:a,onClickResumeButton:handleResumeButtonClick})},a))})}),(0,n.jsx)("input",{type:"file",accept:".txt",ref:i,onChange:o,className:"hidden"})]})};function chatLog_Chat(e){let{role:t,message:a,num:s,onClickResumeButton:r}=e,{t:i}=(0,x.$G)();return(0,n.jsxs)("div",{className:(0,g.W)("mx-auto max-w-sm my-8","assistant"===t?"pr-10 sm:pr-20":"pl-10 sm:pl-20"),children:[(0,n.jsxs)("div",{className:(0,g.W)("px-8 py-2 rounded-t-lg font-bold tracking-wider flex justify-between shadow-inner backdrop-blur-lg","assistant"===t?"bg-pink-600/80":"bg-cyan-600/80"),children:[(0,n.jsxs)("div",{className:"text-bold text-white",children:["assistant"===t&&(0,C.vc)("name").toUpperCase(),"user"===t&&i("YOU")]}),(0,n.jsx)("button",{className:"text-right",onClick:()=>{r(s,a)},children:"user"===t&&(0,n.jsx)("div",{className:"ml-16 p-1 rounded-full",children:(0,n.jsx)(M.Z,{className:"h-5 w-5 hover:animate-spin text-white","aria-hidden":"true"})})})]}),(0,n.jsx)("div",{className:"px-4 py-2 bg-white/80 backdrop-blur-lg rounded-b-lg shadow-sm",children:(0,n.jsx)("div",{className:"typography-16 font-M_PLUS_2 font-bold text-gray-800",children:"assistant"===t?(0,n.jsx)("div",{children:a}):(0,n.jsx)(flexTextarea,{value:a})})})]})}var V=a(54156),B=a(89537);let VrmData=class VrmData{hashEquals(e){return this.hash==e}getHash(){return this.hash}constructor(e,t,a,s="web"){this.url=t,this.thumbUrl=null!=a?a:"",this.hash=e,this.saveType=s}};var W=a(50929),Z=a(20308),D=a(35118),q=a(67608);(s=r||(r={}))[s.addItem=0]="addItem",s[s.updateVrmThumb=1]="updateVrmThumb",s[s.setVrmList=2]="setVrmList",s[s.loadFromLocalStorage=3]="loadFromLocalStorage";let vrmStoreReducer=(e,t)=>{let a=e;switch(t.type){case 0:t.itemFile&&t.callback&&(a=addItem(e,t.itemFile,t.callback));break;case 1:a=updateVrmThumb(e,t);case 2:t.vrmList&&t.vrmList.length&&(a=t.vrmList);case 3:t.vrmList&&t.callback&&(a=LoadFromLocalStorage(t))}return a},addItem=(e,t,a)=>{let s=e,r=new Blob([t],{type:"application/octet-stream"}),n=window.URL.createObjectURL(r);return(0,q.R)(r).then(e=>{let t=(0,Z.un)(e);-1==s.findIndex(e=>e.hashEquals(t))&&(s=[...s,new VrmData(t,n,"/vrm/thumb-placeholder.jpg","local")],D.Z.addItem(t,"local",e),a({url:n,vrmList:s,hash:t}))}),e},updateVrmThumb=(e,t)=>{if(!(t.url&&t.thumbBlob&&t.vrmList))return e;let a=Array(...t.vrmList),s=a.find(e=>e.url==t.url),r=window.URL.createObjectURL(t.thumbBlob);return s instanceof VrmData&&(s.thumbUrl=r,new FileReader().readAsDataURL(t.thumbBlob),(0,q.R)(t.thumbBlob).then(e=>{D.Z.updateItemThumb(s.getHash(),e),t.callback&&t.callback(a)})),e},LoadFromLocalStorage=e=>(D.Z.getItems().then(VrmDataArrayFromVrmDbModelArray).then(t=>{let a=[];return e.vrmList&&(a=e.vrmList),a.concat(t).filter((e,t,a)=>t==a.findIndex(t=>t.getHash()==e.getHash()))}).then(t=>{e.callback&&t&&e.callback(t)}),e.vrmList||[]),VrmDataArrayFromVrmDbModelArray=async e=>{let t=e.map(e=>VrmDbModelToVrmData(e));return Promise.all(t).then(e=>e)},VrmDbModelToVrmData=async e=>{let t,a;if("local"==e.saveType){let t=await (0,q.L)(e.vrmData);a=window.URL.createObjectURL(t)}else a=e.vrmUrl;if(e.thumbData&&e.thumbData.length){let a=await (0,q.L)(e.thumbData);t=window.URL.createObjectURL(a)}else t="/vrm/thumb-placeholder.jpg";return new Promise((s,r)=>{s(new VrmData(e.hash,a,t,e.saveType))})},z=W.P3.map(e=>new VrmData(e,e,"".concat((0,Z.MY)(e),".jpg"),"web")),G=(0,d.createContext)({getCurrentVrm:()=>{},vrmList:z,vrmListAddFile:()=>{},isLoadingVrmList:!1,setIsLoadingVrmList:()=>{}}),VrmStoreProvider=e=>{let{children:t}=e,[a,s]=(0,d.useState)(!0),[i,l]=(0,d.useReducer)(vrmStoreReducer,z);return(0,d.useEffect)(()=>{l({type:r.loadFromLocalStorage,vrmList:z,callback:e=>{l({type:r.setVrmList,vrmList:e}),s(!1)}})},[]),(0,n.jsx)(G.Provider,{value:{getCurrentVrm:()=>"local"==(0,C.vc)("vrm_save_type")?i.find(e=>e.getHash()==(0,C.vc)("vrm_hash")):i.find(e=>e.url==(0,C.vc)("vrm_url")),vrmList:i,vrmListAddFile:(e,t)=>{l({type:r.addItem,itemFile:e,callback:e=>{t.loadVrm(e.url).then(()=>new Promise(e=>setTimeout(e,300))).then(()=>{(0,C.rF)("vrm_url",e.url),(0,C.rF)("vrm_hash",e.hash),(0,C.rF)("vrm_save_type","local"),t.getScreenshotBlob(t=>{t&&l({type:r.updateVrmThumb,url:e.url,thumbBlob:t,vrmList:e.vrmList,callback:e=>{l({type:r.setVrmList,vrmList:e})}})})})}})},isLoadingVrmList:a,setIsLoadingVrmList:s},children:t})},useVrmStoreContext=()=>{let e=(0,d.useContext)(G);if(!e)throw Error("useVrmStoreContext must be used inside the VrmStoreProvider");return e};var $=a(40577),K=a(78948);function VrmViewer(e){let{chatMode:t}=e,{chat:a}=(0,d.useContext)(U.p),{viewer:s}=(0,d.useContext)(V.Z),{getCurrentVrm:r,vrmList:i,vrmListAddFile:l,isLoadingVrmList:o}=useVrmStoreContext(),[c,u]=(0,d.useState)(!0),[m,h]=(0,d.useState)(!1),p="local"==(0,C.vc)("vrm_save_type");s.resizeChatMode(t),window.addEventListener("resize",()=>{s.resizeChatMode(t)});let x=(0,d.useCallback)(e=>{!e||p&&o||(s.setup(e),new Promise(async(e,t)=>{try{let t=r();t?(await s.loadVrm((0,B.Q)(t.url)),e(!0)):(u(!0),e(!1))}catch(e){t(e)}}).then(e=>{e&&(console.log("vrm loaded"),h(!1),u(!1),(0,$.Z)()&&(0,K.dw)("close_splashscreen"))}).catch(e=>{console.error("vrm loading error",e),h(!0),u(!1),(0,$.Z)()&&(0,K.dw)("close_splashscreen")}),e.addEventListener("dragover",function(e){e.preventDefault()}),e.addEventListener("drop",function(e){var t;e.preventDefault();let a=null===(t=e.dataTransfer)||void 0===t?void 0:t.files;if(!a)return;let r=a[0];if(!r)return;let n=r.name.split(".").pop();"vrm"===n&&l(r,s)}))},[0>i.findIndex(e=>{var t;return e.hashEquals((null===(t=r())||void 0===t?void 0:t.getHash())||"")}),s]);return(0,n.jsxs)("div",{className:(0,g.Z)("fixed top-0 left-0 w-full h-full z-1",t?"top-[50%] left-[65%]":"top-0 left-0"),children:[(0,n.jsx)("canvas",{ref:x,className:"h-full w-full"}),c&&(0,n.jsx)("div",{className:"absolute top-0 left-0 w-full h-full bg-black bg-opacity-50 flex justify-center items-center",children:(0,n.jsx)("div",{className:"text-white text-2xl",children:"Loading..."})}),m&&(0,n.jsx)("div",{className:"absolute top-0 left-0 w-full h-full bg-black bg-opacity-50 flex justify-center items-center",children:(0,n.jsx)("div",{className:"text-white text-2xl",children:"Error loading VRM model..."})})]})}var H=a(5152),J=a.n(H);let Y=J()(()=>Promise.all([a.e(8770),a.e(226),a.e(408)]).then(a.bind(a,90408)),{loadableGenerated:{webpack:()=>[90408]},ssr:!1}),MessageInputContainer=e=>{let{isChatProcessing:t}=e,[a,s]=(0,d.useState)("");return(0,d.useEffect)(()=>{t||s("")},[t]),(0,n.jsx)(Y,{userMessage:a,setUserMessage:s,isChatProcessing:t,onChangeUserMessage:e=>s(e.target.value)})},Introduction=e=>{let{open:t}=e,[a,s]=(0,d.useState)(t),{t:r}=(0,x.$G)();return a?(0,n.jsx)("div",{className:"absolute z-40 h-full w-full bg-black/30 mx-auto sm:px-24 lg:px-32 font-M_PLUS_2",children:(0,n.jsxs)("div",{className:"mx-auto max-h-full overflow-auto rounded-lg bg-white/40 p-4 backdrop-blur-lg shadow-lg",children:[(0,n.jsxs)("div",{className:"my-4",children:[(0,n.jsx)("div",{className:"my-8 font-bold text-xl",children:r("Welcome to Amica")}),(0,n.jsx)("p",{children:r("amica_intro","\n            Amica is an open source chatbot interface that provides emotion, vision, animations, self triggered actions, text to speech, and speech to text capabilities.\n            \n            It is designed to be able to be attached to any AI model.\n            \n            It can be used with any VRM model and is very customizable.\n            \n            You can even run Amica on your own computer without an internet connection, or on your phone.\n\n            On launch Amica uses our demo chatbot and TTS server. It may take time to load the first message you send.\n          ")})]}),(0,n.jsxs)("div",{className:"my-4",children:[(0,n.jsx)("div",{className:"my-8 font-bold typography-20",children:r("Setup")}),(0,n.jsxs)("p",{children:[r("amica_setup","\n            Click on the top left of the screen to open settings.\n            \n            You can change the voice, character system prompt, share/load/save and attach to different backends or in-browser models. \n            \n            Please check our docs for more detailed configuration instructions on docs.heyamica.com\n          ")," ",(0,n.jsx)("a",{href:"https://docs.heyamica.com",target:"_blank",className:"text-cyan-500",children:r("Read the full documentation here.")})]})]}),(0,n.jsxs)("div",{className:"my-8 flex space-x-4",children:[(0,n.jsx)("button",{onClick:()=>{(0,C.rF)("show_introduction","false"),s(!1)},className:"inline-flex items-center rounded-md bg-secondary px-2.5 py-1.5 text-sm font-semibold text-white shadow-sm hover:bg-secondary-hover focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-secondary",children:r("dont_show_again","Don't show again")}),(0,n.jsx)("button",{onClick:()=>{s(!1)},className:"ml-3 inline-flex items-center rounded-md bg-white px-2.5 py-1.5 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50",children:r("Close")})]})]})}):null};function LoadingProgress(){window.chatvrm_loading_progress||(window.chatvrm_loading_progress={},window.chatvrm_loading_progress_cnt=0);let[e,t]=(0,d.useState)([]),[a,s]=(0,d.useState)(0);return(0,d.useEffect)(()=>{setInterval(()=>{{let e=window.chatvrm_loading_progress,r=window.chatvrm_loading_progress_cnt;a!==r&&(t(Object.entries(e).map(e=>{let[t,a]=e;return{file:t,progress:a}})),s(r))}},100)},[]),(0,n.jsxs)("div",{className:"absolute top-16 right-0 mt-4 pt-16 pr-2 w-30 text-white text-xs z-20 text-right",children:[e.length>0&&(0,n.jsx)("div",{children:"[loading files]"}),e.map(e=>(0,n.jsxs)("div",{children:[e.file,": ",(100*e.progress|0)/100,"%"]},e.file))]})}var X=a(46134);function useKeyboardShortcut(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];(0,d.useEffect)(()=>{let handleKey=s=>{s.key===e&&s.ctrlKey===a&&t()};return window.addEventListener("keydown",handleKey),()=>{window.removeEventListener("keydown",handleKey)}},[])}function SwitchToggle(e){let{enabled:t,set:a}=e;return(0,n.jsxs)(X.r,{className:"group ml-1 relative inline-flex h-5 w-10 flex-shrink-0 cursor-pointer items-center justify-center rounded-full focus:outline-none focus:ring-0",checked:t,onChange:a,children:[(0,n.jsx)("span",{className:"sr-only",children:"Use setting"}),(0,n.jsx)("span",{"aria-hidden":"true",className:"pointer-events-none absolute h-full w-full rounded-md"}),(0,n.jsx)("span",{"aria-hidden":"true",className:(0,g.W)(t?"bg-indigo-200":"bg-gray-200","pointer-events-none absolute mx-auto h-4 w-9 rounded-full transition-colors duration-200 ease-in-out")}),(0,n.jsx)("span",{"aria-hidden":"true",className:(0,g.W)(t?"translate-x-5":"translate-x-0","pointer-events-none absolute left-0 inline-block h-5 w-5 transform rounded-full border border-gray-200 bg-white shadow ring-0 transition-transform duration-200 ease-in-out")})]})}function DebugPane(e){let{onClickClose:t}=e,[a,s]=(0,d.useState)(!1),[r,i]=(0,d.useState)(!0),[l,o]=(0,d.useState)(!0),[c,u]=(0,d.useState)(!0),m=(0,d.useRef)(null);return useKeyboardShortcut("Escape",t),(0,d.useEffect)(()=>{var e;null===(e=m.current)||void 0===e||e.scrollIntoView({behavior:"auto",block:"center"})},[]),(0,n.jsx)("div",{className:"fixed bg-white/95 w-full h-full top-0 left-0 z-20",children:(0,n.jsxs)("div",{className:"fixed top-0 left-0 w-full max-h-full text-black text-xs text-left z-20",children:[(0,n.jsxs)("div",{className:"p-2 bg-white",children:[(0,n.jsx)(I.h,{iconName:"24/Close",isProcessing:!1,className:"bg-secondary hover:bg-secondary-hover active:bg-secondary-active",onClick:t}),(0,n.jsx)(I.h,{iconName:"24/Description",isProcessing:!1,className:"bg-primary hover:bg-primary-hover active:bg-primary-active ml-4",onClick:function(){navigator.clipboard.writeText(JSON.stringify(window.error_handler_logs))}}),(0,n.jsxs)("div",{className:"inline-block ml-2 items-center",children:[(0,n.jsxs)("span",{className:"px-1",children:[(0,n.jsx)("span",{className:"text-xs text-gray-500",children:"llm: "}),(0,n.jsx)("span",{className:"text-xs text-gray-400",children:(0,C.vc)("chatbot_backend")})]}),(0,n.jsxs)("span",{className:"px-1",children:[(0,n.jsx)("span",{className:"text-xs text-gray-500",children:"tts: "}),(0,n.jsx)("span",{className:"text-xs text-gray-400",children:(0,C.vc)("tts_backend")})]}),(0,n.jsxs)("span",{className:"px-1",children:[(0,n.jsx)("span",{className:"text-xs text-gray-500",children:"stt: "}),(0,n.jsx)("span",{className:"text-xs text-gray-400",children:(0,C.vc)("stt_backend")})]}),(0,n.jsxs)("span",{className:"px-1",children:[(0,n.jsx)("span",{className:"text-xs text-gray-500",children:"bid: "}),(0,n.jsx)("span",{className:"text-xs text-gray-400",children:"LIj0eaVwWXkX3eKv2_v7T"})]})]})]}),(0,n.jsx)("div",{className:"p-2 bg-gray-50",children:(0,n.jsxs)("span",{className:"ml-2",children:[(0,n.jsxs)("span",{className:"mx-1 inline-flex items-center rounded-md bg-gray-50 px-2 py-1 text-xs font-medium text-gray-600 ring-1 ring-inset ring-gray-500/10",children:["debug",(0,n.jsx)(SwitchToggle,{enabled:a,set:s})]}),(0,n.jsxs)("span",{className:"mx-1 inline-flex items-center rounded-md bg-green-100 px-2 py-1 text-xs font-medium text-green-700 ring-1 ring-inset ring-green-600/20",children:["info",(0,n.jsx)(SwitchToggle,{enabled:r,set:i})]}),(0,n.jsxs)("span",{className:"mx-1 inline-flex items-center rounded-md bg-yellow-50 px-2 py-1 text-xs font-medium text-yellow-800 ring-1 ring-inset ring-yellow-600/20",children:["warn",(0,n.jsx)(SwitchToggle,{enabled:l,set:o})]}),(0,n.jsxs)("span",{className:"mx-1 inline-flex items-center rounded-md bg-red-50 px-2 py-1 text-xs font-medium text-red-700 ring-1 ring-inset ring-red-600/10",children:["error",(0,n.jsx)(SwitchToggle,{enabled:c,set:u})]})]})}),(0,n.jsxs)("div",{className:"relative w-full max-h-screen overflow-y-scroll inline-block px-2 md:px-8",children:[window.error_handler_logs.slice(-100).filter(e=>("debug"!==e.type||!!a)&&("info"!==e.type&&"log"!==e.type||!!r)&&("warn"!==e.type||!!l)&&("error"!==e.type||!!c)).map((e,t)=>(0,n.jsxs)("div",{className:(0,g.W)("my-0.5","error"===e.type?"bg-red-50":"bg-gray-50"),children:["debug"===e.type&&(0,n.jsx)("span",{className:"inline-flex items-center rounded-md bg-gray-50 px-2 py-1 text-xs font-medium text-gray-600 ring-1 ring-inset ring-gray-500/10 font-mono w-12",children:"debug"}),("info"===e.type||"log"===e.type)&&(0,n.jsx)("span",{className:"inline-flex items-center rounded-md bg-green-100 px-2 py-1 text-xs font-medium text-green-700 ring-1 ring-inset ring-green-600/20 font-mono w-12",children:"info"}),"warn"===e.type&&(0,n.jsx)("span",{className:"inline-flex items-center rounded-md bg-yellow-50 px-2 py-1 text-xs font-medium text-yellow-800 ring-1 ring-inset ring-yellow-600/20 font-mono w-12",children:"warn"}),"error"===e.type&&(0,n.jsx)("span",{className:"inline-flex items-center rounded-md bg-red-50 px-2 py-1 text-xs font-medium text-red-700 ring-1 ring-inset ring-red-600/10 font-mono w-12",children:"error"}),(0,n.jsx)("small",{className:"text-gray-400 px-1 font-mono",children:e.ts/1e3|0}),(0,n.jsx)("span",{className:"text-gray-700 text-md",children:[...e.arguments].map(e=>"object"==typeof e?JSON.stringify(e):e).join(" ")})]},e.ts+t)),(0,n.jsx)("div",{ref:m,className:"my-20"}),(0,n.jsx)("div",{className:"my-40"})]})]})})}var Q=a(89618),ee=a(17524),et=a(73527),ea=a(10050);let TextButton=e=>(0,n.jsx)("button",{...e,className:"px-4 py-2 text-white font-bold bg-primary hover:bg-primary-hover active:bg-primary-press-press disabled:bg-primary-disabled rounded-lg ".concat(e.className),children:e.children});function MenuPage(e){let{keys:t,menuClick:a}=e,{t:s}=(0,x.$G)(),r=(0,Z.EO)(t);return(0,n.jsx)("ul",{role:"list",className:"divide-y divide-black/5 bg-white rounded-lg shadow-lg",children:r.map(e=>(0,n.jsxs)("li",{className:"relative flex items-center space-x-4 py-4 cursor-pointer rounded-lg hover:bg-gray-50 p-4 transition-all",onClick:()=>{a(e)},children:[(0,n.jsx)("div",{className:"min-w-0 flex-auto",children:(0,n.jsx)("div",{className:"flex items-center gap-x-3",children:(0,n.jsx)("h2",{className:"min-w-0 text-sm font-semibold leading-6",children:(0,n.jsxs)("span",{className:(0,g.W)("whitespace-nowrap flex w-0 flex-1 gap-x-2 items-center",e.className),children:[e.icon,s(e.label)]})})})}),(0,n.jsx)(ee.Z,{className:"h-5 w-5 flex-none text-gray-400","aria-hidden":"true"})]},e.key))})}function ResetSettingsPage(){let{t:e}=(0,x.$G)();return(0,n.jsx)(Z.pv,{title:e("Reset Settings"),description:"Reset all settings to default. This will reload the page. You will lose any unsaved changes.",children:(0,n.jsx)("ul",{role:"list",className:"divide-y divide-gray-100 max-w-xs",children:(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:"",children:(0,n.jsx)(I.h,{iconName:"24/Error",isProcessing:!1,label:e("Reset All Settings"),onClick:()=>{(0,C.Ih)(),window.location.reload()},className:"mx-4 text-xs bg-secondary hover:bg-secondary-hover active:bg-secondary-active"})})})})})}let GitHubLink=()=>(0,n.jsx)("a",{draggable:!1,href:"https://github.com/semperai/amica",rel:"noopener noreferrer",target:"_blank",children:(0,n.jsxs)("div",{className:"py-2 px-2 rounded-lg bg-[#1F2328] hover:bg-[#33383E] active:bg-[565A60] inline-flex",children:[(0,n.jsx)("img",{alt:"https://github.com/semperai/amica",height:24,width:24,src:(0,B.Q)("/github-mark-white.svg")}),(0,n.jsx)("div",{className:"mx-2 text-white font-bold",children:"Open Source"})]})});function CommunityPage(){let{t:e}=(0,x.$G)();return(0,n.jsx)(Z.pv,{title:e("Community"),description:e("community_desc","Join the Amica community to connect with others exploring this technology."),children:(0,n.jsxs)("ul",{role:"list",className:"divide-y divide-gray-100 max-w-xs",children:[(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)("a",{href:"https://t.me/arbius_ai",target:"_blank",className:"rounded bg-indigo-600 px-2 py-1 text-lg font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600",children:e("Telegram")})}),(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)("a",{href:"https://twitter.com/arbius_ai",target:"_blank",className:"rounded bg-indigo-600 px-2 py-1 text-lg font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600",children:e("Twitter")})}),(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)("a",{href:"https://discord.gg/SVtjU4d9jB",target:"_blank",className:"rounded bg-indigo-600 px-2 py-1 text-lg font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600",children:e("Discord")})}),(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(GitHubLink,{})}),(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)("a",{href:"https://docs.heyamica.com",target:"_blank",className:"rounded bg-emerald-600 px-2 py-1 text-lg font-semibold text-white shadow-sm hover:bg-emerald-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-600",children:e("Documentation")})})]})})}function BackgroundImgPage(e){let{bgUrl:t,setBgUrl:a,setSettingsUpdated:s,handleClickOpenBgImgFile:r}=e,{t:i}=(0,x.$G)();return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"rounded-lg shadow-lg bg-white flex flex-wrap justify-center space-x-4 space-y-4 p-4",children:W.t4.map(e=>(0,n.jsx)("button",{onClick:()=>{document.body.style.backgroundImage="url(".concat(e,")"),(0,C.rF)("bg_color",""),(0,C.rF)("youtube_videoid",""),(0,C.rF)("bg_url",e),a(e),s(!0)},className:(0,g.W)("mx-4 py-2 rounded-4 transition-all bg-gray-100 hover:bg-white active:bg-gray-100 rounded-xl",t===e?"opacity-100 shadow-md":"opacity-60 hover:opacity-100"),children:(0,n.jsx)("img",{src:"".concat((0,Z.MY)(e)),alt:e,width:"160",height:"93",className:"m-0 rounded-md mx-4 p-0 shadow-sm shadow-black hover:shadow-md hover:shadow-black rounded-4 transition-all bg-gray-100 hover:bg-white active:bg-gray-100",onError:t=>{t.currentTarget.onerror=null,t.currentTarget.src=e}})},e))}),(0,n.jsx)(TextButton,{className:"rounded-t-none text-lg ml-4 px-8 shadow-lg bg-secondary hover:bg-secondary-hover active:bg-secondary-active",onClick:r,children:i("Load image")})]})}let SwitchBox=e=>{let{value:t,label:a,onChange:s,disabled:r=!1,...i}=e,[l,o]=(0,d.useState)(t);return(0,d.useEffect)(()=>{o(t)},[t]),(0,n.jsxs)(X.r.Group,{as:"div",className:"flex items-center",children:[(0,n.jsxs)(X.r,{checked:l,onChange:e=>{r||(o(e),s(e))},className:(0,g.W)(r?"bg-gray-300 cursor-not-allowed":l?"bg-indigo-600":"bg-gray-200","relative ml-2 inline-flex h-6 w-11 flex-shrink-0 rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none",r&&"pointer-events-none"),disabled:r,...i,children:[(0,n.jsx)("span",{className:"sr-only",children:"Use setting"}),(0,n.jsxs)("span",{className:(0,g.W)(l?"translate-x-5":"translate-x-0","pointer-events-none relative inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"),children:[(0,n.jsx)("span",{className:(0,g.W)(l?"opacity-0 duration-100 ease-out":"opacity-100 duration-200 ease-in","absolute inset-0 flex h-full w-full items-center justify-center transition-opacity"),"aria-hidden":"true",children:(0,n.jsx)("svg",{className:"h-3 w-3 text-gray-400",fill:"none",viewBox:"0 0 12 12",children:(0,n.jsx)("path",{d:"M4 8l2-2m0 0l2-2M6 6L4 4m2 2l2 2",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"})})}),(0,n.jsx)("span",{className:(0,g.W)(l?"opacity-100 duration-200 ease-in":"opacity-0 duration-100 ease-out","absolute inset-0 flex h-full w-full items-center justify-center transition-opacity"),"aria-hidden":"true",children:(0,n.jsx)("svg",{className:"h-3 w-3 text-indigo-600",fill:"currentColor",viewBox:"0 0 12 12",children:(0,n.jsx)("path",{d:"M3.707 5.293a1 1 0 00-1.414 1.414l1.414-1.414zm1.414 2l-.707.707a1 1 0 001.414 0L5 8zm4.707-3.293a1 1 0 00-1.414-1.414l1.414 1.414zm-7.414 2l2 2 1.414-1.414-2-2-1.414 1.414zm3.414 2l4-4-1.414-1.414-4 4 1.414 1.414z"})})})]})]}),(0,n.jsx)(X.r.Label,{as:"span",className:"ml-3 text-sm",children:(0,n.jsx)("span",{className:"font-medium text-gray-900 whitespace-nowrap",children:a})})]})},VerticalSwitchBox=e=>{let{value:t,label:a,onChange:s,...r}=e,[i,l]=(0,d.useState)(t);return(0,d.useEffect)(()=>{l(t)},[t]),(0,n.jsxs)(X.r.Group,{as:"div",className:"flex flex-col items-center space-y-3",children:[(0,n.jsxs)(X.r,{checked:i,onChange:e=>{l(e),s(e)},className:(0,g.W)(i?"bg-gray-400":"bg-gray-200","relative inline-flex h-8 w-4 items-center rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-gray-200 focus:ring-offset-2"),...r,children:[(0,n.jsx)("span",{className:"sr-only",children:a}),(0,n.jsxs)("span",{className:(0,g.W)(i?"-translate-y-2":"translate-y-2","inline-block h-3 w-3 transform rounded-full bg-white shadow ring-0 transition-transform duration-200 ease-in-out"),children:[(0,n.jsx)("span",{className:(0,g.W)(i?"opacity-0":"opacity-100","absolute inset-0 flex h-full w-full items-center justify-center transition-opacity duration-200"),"aria-hidden":"true",children:(0,n.jsx)("svg",{className:"h-3 w-3 text-gray-400",fill:"none",viewBox:"0 0 12 12",children:(0,n.jsx)("path",{d:"M4 8l2-2m0 0l2-2M6 6L4 4m2 2l2 2",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"})})}),(0,n.jsx)("span",{className:(0,g.W)(i?"opacity-100":"opacity-0","absolute inset-0 flex h-full w-full items-center justify-center transition-opacity duration-200"),"aria-hidden":"true",children:(0,n.jsx)("svg",{className:"h-3 w-3 text-gray-600",fill:"currentColor",viewBox:"0 0 12 12",children:(0,n.jsx)("path",{d:"M3.707 5.293a1 1 0 00-1.414 1.414l1.414-1.414zM5 8l-.707.707a1 1 0 001.414 0L5 8zm4.707-3.293a1 1 0 00-1.414-1.414l1.414 1.414zm-7.414 2l2 2 1.414-1.414-2-2-1.414 1.414zm3.414 2l4-4-1.414-1.414-4 4 1.414 1.414z"})})})]})]}),(0,n.jsx)(X.r.Label,{as:"span",className:"text-sm font-medium text-gray-900",children:a})]})};function BackgroundColorPage(e){let{bgColor:t,setBgColor:a,setSettingsUpdated:s}=e,{t:r}=(0,x.$G)();return(0,n.jsx)(Z.pv,{title:r("Background Color"),description:r("bg_color_desc","Configure the background color. This overrides background image."),children:(0,n.jsx)("ul",{role:"list",className:"divide-y divide-gray-100 max-w-xs",children:(0,n.jsxs)("li",{className:"py-4",children:[""===t&&(0,n.jsx)("p",{className:"text-xs text-gray-500",children:r("no_bg_color","No background color set. Click the box below.")}),(0,n.jsxs)(Z.p7,{label:r("Color"),children:[(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("input",{className:"block bg-white border-0 outline-none focus:ring-0 focus:border-gray-300 rounded-md shadow-sm w-20",type:"color",value:t,onChange:e=>{document.body.style.backgroundImage="none",document.body.style.backgroundColor=e.target.value,(0,C.rF)("youtube_videoid",""),(0,C.rF)("bg_url",""),(0,C.rF)("bg_color",e.target.value),a(e.target.value),s(!0)}}),(0,n.jsx)(SwitchBox,{value:"transparent"===t,label:"Transparent",onChange:e=>{document.body.style.backgroundImage="none",document.body.style.backgroundColor=e?"transparent":(0,C.vc)("bg_color"),(0,C.rF)("youtube_videoid",""),(0,C.rF)("bg_url",""),(0,C.rF)("bg_color",e?"transparent":(0,C.vc)("bg_color")),a(e?"transparent":(0,C.vc)("bg_color")),s(!0)}})]}),t!==(0,C.u_)("bg_color")&&(0,n.jsx)("p",{className:"mt-2",children:(0,n.jsx)(Z.Su,{onClick:()=>{document.body.style.backgroundImage="none",document.body.style.backgroundColor=(0,C.u_)("bg_color"),a((0,C.u_)("bg_color")),(0,C.rF)("bg_color",(0,C.u_)("bg_color")),s(!0)}})})]})]})})})}let TextInput=e=>{let{value:t,onChange:a,readOnly:s,...r}=e;return(0,n.jsx)("input",{className:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-1 focus:ring-inset focus:ring-gray-400 sm:text-sm sm:leading-6",type:"text",value:t,onChange:a,readOnly:s,...r})};function BackgroundVideoPage(e){let{youtubeVideoID:t,setYoutubeVideoID:a,setSettingsUpdated:s}=e,{t:r}=(0,x.$G)(),[i,l]=(0,d.useState)(!1),o=(0,n.jsx)(n.Fragment,{children:r("bg_youtube_desc","Select a background video. Copy this from the YouTube video ID from the URL, it will look something like kDCXBwzSI")});return(0,n.jsx)(Z.pv,{title:r("Background Video"),description:o,children:(0,n.jsx)("ul",{role:"list",className:"divide-y divide-gray-100 max-w-xs",children:(0,n.jsx)("li",{className:"py-4",children:(0,n.jsxs)(Z.p7,{label:r("YouTube Video ID"),children:[(0,n.jsx)(TextInput,{value:t,onChange:e=>{let t=e.target.value.trim();return a(t),(0,C.rF)("youtube_videoid",t),s(!0),l(!0),!1}}),t!==(0,C.u_)("youtube_videoid")&&(0,n.jsx)("p",{className:"mt-2",children:(0,n.jsx)(Z.Su,{onClick:()=>{a((0,C.u_)("youtube_videoid")),(0,C.rF)("youtube_videoid",(0,C.u_)("youtube_videoid")),l(!0),s(!0)}})}),i&&(0,n.jsxs)("p",{className:"text-xs text-gray-500 mt-4",children:["Video changed. ",(0,n.jsx)("span",{className:"text-cyan-500 hover:text-cyan-600 hover:cursor-pointer",onClick:()=>window.location.reload(),children:"Refresh"})," to apply."]})]})})})})}function CharacterModelPage(e){let{viewer:t,vrmHash:a,vrmUrl:s,vrmSaveType:r,vrmList:i,setVrmHash:l,setVrmUrl:o,setVrmSaveType:c,setSettingsUpdated:d,handleClickOpenVrmFile:u}=e,{t:m}=(0,x.$G)();return(0,n.jsxs)(Z.pv,{title:m("Character Model"),description:m("character_desc","Select the Character to play, currently only default Amica has full range of emotions. Load your own VRMs here."),children:[(0,n.jsx)("div",{className:"rounded-lg shadow-lg bg-white flex flex-wrap justify-center space-x-4 space-y-4 p-4",children:i.map(e=>(0,n.jsx)("button",{onClick:()=>{t.loadVrm(e.url),c(e.saveType),(0,C.rF)("vrm_save_type",e.saveType),"local"==e.saveType?((0,C.rF)("vrm_hash",e.getHash()),(0,C.rF)("vrm_url",e.url),o(e.url),l(e.getHash())):((0,C.rF)("vrm_hash",""),(0,C.rF)("vrm_url",e.url),o(e.url)),d(!0)},className:(0,g.W)("mx-4 py-2 rounded-4 transition-all bg-gray-100 hover:bg-white active:bg-gray-100 rounded-xl","web"===e.saveType&&e.url===s||"local"===e.saveType&&e.getHash()===a?"opacity-100 shadow-md":"opacity-60 hover:opacity-100"),children:(0,n.jsx)("img",{src:e.thumbUrl,alt:e.url,width:"160",height:"93",className:"m-0 rounded mx-4 pt-0 pb-0 pl-0 pr-0 shadow-sm shadow-black hover:shadow-md hover:shadow-black rounded-4 transition-all bg-gray-100 hover:bg-white active:bg-gray-100"})},e.url))}),(0,n.jsx)(TextButton,{className:"rounded-t-none text-lg ml-4 px-8 shadow-lg bg-secondary hover:bg-secondary-hover active:bg-secondary-active",onClick:u,children:m("Load VRM")})]})}var es=a(215),er=a(3766);function CharacterAnimationPage(e){let{viewer:t,animationUrl:a,setAnimationUrl:s,setSettingsUpdated:r}=e,{t:i}=(0,x.$G)();return(0,n.jsx)(Z.pv,{title:i("Character Idle Animation"),description:i("Select the animation to play when idle. To load more animations refer to docs."),children:(0,n.jsx)("ul",{role:"list",className:"divide-y divide-gray-100 max-w-xs",children:(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:i("Animation"),children:(0,n.jsx)("select",{value:a,className:"mt-2 block w-full rounded-md border-0 py-1.5 pl-3 pr-10 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-indigo-600 sm:text-sm sm:leading-6",onChange:async e=>{e.preventDefault();let a=e.target.value;s(a),(0,C.rF)("animation_url",a),r(!0);let n=a.indexOf("vrma")>0?await (0,er.S)(a):await (0,es.L)(a,t.model.vrm);t.model.loadAnimation(n),requestAnimationFrame(()=>{t.resetCamera()})},children:W.gC.map(e=>(0,n.jsx)("option",{value:e,children:(0,Z.EZ)(e)},e))})})})})})}var en=a(88149);let ei=[{key:"echo",label:"Echo"},{key:"chatgpt",label:"ChatGPT"},{key:"llamacpp",label:"LLama.cpp"},...(0,$.U)()?[]:[{key:"windowai",label:"Window.ai"}],{key:"ollama",label:"Ollama"},{key:"koboldai",label:"KoboldAI"},{key:"openrouter",label:"OpenRouter"}];function idToTitle(e){return ei[ei.findIndex(t=>t.key===e)].label}function ChatbotBackendPage(e){let{chatbotBackend:t,setChatbotBackend:a,setSettingsUpdated:s,setPage:r,breadcrumbs:i,setBreadcrumbs:l}=e,{t:o}=(0,x.$G)(),[c,u]=(0,d.useState)(!1);return(0,d.useEffect)(()=>{(async()=>{try{let e=await (0,en.hX)();e&&u(!0)}catch(e){console.error("window.ai",e)}})()},[]),(0,n.jsx)(Z.pv,{title:o("Chatbot Backend"),description:o("Chatbot_Backend_desc","Select the chatbot backend to use. Echo simply responds with what you type, it is used for testing and demonstration. ChatGPT is a commercial chatbot API from OpenAI, however there are multiple compatible API providers which can be used in lieu of OpenAI. LLama.cpp is a free and open source chatbot backend."),children:(0,n.jsxs)("ul",{role:"list",className:"divide-y divide-gray-100 max-w-xs",children:[(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:o("Chatbot Backend"),children:(0,n.jsx)("select",{className:"mt-2 block w-full rounded-md border-0 py-1.5 pl-3 pr-10 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-indigo-600 sm:text-sm sm:leading-6",value:t,onChange:e=>{a(e.target.value),(0,C.rF)("chatbot_backend",e.target.value),s(!0)},children:ei.map(e=>(0,n.jsx)("option",{value:e.key,children:o(e.label)},e.key))})})}),["chatgpt","llamacpp","ollama","koboldai","openrouter"].includes(t)&&(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:"".concat(o("Configure")," ").concat(o(idToTitle(t))),children:(0,n.jsxs)("button",{type:"button",className:"rounded bg-indigo-600 px-2 py-1 text-xs font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600",onClick:()=>{r("".concat(t,"_settings")),l(i.concat([(0,Z.lT)("".concat(t,"_settings"))]))},children:[o("Click here to configure")," ",o(idToTitle(t))]})})}),"windowai"===t&&!c&&(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:"Window.ai not found",children:(0,n.jsx)("a",{href:"https://windowai.io/",target:"_blank",className:"rounded bg-indigo-600 px-2 py-1 text-xs font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600",children:"Install window.ai"})})})]})})}let SecretTextInput=e=>{let{value:t,onChange:a,...s}=e,[r,i]=(0,d.useState)("password"),[l,o]=(0,d.useState)(!1);return(0,n.jsxs)(X.r.Group,{as:"div",className:"flex items-center",children:[(0,n.jsx)("input",{className:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6",type:r,placeholder:"sk-...",value:t,onChange:a,autoComplete:"off"}),(0,n.jsxs)(X.r,{checked:l,onChange:e=>{o(e),i(e?"text":"password")},className:(0,g.W)(l?"bg-indigo-600":"bg-gray-200","relative ml-2 inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-indigo-600 focus:ring-offset-2"),children:[(0,n.jsx)("span",{className:"sr-only",children:"Use setting"}),(0,n.jsxs)("span",{className:(0,g.W)(l?"translate-x-5":"translate-x-0","pointer-events-none relative inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"),children:[(0,n.jsx)("span",{className:(0,g.W)(l?"opacity-0 duration-100 ease-out":"opacity-100 duration-200 ease-in","absolute inset-0 flex h-full w-full items-center justify-center transition-opacity"),"aria-hidden":"true",children:(0,n.jsx)("svg",{className:"h-3 w-3 text-gray-400",fill:"none",viewBox:"0 0 12 12",children:(0,n.jsx)("path",{d:"M4 8l2-2m0 0l2-2M6 6L4 4m2 2l2 2",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"})})}),(0,n.jsx)("span",{className:(0,g.W)(l?"opacity-100 duration-200 ease-in":"opacity-0 duration-100 ease-out","absolute inset-0 flex h-full w-full items-center justify-center transition-opacity"),"aria-hidden":"true",children:(0,n.jsx)("svg",{className:"h-3 w-3 text-indigo-600",fill:"currentColor",viewBox:"0 0 12 12",children:(0,n.jsx)("path",{d:"M3.707 5.293a1 1 0 00-1.414 1.414l1.414-1.414zM5 8l-.707.707a1 1 0 001.414 0L5 8zm4.707-3.293a1 1 0 00-1.414-1.414l1.414 1.414zm-7.414 2l2 2 1.414-1.414-2-2-1.414 1.414zm3.414 2l4-4-1.414-1.414-4 4 1.414 1.414z"})})})]})]}),(0,n.jsx)(X.r.Label,{as:"span",className:"ml-3 text-sm",children:(0,n.jsx)("span",{className:"font-medium text-gray-900 whitespace-nowrap",children:"Show Key"})})]})};function ChatGPTSettingsPage(e){let{openAIApiKey:t,setOpenAIApiKey:a,openAIUrl:s,setOpenAIUrl:r,openAIModel:i,setOpenAIModel:l,setSettingsUpdated:o}=e,c=(0,n.jsxs)(n.Fragment,{children:["Configure ChatGPT settings. You can get an API key from ",(0,n.jsx)("a",{href:"https://platform.openai.com",children:"platform.openai.com"}),". You can generally use other OpenAI compatible URLs and models here too, such as ",(0,n.jsx)("a",{href:"https://openrouter.ai/",children:"OpenRouter"})," or ",(0,n.jsx)("a",{href:"https://lmstudio.ai/",children:"LM Studio"}),"."]});return(0,n.jsxs)(Z.pv,{title:"ChatGPT Settings",description:c,children:["chatgpt"!==(0,C.vc)("chatbot_backend")&&(0,n.jsx)(Z.Hn,{children:"You are not currently using ChatGPT as your ChatBot backend. These settings will not be used."}),(0,n.jsxs)("ul",{role:"list",className:"divide-y divide-gray-100 max-w-xs",children:[(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:"OpenAI API Key",children:(0,n.jsx)(SecretTextInput,{value:t,onChange:e=>{a(e.target.value),(0,C.rF)("openai_apikey",e.target.value),o(!0)}})})}),(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:"OpenAI URL",children:(0,n.jsx)(TextInput,{value:s,onChange:e=>{r(e.target.value),(0,C.rF)("openai_url",e.target.value),o(!0)}})})}),(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:"OpenAI Model",children:(0,n.jsx)(TextInput,{value:i,onChange:e=>{l(e.target.value),(0,C.rF)("openai_model",e.target.value),o(!0)}})})})]})]})}function LlamaCppSettingsPage(e){let{llamaCppUrl:t,setLlamaCppUrl:a,llamaCppStopSequence:s,setLlamaCppStopSequence:r,setSettingsUpdated:i}=e,{t:l}=(0,x.$G)(),o=(0,n.jsxs)(n.Fragment,{children:[l("llama_cpp_desc","LLama.cpp is a free and open source chatbot backend. You should build the server from source and run it on your own computer. You can get the source code from")," ",(0,n.jsx)("a",{href:"https://github.com/ggerganov/llama.cpp",children:l("GitHub")})]});return(0,n.jsxs)(Z.pv,{title:l("LLama.cpp")+" "+l("Settings"),description:o,children:["llamacpp"!==(0,C.vc)("chatbot_backend")&&(0,n.jsx)(Z.Hn,{children:l("not_using_alert","You are not currently using {{name}} as your {{what}} backend. These settings will not be used.",{name:l("llama.cpp"),what:l("ChatBot")})}),(0,n.jsxs)("ul",{role:"list",className:"divide-y divide-gray-100 max-w-xs",children:[(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:l("API URL"),children:(0,n.jsx)(TextInput,{value:t,onChange:e=>{a(e.target.value),(0,C.rF)("llamacpp_url",e.target.value),i(!0)}})})}),(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:l("STOP SEQUENCE"),children:(0,n.jsx)(TextInput,{value:s,onChange:e=>{r(e.target.value),(0,C.rF)("llamacpp_stop_sequence",e.target.value),i(!0)}})})})]})]})}function OllamaSettingsPage(e){let{ollamaUrl:t,setOllamaUrl:a,ollamaModel:s,setOllamaModel:r,setSettingsUpdated:i}=e,{t:l}=(0,x.$G)(),o=(0,n.jsxs)(n.Fragment,{children:[l("ollama_desc","Ollama lets you get up and running with large language models locally. Download from")," ",(0,n.jsx)("a",{href:"https://ollama.ai/",children:l("ollama.ai")})]});return(0,n.jsxs)(Z.pv,{title:l("Ollama")+" "+l("Settings"),description:o,children:["ollama"!==(0,C.vc)("chatbot_backend")&&(0,n.jsx)(Z.Hn,{children:l("not_using_alert","You are not currently using {{name}} as your {{what}} backend. These settings will not be used.",{name:l("Ollama"),what:l("ChatBot")})}),(0,n.jsxs)("ul",{role:"list",className:"divide-y divide-gray-100 max-w-xs",children:[(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:l("API URL"),children:(0,n.jsx)(TextInput,{value:t,onChange:e=>{a(e.target.value),(0,C.rF)("ollama_url",e.target.value),i(!0)}})})}),(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:l("Model"),children:(0,n.jsx)(TextInput,{value:s,onChange:e=>{r(e.target.value),(0,C.rF)("ollama_model",e.target.value),i(!0)}})})})]})]})}function KoboldAiSettingsPage(e){let{koboldAiUrl:t,setKoboldAiUrl:a,koboldAiUseExtra:s,setKoboldAiUseExtra:r,koboldAiStopSequence:i,setKoboldAiStopSequence:l,setSettingsUpdated:o}=e,{t:c}=(0,x.$G)();return(0,n.jsxs)(Z.pv,{title:c("KoboldAI")+" "+c("Settings"),description:c("kobold_cpp_desc","KoboldCpp is an easy-to-use AI text-generation software for GGML and GGUF models."),children:["koboldai"!==(0,C.vc)("chatbot_backend")&&(0,n.jsx)(Z.Hn,{children:c("not_using_alert","You are not currently using {{name}} as your {{what}} backend. These settings will not be used.",{name:c("KoboldAI"),what:c("ChatBot")})}),(0,n.jsxs)("ul",{role:"list",className:"divide-y divide-gray-100 max-w-xs",children:[(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:c("API URL"),children:(0,n.jsx)(TextInput,{value:t,onChange:e=>{a(e.target.value),(0,C.rF)("koboldai_url",e.target.value),o(!0)}})})}),(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:c("STOP SEQUENCE"),children:(0,n.jsx)(TextInput,{value:i,onChange:e=>{l(e.target.value),(0,C.rF)("koboldai_stop_sequence",e.target.value),o(!0)}})})}),(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:"Use Koboldcpp",children:(0,n.jsx)(SwitchBox,{value:s,label:"Use Extra (enables streaming)",onChange:e=>{r(e),(0,C.rF)("koboldai_use_extra",e.toString()),o(!0)}})})})]})]})}let el=[{key:"none",label:"None"},{key:"elevenlabs",label:"ElevenLabs"},{key:"speecht5",label:"SpeechT5"},{key:"openai_tts",label:"OpenAI TTS"},{key:"localXTTS",label:"Alltalk TTS"},{key:"piper",label:"Piper"},{key:"coquiLocal",label:"Coqui Local"}];function TTSBackendPage_idToTitle(e){return el[el.findIndex(t=>t.key===e)].label}function TTSBackendPage(e){let{ttsBackend:t,setTTSBackend:a,setSettingsUpdated:s,setPage:r,breadcrumbs:i,setBreadcrumbs:l}=e,{t:o}=(0,x.$G)();return(0,n.jsx)(Z.pv,{title:o("TTS Backend"),description:o("TTS_Backend_desc","Select the TTS backend to use. By default this is set to our TTS server. Elevenlabs is a paid service with the best voice, but it is free for non-commercial use. SpeechT5 is an open source TTS model. OpenAI TTS is an open source TTS model. Local XTTS is our local TTS endpoint (XTTS based). Piper is a free TTS model. Coqui Local is a free TTS model."),children:(0,n.jsxs)("ul",{role:"list",className:"divide-y divide-gray-100 max-w-xs",children:[(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:o("TTS Backend"),children:(0,n.jsx)("select",{className:"mt-2 block w-full rounded-md border-0 py-1.5 pl-3 pr-10 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-indigo-600 sm:text-sm sm:leading-6",value:t,onChange:e=>{a(e.target.value),(0,C.rF)("tts_backend",e.target.value),s(!0)},children:el.map(e=>(0,n.jsx)("option",{value:e.key,children:e.label},e.key))})})}),["elevenlabs","speecht5","openai_tts","piper","coquiLocal","localXTTS"].includes(t)&&(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:"".concat(o("Configure")," ").concat(o(TTSBackendPage_idToTitle(t))),children:(0,n.jsxs)("button",{type:"button",className:"rounded bg-indigo-600 px-2 py-1 text-xs font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600",onClick:()=>{r("".concat(t,"_settings")),l(i.concat([(0,Z.lT)("".concat(t,"_settings"))]))},children:[o("Click here to configure")," ",o(TTSBackendPage_idToTitle(t))]})})})]})})}function ElevenLabsSettingsPage(e){let{elevenlabsApiKey:t,setElevenlabsApiKey:a,elevenlabsVoiceId:s,setElevenlabsVoiceId:r,setSettingsUpdated:i}=e,{t:l}=(0,x.$G)();return(0,n.jsxs)(Z.pv,{title:l("ElevenLabs")+" "+l("Settings"),description:l("elevenLabs_desc","Configure ElevenLabs"),children:["elevenlabs"!==(0,C.vc)("tts_backend")&&(0,n.jsx)(Z.Hn,{children:l("not_using_alert","You are not currently using {{name}} as your {{what}} backend. These settings will not be used.",{name:l("ElevenLabs"),what:l("TTS")})}),(0,n.jsxs)("ul",{role:"list",className:"divide-y divide-gray-100 max-w-xs",children:[(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:l("API Key"),children:(0,n.jsx)(SecretTextInput,{value:t,onChange:e=>{a(e.target.value),(0,C.rF)("elevenlabs_apikey",e.target.value),i(!0)}})})}),(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:l("Voice ID"),children:(0,n.jsx)(TextInput,{value:s,onChange:e=>{r(e.target.value),(0,C.rF)("elevenlabs_voiceid",e.target.value),i(!0)}})})})]})]})}function SpeechT5SettingsPage(e){let{speechT5SpeakerEmbeddingsUrl:t,setSpeechT5SpeakerEmbeddingsUrl:a,setSettingsUpdated:s}=e,{t:r}=(0,x.$G)();return(0,n.jsxs)(Z.pv,{title:r("SpeechT5")+" "+r("Settings"),description:r("SpeechT5_desc","Configure SpeechT5"),children:["speecht5"!==(0,C.vc)("tts_backend")&&(0,n.jsx)(Z.Hn,{children:r("not_using_alert","You are not currently using {{name}} as your {{what}} backend. These settings will not be used.",{name:r("SpeechT5"),what:r("TTS")})}),(0,n.jsx)("ul",{role:"list",className:"divide-y divide-gray-100 max-w-xs",children:(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:"Speaker Embeddings URL",children:(0,n.jsx)("select",{value:t,onChange:e=>{e.preventDefault(),a(e.target.value),(0,C.rF)("speecht5_speaker_embedding_url",e.target.value),s(!0)},children:W.Z7.map(e=>(0,n.jsx)("option",{value:e,children:(0,Z.EZ)(e)},e))})})})})]})}function OpenAITTSSettingsPage(e){let{openAITTSApiKey:t,setOpenAITTSApiKey:a,openAITTSUrl:s,setOpenAITTSUrl:r,openAITTSModel:i,setOpenAITTSModel:l,openAITTSVoice:o,setOpenAITTSVoice:c,setSettingsUpdated:d}=e,{t:u}=(0,x.$G)();return(0,n.jsxs)(Z.pv,{title:u("OpenAI TTS")+" "+u("Settings"),description:u("OpenAI_tts_desc","Configure OpenAI TTS"),children:["openai_tts"!==(0,C.vc)("tts_backend")&&(0,n.jsx)(Z.Hn,{children:u("not_using_alert","You are not currently using {{name}} as your {{what}} backend. These settings will not be used.",{name:u("OpenAI"),what:u("TTS")})}),(0,n.jsxs)("ul",{role:"list",className:"divide-y divide-gray-100 max-w-xs",children:[(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:u("API Key"),children:(0,n.jsx)(SecretTextInput,{value:t,onChange:e=>{e.preventDefault(),a(e.target.value),(0,C.rF)("openai_tts_apikey",e.target.value),d(!0)}})})}),(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:u("API URL"),children:(0,n.jsx)(TextInput,{value:s,onChange:e=>{e.preventDefault(),r(e.target.value),(0,C.rF)("openai_tts_url",e.target.value),d(!0)}})})}),(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:u("Model"),children:(0,n.jsx)(TextInput,{value:i,onChange:e=>{e.preventDefault(),l(e.target.value),(0,C.rF)("openai_tts_model",e.target.value),d(!0)}})})}),(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:u("Voice"),children:(0,n.jsx)(TextInput,{value:o,onChange:e=>{e.preventDefault(),c(e.target.value),(0,C.rF)("openai_tts_voice",e.target.value),d(!0)}})})})]})]})}function PiperSettingsPage(e){let{piperUrl:t,setPiperUrl:a,setSettingsUpdated:s}=e,{t:r}=(0,x.$G)();return(0,n.jsxs)(Z.pv,{title:r("Piper")+" "+r("Settings"),description:r("piper_desc","Configure Piper"),children:["piper"!==(0,C.vc)("tts_backend")&&(0,n.jsx)(Z.Hn,{children:r("not_using_alert","You are not currently using {{name}} as your {{what}} backend. These settings will not be used.",{name:r("Piper"),what:r("TTS")})}),(0,n.jsx)("ul",{role:"list",className:"divide-y divide-gray-100 max-w-xs",children:(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:r("URL"),children:(0,n.jsx)(TextInput,{value:t,onChange:e=>{a(e.target.value),(0,C.rF)("piper_url",e.target.value),s(!0)}})})})})]})}var eo=a(3340);function CoquiLocalSettingsPage(e){let{coquiLocalUrl:t,setCoquiLocalUrl:a,setSettingsUpdated:s,coquiLocalVoiceId:r,setCoquiLocalVoiceId:i}=e,{t:l}=(0,x.$G)(),[o,c]=(0,d.useState)([]);return(0,d.useEffect)(()=>{(async function(){try{let e=await (0,eo.P)();e&&e.list&&c(e.list)}catch(e){console.error("Error fetching voice list:",e)}})()},[]),(0,n.jsxs)(Z.pv,{title:l("CoquiLocal")+" "+l("Settings"),description:l("coquiLocal_desc","Configure Coqui (Local), this is running Coqui locally, and no Coqui API (where the company has stopped providing an API service."),children:["coquiLocal"!==(0,C.vc)("tts_backend")&&(0,n.jsx)(Z.Hn,{children:l("not_using_alert","You are not currently using {{name}} as your {{what}} backend. These settings will not be used.",{name:l("CoquiLocal"),what:l("TTS")})}),(0,n.jsxs)("ul",{role:"list",className:"divide-y divide-gray-100 max-w-xs",children:[(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:l("URL"),children:(0,n.jsx)(TextInput,{value:t,onChange:e=>{a(e.target.value),(0,C.rF)("coquiLocal_url",e.target.value),s(!0)}})})}),(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:l("Voice ID"),children:(0,n.jsx)("select",{value:r,onChange:e=>{e.preventDefault(),i(e.target.value),(0,C.rF)("coquiLocal_voiceid",e.target.value),s(!0)},children:o.map(e=>(0,n.jsx)("option",{value:e,children:e},e))})})})]})]})}var ec=a(35079),ed=a(46032),eu=a(13840),em=a(75837);function LocalXTTSSettingsPage(e){let{localXTTSUrl:t,setLocalXTTSUrl:a,setSettingsUpdated:s}=e,{t:r}=(0,x.$G)(),[i,l]=(0,d.useState)(!1),[o,c]=(0,d.useState)(null),[u,m]=(0,d.useState)((0,C.vc)("alltalk_version")||"v2"),[h,v]=(0,d.useState)([]),[f,b]=(0,d.useState)((0,C.vc)("alltalk_voice")||""),[y,w]=(0,d.useState)((0,C.vc)("alltalk_language")||"en"),[j,_]=(0,d.useState)("unchecked"),[k,N]=(0,d.useState)(["Disabled"]),[S,T]=(0,d.useState)((0,C.vc)("alltalk_rvc_voice")||"Disabled"),[I,L]=(0,d.useState)((0,C.vc)("alltalk_rvc_pitch")||"0"),checkServerStatus=async()=>{try{l(!0);let e=t.replace(/\/+$/,""),a=await fetch("".concat(e,"/api/ready"));if(a.ok){let e=await a.text();_("Ready"===e?"ready":"not-ready")}else _("error")}catch(e){_("error"),c("Failed to connect to AllTalk server")}finally{l(!1)}},fetchVoices=async()=>{try{l(!0);let e=t.replace(/\/+$/,""),a=await fetch("".concat(e,"/api/voices"));if(a.ok){let e=await a.json();e.voices&&Array.isArray(e.voices)&&(v(e.voices),e.voices.length>0&&!f&&b(e.voices[0]))}}catch(e){console.error("Error fetching voices:",e),c("Failed to fetch voices")}finally{l(!1)}},fetchRvcVoices=async()=>{try{let e=t.replace(/\/+$/,""),a=await fetch("".concat(e,"/api/rvcvoices"));if(a.ok){let e=await a.json();e.rvcvoices&&Array.isArray(e.rvcvoices)&&N(e.rvcvoices)}}catch(e){console.error("Error fetching RVC voices:",e)}};(0,d.useEffect)(()=>{let loadData=async()=>{if(t){l(!0);try{await checkServerStatus(),0!==h.length&&h.includes((0,C.vc)("alltalk_voice")||"")||(console.log("[AllTalk] Fetching standard voices"),await fetchVoices()),"v2"===(0,C.vc)("alltalk_version")&&(k.length<=1||!k.includes((0,C.vc)("alltalk_rvc_voice")||"Disabled"))&&(console.log("[AllTalk] Fetching RVC voices"),await fetchRvcVoices());let e=(0,C.vc)("alltalk_voice");e&&h.includes(e)&&b(e);let t=(0,C.vc)("alltalk_rvc_voice");t&&k.includes(t)&&T(t)}catch(e){console.error("[AllTalk] Error loading data:",e),c("Failed to load voice data")}finally{l(!1)}}};loadData()},[t]);let handlePreviewVoice=async()=>{try{l(!0);let e=t.replace(/\/+$/,""),a=new URLSearchParams({voice:f}),s=await fetch("".concat(e,"/api/previewvoice"),{method:"POST",body:a});if(!s.ok)throw Error("Preview failed");let r=await s.json(),n="v1"===(0,C.vc)("alltalk_version")?r.output_file_url:"".concat(e).concat(r.output_file_url),i=new Audio(n);await i.play()}catch(e){console.error("Preview error:",e),c("Failed to preview voice")}finally{l(!1)}};return"localXTTS"!==(0,C.vc)("tts_backend")?(0,n.jsx)("div",{className:"rounded-md bg-yellow-50 p-4",children:(0,n.jsxs)("div",{className:"flex",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:(0,n.jsx)(em.Z,{className:"h-5 w-5 text-yellow-400","aria-hidden":"true"})}),(0,n.jsx)("div",{className:"ml-3",children:(0,n.jsx)("h3",{className:"text-sm font-medium text-yellow-800",children:r("not_using_alert","You are not currently using {{name}} as your {{what}} backend. These settings will not be used.",{name:r("AllTalk TTS"),what:r("TTS")})})})]})}):(0,n.jsx)("div",{className:"bg-white shadow sm:rounded-lg",children:(0,n.jsxs)("div",{className:"px-4 py-5 sm:p-6",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,n.jsx)("h3",{className:"text-lg font-medium leading-6 text-gray-900",children:r("AllTalk TTS Settings")}),(0,n.jsx)("button",{type:"button",onClick:()=>{checkServerStatus(),fetchVoices()},disabled:i,className:(0,g.Z)("rounded-md bg-blue-600 px-3.5 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-blue-500",i&&"opacity-50 cursor-not-allowed"),children:r(i?"Loading...":"Refresh")})]}),o&&(0,n.jsx)("div",{className:"rounded-md bg-red-50 p-4 mb-4",children:(0,n.jsx)("div",{className:"flex",children:(0,n.jsx)("div",{className:"ml-3",children:(0,n.jsx)("h3",{className:"text-sm font-medium text-red-800",children:o})})})}),(0,n.jsxs)("div",{className:"mt-6 grid grid-cols-1 gap-y-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"url",className:"block text-sm font-medium text-gray-700",children:r("Server URL")}),(0,n.jsx)("div",{className:"mt-1",children:(0,n.jsx)("input",{type:"text",name:"url",id:"url",value:t,onChange:e=>{a(e.target.value),(0,C.rF)("localXTTS_url",e.target.value),s(!0)},className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",placeholder:"http://localhost:7851"})})]}),(0,n.jsx)("div",{children:(0,n.jsxs)(ec.R,{value:u,onChange:e=>{m(e),(0,C.rF)("alltalk_version",e),s(!0)},children:[(0,n.jsx)(ec.R.Label,{className:"block text-sm font-medium text-gray-700",children:r("Server Version")}),(0,n.jsxs)("div",{className:"relative mt-1",children:[(0,n.jsxs)(ec.R.Button,{className:"relative w-full cursor-default rounded-md border border-gray-300 bg-white py-2 pl-3 pr-10 text-left shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 sm:text-sm",children:[(0,n.jsx)("span",{className:"block truncate",children:u}),(0,n.jsx)("span",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2",children:(0,n.jsx)(ed.Z,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"})})]}),(0,n.jsx)(p.u,{leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,n.jsx)(ec.R.Options,{className:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm",children:["v1","v2"].map(e=>(0,n.jsx)(ec.R.Option,{value:e,className:e=>{let{active:t}=e;return(0,g.Z)(t?"text-white bg-blue-600":"text-gray-900","relative cursor-default select-none py-2 pl-3 pr-9")},children:t=>{let{selected:a,active:s}=t;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:(0,g.Z)(a?"font-semibold":"font-normal","block truncate"),children:"AllTalk ".concat(e)}),a&&(0,n.jsx)("span",{className:(0,g.Z)(s?"text-white":"text-blue-600","absolute inset-y-0 right-0 flex items-center pr-4"),children:(0,n.jsx)(eu.Z,{className:"h-5 w-5","aria-hidden":"true"})})]})}},e))})})]})]})}),(0,n.jsx)("div",{children:(0,n.jsxs)(ec.R,{value:f,onChange:e=>{b(e),(0,C.rF)("alltalk_voice",e),s(!0)},children:[(0,n.jsx)(ec.R.Label,{className:"block text-sm font-medium text-gray-700",children:r("Voice")}),(0,n.jsxs)("div",{className:"relative mt-1",children:[(0,n.jsxs)(ec.R.Button,{className:"relative w-full cursor-default rounded-md border border-gray-300 bg-white py-2 pl-3 pr-10 text-left shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 sm:text-sm",children:[(0,n.jsx)("span",{className:"block truncate",children:f||r("Select voice")}),(0,n.jsx)("span",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2",children:(0,n.jsx)(ed.Z,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"})})]}),(0,n.jsx)(p.u,{leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,n.jsx)(ec.R.Options,{className:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm",children:h.map(e=>(0,n.jsx)(ec.R.Option,{value:e,className:e=>{let{active:t}=e;return(0,g.Z)(t?"text-white bg-blue-600":"text-gray-900","relative cursor-default select-none py-2 pl-3 pr-9")},children:t=>{let{selected:a,active:s}=t;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:(0,g.Z)(a?"font-semibold":"font-normal","block truncate"),children:e}),a&&(0,n.jsx)("span",{className:(0,g.Z)(s?"text-white":"text-blue-600","absolute inset-y-0 right-0 flex items-center pr-4"),children:(0,n.jsx)(eu.Z,{className:"h-5 w-5","aria-hidden":"true"})})]})}},e))})})]})]})}),(0,n.jsx)("div",{children:(0,n.jsxs)(ec.R,{value:S,onChange:e=>{T(e),(0,C.rF)("alltalk_rvc_voice",e),s(!0)},children:[(0,n.jsx)(ec.R.Label,{className:"block text-sm font-medium text-gray-700",children:r("RVC Voice")}),(0,n.jsxs)("div",{className:"relative mt-1",children:[(0,n.jsxs)(ec.R.Button,{className:"relative w-full cursor-default rounded-md border border-gray-300 bg-white py-2 pl-3 pr-10 text-left shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 sm:text-sm",children:[(0,n.jsx)("span",{className:"block truncate",children:S}),(0,n.jsx)("span",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2",children:(0,n.jsx)(ed.Z,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"})})]}),(0,n.jsx)(p.u,{leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,n.jsx)(ec.R.Options,{className:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm",children:k.map(e=>(0,n.jsx)(ec.R.Option,{value:e,className:e=>{let{active:t}=e;return(0,g.Z)(t?"text-white bg-blue-600":"text-gray-900","relative cursor-default select-none py-2 pl-3 pr-9")},children:t=>{let{selected:a,active:s}=t;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:(0,g.Z)(a?"font-semibold":"font-normal","block truncate"),children:e}),a&&(0,n.jsx)("span",{className:(0,g.Z)(s?"text-white":"text-blue-600","absolute inset-y-0 right-0 flex items-center pr-4"),children:(0,n.jsx)(eu.Z,{className:"h-5 w-5","aria-hidden":"true"})})]})}},e))})})]})]})}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("label",{className:"block text-sm font-medium text-gray-700",children:[r("RVC Pitch")," (-24 to 24)"]}),(0,n.jsx)("div",{className:"mt-1",children:(0,n.jsx)("input",{type:"number",min:"-24",max:"24",value:I,onChange:e=>{let t=Math.max(-24,Math.min(24,parseInt(e.target.value)||0));L(t.toString()),(0,C.rF)("alltalk_rvc_pitch",t.toString()),s(!0)},className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"})})]}),(0,n.jsx)("div",{children:(0,n.jsx)(ec.R,{value:y,onChange:e=>{w(e),(0,C.rF)("alltalk_language",e),s(!0)}})}),(0,n.jsx)("div",{children:(0,n.jsx)("button",{type:"button",onClick:handlePreviewVoice,disabled:i||!f,className:(0,g.Z)("rounded-md bg-green-600 px-3.5 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-green-500",(i||!f)&&"opacity-50 cursor-not-allowed"),children:r("Preview Voice")})}),(0,n.jsx)("div",{className:(0,g.Z)("mt-4 rounded-md p-4","ready"===j?"bg-green-50":"bg-gray-50","error"===j&&"bg-red-50"),children:(0,n.jsx)("div",{className:"flex",children:(0,n.jsx)("div",{className:"ml-3",children:(0,n.jsxs)("h3",{className:(0,g.Z)("text-sm font-medium","ready"===j&&"text-green-800","error"===j&&"text-red-800","not-ready"===j&&"text-gray-800"),children:[r("Server Status"),": "," ","ready"===j&&r("Connected and ready"),"not-ready"===j&&r("Server is not ready"),"error"===j&&r("Failed to connect to server"),"unchecked"===j&&r("Server status not checked")]})})})}),(0,n.jsx)("div",{className:"text-sm text-gray-500",children:(0,n.jsxs)("a",{href:"https://github.com/erew123/alltalk_tts/wiki",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-500",children:[r("View AllTalk Documentation")," "]})})]})]})})}var eh=a(85693);let NumberInput=e=>{let{value:t,onChange:a,...s}=e;return(0,n.jsx)("input",{className:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-1 focus:ring-inset focus:ring-gray-400 sm:text-sm sm:leading-6",type:"number",value:t,onChange:a,...s})},ep=[{key:"harvest",label:"harvest"},{key:"pm",label:"pm"}];function RVCSettingsPage(e){let{rvcUrl:t,rvcEnabled:a,rvcModelName:s,rvcIndexPath:r,rvcF0upKey:i,rvcF0Method:l,rvcIndexRate:o,rvcFilterRadius:c,rvcResampleSr:u,rvcRmsMixRate:m,rvcProtect:h,setRvcUrl:p,setRvcEnabled:g,setRvcModelName:v,setRvcIndexPath:f,setRvcF0upKey:b,setRvcF0Method:y,setRvcIndexRate:w,setRvcFilterRadius:j,setRvcResampleSr:_,setRvcRmsMixRate:k,setRvcProtect:N,setSettingsUpdated:S}=e,{t:T}=(0,x.$G)(),[I,L]=(0,d.useState)(!1),[P,E]=(0,d.useState)(!1),[A,R]=(0,d.useState)(!1),[F,M]=(0,d.useState)(!1),[U,O]=(0,d.useState)(!1),[V,B]=(0,d.useState)(!1),[W,D]=(0,d.useState)(!1),[q,z]=(0,d.useState)(!1),[G,$]=(0,d.useState)(!1);return(0,n.jsx)(Z.pv,{title:"".concat(T("RVC")," ").concat(T("Settings")),description:"".concat(T("Configure")," ").concat(T("RVC")),children:(0,n.jsxs)("ul",{role:"list",className:"divide-y divide-gray-100 max-w-xs",children:[(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:"".concat(T("Use")," ").concat(T("RVC")),children:(0,n.jsx)(SwitchBox,{value:a,label:"".concat(T("RVC")," ").concat(T("Enabled")),onChange:e=>{g(e),(0,C.rF)("rvc_enabled",e.toString()),S(!0)}})})}),a&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:T("URL"),children:(0,n.jsx)(TextInput,{value:t,onChange:e=>{p(e.target.value),(0,C.rF)("rvc_url",e.target.value),S(!0)}})})}),(0,n.jsx)("li",{className:"py-4 relative",children:(0,n.jsx)(Z.p7,{label:"".concat(T("Specify")," ").concat(T("Model Name")),children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)(TextInput,{value:s,onChange:e=>{v(e.target.value),(0,C.rF)("rvc_model_name",e.target.value),S(!0)}}),(0,n.jsxs)("div",{className:"relative ml-1",children:[(0,n.jsx)(eh.Z,{className:"h-5 w-5 text-gray-400 cursor-pointer",onMouseEnter:()=>L(!0),onMouseLeave:()=>L(!1)}),I&&(0,n.jsx)("div",{className:"absolute bottom-0 left-full ml-2 bg-white rounded-md shadow-md p-2 text-sm text-gray-600 w-60",children:T("the name of the model which was included in your '/assets/weights' folder")})]})]})})}),(0,n.jsx)("li",{className:"py-4 relative",children:(0,n.jsx)(Z.p7,{label:"".concat(T("Specify")," ").concat(T("Index Path")),children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)(TextInput,{value:r,onChange:e=>{f(e.target.value),(0,C.rF)("rvc_index_path",e.target.value),S(!0)}}),(0,n.jsxs)("div",{className:"relative ml-1",children:[(0,n.jsx)(eh.Z,{className:"h-5 w-5 text-gray-400 cursor-pointer",onMouseEnter:()=>E(!0),onMouseLeave:()=>E(!1)}),P&&(0,n.jsx)("div",{className:"absolute bottom-0 left-full ml-2 bg-white rounded-md shadow-md p-2 text-sm text-gray-600 w-60",children:T("the index file of the previously trained model if none then use default dir logs by rvc.")})]})]})})}),(0,n.jsx)("li",{className:"py-4 relative",children:(0,n.jsx)(Z.p7,{label:"".concat(T("Specify")," ").concat(T("F0 UpKey")),children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)(NumberInput,{value:i,min:0,max:1,onChange:e=>{b(e.target.value),(0,C.rF)("rvc_f0_upkey",e.target.value),S(!0)}}),(0,n.jsxs)("div",{className:"relative ml-1",children:[(0,n.jsx)(eh.Z,{className:"h-5 w-5 text-gray-400 cursor-pointer",onMouseEnter:()=>R(!0),onMouseLeave:()=>R(!1)}),A&&(0,n.jsx)("div",{className:"absolute bottom-0 left-full ml-2 bg-white rounded-md shadow-md p-2 text-sm text-gray-600 w-40",children:T("0 or 1")})]})]})})}),(0,n.jsx)("li",{className:"py-4 relative",children:(0,n.jsx)(Z.p7,{label:"".concat(T("Specify")," ").concat(T("F0 Method")),children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("select",{className:"mt-2 block w-full rounded-md border-0 py-1.5 pl-3 pr-10 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-indigo-600 sm:text-sm sm:leading-6",value:l,onChange:e=>{y(e.target.value),(0,C.rF)("rvc_f0_method",e.target.value),S(!0)},children:ep.map(e=>(0,n.jsx)("option",{value:e.key,children:e.label},e.key))}),(0,n.jsxs)("div",{className:"relative ml-1",children:[(0,n.jsx)(eh.Z,{className:"h-5 w-5 text-gray-400 cursor-pointer",onMouseEnter:()=>$(!0),onMouseLeave:()=>$(!1)}),G&&(0,n.jsx)("div",{className:"absolute bottom-0 left-full ml-2 bg-white rounded-md shadow-md p-2 text-sm text-gray-600 w-48",children:T("Select the pitch extraction algorithm ('pm': faster extraction but lower-quality speech; 'harvest': better bass but extremely slow;)")})]})]})})}),(0,n.jsx)("li",{className:"py-4 relative",children:(0,n.jsx)(Z.p7,{label:"".concat(T("Specify")," ").concat(T("Index Rate")),children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)(TextInput,{value:o,onChange:e=>{w(e.target.value),(0,C.rF)("rvc_index_rate",e.target.value),S(!0)}}),(0,n.jsxs)("div",{className:"relative ml-1",children:[(0,n.jsx)(eh.Z,{className:"h-5 w-5 text-gray-400 cursor-pointer",onMouseEnter:()=>M(!0),onMouseLeave:()=>M(!1)}),F&&(0,n.jsx)("div",{className:"absolute bottom-0 left-full ml-2 bg-white rounded-md shadow-md p-2 text-sm text-gray-600 w-40",children:T("Default is 0.66")})]})]})})}),(0,n.jsx)("li",{className:"py-4 relative",children:(0,n.jsx)(Z.p7,{label:"".concat(T("Specify")," ").concat(T("Filter Radius")),children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)(NumberInput,{value:c,min:0,max:7,onChange:e=>{j(e.target.value),(0,C.rF)("rvc_filter_radius",e.target.value),S(!0)}}),(0,n.jsxs)("div",{className:"relative ml-1",children:[(0,n.jsx)(eh.Z,{className:"h-5 w-5 text-gray-400 cursor-pointer",onMouseEnter:()=>O(!0),onMouseLeave:()=>O(!1)}),U&&(0,n.jsx)("div",{className:"absolute bottom-0 left-full ml-2 bg-white rounded-md shadow-md p-2 text-sm text-gray-600 w-60",children:T("If >=3: apply median filtering to the harvested pitch results. The value represents the filter radius and can reduce breathiness. [ 0 to 7 ]")})]})]})})}),(0,n.jsx)("li",{className:"py-4 relative",children:(0,n.jsx)(Z.p7,{label:"".concat(T("Specify")," ").concat(T("Resample Sr")),children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)(NumberInput,{value:u,min:0,max:48e3,onChange:e=>{_(e.target.value),(0,C.rF)("rvc_resample_sr",e.target.value),S(!0)}}),(0,n.jsxs)("div",{className:"relative ml-1",children:[(0,n.jsx)(eh.Z,{className:"h-5 w-5 text-gray-400 cursor-pointer",onMouseEnter:()=>B(!0),onMouseLeave:()=>B(!1)}),V&&(0,n.jsx)("div",{className:"absolute bottom-0 left-full ml-2 bg-white rounded-md shadow-md p-2 text-sm text-gray-600 w-60",children:T("Resample the output audio in post-processing to the final sample rate. Set to 0 for no resampling [ 0 to 48000 ]")})]})]})})}),(0,n.jsx)("li",{className:"py-4 relative",children:(0,n.jsx)(Z.p7,{label:"".concat(T("Specify")," ").concat(T("RMS Mix Rate")),children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)(NumberInput,{value:m,min:0,max:1,onChange:e=>{k(e.target.value),(0,C.rF)("rvc_rms_mix_rate",e.target.value),S(!0)}}),(0,n.jsxs)("div",{className:"relative ml-1",children:[(0,n.jsx)(eh.Z,{className:"h-5 w-5 text-gray-400 cursor-pointer",onMouseEnter:()=>D(!0),onMouseLeave:()=>D(!1)}),W&&(0,n.jsx)("div",{className:"absolute bottom-0 left-full ml-2 bg-white rounded-md shadow-md p-2 text-sm text-gray-600 w-60",children:T("Adjust the volume envelope scaling. Closer to 0, the more it mimicks the volume of the original vocals. Can help mask noise and make volume sound more natural when set relatively low. Closer to 1 will be more of a consistently loud volume [ 0 to 1]")})]})]})})}),(0,n.jsx)("li",{className:"py-4 relative",children:(0,n.jsx)(Z.p7,{label:"".concat(T("Specify")," ").concat(T("Protect")),children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)(NumberInput,{value:h,min:0,max:.5,onChange:e=>{N(e.target.value),(0,C.rF)("rvc_protect",e.target.value),S(!0)}}),(0,n.jsxs)("div",{className:"relative ml-1",children:[(0,n.jsx)(eh.Z,{className:"h-5 w-5 text-gray-400 cursor-pointer",onMouseEnter:()=>z(!0),onMouseLeave:()=>z(!1)}),q&&(0,n.jsx)("div",{className:"absolute bottom-0 left-full ml-2 bg-white rounded-md shadow-md p-2 text-sm text-gray-600 w-60",children:T("Protect voiceless consonants and breath sounds to prevent artifacts such as tearing in electronic music. Set to 0.5 to disable. Decrease the value to increase protection, but it may reduce indexing accuracy [ 0 to 0.5 ]")})]})]})})})]})]})})}let eg=[{key:"none",label:"None"},{key:"whisper_browser",label:"Whisper (Browser)"},{key:"whisper_openai",label:"Whisper (OpenAI)"},{key:"whispercpp",label:"Whisper.cpp"}];function STTBackendPage_idToTitle(e){return eg[eg.findIndex(t=>t.key===e)].label}function STTBackendPage(e){let{sttBackend:t,setSTTBackend:a,setSettingsUpdated:s,setPage:r,breadcrumbs:i,setBreadcrumbs:l}=e,{t:o}=(0,x.$G)();return(0,n.jsx)(Z.pv,{title:o("STT")+" "+o("Settings"),description:o("STT_desc","Select the STT backend to use"),children:(0,n.jsxs)("ul",{role:"list",className:"divide-y divide-gray-100 max-w-xs",children:[(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:o("STT Backend"),children:(0,n.jsx)("select",{className:"mt-2 block w-full rounded-md border-0 py-1.5 pl-3 pr-10 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-indigo-600 sm:text-sm sm:leading-6",value:t,onChange:e=>{a(e.target.value),(0,C.rF)("stt_backend",e.target.value),s(!0)},children:eg.map(e=>(0,n.jsx)("option",{value:e.key,children:e.label},e.key))})})}),["whisper_openai","whispercpp"].includes(t)&&(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:"".concat(o("Configure")," ").concat(o(STTBackendPage_idToTitle(t))),children:(0,n.jsxs)("button",{type:"button",className:"rounded bg-indigo-600 px-2 py-1 text-xs font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600",onClick:()=>{r("".concat(t,"_settings")),l(i.concat([(0,Z.lT)("".concat(t,"_settings"))]))},children:[o("Click here to configure")," ",o(STTBackendPage_idToTitle(t))]})})})]})})}function STTWakeWordSettingsPage(e){let{sttWakeWordEnabled:t,sttWakeWord:a,timeBeforeIdle:s,setSTTWakeWordEnabled:r,setSTTWakeWord:i,setTimeBeforeIdle:l,setSettingsUpdated:o}=e,{t:c}=(0,x.$G)();return(0,n.jsx)(Z.pv,{title:"".concat(c("Wake Word")," ").concat(c("Settings")),description:"".concat(c("Configure")," ").concat(c("Wake Word")),children:(0,n.jsxs)("ul",{role:"list",className:"divide-y divide-gray-100 max-w-xs",children:[(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:"".concat(c("Use")," ").concat(c("Wake Word")),children:(0,n.jsx)(SwitchBox,{value:t,label:"".concat(c("Wake Word")," ").concat(c("Enabled")),onChange:e=>{r(e),(0,C.rF)("wake_word_enabled",e.toString()),o(!0)}})})}),t&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:"".concat(c("Specify")," ").concat(c("Wake Word")),children:(0,n.jsx)(TextInput,{value:a,onChange:e=>{i(e.target.value),(0,C.rF)("wake_word",e.target.value),o(!0)}})})}),(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:"".concat(c("Set time before bot go idle"),"(").concat(c("sec"),")"),children:(0,n.jsx)(NumberInput,{value:s,min:0,max:3600,onChange:e=>{l(e.target.value),(0,C.rF)("time_before_idle_sec",e.target.value),o(!0)}})})})]})]})})}function WhisperOpenAISettingsPage(e){let{whisperOpenAIUrl:t,setWhisperOpenAIUrl:a,whisperOpenAIApiKey:s,setWhisperOpenAIApiKey:r,whisperOpenAIModel:i,setWhisperOpenAIModel:l,setSettingsUpdated:o}=e,{t:c}=(0,x.$G)();return(0,n.jsxs)(Z.pv,{title:c("Whisper (OpenAI)")+" "+c("Settings"),description:c("Whisper_OpenAI_desc","Configure Whisper (OpenAI)"),children:["whisper_openai"!==(0,C.vc)("stt_backend")&&(0,n.jsx)(Z.Hn,{children:c("not_using_alert","You are not currently using {{name}} as your {{what}} backend. These settings will not be used.",{name:c("Whisper (OpenAI)"),what:c("STT")})}),(0,n.jsxs)("ul",{role:"list",className:"divide-y divide-gray-100 max-w-xs",children:[(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:c("OpenAI URL"),children:(0,n.jsx)(TextInput,{value:t,onChange:e=>{a(e.target.value),(0,C.rF)("openai_whisper_url",e.target.value),o(!0)}})})}),(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:c("API Key"),children:(0,n.jsx)(SecretTextInput,{value:s,onChange:e=>{r(e.target.value),(0,C.rF)("openai_whisper_apikey",e.target.value),o(!0)}})})}),(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:c("Model"),children:(0,n.jsx)(TextInput,{value:i,onChange:e=>{l(e.target.value),(0,C.rF)("openai_whisper_model",e.target.value),o(!0)}})})})]})]})}function WhisperCppSettingsPage(e){let{whisperCppUrl:t,setWhisperCppUrl:a,setSettingsUpdated:s}=e,{t:r}=(0,x.$G)();return(0,n.jsxs)(Z.pv,{title:r("Whisper.cpp")+" "+r("Settings"),description:r("Whisper_cpp_desc","Configure Whisper.cpp"),children:["whispercpp"!==(0,C.vc)("stt_backend")&&(0,n.jsx)(Z.Hn,{children:r("not_using_alert","You are not currently using {{name}} as your {{what}} backend. These settings will not be used.",{name:r("Whisper.cpp"),what:r("STT")})}),(0,n.jsx)("ul",{role:"list",className:"divide-y divide-gray-100 max-w-xs",children:(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:r("URL"),children:(0,n.jsx)(TextInput,{value:t,onChange:e=>{a(e.target.value),(0,C.rF)("whispercpp_url",e.target.value),s(!0)}})})})})]})}let ex=[{key:"none",label:"None"},{key:"vision_llamacpp",label:"LLama.cpp"},{key:"vision_ollama",label:"Ollama"}];function VisionBackendPage_idToTitle(e){return ex[ex.findIndex(t=>t.key===e)].label}function VisionBackendPage(e){let{visionBackend:t,setVisionBackend:a,setSettingsUpdated:s,setPage:r,breadcrumbs:i,setBreadcrumbs:l}=e,{t:o}=(0,x.$G)();return(0,n.jsx)(Z.pv,{title:o("Vision Backend"),description:o("Vision_Backend_desc","Select the Vision backend to use"),children:(0,n.jsxs)("ul",{role:"list",className:"divide-y divide-gray-100 max-w-xs",children:[(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:o("Vision Backend"),children:(0,n.jsx)("select",{className:"mt-2 block w-full rounded-md border-0 py-1.5 pl-3 pr-10 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-indigo-600 sm:text-sm sm:leading-6",value:t,onChange:e=>{a(e.target.value),(0,C.rF)("vision_backend",e.target.value),s(!0)},children:ex.map(e=>(0,n.jsx)("option",{value:e.key,children:o(e.label)},e.key))})})}),["vision_llamacpp","vision_ollama"].includes(t)&&(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:"".concat(o("Configure")," ").concat(o(VisionBackendPage_idToTitle(t))),children:(0,n.jsxs)("button",{type:"button",className:"rounded bg-indigo-600 px-2 py-1 text-xs font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600",onClick:()=>{r("".concat(t,"_settings")),l(i.concat([(0,Z.lT)("".concat(t,"_settings"))]))},children:[o("Click here to configure")," ",o(VisionBackendPage_idToTitle(t))]})})})]})})}function VisionLlamaCppSettingsPage(e){let{visionLlamaCppUrl:t,setVisionLlamaCppUrl:a,setSettingsUpdated:s}=e,{t:r}=(0,x.$G)(),i=(0,n.jsxs)(n.Fragment,{children:[r("llama_cpp_desc","LLama.cpp is a free and open source chatbot backend. You should build the server from source and run it on your own computer. You can get the source code from")," ",(0,n.jsx)("a",{href:"https://github.com/ggerganov/llama.cpp",children:r("GitHub")})]});return(0,n.jsxs)(Z.pv,{title:r("Vision")+" "+r("LLama.cpp")+" "+r("Settings"),description:i,children:["vision_llamacpp"!==(0,C.vc)("vision_backend")&&(0,n.jsx)(Z.Hn,{children:r("not_using_alert","You are not currently using {{name}} as your {{what}} backend. These settings will not be used.",{name:r("llama.cpp"),what:r("Vision")})}),(0,n.jsx)("ul",{role:"list",className:"divide-y divide-gray-100 max-w-xs",children:(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:r("API URL"),children:(0,n.jsx)(TextInput,{value:t,onChange:e=>{a(e.target.value),(0,C.rF)("vision_llamacpp_url",e.target.value),s(!0)}})})})})]})}function VisionOllamaSettingsPage(e){let{visionOllamaUrl:t,setVisionOllamaUrl:a,visionOllamaModel:s,setVisionOllamaModel:r,setSettingsUpdated:i}=e,{t:l}=(0,x.$G)(),o=(0,n.jsxs)(n.Fragment,{children:[l("ollama_desc","Ollama lets you get up and running with large language models locally. Download from")," ",(0,n.jsx)("a",{href:"https://ollama.ai/",children:l("ollama.ai")})]});return(0,n.jsxs)(Z.pv,{title:l("Ollama")+" "+l("Settings"),description:o,children:["vision_ollama"!==(0,C.vc)("vision_backend")&&(0,n.jsx)(Z.Hn,{children:l("not_using_alert","You are not currently using {{name}} as your {{what}} backend. These settings will not be used.",{name:l("Ollama"),what:l("Vision")})}),(0,n.jsxs)("ul",{role:"list",className:"divide-y divide-gray-100 max-w-xs",children:[(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:l("API URL"),children:(0,n.jsx)(TextInput,{value:t,onChange:e=>{a(e.target.value),(0,C.rF)("vision_ollama_url",e.target.value),i(!0)}})})}),(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:l("Model"),children:(0,n.jsx)(TextInput,{value:s,onChange:e=>{r(e.target.value),(0,C.rF)("vision_ollama_model",e.target.value),i(!0)}})})})]})]})}function VisionSystemPromptPage(e){let{visionSystemPrompt:t,setVisionSystemPrompt:a,setSettingsUpdated:s}=e,{t:r}=(0,x.$G)();return(0,n.jsx)(Z.pv,{title:r("Vision")+" "+r("System Prompt")+" "+r("Settings"),description:r("Vision_System_Prompt_desc","Configure the vision system prompt. This is the prompt that is used to generate the image descriptions."),children:(0,n.jsx)("ul",{role:"list",className:"divide-y divide-gray-100 max-w-xs",children:(0,n.jsx)("li",{className:"py-4",children:(0,n.jsxs)(Z.p7,{label:r("Vision")+" "+r("System Prompt"),children:[(0,n.jsx)("textarea",{value:t,rows:8,className:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6",onChange:e=>{e.preventDefault(),a(e.target.value),(0,C.rF)("vision_system_prompt",e.target.value),s(!0)}}),t!==(0,C.u_)("vision_system_prompt")&&(0,n.jsx)("p",{className:"mt-2",children:(0,n.jsx)(Z.Su,{onClick:()=>{a((0,C.u_)("vision_system_prompt")),(0,C.rF)("vision_system_prompt",(0,C.u_)("vision_system_prompt")),s(!0)}})})]})})})})}function NamePage(e){let{name:t,setName:a,setSettingsUpdated:s}=e,{t:r}=(0,x.$G)();return(0,n.jsx)(Z.pv,{title:r("Name"),description:r("cfg_avatar_name_desc","Configure the avatars name. This is the name that is used to generate the chatbot response."),children:(0,n.jsx)("ul",{role:"list",className:"divide-y divide-gray-100 max-w-xs",children:(0,n.jsx)("li",{className:"py-4",children:(0,n.jsxs)(Z.p7,{label:r("Name"),children:[(0,n.jsx)(TextInput,{value:t,onChange:e=>{a(e.target.value),(0,C.rF)("name",e.target.value),s(!0)}}),t!==(0,C.u_)("name")&&(0,n.jsx)("p",{className:"mt-2",children:(0,n.jsx)(Z.Su,{onClick:()=>{a((0,C.u_)("name")),(0,C.rF)("name",(0,C.u_)("name")),s(!0)}})})]})})})})}function SystemPromptPage(e){let{systemPrompt:t,setSystemPrompt:a,setSettingsUpdated:s}=e,{t:r}=(0,x.$G)();return(0,n.jsx)(Z.pv,{title:r("System Prompt")+" "+r("Settings"),description:r("System_Prompt_desc","Configure the system prompt. Alter the prompt to change your character's personality. You can share your character's personality using the share button!"),children:(0,n.jsx)("ul",{role:"list",className:"divide-y divide-gray-100 max-w-xs",children:(0,n.jsx)("li",{className:"py-4",children:(0,n.jsxs)(Z.p7,{label:r("System Prompt"),children:[(0,n.jsx)("textarea",{value:t,rows:8,className:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6",onChange:e=>{e.preventDefault(),a(e.target.value),(0,C.rF)("system_prompt",e.target.value),s(!0)}}),t!==(0,C.u_)("system_prompt")&&(0,n.jsx)("p",{className:"mt-2",children:(0,n.jsx)(Z.Su,{onClick:()=>{a((0,C.u_)("system_prompt")),(0,C.rF)("system_prompt",(0,C.u_)("system_prompt")),s(!0)}})})]})})})})}let RangeInput=e=>{let{min:t,max:a,minChange:s,maxChange:r}=e,{t:i}=(0,x.$G)();return(0,n.jsxs)("div",{className:"flex space-x-2",children:[(0,n.jsxs)("label",{className:"flex items-center",children:[(0,n.jsx)("span",{className:"mr-2 block text-small font-medium leading-6 text-gray-900",children:"".concat(i("Min"))}),(0,n.jsx)("input",{className:"w-32 block rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-1 focus:ring-inset focus:ring-gray-400 sm:text-sm sm:leading-6",type:"number",value:t,onChange:e=>{s&&s(e,"min")},placeholder:"Min",min:0,max:a-1})]}),(0,n.jsxs)("label",{className:"flex items-center",children:[(0,n.jsx)("span",{className:"mr-2 block text-small font-medium leading-6 text-gray-900",children:"".concat(i("Max"))}),(0,n.jsx)("input",{className:"w-32 block rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-1 focus:ring-inset focus:ring-gray-400 sm:text-sm sm:leading-6",type:"number",value:a,onChange:e=>{r&&r(e,"max")},placeholder:"Max",min:t+1,max:3600})]})]})};var ev=a(60496);function AmicaLifePage(e){let{amicaLifeEnabled:t,timeBeforeIdle:a,minTimeInterval:s,maxTimeInterval:r,timeToSleep:i,idleTextPrompt:l,setAmicaLifeEnabled:o,setTimeBeforeIdle:c,setMinTimeInterval:u,setMaxTimeInterval:m,setTimeToSleep:h,setIdleTextPrompt:p,setSettingsUpdated:g}=e,{t:v}=(0,x.$G)(),{chat:f}=(0,d.useContext)(U.p),{amicaLife:b}=(0,d.useContext)(ev.r);(0,d.useEffect)(()=>{b.processingIdle()},[t,b]);let y=(0,d.useRef)(null),w=(0,d.useCallback)(()=>{var e;null===(e=y.current)||void 0===e||e.click()},[]),j=(0,d.useCallback)(e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(a){let e=new FileReader;e.onload=()=>{var t;let a=null===(t=e.result)||void 0===t?void 0:t.toString();if(a){let e=JSON.parse(a);e.idleTextPrompt?(b.loadIdleTextPrompt(e.idleTextPrompt),console.log("idleTextPrompt",e.idleTextPrompt)):console.error("Wrong json format")}},e.readAsText(a);let t=a.name;p(t),(0,C.rF)("idle_text_prompt",t),g(!0)}},[f,l]);return(0,n.jsx)(Z.pv,{title:"".concat(v("Amica Life")," ").concat(v("Settings")),description:"".concat(v("Enables")," ").concat(v("Semi-autonomous mode, includes animations, sleep, function calling, subconcious subroutine and self-prompting. (Experimental)")),children:(0,n.jsxs)("ul",{role:"list",className:"divide-y divide-gray-100 max-w-xs",children:[(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:"".concat(v("Use")," ").concat(v("Amica Life")),children:(0,n.jsx)(SwitchBox,{value:t,label:"".concat(v("Amica Life")," ").concat(v("Enabled")," ").concat(v("(Disable to improve performance)")),disabled:"echo"===(0,C.vc)("chatbot_backend"),onChange:e=>{o(e),(0,C.rF)("amica_life_enabled",e.toString()),g(!0)}})})}),t&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:v("Idle self prompts (leave empty to use default)"),children:(0,n.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,n.jsx)(I.h,{iconName:"24/UploadAlt",label:v("Load"),isProcessing:!1,className:"block h-9 w-auto rounded-md border-0 py-1.5 px-4 bg-secondary hover:bg-secondary-hover active:bg-secondary-active text-sm text-white ring-1 ring-inset ring-gray-300 sm:text-sm sm:leading-6",onClick:w}),(0,n.jsx)(TextInput,{value:l,readOnly:!0}),(0,n.jsx)("input",{type:"file",accept:"application/json",id:"fileInput",className:"hidden",ref:y,onChange:j})]})})}),(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:"".concat(v("Idle time before Amica life activates"),"(").concat(v("sec"),")"),children:(0,n.jsx)(NumberInput,{value:a,min:0,max:3600,onChange:e=>{c(e.target.value),(0,C.rF)("time_before_idle_sec",e.target.value),g(!0)}})})}),(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:"".concat(v("Set time before bot go to sleep"),"(").concat(v("sec"),")"),children:(0,n.jsx)(NumberInput,{value:i,min:0,max:3600,onChange:e=>{h(e.target.value),(0,C.rF)("time_to_sleep_sec",e.target.value),g(!0)}})})}),(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:"".concat(v("Set min max interval range"),"(").concat(v("sec"),")"),children:(0,n.jsx)(RangeInput,{min:s,max:r,minChange:e=>{u(e.target.value),(0,C.rF)("min_time_interval_sec",e.target.value),g(!0)},maxChange:e=>{m(e.target.value),(0,C.rF)("max_time_interval_sec",e.target.value),g(!0)}})})})]})]})})}function OpenRouterSettings(e){let{openRouterApiKey:t,setOpenRouterApiKey:a,openRouterUrl:s,setOpenRouterUrl:r,openRouterModel:i,setOpenRouterModel:l,setSettingsUpdated:o}=e,c=(0,n.jsxs)(n.Fragment,{children:["Configure OpenRouter settings. You can get an API key from ",(0,n.jsx)("a",{href:"https://openrouter.ai",children:"https://openrouter.ai"})]});return(0,n.jsxs)(Z.pv,{title:"OpenRouter Settings",description:c,children:["openrouter"!==(0,C.vc)("chatbot_backend")&&(0,n.jsx)(Z.Hn,{children:"You are not currently using OpenRouter as your ChatBot backend. These settings will not be used."}),(0,n.jsxs)("ul",{role:"list",className:"divide-y divide-gray-100 max-w-xs",children:[(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:"OpenRouter API Key",children:(0,n.jsx)(SecretTextInput,{value:t,onChange:e=>{a(e.target.value),(0,C.rF)("openrouter_apikey",e.target.value),o(!0)}})})}),(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:"OpenAI URL",children:(0,n.jsx)(TextInput,{value:s,onChange:e=>{r(e.target.value),(0,C.rF)("openrouter_url",e.target.value),o(!0)}})})}),(0,n.jsx)("li",{className:"py-4",children:(0,n.jsx)(Z.p7,{label:"OpenAI Model",children:(0,n.jsx)(TextInput,{value:i,onChange:e=>{l(e.target.value),(0,C.rF)("openrouter_model",e.target.value),o(!0)}})})})]})]})}let Settings=e=>{let{onClickClose:t}=e,{viewer:a}=(0,d.useContext)(V.Z),{vrmList:s,vrmListAddFile:r}=useVrmStoreContext();useKeyboardShortcut("Escape",t);let[i,l]=(0,d.useState)("main_menu"),[o,c]=(0,d.useState)([]),[u,m]=(0,d.useState)(!1),[h,g]=(0,d.useState)(!1),[x,v]=(0,d.useState)((0,C.vc)("chatbot_backend")),[f,b]=(0,d.useState)((0,C.vc)("openai_apikey")),[y,w]=(0,d.useState)((0,C.vc)("openai_url")),[j,_]=(0,d.useState)((0,C.vc)("openai_model")),[k,N]=(0,d.useState)((0,C.vc)("llamacpp_url")),[S,T]=(0,d.useState)((0,C.vc)("llamacpp_stop_sequence")),[I,P]=(0,d.useState)((0,C.vc)("ollama_url")),[E,A]=(0,d.useState)((0,C.vc)("ollama_model")),[R,F]=(0,d.useState)((0,C.vc)("koboldai_url")),[M,U]=(0,d.useState)("true"===(0,C.vc)("koboldai_use_extra")),[O,B]=(0,d.useState)((0,C.vc)("koboldai_stop_sequence")),[W,Z]=(0,d.useState)((0,C.vc)("openrouter_apikey")),[D,q]=(0,d.useState)((0,C.vc)("openrouter_url")),[z,G]=(0,d.useState)((0,C.vc)("openrouter_model")),[$,K]=(0,d.useState)((0,C.vc)("tts_backend")),[H,J]=(0,d.useState)((0,C.vc)("elevenlabs_apikey")),[Y,X]=(0,d.useState)((0,C.vc)("elevenlabs_voiceid")),[es,er]=(0,d.useState)((0,C.vc)("speecht5_speaker_embedding_url")),[en,ei]=(0,d.useState)((0,C.vc)("openai_tts_apikey")),[el,eo]=(0,d.useState)((0,C.vc)("openai_tts_url")),[ec,ed]=(0,d.useState)((0,C.vc)("openai_tts_model")),[eu,em]=(0,d.useState)((0,C.vc)("openai_tts_voice")),[eh,ep]=(0,d.useState)((0,C.vc)("piper_url")),[eg,ex]=(0,d.useState)((0,C.vc)("rvc_url")),[ev,ef]=(0,d.useState)("true"===(0,C.vc)("rvc_enabled")),[eb,ey]=(0,d.useState)((0,C.vc)("rvc_model_name")),[ew,ej]=(0,d.useState)((0,C.vc)("rvc_index_path")),[e_,ek]=(0,d.useState)(parseInt((0,C.vc)("rvc_f0_upkey"))),[eN,eS]=(0,d.useState)((0,C.vc)("rvc_f0_method")),[eT,eC]=(0,d.useState)((0,C.vc)("rvc_index_rate")),[eI,eL]=(0,d.useState)(parseInt((0,C.vc)("rvc_filter_radius"))),[eP,eE]=(0,d.useState)(parseInt((0,C.vc)("rvc_resample_sr"))),[eA,eR]=(0,d.useState)(parseInt((0,C.vc)("rvc_rms_mix_rate"))),[eF,eM]=(0,d.useState)(parseInt((0,C.vc)("rvc_protect"))),[eU,eO]=(0,d.useState)((0,C.vc)("coquiLocal_url")),[eV,eB]=(0,d.useState)((0,C.vc)("coquiLocal_voiceid")),[eW,eZ]=(0,d.useState)((0,C.vc)("localXTTS_url")),[eD,eq]=(0,d.useState)((0,C.vc)("vision_backend")),[ez,eG]=(0,d.useState)((0,C.vc)("vision_llamacpp_url")),[e$,eK]=(0,d.useState)((0,C.vc)("vision_ollama_url")),[eH,eJ]=(0,d.useState)((0,C.vc)("vision_ollama_model")),[eY,eX]=(0,d.useState)((0,C.vc)("vision_system_prompt")),[eQ,e0]=(0,d.useState)((0,C.vc)("bg_url")),[e1,e4]=(0,d.useState)((0,C.vc)("bg_color")),[e2,e5]=(0,d.useState)((0,C.vc)("vrm_url")),[e6,e7]=(0,d.useState)((0,C.vc)("vrm_hash")),[e3,e8]=(0,d.useState)((0,C.vc)("vrm_save_type")),[e9,te]=(0,d.useState)((0,C.vc)("youtube_videoid")),[tt,ta]=(0,d.useState)((0,C.vc)("animation_url")),[ts,tr]=(0,d.useState)((0,C.vc)("stt_backend")),[tn,ti]=(0,d.useState)("true"===(0,C.vc)("wake_word_enabled")),[tl,to]=(0,d.useState)((0,C.vc)("wake_word")),[tc,td]=(0,d.useState)((0,C.vc)("openai_whisper_url")),[tu,tm]=(0,d.useState)((0,C.vc)("openai_whisper_apikey")),[th,tp]=(0,d.useState)((0,C.vc)("openai_whisper_model")),[tg,tx]=(0,d.useState)((0,C.vc)("whispercpp_url")),[tv,tf]=(0,d.useState)("true"===(0,C.vc)("amica_life_enabled")),[tb,ty]=(0,d.useState)(parseInt((0,C.vc)("time_before_idle_sec"))),[tw,tj]=(0,d.useState)(parseInt((0,C.vc)("min_time_interval_sec"))),[t_,tk]=(0,d.useState)(parseInt((0,C.vc)("max_time_interval_sec"))),[tN,tS]=(0,d.useState)(parseInt((0,C.vc)("time_to_sleep_sec"))),[tT,tC]=(0,d.useState)((0,C.vc)("idle_text_prompt")),[tI,tL]=(0,d.useState)((0,C.vc)("name")),[tP,tE]=(0,d.useState)((0,C.vc)("system_prompt")),tA=(0,d.useRef)(null),tR=(0,d.useCallback)(()=>{var e;null===(e=tA.current)||void 0===e||e.click()},[]),tF=(0,d.useRef)(null),tM=(0,d.useCallback)(()=>{var e;null===(e=tF.current)||void 0===e||e.click()},[]),tU=(0,d.useCallback)(e=>{let t=e.target.files;if(!t)return;let s=t[0];if(!s)return;let n=s.name.split(".").pop();"vrm"===n&&r(s,a),e.target.value=""},[a]);function handleMenuClick(e){l(e.key),c([...o,e])}return(0,d.useEffect)(()=>{tv&&"echo"===x&&tf(!1)},[x,tv]),(0,d.useEffect)(()=>{let e=setTimeout(()=>{h&&(m(!0),setTimeout(()=>{m(!1)},5e3))},1e3);return()=>clearTimeout(e)},[x,f,y,j,k,S,I,E,R,M,O,W,D,z,$,H,Y,es,en,el,ec,eu,eh,eg,ev,eb,ew,e_,eN,eT,eI,,eP,eA,eF,eU,eV,eW,eD,ez,e$,eH,eY,e1,eQ,e6,e2,e9,tt,ts,tu,th,tc,tg,tv,tb,tw,t_,tN,tT,tI,tP,tn,tl]),(0,n.jsxs)("div",{className:"fixed top-0 left-0 w-full max-h-full text-black text-xs text-left z-20 overflow-y-auto backdrop-blur",children:[(0,n.jsx)("div",{className:"absolute top-0 left-0 w-full h-full bg-violet-700 opacity-10 z-index-50"}),(0,n.jsx)("div",{className:"fixed w-full top-0 left-0 z-50 p-2 bg-white",children:(0,n.jsx)("nav",{"aria-label":"Breadcrumb",className:"inline-block ml-4",children:(0,n.jsxs)("ol",{role:"list",className:"flex items-center space-x-4",children:[(0,n.jsx)("li",{className:"flex",children:(0,n.jsx)("div",{className:"flex items-center",children:(0,n.jsxs)("span",{onClick:()=>{if(0===o.length){t();return}l("main_menu"),c([])},className:"text-gray-400 hover:text-gray-500 cursor-pointer",children:[(0,n.jsx)(Q.Z,{className:"h-5 w-5 flex-shrink-0","aria-hidden":"true"}),(0,n.jsx)("span",{className:"sr-only",children:"Home"})]})})}),o.map(e=>(0,n.jsx)("li",{className:"flex",children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)(ee.Z,{className:"h-5 w-5 flex-shrink-0 text-gray-400","aria-hidden":"true"}),(0,n.jsx)("span",{onClick:()=>{l(e.key);let t=[];for(let a of o)if(t.push(a),a.key===e.key)break;c(t)},className:"ml-4 text-sm font-medium text-gray-500 hover:text-gray-700 cursor-pointer",children:e.label})]})},e.key))]})})}),(0,n.jsx)("div",{className:"h-screen overflow-auto opacity-95 backdrop-blur",children:(0,n.jsx)("div",{className:"mx-auto max-w-2xl py-16 text-text1",children:(0,n.jsxs)("div",{className:"mt-16",children:[(0,n.jsx)(TextButton,{className:"rounded-b-none text-lg ml-4 px-8 shadow-sm",onClick:()=>{if(0===o.length){t();return}if(1===o.length){l("main_menu"),c([]);return}let e=o[o.length-2];l(e.key),c(o.slice(0,-1))},children:(0,n.jsx)(et.Z,{className:"h-5 w-5 flex-none text-white","aria-hidden":"true"})}),function(){switch(i){case"main_menu":return(0,n.jsx)(MenuPage,{keys:["appearance","amica_life","chatbot","tts","stt","vision","reset_settings","community"],menuClick:handleMenuClick});case"appearance":return(0,n.jsx)(MenuPage,{keys:["background_img","background_color","background_video","character_model","character_animation"],menuClick:handleMenuClick});case"chatbot":return(0,n.jsx)(MenuPage,{keys:["chatbot_backend","name","system_prompt","chatgpt_settings","llamacpp_settings","ollama_settings","koboldai_settings","openrouter_settings"],menuClick:handleMenuClick});case"tts":return(0,n.jsx)(MenuPage,{keys:["tts_backend","elevenlabs_settings","speecht5_settings","coquiLocal_settings","openai_tts_settings","piper_settings","localXTTS_settings","rvc_settings"],menuClick:handleMenuClick});case"stt":return(0,n.jsx)(MenuPage,{keys:["stt_backend","stt_wake_word","whisper_openai_settings","whispercpp_settings"],menuClick:handleMenuClick});case"vision":return(0,n.jsx)(MenuPage,{keys:["vision_backend","vision_llamacpp_settings","vision_ollama_settings","vision_system_prompt"],menuClick:handleMenuClick});case"reset_settings":return(0,n.jsx)(ResetSettingsPage,{});case"community":return(0,n.jsx)(CommunityPage,{});case"background_img":return(0,n.jsx)(BackgroundImgPage,{bgUrl:eQ,setBgUrl:e0,setSettingsUpdated:g,handleClickOpenBgImgFile:tM});case"background_color":return(0,n.jsx)(BackgroundColorPage,{bgColor:e1,setBgColor:e4,setSettingsUpdated:g});case"background_video":return(0,n.jsx)(BackgroundVideoPage,{youtubeVideoID:e9,setYoutubeVideoID:te,setSettingsUpdated:g});case"character_model":return(0,n.jsx)(CharacterModelPage,{viewer:a,vrmHash:e6,vrmUrl:e2,vrmSaveType:e3,vrmList:s,setVrmHash:e7,setVrmUrl:e5,setVrmSaveType:e8,setSettingsUpdated:g,handleClickOpenVrmFile:tR});case"character_animation":return(0,n.jsx)(CharacterAnimationPage,{viewer:a,animationUrl:tt,setAnimationUrl:ta,setSettingsUpdated:g});case"chatbot_backend":return(0,n.jsx)(ChatbotBackendPage,{chatbotBackend:x,setChatbotBackend:v,setSettingsUpdated:g,setPage:l,breadcrumbs:o,setBreadcrumbs:c});case"chatgpt_settings":return(0,n.jsx)(ChatGPTSettingsPage,{openAIApiKey:f,setOpenAIApiKey:b,openAIUrl:y,setOpenAIUrl:w,openAIModel:j,setOpenAIModel:_,setSettingsUpdated:g});case"llamacpp_settings":return(0,n.jsx)(LlamaCppSettingsPage,{llamaCppUrl:k,setLlamaCppUrl:N,llamaCppStopSequence:S,setLlamaCppStopSequence:T,setSettingsUpdated:g});case"ollama_settings":return(0,n.jsx)(OllamaSettingsPage,{ollamaUrl:I,setOllamaUrl:P,ollamaModel:E,setOllamaModel:A,setSettingsUpdated:g});case"koboldai_settings":return(0,n.jsx)(KoboldAiSettingsPage,{koboldAiUrl:R,setKoboldAiUrl:F,koboldAiUseExtra:M,setKoboldAiUseExtra:U,koboldAiStopSequence:O,setKoboldAiStopSequence:B,setSettingsUpdated:g});case"openrouter_settings":return(0,n.jsx)(OpenRouterSettings,{openRouterUrl:D,setOpenRouterUrl:q,openRouterApiKey:W,setOpenRouterApiKey:Z,openRouterModel:z,setOpenRouterModel:G,setSettingsUpdated:g});case"tts_backend":return(0,n.jsx)(TTSBackendPage,{ttsBackend:$,setTTSBackend:K,setSettingsUpdated:g,setPage:l,breadcrumbs:o,setBreadcrumbs:c});case"elevenlabs_settings":return(0,n.jsx)(ElevenLabsSettingsPage,{elevenlabsApiKey:H,setElevenlabsApiKey:J,elevenlabsVoiceId:Y,setElevenlabsVoiceId:X,setSettingsUpdated:g});case"speecht5_settings":return(0,n.jsx)(SpeechT5SettingsPage,{speechT5SpeakerEmbeddingsUrl:es,setSpeechT5SpeakerEmbeddingsUrl:er,setSettingsUpdated:g});case"openai_tts_settings":return(0,n.jsx)(OpenAITTSSettingsPage,{openAITTSApiKey:en,setOpenAITTSApiKey:ei,openAITTSUrl:el,setOpenAITTSUrl:eo,openAITTSModel:ec,setOpenAITTSModel:ed,openAITTSVoice:eu,setOpenAITTSVoice:em,setSettingsUpdated:g});case"piper_settings":return(0,n.jsx)(PiperSettingsPage,{piperUrl:eh,setPiperUrl:ep,setSettingsUpdated:g});case"coquiLocal_settings":return(0,n.jsx)(CoquiLocalSettingsPage,{coquiLocalUrl:eU,coquiLocalVoiceId:eV,setCoquiLocalVoiceId:eB,setCoquiLocalUrl:eO,setSettingsUpdated:g});case"localXTTS_settings":return(0,n.jsx)(LocalXTTSSettingsPage,{localXTTSUrl:eW,setLocalXTTSUrl:eZ,setSettingsUpdated:g});case"rvc_settings":return(0,n.jsx)(RVCSettingsPage,{rvcUrl:eg,rvcEnabled:ev,rvcModelName:eb,rvcIndexPath:ew,rvcF0upKey:e_,rvcF0Method:eN,rvcIndexRate:eT,rvcFilterRadius:eI,rvcResampleSr:eP,rvcRmsMixRate:eA,rvcProtect:eF,setRvcUrl:ex,setRvcEnabled:ef,setRvcModelName:ey,setRvcIndexPath:ej,setRvcF0upKey:ek,setRvcF0Method:eS,setRvcIndexRate:eC,setRvcFilterRadius:eL,setRvcResampleSr:eE,setRvcRmsMixRate:eR,setRvcProtect:eM,setSettingsUpdated:g});case"stt_backend":return(0,n.jsx)(STTBackendPage,{sttBackend:ts,setSTTBackend:tr,setSettingsUpdated:g,setPage:l,breadcrumbs:o,setBreadcrumbs:c});case"stt_wake_word":return(0,n.jsx)(STTWakeWordSettingsPage,{sttWakeWordEnabled:tn,sttWakeWord:tl,timeBeforeIdle:tb,setSTTWakeWordEnabled:ti,setSTTWakeWord:to,setTimeBeforeIdle:ty,setSettingsUpdated:g});case"whisper_openai_settings":return(0,n.jsx)(WhisperOpenAISettingsPage,{whisperOpenAIUrl:tc,setWhisperOpenAIUrl:td,whisperOpenAIApiKey:tu,setWhisperOpenAIApiKey:tm,whisperOpenAIModel:th,setWhisperOpenAIModel:tp,setSettingsUpdated:g});case"whispercpp_settings":return(0,n.jsx)(WhisperCppSettingsPage,{whisperCppUrl:tg,setWhisperCppUrl:tx,setSettingsUpdated:g});case"vision_backend":return(0,n.jsx)(VisionBackendPage,{visionBackend:eD,setVisionBackend:eq,setSettingsUpdated:g,setPage:l,breadcrumbs:o,setBreadcrumbs:c});case"vision_llamacpp_settings":return(0,n.jsx)(VisionLlamaCppSettingsPage,{visionLlamaCppUrl:ez,setVisionLlamaCppUrl:eG,setSettingsUpdated:g});case"vision_ollama_settings":return(0,n.jsx)(VisionOllamaSettingsPage,{visionOllamaUrl:e$,setVisionOllamaUrl:eK,visionOllamaModel:eH,setVisionOllamaModel:eJ,setSettingsUpdated:g});case"vision_system_prompt":return(0,n.jsx)(VisionSystemPromptPage,{visionSystemPrompt:eY,setVisionSystemPrompt:eX,setSettingsUpdated:g});case"system_prompt":return(0,n.jsx)(SystemPromptPage,{systemPrompt:tP,setSystemPrompt:tE,setSettingsUpdated:g});case"name":return(0,n.jsx)(NamePage,{name:tI,setName:tL,setSettingsUpdated:g});case"amica_life":return(0,n.jsx)(AmicaLifePage,{amicaLifeEnabled:tv,timeBeforeIdle:tb,minTimeInterval:tw,maxTimeInterval:t_,timeToSleep:tN,idleTextPrompt:tT,setAmicaLifeEnabled:tf,setTimeBeforeIdle:ty,setMinTimeInterval:tj,setMaxTimeInterval:tk,setTimeToSleep:tS,setIdleTextPrompt:tC,setSettingsUpdated:g});default:throw Error("page not found")}}()]})})}),(0,n.jsx)("div",{"aria-live":"assertive",className:"pointer-events-none fixed inset-0 flex items-end px-4 py-6 sm:items-start sm:p-6 mt-2",children:(0,n.jsx)("div",{className:"flex w-full flex-col items-center space-y-4 sm:items-end",children:(0,n.jsx)(p.u,{show:u,as:d.Fragment,enter:"transform ease-out duration-300 transition",enterFrom:"translate-y-2 opacity-0 sm:translate-y-0 sm:translate-x-2",enterTo:"translate-y-0 opacity-100 sm:translate-x-0",leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,n.jsx)("div",{className:"pointer-events-auto w-full max-w-sm overflow-hidden rounded-lg bg-white shadow-lg ring-1 ring-black ring-opacity-5",children:(0,n.jsx)("div",{className:"p-4",children:(0,n.jsxs)("div",{className:"flex items-start",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:(0,n.jsx)(ea.Z,{className:"h-6 w-6 text-green-400","aria-hidden":"true"})}),(0,n.jsxs)("div",{className:"ml-3 w-0 flex-1 pt-0.5",children:[(0,n.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Successfully saved!"}),(0,n.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Your settings were updated successfully."})]}),(0,n.jsx)("div",{className:"ml-4 flex flex-shrink-0",children:(0,n.jsxs)("button",{type:"button",className:"inline-flex rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",onClick:()=>{m(!1)},children:[(0,n.jsx)("span",{className:"sr-only",children:"Close"}),(0,n.jsx)(L.Z,{className:"h-5 w-5","aria-hidden":"true"})]})})]})})})})})}),(0,n.jsx)("input",{type:"file",className:"hidden",accept:".vrm",ref:tA,onChange:tU}),(0,n.jsx)("input",{type:"file",className:"hidden",accept:".jpg,.jpeg,.png,.gif,.webp",ref:tF,onChange:function(e){let t=e.target.files;if(!t)return;let a=t[0];if(!a||(a.name.split(".").pop(),!a.type.match("image.*")))return;let s=new FileReader;s.onload=function(e){var t;let a=null===(t=e.target)||void 0===t?void 0:t.result;a&&(document.body.style.backgroundImage="url(".concat(a,")"),a.length<2e6&&((0,C.rF)("youtube_videoid",""),(0,C.rF)("bg_url",a),m(!0)))},s.readAsDataURL(a),e.target.value=""}})]})};var ef=a(64970),eb=a.n(ef),ey=a(85973);function EmbeddedWebcam(e){let{setWebcamEnabled:t}=e,{chat:a}=(0,d.useContext)(U.p),s=(0,d.useRef)(null),[r,i]=(0,d.useState)("environment"),[l,o]=(0,d.useState)(!1),[c,u]=(0,d.useState)(""),[m,h]=(0,d.useState)("webcam"),p=(0,d.useRef)(null);useKeyboardShortcut("Escape",()=>{t(!1)});let processImageFromCanvas=async e=>{let t=document.createElement("canvas");t.width=p.current.width,t.height=p.current.height;let a=t.getContext("2d");if(!a)return"";let s=new Image;return await new Promise((t,r)=>{s.onload=()=>{a.drawImage(s,0,0,p.current.width,p.current.height),t()},s.onerror=r,s.src=e}),t.toDataURL("image/jpeg").replace("data:image/jpeg;base64,","")};(0,d.useEffect)(()=>{let handleImageDataChange=async()=>{if(c){let e="webcam"===m?c.replace("data:image/jpeg;base64,",""):await processImageFromCanvas(c);await a.getVisionResponse(e),o(!1),u(""),t(!1)}};handleImageDataChange()},[c,m,a]);let x=(0,d.useCallback)(()=>{if(null===s.current)return;let e=s.current.getScreenshot();e&&(o(!0),u(e),h("webcam"))},[s]),v=(0,d.useRef)(null),f=(0,d.useCallback)(()=>{var e;null===(e=v.current)||void 0===e||e.click()},[]),b=(0,d.useCallback)(e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(a&&a.type.match("image.*")){let e=new FileReader;e.onloadend=()=>{o(!0),h("uploader"),u(e.result)},e.readAsDataURL(a)}},[]);return(0,n.jsxs)("div",{className:"fixed right-[calc(320px)] top-0 z-[11]",children:[(0,n.jsx)("div",{className:"fixed",children:(0,n.jsxs)(n.Fragment,{children:[!l&&(0,n.jsx)(eb(),{ref:s,audio:!1,width:320,height:240,screenshotFormat:"image/jpeg",videoConstraints:{facingMode:r},className:(0,g.W)("rounded-bl-none rounded-br-none rounded-lg bg-black",l&&"animate-pulse")}),l&&(0,n.jsx)("img",{ref:p,src:c,alt:"Captured image",width:320,height:240,className:(0,g.W)("rounded-bl-none rounded-br-none rounded-lg bg-black",l&&"animate-pulse")}),(0,n.jsxs)("div",{className:"p-1 shadow-md flex flex-auto justify-evenly bg-gray-50 rounded-tl-none rounded-tr-none rounded-full",children:[(0,n.jsx)(I.h,{iconName:"24/UploadAlt",isProcessing:!1,className:"bg-secondary hover:bg-secondary-hover active:bg-secondary-active",onClick:f,disabled:l}),(0,n.jsx)(I.h,{iconName:"24/Shutter",isProcessing:!1,className:"bg-secondary hover:bg-secondary-hover active:bg-secondary-active",onClick:()=>x(),disabled:l}),(0,n.jsx)("button",{className:"pr-2 rounded-lg text-sm p-1 text-center inline-flex items-center",children:(0,n.jsx)(ey.Z,{className:"w-5 h-5 text-gray-700 focus:animate-spin",onClick:()=>{i(e=>"user"===e?"environment":"user")}})})]})]})}),(0,n.jsx)("input",{type:"file",className:"hidden",accept:".jpeg, .jpg, .png, .webp, .heic",ref:v,onChange:b})]})}var ew=a(99842);let ChatModeText=e=>{let{messages:t}=e,a=(0,d.useRef)(null);return(0,d.useEffect)(()=>{var e;null===(e=a.current)||void 0===e||e.scrollIntoView({behavior:"smooth",block:"center"})},[t]),(0,n.jsx)("div",{className:"fixed bottom-0 w-full h-[90%] mb-20 flex flex-col justify-end",children:(0,n.jsx)("div",{className:"w-full h-full overflow-y-auto flex flex-col-reverse",children:(0,n.jsx)("div",{className:"w-full max-w-full mx-auto px-4 md:px-16 flex flex-col",children:t.map((e,s)=>(0,n.jsx)("div",{ref:t.length-1===s?a:null,children:(0,n.jsx)(chatModeText_Chat,{role:e.role,message:e.content.replace(/\[(.*?)\]/g,""),num:s})},s))})})})};function chatModeText_Chat(e){let{role:t,message:a,num:s}=e,{t:r}=(0,x.$G)(),i=(0,d.useRef)(null),[l,o]=(0,d.useState)(!1);return(0,n.jsx)("div",{className:(0,g.W)("mx-auto max-w-4xl my-2","assistant"===t?"pr-10 sm:pr-20":"pl-10 sm:pl-20"),children:(0,n.jsx)("div",{className:"backdrop-blur-lg rounded-lg",children:(0,n.jsxs)("div",{className:"shadow-lg backdrop-blur-lg rounded-lg bg-white/70",children:[(0,n.jsxs)("div",{className:(0,g.W)("pr-1 py-3 bg-rose/90 rounded-t-lg text-white font-bold tracking-wider","px-8"),children:[(0,n.jsxs)("span",{className:(0,g.W)("p-4 rounded-lg rounded-tl-none rounded-tr-none shadow-sm","assistant"===t?"bg-pink-600/80":"bg-cyan-600/80"),children:["assistant"===t&&(0,C.vc)("name").toUpperCase(),"user"===t&&r("YOU")]}),"assistant"===t&&(0,n.jsx)(I.h,{iconName:"24/FrameSize",className:"bg-transparent hover:bg-transparent active:bg-transparent disabled:bg-transparent float-right",isProcessing:!1,onClick:()=>o(!l)})]}),"assistant"===t&&(0,n.jsx)("div",{className:(0,g.W)("px-8 py-4 overflow-y-auto",l?"max-h-32":"max-h-[calc(75vh)]"),children:(0,n.jsxs)("div",{className:"min-h-8 max-h-full typography-16 font-bold text-gray-600",children:[a.replace(/\[([a-zA-Z]*?)\]/g,""),(0,n.jsx)("div",{ref:i})]})}),"user"===t&&(0,n.jsx)("div",{className:"px-8 py-4 max-h-32 overflow-y-auto",children:(0,n.jsxs)("div",{className:"min-h-8 max-h-full typography-16 font-bold text-gray-600",children:[a.replace(/\[([a-zA-Z]*?)\]/g,""),(0,n.jsx)("div",{ref:i})]})})]})})})}function Home(){let{t:e,i18n:t}=(0,x.$G)(),a=t.resolvedLanguage,{viewer:s}=(0,d.useContext)(V.Z),{alert:r}=(0,d.useContext)(A.w),{chat:i}=(0,d.useContext)(U.p),{amicaLife:o}=(0,d.useContext)(ev.r),[u,I]=(0,d.useState)(!1),[L,P]=(0,d.useState)(!1),[E,R]=(0,d.useState)([]),[F,M]=(0,d.useState)(""),[O,B]=(0,d.useState)(""),[W,Z]=(0,d.useState)("system"),[D,q]=(0,d.useState)([]),[z,G]=(0,d.useState)(!1),[K,H]=(0,d.useState)(!1),[J,Y]=(0,d.useState)(!1),[X,Q]=(0,d.useState)(!1),[ee,et]=(0,d.useState)(!1),[ea,es]=(0,d.useState)(!1),[er,en]=(0,d.useState)(null),[ei,el]=(0,d.useState)(!1),[eo,ec]=(0,d.useState)(!1);function toggleTTSMute(){(0,C.rF)("tts_muted","true"===(0,C.vc)("tts_muted")?"false":"true"),en("true"===(0,C.vc)("tts_muted"))}(0,d.useEffect)(()=>{o.checkSettingOff(!K)},[K,o]),(0,d.useEffect)(()=>{null===er&&en("true"===(0,C.vc)("tts_muted")),""!==(0,C.vc)("bg_color")?document.body.style.backgroundColor=(0,C.vc)("bg_color"):document.body.style.backgroundImage="url(".concat((0,C.vc)("bg_url"),")")},[]);let toggleState=(e,t)=>{e(e=>(e||t.forEach(e=>e(!1)),!e))},toggleChatLog=()=>{toggleState(Y,[es,et])},toggleSubconciousText=()=>{0!==D.length&&toggleState(es,[Y,et])};return((0,d.useEffect)(()=>{i.initialize(o,s,r,R,B,M,Z,P,I),"openai"===(0,C.vc)("tts_backend")&&(0,C.rF)("tts_backend","openai_tts")},[i,s]),(0,d.useEffect)(()=>{o.initialize(s,i,q,u)},[o,i,s]),(0,d.useEffect)(()=>G(!0),[]),z)?(0,n.jsxs)("div",{className:(0,g.W)(l().variable,c().variable),children:[""!==(0,C.vc)("youtube_videoid")&&(0,n.jsx)("div",{className:"fixed video-container w-full h-full z-0",children:(0,n.jsx)("iframe",{className:"w-full h-full",src:"https://www.youtube.com/embed/".concat((0,C.vc)("youtube_videoid"),"?&autoplay=1&mute=1&playsinline=1&loop=1&controls=0&disablekb=1&fs=0&playlist=").concat((0,C.vc)("youtube_videoid")),frameBorder:"0"})}),(0,n.jsx)(Introduction,{open:"true"===(0,C.vc)("show_introduction")}),(0,n.jsx)(LoadingProgress,{}),ei&&(0,n.jsx)(EmbeddedWebcam,{setWebcamEnabled:el}),X&&(0,n.jsx)(DebugPane,{onClickClose:()=>Q(!1)}),(0,n.jsxs)(VrmStoreProvider,{children:[(0,n.jsx)(VrmViewer,{chatMode:ee}),K&&(0,n.jsx)(Settings,{onClickClose:()=>H(!1)})]}),(0,n.jsx)(MessageInputContainer,{isChatProcessing:L}),(0,n.jsx)("div",{className:"absolute z-10 m-2",children:(0,n.jsx)("div",{className:"grid grid-flow-col gap-[8px] place-content-end mt-2 bg-slate-800/40 rounded-md backdrop-blur-md shadow-sm",children:(0,n.jsxs)("div",{className:"flex flex-col justify-center items-center p-1 space-y-3",children:[(0,n.jsx)("div",{className:"flex flex-row items-center space-x-2",children:(0,n.jsx)(v.Z,{className:"h-7 w-7 text-white opacity-50 hover:opacity-100 active:opacity-100 hover:cursor-pointer","aria-hidden":"true",onClick:()=>H(!0)})}),(0,n.jsx)("div",{className:"flex flex-row items-center space-x-2",children:J?(0,n.jsx)(f.Z,{className:"h-7 w-7 text-white opacity-50 hover:opacity-100 active:opacity-100 hover:cursor-pointer","aria-hidden":"true",onClick:toggleChatLog}):(0,n.jsx)(b.Z,{className:"h-7 w-7 text-white opacity-50 hover:opacity-100 active:opacity-100 hover:cursor-pointer","aria-hidden":"true",onClick:toggleChatLog})}),(0,n.jsxs)("div",{className:"flex flex-row items-center space-x-2",children:[er?(0,n.jsx)(y.Z,{className:"h-7 w-7 text-white opacity-50 hover:opacity-100 active:opacity-100 hover:cursor-pointer","aria-hidden":"true",onClick:toggleTTSMute}):(0,n.jsx)(w.Z,{className:"h-7 w-7 text-white opacity-50 hover:opacity-100 active:opacity-100 hover:cursor-pointer","aria-hidden":"true",onClick:toggleTTSMute}),(0,n.jsx)("span",{className:"text-white hidden",children:"Mute / Unmute"})]}),(0,n.jsxs)("div",{className:"flex flex-row items-center space-x-2",children:[ei?(0,n.jsx)(j.Z,{className:"h-7 w-7 text-white opacity-50 hover:opacity-100 active:opacity-100 hover:cursor-pointer","aria-hidden":"true",onClick:()=>el(!1)}):(0,n.jsx)(_.Z,{className:"h-7 w-7 text-white opacity-50 hover:opacity-100 active:opacity-100 hover:cursor-pointer","aria-hidden":"true",onClick:()=>el(!0)}),(0,n.jsx)("span",{className:"text-white hidden",children:"Webcam"})]}),(0,n.jsx)("div",{className:"flex flex-row items-center space-x-2 w-[28px] h-[28px]",children:(0,n.jsxs)(h.v,{as:"div",children:[(0,n.jsx)("div",{children:(0,n.jsx)(h.v.Button,{children:(0,n.jsx)(k.Z,{className:"h-7 w-7 text-white opacity-50 hover:opacity-100 active:opacity-100 hover:cursor-pointer","aria-hidden":"true"})})}),(0,n.jsx)(p.u,{as:d.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:(0,n.jsx)(h.v.Items,{className:"absolute left-10 -mt-8 z-10 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none",children:(0,n.jsx)("div",{className:"py-0",children:Object.keys(ew.R).map(e=>(0,n.jsx)(h.v.Item,{children:(0,n.jsx)("button",{className:(0,g.W)(a===e&&"bg-cyan-400 text-white","group flex w-full items-center px-2 py-2 text-sm"),onClick:()=>t.changeLanguage(e),children:ew.R[e].nativeName})},e))})})})]})}),(0,n.jsxs)("div",{className:"flex flex-row items-center space-x-2",children:[(0,n.jsx)(m(),{href:"/share",target:(0,$.U)()?"":"_blank",children:(0,n.jsx)(N.Z,{className:"h-7 w-7 text-white opacity-50 hover:opacity-100 active:opacity-100 hover:cursor-pointer","aria-hidden":"true"})}),(0,n.jsx)("span",{className:"text-white hidden",children:"Share"})]}),(0,n.jsxs)("div",{className:"flex flex-row items-center space-x-2",children:[(0,n.jsx)(m(),{href:"/import",children:(0,n.jsx)(S.Z,{className:"h-7 w-7 text-white opacity-50 hover:opacity-100 active:opacity-100 hover:cursor-pointer","aria-hidden":"true"})}),(0,n.jsx)("span",{className:"text-white hidden",children:"Import"})]}),(0,n.jsx)("div",{className:"flex flex-row items-center space-x-2",children:ea?(0,n.jsx)(T.Z,{className:"h-7 w-7 text-white opacity-100 hover:opacity-50 active:opacity-100 hover:cursor-pointer","aria-hidden":"true",stroke:2,onClick:toggleSubconciousText}):(0,n.jsx)(T.Z,{className:"h-7 w-7 text-white opacity-50 hover:opacity-100 active:opacity-100 hover:cursor-pointer","aria-hidden":"true",stroke:2,onClick:toggleSubconciousText})}),(0,n.jsx)("div",{className:"flex flex-row items-center space-x-2",children:(0,n.jsx)(VerticalSwitchBox,{value:ee,label:"",onChange:()=>{toggleState(et,[Y,es])}})})]})})}),J&&(0,n.jsx)(ChatLog,{messages:E}),!ea&&!J&&!ee&&(0,n.jsxs)(n.Fragment,{children:["assistant"===W&&(0,n.jsx)(AssistantText,{message:F}),"user"===W&&(0,n.jsx)(UserText,{message:O})]}),ee&&(0,n.jsx)(ChatModeText,{messages:E}),ea&&(0,n.jsx)(SubconciousText,{messages:D}),(0,n.jsx)(AddToHomescreen,{}),(0,n.jsx)(Alert,{})]}):(0,n.jsx)(n.Fragment,{})}},50929:function(e,t,a){"use strict";a.d(t,{P3:function(){return r},Z7:function(){return n},gC:function(){return i},t4:function(){return s}});let s=["/bg/bg-arbius1.jpg","/bg/bg-arbius2.jpg","/bg/bg-forest1.jpg","/bg/bg-landscape1.jpg","/bg/bg-landscape2.jpg","/bg/bg-landscape3.jpg","/bg/bg-room1.jpg","/bg/bg-room2.jpg","/bg/bg-sunset1.jpg","/bg/bg-town1.jpg"],r=["/vrm/AvatarSample_A.vrm","/vrm/AvatarSample_B.vrm","/vrm/AvatarSample_C.vrm","/vrm/AvatarSample_D.vrm"],n=["/speecht5_speaker_embeddings/cmu_us_awb_arctic-wav-arctic_a0002.bin","/speecht5_speaker_embeddings/cmu_us_slt_arctic-wav-arctic_a0001.bin"],i=["/animations/dance.vrma","/animations/greeting.vrma","/animations/idle_loop.vrma","/animations/modelPose.vrma","/animations/peaceSign.vrma","/animations/shoot.vrma","/animations/showFullBody.vrma","/animations/spin.vrma","/animations/squat.vrma"]},46572:function(e,t,a){"use strict";a.d(t,{N:function(){return buildPrompt},f:function(){return buildVisionPrompt}});var s=a(65752);function buildPrompt(e){let t="";for(let a of e)switch(a.role){case"system":t+=(0,s.vc)("system_prompt")+"\n\n";break;case"user":t+="User: ".concat(a.content,"\n");break;case"assistant":t+="".concat((0,s.vc)("name"),": ").concat(a.content,"\n")}return t+"".concat((0,s.vc)("name"),":")}function buildVisionPrompt(e){let t="";for(let a of e)switch(a.role){case"system":t+=(0,s.vc)("vision_system_prompt")+"\n\n";break;case"user":t+="User: ".concat(a.content,"\n");break;case"assistant":t+="".concat((0,s.vc)("name"),": ").concat(a.content,"\n")}return t+"".concat((0,s.vc)("name"),":")}},93206:function(e,t,a){"use strict";a.d(t,{T:function(){return resetIdleTimer},TH:function(){return characterIdleTime},Yi:function(){return isCharacterIdle},fL:function(){return pauseIdleTimer},hw:function(){return resumeIdleTimer}});var s=a(65752);let r=!1,n=0,i=0;function isCharacterIdle(e){return(new Date().getTime()-e-i)/1e3>=parseInt((0,s.vc)("time_before_idle_sec"))}function characterIdleTime(e){return(new Date().getTime()-e-i)/1e3-parseInt((0,s.vc)("time_before_idle_sec"))}function pauseIdleTimer(){r||(r=!0,n=new Date().getTime())}function resumeIdleTimer(){r&&(r=!1,i+=new Date().getTime()-n)}function resetIdleTimer(){r=!1,n=0,i=0}},87797:function(e,t,a){"use strict";a.d(t,{F:function(){return processResponse}});var s=a(92613);function processResponse(e){let{sentences:t,aiTextLog:a,receivedMessage:r,tag:n,rolePlay:i,callback:l}=e,o=!1,c=r.match(/^\[(.*?)\]/);c&&c[0]&&(n=c[0],r=r.slice(n.length));let d=r.match(/\*(.*?)\*/);d&&d[0]&&(i=d[0],r=r.replace(i,""));let u=r.match(/^(.+[\.\\!\\?\\\n]|.{10,}[,])/);if(u&&u[0]){let e=u[0];if(t.push(e),r=r.slice(e.length).trimStart(),!e.replace(/^[\s\[\(\{\}\)\]]+$/g,""))return{sentences:t,aiTextLog:a,receivedMessage:r,tag:n,rolePlay:i,shouldBreak:o};let c="".concat(n," ").concat(e),d=(0,s._o)([c]);a+=c,o=l(d)}return{sentences:t,aiTextLog:a,receivedMessage:r,tag:n,rolePlay:i,shouldBreak:o}}},24852:function(e,t,a){"use strict";function updateFileProgress(e,t){window.chatvrm_loading_progress||(window.chatvrm_loading_progress={},window.chatvrm_loading_progress_cnt=0),100===t?delete window.chatvrm_loading_progress[e]:window.chatvrm_loading_progress[e]=t,window.chatvrm_loading_progress_cnt++}a.d(t,{I:function(){return updateFileProgress}})},22725:function(e,t,a){"use strict";a.d(t,{D:function(){return wait}});let wait=async e=>new Promise(t=>setTimeout(t,e))},2264:function(e){e.exports={FlexTextarea:"flexTextarea_FlexTextarea___hc6U",FlexTextarea__dummy:"flexTextarea_FlexTextarea__dummy__gh_ho",FlexTextarea__textarea:"flexTextarea_FlexTextarea__textarea__i90by"}}},function(e){e.O(0,[8086,3737,7922,2139,923,9774,2888,179],function(){return e(e.s=48312)}),_N_E=e.O()}]);