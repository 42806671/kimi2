(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3347],{46351:function(e,s,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/share",function(){return a(28350)}])},45417:function(e,s,a){"use strict";a.d(s,{h:function(){return IconButton}});var t=a(85893);let IconButton=e=>{let{iconName:s,isProcessing:a,label:r,...d}=e;return(0,t.jsxs)("button",{...d,className:"bg-primary hover:bg-primary-hover active:bg-primary-press disabled:bg-primary-disabled text-white rounded-lg text-sm p-1 text-center inline-flex items-center mr-2\n        ".concat(d.className,"\n      "),children:[a?(0,t.jsx)("pixiv-icon",{name:"24/Dot",scale:"1"}):(0,t.jsx)("pixiv-icon",{name:s,scale:"1"}),r&&(0,t.jsx)("div",{className:"mx-2 font-bold",children:r})]})}},44387:function(e,s,a){"use strict";a.d(s,{Z:function(){return VrmDemo}});var t=a(85893),r=a(67294),d=a(54156),n=a(89537);function VrmDemo(e){let{vrmUrl:s,onScreenShot:a,onLoaded:l,onError:c}=e,{viewer:o}=(0,r.useContext)(d.Z),[i,m]=(0,r.useState)(!0),[u,f]=(0,r.useState)(!1);(0,r.useEffect)(()=>{m(!0),f(!1)},[s]);let x=(0,r.useCallback)(e=>{e&&(o.setup(e),new Promise(async(e,a)=>{try{await o.loadVrm((0,n.Q)(s)),e(!0)}catch(e){a()}}).then(()=>{console.log("vrm loaded"),m(!1),f(!1),l&&l()}).then(()=>{if(a)return new Promise(e=>setTimeout(e,300))}).then(()=>{a&&o.getScreenshotBlob(a)}).catch(e=>{console.error("vrm loading error",e),f(!0),m(!1),c&&c()}))},[o,s]);return(0,t.jsxs)("div",{children:[(0,t.jsx)("canvas",{ref:x,className:"h-full w-full"}),i&&(0,t.jsx)("div",{className:"text-gray-500 p-2 text-2xl",children:"Loading..."}),u&&(0,t.jsx)("div",{className:"p-2 text-2xl",children:"Error loading VRM model..."})]})}},28350:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return Share}});var t=a(85893),r=a(5379),d=a.n(r),n=a(42474),l=a(41664),c=a.n(l),o=a(11163),i=a(67294),m=a(67421),u=a(65752),f=a(40577),x=a(73042),g=a(54156),h=a(44387),p=a(3766),b=a(72965),j=a.n(b),y=a(90521),v=a.n(y);a(83027),a(12817);var w=a(35118),N=a(45417),k=a(48764).Buffer;async function hashFile(e){let s=await e.arrayBuffer(),a=(0,n.createHash)("sha256").update(k.from(s)).digest("hex");return a}async function updateVrmAvatar(e,s){try{await e.loadVrm(s)}catch(e){console.error(e)}}function vrmDetector(e,s){return new Promise((s,a)=>{console.log(e),(async()=>{let a=await e.arrayBuffer(),t=k.from(a);"glTF"===t.slice(0,4).toString()?s("model/gltf-binary"):s("unknown")})()})}function Share(){let{t:e}=(0,m.$G)(),{viewer:s}=(0,i.useContext)(g.Z),[a,r]=(0,i.useState)(""),[n,l]=(0,i.useState)(""),[b,j]=(0,i.useState)(""),[y,v]=(0,i.useState)(""),[k,_]=(0,i.useState)(""),[S,C]=(0,i.useState)(""),[V,F]=(0,i.useState)(""),[O,T]=(0,i.useState)(""),[P,E]=(0,i.useState)(""),[I,D]=(0,i.useState)(""),[R,B]=(0,i.useState)(""),[U,z]=(0,i.useState)([]),[A,Q]=(0,i.useState)([]),[Z,M]=(0,i.useState)([]),[q,L]=(0,i.useState)([]),[X,H]=(0,i.useState)(!1),[W,G]=(0,i.useState)(!1),[J,Y]=(0,i.useState)(!1),[$,K]=(0,i.useState)(!1),[ee,es]=(0,i.useState)(""),ea=(0,i.useRef)(null),delay=e=>new Promise(s=>setTimeout(s,e));async function uploadVrmFromIndexedDb(){let e=await w.Z.getItemAsBlob(O);ea.current&&e?ea.current.addFile(e).then(()=>{Y(!0)}):(console.log("FilePond not loaded, retry in 0.5 sec"),delay(500).then(uploadVrmFromIndexedDb))}(0,i.useEffect)(()=>{l((0,u.vc)("name")),j((0,u.vc)("system_prompt")),v((0,u.vc)("vision_system_prompt")),(0,u.vc)("bg_url").startsWith("data")||_((0,u.vc)("bg_url")),C((0,u.vc)("youtube_videoid")),F((0,u.vc)("vrm_url")),T((0,u.vc)("vrm_hash")),E((0,u.vc)("vrm_save_type")),D((0,u.vc)("animation_url")),B((0,u.vc)("voice_url"))},[]),(0,i.useEffect)(()=>{W&&(w.Z.addItemUrl(O,V),(0,u.rF)("vrm_url",V),(0,u.rF)("vrm_save_type","web"),E("web"))},[W]),(0,i.useEffect)(()=>{K("local"==P&&!W&&!J)},[P,W,J]);let[et,er]=(0,i.useState)(!1),ed=(0,o.useRouter)();return(0,i.useEffect)(()=>{document.body.style.backgroundImage="url(/liquid-metaballs.jpg)",document.body.style.backgroundSize="cover",document.body.style.backgroundRepeat="no-repeat",document.body.style.backgroundPosition="bottom right"},[]),(0,t.jsxs)("div",{className:"jsx-451d1f271e3fcd98 p-10 md:p-20",children:[(0,t.jsx)(d(),{id:"451d1f271e3fcd98",children:'body{background-image:url("/liquid-metaballs.jpg");-webkit-background-size:cover;-moz-background-size:cover;-o-background-size:cover;background-size:cover;background-repeat:no-repeat;background-position:bottom right}'}),(0,t.jsx)("div",{className:"jsx-451d1f271e3fcd98 fixed top-0 left-0 w-full max-h-full text-black text-xs text-left z-20",children:(0,t.jsx)("div",{className:"jsx-451d1f271e3fcd98 p-2 bg-white",children:(0,t.jsx)(N.h,{iconName:"24/Close",isProcessing:!1,className:"bg-secondary hover:bg-secondary-hover active:bg-secondary-active",onClick:()=>{ed.push("/")}})})}),(0,t.jsx)("div",{className:"jsx-451d1f271e3fcd98 col-span-3 max-w-md rounded-xl mt-4",children:(0,t.jsx)("h1",{className:"jsx-451d1f271e3fcd98 text-lg",children:e("Character Creator")})}),(0,t.jsxs)("div",{className:"jsx-451d1f271e3fcd98 grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"jsx-451d1f271e3fcd98",children:[(0,t.jsxs)("div",{className:"jsx-451d1f271e3fcd98 sm:col-span-3 max-w-md rounded-xl mt-4",children:[(0,t.jsx)("label",{className:"jsx-451d1f271e3fcd98 block text-sm font-medium leading-6 text-gray-900",children:e("Description")}),(0,t.jsx)("div",{className:"jsx-451d1f271e3fcd98 mt-2",children:(0,t.jsx)("textarea",{rows:4,value:a,readOnly:!!ee,placeholder:e("Provide a description of the character"),onChange:e=>{r(e.target.value)},className:"jsx-451d1f271e3fcd98 block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"})})]}),(0,t.jsxs)("div",{className:"jsx-451d1f271e3fcd98 sm:col-span-3 max-w-md rounded-xl mt-4",children:[(0,t.jsx)("label",{className:"jsx-451d1f271e3fcd98 block text-sm font-medium leading-6 text-gray-900",children:e("Name")}),(0,t.jsx)("div",{className:"jsx-451d1f271e3fcd98 mt-2",children:(0,t.jsx)("input",{type:"text",value:n,readOnly:!!ee,onChange:e=>{l(e.target.value)},className:"jsx-451d1f271e3fcd98 block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"})})]}),(0,t.jsxs)("div",{className:"jsx-451d1f271e3fcd98 sm:col-span-3 max-w-md rounded-xl mt-4",children:[(0,t.jsx)("label",{className:"jsx-451d1f271e3fcd98 block text-sm font-medium leading-6 text-gray-900",children:e("System Prompt")}),(0,t.jsx)("div",{className:"jsx-451d1f271e3fcd98 mt-2",children:(0,t.jsx)("textarea",{rows:4,value:b,readOnly:!!ee,onChange:e=>{j(e.target.value)},className:"jsx-451d1f271e3fcd98 block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"})})]}),(0,t.jsxs)("div",{className:"jsx-451d1f271e3fcd98 sm:col-span-3 max-w-md rounded-xl mt-4",children:[(0,t.jsx)("label",{className:"jsx-451d1f271e3fcd98 block text-sm font-medium leading-6 text-gray-900",children:e("Vision System Prompt")}),(0,t.jsx)("div",{className:"jsx-451d1f271e3fcd98 mt-2",children:(0,t.jsx)("textarea",{rows:4,value:y,readOnly:!!ee,onChange:e=>{v(e.target.value)},className:"jsx-451d1f271e3fcd98 block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"})})]}),(0,t.jsxs)("div",{className:"jsx-451d1f271e3fcd98 sm:col-span-3 max-w-md rounded-xl mt-4",children:[(0,t.jsx)("label",{className:"jsx-451d1f271e3fcd98 block text-sm font-medium leading-6 text-gray-900",children:e("Background URL")}),(0,t.jsxs)("div",{className:"jsx-451d1f271e3fcd98 mt-2",children:[(0,t.jsx)("input",{type:"text",value:k,readOnly:!!ee,onChange:e=>{_(e.target.value)},className:"jsx-451d1f271e3fcd98 block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"}),(0,t.jsx)(x.Q9,{files:U,onupdatefiles:e=>{z(e)},server:"".concat("https://store.heyamica.com","/api/upload?type=bgimg"),name:"file",labelIdle:".png & .jpg files only<br />click or drag & drop",acceptedFileTypes:["image/png","image/jpeg"],onremovefile:(e,s)=>{if(e){console.error(e);return}_("")},onprocessfile:(e,s)=>{if(e){console.error(e);return}(async function(e){let s=await hashFile(e);_("".concat("https://vrm.heyamica.com/file/amica-vrm","/").concat(s))})(s.file)},disabled:!!ee})]})]}),(0,t.jsxs)("div",{className:"jsx-451d1f271e3fcd98 sm:col-span-3 max-w-md rounded-xl mt-4",children:[(0,t.jsx)("label",{className:"jsx-451d1f271e3fcd98 block text-sm font-medium leading-6 text-gray-900",children:e("YouTube Video ID")}),(0,t.jsxs)("div",{className:"jsx-451d1f271e3fcd98 mt-2",children:[(0,t.jsxs)("p",{className:"jsx-451d1f271e3fcd98 text-xs text-slate-500",children:[e("Example"),": https://www.youtube.com/watch?v=",(0,t.jsx)("span",{className:"jsx-451d1f271e3fcd98 text-red-500",children:"dQw4w9WgXcQ"})]}),(0,t.jsx)("input",{type:"text",value:S,readOnly:!!ee,onChange:e=>{C(e.target.value)},className:"jsx-451d1f271e3fcd98 block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"}),S&&(0,t.jsx)("img",{width:"100%",src:"https://img.youtube.com/vi/".concat(S,"/0.jpg"),className:"jsx-451d1f271e3fcd98"})]})]}),$&&(0,t.jsxs)("div",{className:"jsx-451d1f271e3fcd98 sm:col-span-3 max-w-md rounded-xl mt-4",children:[(0,t.jsx)("label",{className:"jsx-451d1f271e3fcd98 block text-sm font-medium leading-6 text-gray-900",children:e("Upload VRM")}),(0,t.jsxs)("div",{className:"jsx-451d1f271e3fcd98 mt-2 text-sm leading-6 text-gray-900",children:[(0,t.jsx)("p",{className:"jsx-451d1f271e3fcd98",children:e("VRM upload message")}),(0,t.jsx)("p",{className:"jsx-451d1f271e3fcd98",children:e("VRM local share message")}),(0,t.jsx)("div",{className:"jsx-451d1f271e3fcd98 sm:col-span-3 max-w-md rounded-xl mt-2",children:(0,t.jsx)("button",{onClick:uploadVrmFromIndexedDb,className:"jsx-451d1f271e3fcd98 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-fuchsia-500 hover:bg-fuchsia-600 focus:outline-none disabled:opacity-50 disabled:hover:bg-fuchsia-500 disabled:cursor-not-allowed",children:e("Upload Vrm")})})]})]}),(0,t.jsxs)("div",{className:"jsx-451d1f271e3fcd98 sm:col-span-3 max-w-md rounded-xl mt-4"+($?" hidden":""),children:[(0,t.jsx)("label",{className:"jsx-451d1f271e3fcd98 block text-sm font-medium leading-6 text-gray-900",children:e("VRM Url")}),(0,t.jsxs)("div",{className:"jsx-451d1f271e3fcd98 mt-2",children:[(0,t.jsx)("p",{className:"jsx-451d1f271e3fcd98 text-xs text-slate-500"}),(0,t.jsx)("input",{type:"text",value:V,readOnly:!!ee,onChange:e=>{F(e.target.value),updateVrmAvatar(s,e.target.value),H(!1)},className:"jsx-451d1f271e3fcd98 block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"}),(0,t.jsx)(x.Q9,{ref:ea,files:A,onupdatefiles:e=>{Q(e)},server:"".concat("https://store.heyamica.com","/api/upload?type=vrm"),name:"file",labelIdle:".vrm files only<br />click or drag & drop",acceptedFileTypes:["model/gltf-binary"],fileValidateTypeDetectType:vrmDetector,onaddfilestart:e=>{F(""),H(!1)},onremovefile:(e,s)=>{if(e){console.error(e);return}F(""),H(!1)},onprocessfile:(e,a)=>{if(e){console.error(e);return}(async function(e){let a=await hashFile(e),t="".concat("https://vrm.heyamica.com/file/amica-vrm","/").concat(a);F(t),updateVrmAvatar(s,t),"local"==P&&(Y(!1),G(!0)),H(!1)})(a.file)},disabled:!!ee}),(0,t.jsx)("div",{className:"jsx-451d1f271e3fcd98 sm:col-span-3 max-w-md rounded-xl mt-4 bg-gray-100",children:V&&(0,t.jsx)(h.Z,{vrmUrl:V,onLoaded:()=>{H(!0),(async()=>{try{let e=await (0,p.S)("/animations/idle_loop.vrma");if(!e){console.error("loading animation failed");return}s.model.loadAnimation(e),requestAnimationFrame(()=>{s.resetCamera()})}catch(e){console.error("loading animation failed",e)}})(),console.log("vrm demo loaded")}})})]})]}),(0,t.jsxs)("div",{className:"jsx-451d1f271e3fcd98 sm:col-span-3 max-w-md rounded-xl mt-4",children:[(0,t.jsx)("label",{className:"jsx-451d1f271e3fcd98 block text-sm font-medium leading-6 text-gray-900",children:"Voice Url"}),(0,t.jsxs)("div",{className:"jsx-451d1f271e3fcd98 mt-2",children:[(0,t.jsx)("input",{type:"text",value:R,readOnly:!!ee,onChange:e=>{B(e.target.value)},className:"jsx-451d1f271e3fcd98 block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"}),(0,t.jsx)(x.Q9,{files:q,onupdatefiles:e=>{L(e)},server:"".concat("https://store.heyamica.com","/api/upload?type=voice"),name:"file",labelIdle:".wav & .mp3 files only<br />click or drag & drop",acceptedFileTypes:["audio/wav","audio/mpeg"],onremovefile:(e,s)=>{if(e){console.error(e);return}B("")},onprocessfile:(e,s)=>{if(e){console.error(e);return}(async function(e){let s=await hashFile(e);B("".concat("https://vrm.heyamica.com/file/amica-vrm","/").concat(s))})(s.file)},disabled:!!ee})]})]}),!ee&&(0,t.jsx)("div",{className:"jsx-451d1f271e3fcd98 sm:col-span-3 max-w-md rounded-xl mt-8",children:(0,t.jsx)("button",{onClick:function(){er(!0),async function(){let e=await fetch("".concat("https://store.heyamica.com","/api/add_character"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({description:a,name:n,system_prompt:b,vision_system_prompt:y,bg_url:k,youtube_videoid:S,vrm_url:V,animation_url:I,voice_url:R})}),s=await e.json();console.log("response",s),es(s.sqid),er(!1)}()},disabled:!X||$||J||et,className:"jsx-451d1f271e3fcd98 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-fuchsia-500 hover:bg-fuchsia-600 focus:outline-none disabled:opacity-50 disabled:hover:bg-fuchsia-500 disabled:cursor-not-allowed",children:e("Save Character")})}),ee&&(0,t.jsxs)("div",{className:"jsx-451d1f271e3fcd98 sm:col-span-3 max-w-md rounded-xl mt-8",children:[(0,t.jsx)("p",{className:"jsx-451d1f271e3fcd98 text-sm",children:e("Share this code (click to copy):")}),(0,t.jsx)("input",{type:"text",defaultValue:ee,readOnly:!0,onClick:e=>{navigator.clipboard.writeText(e.target.value)},className:"jsx-451d1f271e3fcd98 inline-flex items-center px-2 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-fuchsia-600 bg-fuchsia-100 hover:bg-fuchsia-200 focus:outline-transparent focus:border-transparent border-transparent disabled:opacity-50 disabled:hover:bg-fuchsia-50 disabled:cursor-not-allowed hover:cursor-copy"}),(0,t.jsxs)("p",{className:"jsx-451d1f271e3fcd98 mt-6 text-sm",children:[e("Or, you can share this direct link:")," ",(0,t.jsxs)(c(),{href:"https://amica.arbius.ai/import/".concat(ee),target:(0,f.U)()?"_blank":"",className:"text-cyan-600 hover:text-cyan-700",children:["https://amica.arbius.ai/import/",ee]})]}),(0,t.jsx)(c(),{href:"/",children:(0,t.jsx)("button",{className:"jsx-451d1f271e3fcd98 mt-6 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-emerald-500 hover:bg-emerald-600 focus:outline-none disabled:opacity-50 disabled:hover:bg-emerald-500 disabled:cursor-not-allowed",children:e("Return Home")})})]})]}),(0,t.jsx)("div",{className:"jsx-451d1f271e3fcd98"})]})]})}(0,x.fo)(j(),v())}},function(e){e.O(0,[8086,3737,3714,7719,7922,4380,923,9774,2888,179],function(){return e(e.s=46351)}),_N_E=e.O()}]);