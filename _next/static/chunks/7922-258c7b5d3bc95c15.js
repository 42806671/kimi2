(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7922],{22617:function(d,x,T){d.exports=function(){"use strict";var s=function(d,x){return(s=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(d,x){d.__proto__=x}||function(d,x){for(var T in x)Object.prototype.hasOwnProperty.call(x,T)&&(d[T]=x[T])})(d,x)},w=function(){return(w=Object.assign||function(d){for(var x,T=1,E=arguments.length;T<E;T++)for(var I in x=arguments[T])Object.prototype.hasOwnProperty.call(x,I)&&(d[I]=x[I]);return d}).apply(this,arguments)};function i(d,x,T){if(T||2==arguments.length)for(var E,I=0,R=x.length;I<R;I++)!E&&I in x||((E=E||Array.prototype.slice.call(x,0,I))[I]=x[I]);return d.concat(E||Array.prototype.slice.call(x))}var d="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:T.g,x=Object.keys,E=Array.isArray;function a(d,T){return"object"!=typeof T||x(T).forEach(function(x){d[x]=T[x]}),d}"undefined"==typeof Promise||d.Promise||(d.Promise=Promise);var I=Object.getPrototypeOf,R={}.hasOwnProperty;function m(d,x){return R.call(d,x)}function r(d,T){"function"==typeof T&&(T=T(I(d))),("undefined"==typeof Reflect?x:Reflect.ownKeys)(T).forEach(function(x){l(d,x,T[x])})}var k=Object.defineProperty;function l(d,x,T,E){k(d,x,a(T&&m(T,"get")&&"function"==typeof T.get?{get:T.get,set:T.set,configurable:!0}:{value:T,configurable:!0,writable:!0},E))}function o(d){return{from:function(x){return d.prototype=Object.create(x.prototype),l(d.prototype,"constructor",d),{extend:r.bind(null,d.prototype)}}}}var M=Object.getOwnPropertyDescriptor,C=[].slice;function b(d,x,T){return C.call(d,x,T)}function p(d,x){return x(d)}function y(d){if(!d)throw Error("Assertion Failed")}function v(x){d.setImmediate?setImmediate(x):setTimeout(x,0)}function O(d,x){if("string"==typeof x&&m(d,x))return d[x];if(!x)return d;if("string"!=typeof x){for(var T=[],E=0,I=x.length;E<I;++E){var R=O(d,x[E]);T.push(R)}return T}var k=x.indexOf(".");if(-1!==k){var M=d[x.substr(0,k)];return null==M?void 0:O(M,x.substr(k+1))}}function P(d,x,T){if(d&&void 0!==x&&!("isFrozen"in Object&&Object.isFrozen(d))){if("string"!=typeof x&&"length"in x){y("string"!=typeof T&&"length"in T);for(var I=0,R=x.length;I<R;++I)P(d,x[I],T[I])}else{var k,M,C=x.indexOf(".");-1!==C?(k=x.substr(0,C),""===(M=x.substr(C+1))?void 0===T?E(d)&&!isNaN(parseInt(k))?d.splice(k,1):delete d[k]:d[k]=T:P(C=(C=d[k])&&m(d,k)?C:d[k]={},M,T)):void 0===T?E(d)&&!isNaN(parseInt(x))?d.splice(x,1):delete d[x]:d[x]=T}}}function g(d){var x,T={};for(x in d)m(d,x)&&(T[x]=d[x]);return T}var D=[].concat;function _(d){return D.apply([],d)}var F="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(_([8,16,32,64].map(function(d){return["Int","Uint","Float"].map(function(x){return x+d+"Array"})}))).filter(function(x){return d[x]}),j=new Set(F.map(function(x){return d[x]})),K=null;function S(d){return K=new WeakMap,d=function e(d){if(!d||"object"!=typeof d)return d;var x=K.get(d);if(x)return x;if(E(d)){x=[],K.set(d,x);for(var T=0,R=d.length;T<R;++T)x.push(e(d[T]))}else if(j.has(d.constructor))x=d;else{var k,M=I(d);for(k in x=M===Object.prototype?{}:Object.create(M),K.set(d,x),d)m(d,k)&&(x[k]=e(d[k]))}return x}(d),K=null,d}var V={}.toString;function A(d){return V.call(d).slice(8,-1)}var W="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator",Y="symbol"==typeof W?function(d){var x;return null!=d&&(x=d[W])&&x.apply(d)}:function(){return null};function q(d,x){return 0<=(x=d.indexOf(x))&&d.splice(x,1),0<=x}var $={};function B(d){var x,T,I,R;if(1==arguments.length){if(E(d))return d.slice();if(this===$&&"string"==typeof d)return[d];if(R=Y(d)){for(T=[];!(I=R.next()).done;)T.push(I.value);return T}if(null==d||"number"!=typeof(x=d.length))return[d];for(T=Array(x);x--;)T[x]=d[x];return T}for(x=arguments.length,T=Array(x);x--;)T[x]=arguments[x];return T}var Q="undefined"!=typeof Symbol?function(d){return"AsyncFunction"===d[Symbol.toStringTag]}:function(){return!1},et=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],er=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(et),ei={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function N(d,x){this.name=d,this.message=x}function L(d,x){return d+". Errors: "+Object.keys(x).map(function(d){return x[d].toString()}).filter(function(d,x,T){return T.indexOf(d)===x}).join("\n")}function U(d,x,T,E){this.failures=x,this.failedKeys=E,this.successCount=T,this.message=L(d,x)}function z(d,x){this.name="BulkError",this.failures=Object.keys(x).map(function(d){return x[d]}),this.failuresByPos=x,this.message=L(d,this.failures)}o(N).from(Error).extend({toString:function(){return this.name+": "+this.message}}),o(U).from(N),o(z).from(N);var eo=er.reduce(function(d,x){return d[x]=x+"Error",d},{}),ea=er.reduce(function(d,x){var T=x+"Error";function t(d,E){this.name=T,d?"string"==typeof d?(this.message="".concat(d).concat(E?"\n "+E:""),this.inner=E||null):"object"==typeof d&&(this.message="".concat(d.name," ").concat(d.message),this.inner=d):(this.message=ei[x]||T,this.inner=null)}return o(t).from(N),d[x]=t,d},{});ea.Syntax=SyntaxError,ea.Type=TypeError,ea.Range=RangeError;var es=et.reduce(function(d,x){return d[x+"Error"]=ea[x],d},{}),eu=er.reduce(function(d,x){return -1===["Syntax","Type","Range"].indexOf(x)&&(d[x+"Error"]=ea[x]),d},{});function G(){}function X(d){return d}function H(d,x){return null==d||d===X?x:function(T){return x(d(T))}}function J(d,x){return function(){d.apply(this,arguments),x.apply(this,arguments)}}function Z(d,x){return d===G?x:function(){var T=d.apply(this,arguments);void 0!==T&&(arguments[0]=T);var E=this.onsuccess,I=this.onerror;this.onsuccess=null,this.onerror=null;var R=x.apply(this,arguments);return E&&(this.onsuccess=this.onsuccess?J(E,this.onsuccess):E),I&&(this.onerror=this.onerror?J(I,this.onerror):I),void 0!==R?R:T}}function ee(d,x){return d===G?x:function(){d.apply(this,arguments);var T=this.onsuccess,E=this.onerror;this.onsuccess=this.onerror=null,x.apply(this,arguments),T&&(this.onsuccess=this.onsuccess?J(T,this.onsuccess):T),E&&(this.onerror=this.onerror?J(E,this.onerror):E)}}function te(d,x){return d===G?x:function(T){var E=d.apply(this,arguments);a(T,E);var I=this.onsuccess,R=this.onerror;return this.onsuccess=null,this.onerror=null,T=x.apply(this,arguments),I&&(this.onsuccess=this.onsuccess?J(I,this.onsuccess):I),R&&(this.onerror=this.onerror?J(R,this.onerror):R),void 0===E?void 0===T?void 0:T:a(E,T)}}function ne(d,x){return d===G?x:function(){return!1!==x.apply(this,arguments)&&d.apply(this,arguments)}}function re(d,x){return d===G?x:function(){var T=d.apply(this,arguments);if(T&&"function"==typeof T.then){for(var E=this,I=arguments.length,R=Array(I);I--;)R[I]=arguments[I];return T.then(function(){return x.apply(E,R)})}return x.apply(this,arguments)}}eu.ModifyError=U,eu.DexieError=N,eu.BulkError=z;var el="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href),ec={},F="undefined"==typeof Promise?[]:function(){var d=Promise.resolve();if("undefined"==typeof crypto||!crypto.subtle)return[d,I(d),d];var x=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[x,I(x),d]}(),et=F[0],er=F[1],F=F[2],er=er&&er.then,ef=et&&et.constructor,eh=!!F,le=function(d,x){ew.push([d,x]),ep&&(queueMicrotask(Se),ep=!1)},ed=!0,ep=!0,em=[],ey=[],eg=X,ev={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:G,pgp:!1,env:{},finalize:G},eb=ev,ew=[],ex=0,eT=[];function _e(d){if("object"!=typeof this)throw TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var x=this._PSD=eb;if("function"!=typeof d){if(d!==ec)throw TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&Oe(this,this._value))}this._state=null,this._value=null,++x.ref,function t(d,x){try{x(function(x){if(null===d._state){if(x===d)throw TypeError("A promise cannot be resolved with itself.");var T=d._lib&&je();x&&"function"==typeof x.then?t(d,function(d,T){x instanceof _e?x._then(d,T):x.then(d,T)}):(d._state=!0,d._value=x,Pe(d)),T&&Ae()}},Oe.bind(null,d))}catch(x){Oe(d,x)}}(this,d)}var e_={get:function(){var d=eb,x=eR;function e(T,E){var I=this,R=!d.global&&(d!==eb||x!==eR),k=R&&!Ue(),M=new _e(function(x,M){Ee(I,new ke(Qe(T,d,R,k),Qe(E,d,R,k),x,M,d))});return this._consoleTask&&(M._consoleTask=this._consoleTask),M}return e.prototype=ec,e},set:function(d){l(this,"then",d&&d.prototype===ec?e_:{get:function(){return d},set:e_.set})}};function ke(d,x,T,E,I){this.onFulfilled="function"==typeof d?d:null,this.onRejected="function"==typeof x?x:null,this.resolve=T,this.reject=E,this.psd=I}function Oe(d,x){var T;ey.push(x),null===d._state&&(T=d._lib&&je(),x=eg(x),d._state=!1,d._value=x,em.some(function(x){return x._value===d._value})||em.push(d),Pe(d),T&&Ae())}function Pe(d){var x=d._listeners;d._listeners=[];for(var T=0,E=x.length;T<E;++T)Ee(d,x[T]);var I=d._PSD;--I.ref||I.finalize(),0===ex&&(++ex,le(function(){0==--ex&&Ce()},[]))}function Ee(d,x){if(null!==d._state){var T=d._state?x.onFulfilled:x.onRejected;if(null===T)return(d._state?x.resolve:x.reject)(d._value);++x.psd.ref,++ex,le(Ke,[T,d,x])}else d._listeners.push(x)}function Ke(d,x,T){try{var E,I=x._value;!x._state&&ey.length&&(ey=[]),E=el&&x._consoleTask?x._consoleTask.run(function(){return d(I)}):d(I),x._state||-1!==ey.indexOf(I)||function(d){for(var x=em.length;x;)if(em[--x]._value===d._value)return em.splice(x,1)}(x),T.resolve(E)}catch(d){T.reject(d)}finally{0==--ex&&Ce(),--T.psd.ref||T.psd.finalize()}}function Se(){$e(ev,function(){je()&&Ae()})}function je(){var d=ed;return ep=ed=!1,d}function Ae(){var d,x,T;do for(;0<ew.length;)for(d=ew,ew=[],T=d.length,x=0;x<T;++x){var E=d[x];E[0].apply(null,E[1])}while(0<ew.length);ep=ed=!0}function Ce(){var d=em;em=[],d.forEach(function(d){d._PSD.onunhandled.call(null,d._value,d)});for(var x=eT.slice(0),T=x.length;T;)x[--T]()}function De(d){return new _e(ec,!1,d)}function qe(d,x){var T=eb;return function(){var E=je(),I=eb;try{return We(T,!0),d.apply(this,arguments)}catch(d){x&&x(d)}finally{We(I,!1),E&&Ae()}}}r(_e.prototype,{then:e_,_then:function(d,x){Ee(this,new ke(null,null,d,x,eb))},catch:function(d){if(1==arguments.length)return this.then(null,d);var x=arguments[1];return"function"==typeof d?this.then(null,function(T){return(T instanceof d?x:De)(T)}):this.then(null,function(T){return(T&&T.name===d?x:De)(T)})},finally:function(d){return this.then(function(x){return _e.resolve(d()).then(function(){return x})},function(x){return _e.resolve(d()).then(function(){return De(x)})})},timeout:function(d,x){var T=this;return d<1/0?new _e(function(E,I){var R=setTimeout(function(){return I(new ea.Timeout(x))},d);T.then(E,I).finally(clearTimeout.bind(null,R))}):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&l(_e.prototype,Symbol.toStringTag,"Dexie.Promise"),ev.env=Ye(),r(_e,{all:function(){var d=B.apply(null,arguments).map(ze);return new _e(function(x,T){0===d.length&&x([]);var E=d.length;d.forEach(function(I,R){return _e.resolve(I).then(function(T){d[R]=T,--E||x(d)},T)})})},resolve:function(d){return d instanceof _e?d:d&&"function"==typeof d.then?new _e(function(x,T){d.then(x,T)}):new _e(ec,!0,d)},reject:De,race:function(){var d=B.apply(null,arguments).map(ze);return new _e(function(x,T){d.map(function(d){return _e.resolve(d).then(x,T)})})},PSD:{get:function(){return eb},set:function(d){return eb=d}},totalEchoes:{get:function(){return eR}},newPSD:Ne,usePSD:$e,scheduler:{get:function(){return le},set:function(d){le=d}},rejectionMapper:{get:function(){return eg},set:function(d){eg=d}},follow:function(d,x){return new _e(function(T,E){return Ne(function(x,T){var E=eb;E.unhandleds=[],E.onunhandled=T,E.finalize=J(function(){var d,E=this;d=function(){0===E.unhandleds.length?x():T(E.unhandleds[0])},eT.push(function e(){d(),eT.splice(eT.indexOf(e),1)}),++ex,le(function(){0==--ex&&Ce()},[])},E.finalize),d()},x,T,E)})}}),ef&&(ef.allSettled&&l(_e,"allSettled",function(){var d=B.apply(null,arguments).map(ze);return new _e(function(x){0===d.length&&x([]);var T=d.length,E=Array(T);d.forEach(function(d,I){return _e.resolve(d).then(function(d){return E[I]={status:"fulfilled",value:d}},function(d){return E[I]={status:"rejected",reason:d}}).then(function(){return--T||x(E)})})})}),ef.any&&"undefined"!=typeof AggregateError&&l(_e,"any",function(){var d=B.apply(null,arguments).map(ze);return new _e(function(x,T){0===d.length&&T(AggregateError([]));var E=d.length,I=Array(E);d.forEach(function(d,R){return _e.resolve(d).then(function(d){return x(d)},function(d){I[R]=d,--E||T(AggregateError(I))})})})}));var eA={awaits:0,echoes:0,id:0},eE=0,eP=[],eI=0,eR=0,eO=0;function Ne(d,x,T,E){var I=eb,R=Object.create(I);return R.parent=I,R.ref=0,R.global=!1,R.id=++eO,ev.env,R.env=eh?{Promise:_e,PromiseProp:{value:_e,configurable:!0,writable:!0},all:_e.all,race:_e.race,allSettled:_e.allSettled,any:_e.any,resolve:_e.resolve,reject:_e.reject}:{},x&&a(R,x),++I.ref,R.finalize=function(){--this.parent.ref||this.parent.finalize()},E=$e(R,d,T,E),0===R.ref&&R.finalize(),E}function Le(){return eA.id||(eA.id=++eE),++eA.awaits,eA.echoes+=100,eA.id}function Ue(){return!!eA.awaits&&(0==--eA.awaits&&(eA.id=0),eA.echoes=100*eA.awaits,!0)}function ze(d){return eA.echoes&&d&&d.constructor===ef?(Le(),d.then(function(d){return Ue(),d},function(d){return Ue(),ek(d)})):d}function Ve(){var d=eP[eP.length-1];eP.pop(),We(d,!1)}function We(x,T){var E,I=eb;(T?!eA.echoes||eI++&&x===eb:!eI||--eI&&x===eb)||queueMicrotask(T?(function(d){++eR,eA.echoes&&0!=--eA.echoes||(eA.echoes=eA.awaits=eA.id=0),eP.push(eb),We(d,!0)}).bind(null,x):Ve),x!==eb&&(eb=x,I===ev&&(ev.env=Ye()),eh&&(E=ev.env.Promise,T=x.env,(I.global||x.global)&&(Object.defineProperty(d,"Promise",T.PromiseProp),E.all=T.all,E.race=T.race,E.resolve=T.resolve,E.reject=T.reject,T.allSettled&&(E.allSettled=T.allSettled),T.any&&(E.any=T.any))))}function Ye(){var x=d.Promise;return eh?{Promise:x,PromiseProp:Object.getOwnPropertyDescriptor(d,"Promise"),all:x.all,race:x.race,allSettled:x.allSettled,any:x.any,resolve:x.resolve,reject:x.reject}:{}}function $e(d,x,T,E,I){var R=eb;try{return We(d,!0),x(T,E,I)}finally{We(R,!1)}}function Qe(d,x,T,E){return"function"!=typeof d?d:function(){var I=eb;T&&Le(),We(x,!0);try{return d.apply(this,arguments)}finally{We(I,!1),E&&queueMicrotask(Ue)}}}function Ge(d){Promise===ef&&0===eA.echoes?0===eI?d():enqueueNativeMicroTask(d):setTimeout(d,0)}-1===(""+er).indexOf("[native code]")&&(Le=Ue=G);var ek=_e.reject,eS=String.fromCharCode(65535),eM="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",eL="String expected.",eC=[],eN="__dbnames",eD="readonly",eF="readwrite";function it(d,x){return d?x?function(){return d.apply(this,arguments)&&x.apply(this,arguments)}:d:x}var ej={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function at(d){return"string"!=typeof d||/\./.test(d)?function(d){return d}:function(x){return void 0===x[d]&&d in x&&delete(x=S(x))[d],x}}function ut(){throw ea.Type()}function st(d,x){try{var T=ct(d),E=ct(x);if(T!==E)return"Array"===T?1:"Array"===E?-1:"binary"===T?1:"binary"===E?-1:"string"===T?1:"string"===E?-1:"Date"===T?1:"Date"!==E?NaN:-1;switch(T){case"number":case"Date":case"string":return x<d?1:d<x?-1:0;case"binary":return function(d,x){for(var T=d.length,E=x.length,I=T<E?T:E,R=0;R<I;++R)if(d[R]!==x[R])return d[R]<x[R]?-1:1;return T===E?0:T<E?-1:1}(lt(d),lt(x));case"Array":return function(d,x){for(var T=d.length,E=x.length,I=T<E?T:E,R=0;R<I;++R){var k=st(d[R],x[R]);if(0!==k)return k}return T===E?0:T<E?-1:1}(d,x)}}catch(d){}return NaN}function ct(d){var x=typeof d;return"object"!=x?x:ArrayBuffer.isView(d)?"binary":"ArrayBuffer"===(d=A(d))?"binary":d}function lt(d){return d instanceof Uint8Array?d:ArrayBuffer.isView(d)?new Uint8Array(d.buffer,d.byteOffset,d.byteLength):new Uint8Array(d)}var eB=(ht.prototype._trans=function(d,x,T){var E=this._tx||eb.trans,I=this.name,R=el&&"undefined"!=typeof console&&console.createTask&&console.createTask("Dexie: ".concat("readonly"===d?"read":"write"," ").concat(this.name));function a(d,T,E){if(!E.schema[I])throw new ea.NotFound("Table "+I+" not part of transaction");return x(E.idbtrans,E)}var k=je();try{var M=E&&E.db._novip===this.db._novip?E===eb.trans?E._promise(d,a,T):Ne(function(){return E._promise(d,a,T)},{trans:E,transless:eb.transless||eb}):function t(d,x,T,E){if(d.idbdb&&(d._state.openComplete||eb.letThrough||d._vip)){var I=d._createTransaction(x,T,d._dbSchema);try{I.create(),d._state.PR1398_maxLoop=3}catch(I){return I.name===eo.InvalidState&&d.isOpen()&&0<--d._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),d.close({disableAutoOpen:!1}),d.open().then(function(){return t(d,x,T,E)})):ek(I)}return I._promise(x,function(d,x){return Ne(function(){return eb.trans=I,E(d,x,I)})}).then(function(d){if("readwrite"===x)try{I.idbtrans.commit()}catch(d){}return"readonly"===x?d:I._completion.then(function(){return d})})}if(d._state.openComplete)return ek(new ea.DatabaseClosed(d._state.dbOpenError));if(!d._state.isBeingOpened){if(!d._state.autoOpen)return ek(new ea.DatabaseClosed);d.open().catch(G)}return d._state.dbReadyPromise.then(function(){return t(d,x,T,E)})}(this.db,d,[this.name],a);return R&&(M._consoleTask=R,M=M.catch(function(d){return console.trace(d),ek(d)})),M}finally{k&&Ae()}},ht.prototype.get=function(d,x){var T=this;return d&&d.constructor===Object?this.where(d).first(x):null==d?ek(new ea.Type("Invalid argument to Table.get()")):this._trans("readonly",function(x){return T.core.get({trans:x,key:d}).then(function(d){return T.hook.reading.fire(d)})}).then(x)},ht.prototype.where=function(d){if("string"==typeof d)return new this.db.WhereClause(this,d);if(E(d))return new this.db.WhereClause(this,"[".concat(d.join("+"),"]"));var T=x(d);if(1===T.length)return this.where(T[0]).equals(d[T[0]]);var I=this.schema.indexes.concat(this.schema.primKey).filter(function(d){if(d.compound&&T.every(function(x){return 0<=d.keyPath.indexOf(x)})){for(var x=0;x<T.length;++x)if(-1===T.indexOf(d.keyPath[x]))return!1;return!0}return!1}).sort(function(d,x){return d.keyPath.length-x.keyPath.length})[0];if(I&&this.db._maxKey!==eS){var R=I.keyPath.slice(0,T.length);return this.where(R).equals(R.map(function(x){return d[x]}))}!I&&el&&console.warn("The query ".concat(JSON.stringify(d)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(T.join("+"),"]"));var k=this.schema.idxByName,M=this.db._deps.indexedDB;function u(d,x){return 0===M.cmp(d,x)}var C=T.reduce(function(x,T){var I=x[0],R=x[1],x=k[T],M=d[T];return[I||x,I||!x?it(R,x&&x.multi?function(d){return E(d=O(d,T))&&d.some(function(d){return u(M,d)})}:function(d){return u(M,O(d,T))}):R]},[null,null]),R=C[0],C=C[1];return R?this.where(R.name).equals(d[R.keyPath]).filter(C):I?this.filter(C):this.where(T).equals("")},ht.prototype.filter=function(d){return this.toCollection().and(d)},ht.prototype.count=function(d){return this.toCollection().count(d)},ht.prototype.offset=function(d){return this.toCollection().offset(d)},ht.prototype.limit=function(d){return this.toCollection().limit(d)},ht.prototype.each=function(d){return this.toCollection().each(d)},ht.prototype.toArray=function(d){return this.toCollection().toArray(d)},ht.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},ht.prototype.orderBy=function(d){return new this.db.Collection(new this.db.WhereClause(this,E(d)?"[".concat(d.join("+"),"]"):d))},ht.prototype.reverse=function(){return this.toCollection().reverse()},ht.prototype.mapToClass=function(d){var x,T=this.db,E=this.name;function i(){return null!==x&&x.apply(this,arguments)||this}(this.schema.mappedClass=d).prototype instanceof ut&&(function(d,x){if("function"!=typeof x&&null!==x)throw TypeError("Class extends value "+String(x)+" is not a constructor or null");function n(){this.constructor=d}s(d,x),d.prototype=null===x?Object.create(x):(n.prototype=x.prototype,new n)}(i,x=d),Object.defineProperty(i.prototype,"db",{get:function(){return T},enumerable:!1,configurable:!0}),i.prototype.table=function(){return E},d=i);for(var R=new Set,k=d.prototype;k;k=I(k))Object.getOwnPropertyNames(k).forEach(function(d){return R.add(d)});function u(x){if(!x)return x;var T,E=Object.create(d.prototype);for(T in x)if(!R.has(T))try{E[T]=x[T]}catch(d){}return E}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=u,this.hook("reading",u),d},ht.prototype.defineClass=function(){return this.mapToClass(function(d){a(this,d)})},ht.prototype.add=function(d,x){var T=this,E=this.schema.primKey,I=E.auto,R=E.keyPath,k=d;return R&&I&&(k=at(R)(d)),this._trans("readwrite",function(d){return T.core.mutate({trans:d,type:"add",keys:null!=x?[x]:null,values:[k]})}).then(function(d){return d.numFailures?_e.reject(d.failures[0]):d.lastResult}).then(function(x){if(R)try{P(d,R,x)}catch(d){}return x})},ht.prototype.update=function(d,x){return"object"!=typeof d||E(d)?this.where(":id").equals(d).modify(x):void 0===(d=O(d,this.schema.primKey.keyPath))?ek(new ea.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(d).modify(x)},ht.prototype.put=function(d,x){var T=this,E=this.schema.primKey,I=E.auto,R=E.keyPath,k=d;return R&&I&&(k=at(R)(d)),this._trans("readwrite",function(d){return T.core.mutate({trans:d,type:"put",values:[k],keys:null!=x?[x]:null})}).then(function(d){return d.numFailures?_e.reject(d.failures[0]):d.lastResult}).then(function(x){if(R)try{P(d,R,x)}catch(d){}return x})},ht.prototype.delete=function(d){var x=this;return this._trans("readwrite",function(T){return x.core.mutate({trans:T,type:"delete",keys:[d]})}).then(function(d){return d.numFailures?_e.reject(d.failures[0]):void 0})},ht.prototype.clear=function(){var d=this;return this._trans("readwrite",function(x){return d.core.mutate({trans:x,type:"deleteRange",range:ej})}).then(function(d){return d.numFailures?_e.reject(d.failures[0]):void 0})},ht.prototype.bulkGet=function(d){var x=this;return this._trans("readonly",function(T){return x.core.getMany({keys:d,trans:T}).then(function(d){return d.map(function(d){return x.hook.reading.fire(d)})})})},ht.prototype.bulkAdd=function(d,x,T){var E=this,I=Array.isArray(x)?x:void 0,R=(T=T||(I?void 0:x))?T.allKeys:void 0;return this._trans("readwrite",function(x){var T=E.schema.primKey,k=T.auto,T=T.keyPath;if(T&&I)throw new ea.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(I&&I.length!==d.length)throw new ea.InvalidArgument("Arguments objects and keys must have the same length");var M=d.length,T=T&&k?d.map(at(T)):d;return E.core.mutate({trans:x,type:"add",keys:I,values:T,wantResults:R}).then(function(d){var x=d.numFailures,T=d.results,I=d.lastResult,d=d.failures;if(0===x)return R?T:I;throw new z("".concat(E.name,".bulkAdd(): ").concat(x," of ").concat(M," operations failed"),d)})})},ht.prototype.bulkPut=function(d,x,T){var E=this,I=Array.isArray(x)?x:void 0,R=(T=T||(I?void 0:x))?T.allKeys:void 0;return this._trans("readwrite",function(x){var T=E.schema.primKey,k=T.auto,T=T.keyPath;if(T&&I)throw new ea.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(I&&I.length!==d.length)throw new ea.InvalidArgument("Arguments objects and keys must have the same length");var M=d.length,T=T&&k?d.map(at(T)):d;return E.core.mutate({trans:x,type:"put",keys:I,values:T,wantResults:R}).then(function(d){var x=d.numFailures,T=d.results,I=d.lastResult,d=d.failures;if(0===x)return R?T:I;throw new z("".concat(E.name,".bulkPut(): ").concat(x," of ").concat(M," operations failed"),d)})})},ht.prototype.bulkUpdate=function(d){var x=this,T=this.core,E=d.map(function(d){return d.key}),I=d.map(function(d){return d.changes}),R=[];return this._trans("readwrite",function(k){return T.getMany({trans:k,keys:E,cache:"clone"}).then(function(M){var C=[],D=[];d.forEach(function(d,T){var E=d.key,I=d.changes,k=M[T];if(k){for(var F=0,j=Object.keys(I);F<j.length;F++){var K=j[F],V=I[K];if(K===x.schema.primKey.keyPath){if(0!==st(V,E))throw new ea.Constraint("Cannot update primary key in bulkUpdate()")}else P(k,K,V)}R.push(T),C.push(E),D.push(k)}});var F=C.length;return T.mutate({trans:k,type:"put",keys:C,values:D,updates:{keys:E,changeSpecs:I}}).then(function(d){var T=d.numFailures,E=d.failures;if(0===T)return F;for(var I=0,k=Object.keys(E);I<k.length;I++){var M,C=k[I],D=R[Number(C)];null!=D&&(M=E[C],delete E[C],E[D]=M)}throw new z("".concat(x.name,".bulkUpdate(): ").concat(T," of ").concat(F," operations failed"),E)})})})},ht.prototype.bulkDelete=function(d){var x=this,T=d.length;return this._trans("readwrite",function(T){return x.core.mutate({trans:T,type:"delete",keys:d})}).then(function(d){var E=d.numFailures,I=d.lastResult,d=d.failures;if(0===E)return I;throw new z("".concat(x.name,".bulkDelete(): ").concat(E," of ").concat(T," operations failed"),d)})},ht);function ht(){}function dt(d){function t(x,E){if(E){for(var I=arguments.length,R=Array(I-1);--I;)R[I-1]=arguments[I];return T[x].subscribe.apply(null,R),d}if("string"==typeof x)return T[x]}var T={};t.addEventType=u;for(var I=1,R=arguments.length;I<R;++I)u(arguments[I]);return t;function u(d,I,R){if("object"!=typeof d){I=I||ne;var k={subscribers:[],fire:R=R||G,subscribe:function(d){-1===k.subscribers.indexOf(d)&&(k.subscribers.push(d),k.fire=I(k.fire,d))},unsubscribe:function(d){k.subscribers=k.subscribers.filter(function(x){return x!==d}),k.fire=k.subscribers.reduce(I,R)}};return T[d]=t[d]=k}x(d).forEach(function(x){var T=d[x];if(E(T))u(x,d[x][0],d[x][1]);else{if("asap"!==T)throw new ea.InvalidArgument("Invalid event config");var I=u(x,X,function(){for(var d=arguments.length,x=Array(d);d--;)x[d]=arguments[d];I.subscribers.forEach(function(d){v(function(){d.apply(null,x)})})})}})}}function pt(d,x){return o(x).from({prototype:d}),x}function yt(d,x){return!(d.filter||d.algorithm||d.or)&&(x?d.justLimit:!d.replayFilter)}function vt(d,x){d.filter=it(d.filter,x)}function mt(d,x,T){var E=d.replayFilter;d.replayFilter=E?function(){return it(E(),x())}:x,d.justLimit=T&&!E}function bt(d,x){if(d.isPrimKey)return x.primaryKey;var T=x.getIndexByKeyPath(d.index);if(!T)throw new ea.Schema("KeyPath "+d.index+" on object store "+x.name+" is not indexed");return T}function gt(d,x,T){var E=bt(d,x.schema);return x.openCursor({trans:T,values:!d.keysOnly,reverse:"prev"===d.dir,unique:!!d.unique,query:{index:E,range:d.range}})}function wt(d,x,T,E){var I=d.replayFilter?it(d.filter,d.replayFilter()):d.filter;if(d.or){var R={},r=function(d,T,E){var k,M;I&&!I(T,E,function(d){return T.stop(d)},function(d){return T.fail(d)})||("[object ArrayBuffer]"==(M=""+(k=T.primaryKey))&&(M=""+new Uint8Array(k)),m(R,M)||(R[M]=!0,x(d,T,E)))};return Promise.all([d.or._iterate(r,T),_t(gt(d,E,T),d.algorithm,r,!d.keysOnly&&d.valueMapper)])}return _t(gt(d,E,T),it(d.algorithm,I),x,!d.keysOnly&&d.valueMapper)}function _t(d,x,T,E){var I=qe(E?function(d,x,I){return T(E(d),x,I)}:T);return d.then(function(d){if(d)return d.start(function(){var t=function(){return d.continue()};x&&!x(d,function(d){return t=d},function(x){d.stop(x),t=G},function(x){d.fail(x),t=G})||I(d.value,d,function(d){return t=d}),t()})})}var F=Symbol(),eK=(kt.prototype.execute=function(d){var x=null===(x=this.replacePrefix)||void 0===x?void 0:x[0];return x&&"string"==typeof d&&d.startsWith(x)?this.replacePrefix[1]+d.substring(x.length):d},kt);function kt(d){Object.assign(this,d)}var eU=(Pt.prototype._read=function(d,x){var T=this._ctx;return T.error?T.table._trans(null,ek.bind(null,T.error)):T.table._trans("readonly",d).then(x)},Pt.prototype._write=function(d){var x=this._ctx;return x.error?x.table._trans(null,ek.bind(null,x.error)):x.table._trans("readwrite",d,"locked")},Pt.prototype._addAlgorithm=function(d){var x=this._ctx;x.algorithm=it(x.algorithm,d)},Pt.prototype._iterate=function(d,x){return wt(this._ctx,d,x,this._ctx.table.core)},Pt.prototype.clone=function(d){var x=Object.create(this.constructor.prototype),T=Object.create(this._ctx);return d&&a(T,d),x._ctx=T,x},Pt.prototype.raw=function(){return this._ctx.valueMapper=null,this},Pt.prototype.each=function(d){var x=this._ctx;return this._read(function(T){return wt(x,d,T,x.table.core)})},Pt.prototype.count=function(d){var x=this;return this._read(function(d){var T=x._ctx,E=T.table.core;if(yt(T,!0))return E.count({trans:d,query:{index:bt(T,E.schema),range:T.range}}).then(function(d){return Math.min(d,T.limit)});var I=0;return wt(T,function(){return++I,!1},d,E).then(function(){return I})}).then(d)},Pt.prototype.sortBy=function(d,x){var T=d.split(".").reverse(),E=T[0],I=T.length-1;function o(d,x){return x?o(d[T[x]],x-1):d[E]}var R="next"===this._ctx.dir?1:-1;function u(d,x){return(d=o(d,I))<(x=o(x,I))?-R:x<d?R:0}return this.toArray(function(d){return d.sort(u)}).then(x)},Pt.prototype.toArray=function(d){var x=this;return this._read(function(d){var T=x._ctx;if("next"===T.dir&&yt(T,!0)&&0<T.limit){var E=T.valueMapper,I=bt(T,T.table.core.schema);return T.table.core.query({trans:d,limit:T.limit,values:!0,query:{index:I,range:T.range}}).then(function(d){return d=d.result,E?d.map(E):d})}var R=[];return wt(T,function(d){return R.push(d)},d,T.table.core).then(function(){return R})},d)},Pt.prototype.offset=function(d){var x=this._ctx;return d<=0||(x.offset+=d,yt(x)?mt(x,function(){var x=d;return function(d,T){return 0===x||(1===x?--x:T(function(){d.advance(x),x=0}),!1)}}):mt(x,function(){var x=d;return function(){return--x<0}})),this},Pt.prototype.limit=function(d){return this._ctx.limit=Math.min(this._ctx.limit,d),mt(this._ctx,function(){var x=d;return function(d,T,E){return--x<=0&&T(E),0<=x}},!0),this},Pt.prototype.until=function(d,x){return vt(this._ctx,function(T,E,I){return!d(T.value)||(E(I),x)}),this},Pt.prototype.first=function(d){return this.limit(1).toArray(function(d){return d[0]}).then(d)},Pt.prototype.last=function(d){return this.reverse().first(d)},Pt.prototype.filter=function(d){var x;return vt(this._ctx,function(x){return d(x.value)}),(x=this._ctx).isMatch=it(x.isMatch,d),this},Pt.prototype.and=function(d){return this.filter(d)},Pt.prototype.or=function(d){return new this.db.WhereClause(this._ctx.table,d,this)},Pt.prototype.reverse=function(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},Pt.prototype.desc=function(){return this.reverse()},Pt.prototype.eachKey=function(d){var x=this._ctx;return x.keysOnly=!x.isMatch,this.each(function(x,T){d(T.key,T)})},Pt.prototype.eachUniqueKey=function(d){return this._ctx.unique="unique",this.eachKey(d)},Pt.prototype.eachPrimaryKey=function(d){var x=this._ctx;return x.keysOnly=!x.isMatch,this.each(function(x,T){d(T.primaryKey,T)})},Pt.prototype.keys=function(d){var x=this._ctx;x.keysOnly=!x.isMatch;var T=[];return this.each(function(d,x){T.push(x.key)}).then(function(){return T}).then(d)},Pt.prototype.primaryKeys=function(d){var x=this._ctx;if("next"===x.dir&&yt(x,!0)&&0<x.limit)return this._read(function(d){var T=bt(x,x.table.core.schema);return x.table.core.query({trans:d,values:!1,limit:x.limit,query:{index:T,range:x.range}})}).then(function(d){return d.result}).then(d);x.keysOnly=!x.isMatch;var T=[];return this.each(function(d,x){T.push(x.primaryKey)}).then(function(){return T}).then(d)},Pt.prototype.uniqueKeys=function(d){return this._ctx.unique="unique",this.keys(d)},Pt.prototype.firstKey=function(d){return this.limit(1).keys(function(d){return d[0]}).then(d)},Pt.prototype.lastKey=function(d){return this.reverse().firstKey(d)},Pt.prototype.distinct=function(){var d=this._ctx,d=d.index&&d.table.schema.idxByName[d.index];if(!d||!d.multi)return this;var x={};return vt(this._ctx,function(d){var T=d.primaryKey.toString(),d=m(x,T);return x[T]=!0,!d}),this},Pt.prototype.modify=function(d){var T=this,E=this._ctx;return this._write(function(I){function y(d,T){var E=T.failures,T=T.numFailures;W+=d-T;for(var I=0,R=x(E);I<R.length;I++){var k=R[I];V.push(E[k])}}M="function"==typeof d?d:(k=(R=x(d)).length,function(x){for(var T=!1,E=0;E<k;++E){var I=R[E],M=d[I],C=O(x,I);M instanceof eK?(P(x,I,M.execute(C)),T=!0):C!==M&&(P(x,I,M),T=!0)}return T});var R,k,M,C=E.table.core,D=C.schema.primaryKey,F=D.outbound,j=D.extractKey,K=T.db._options.modifyChunkSize||200,V=[],W=0,Y=[];return T.clone().primaryKeys().then(function(x){return(function h(T){var R=Math.min(K,x.length-T);return C.getMany({trans:I,keys:x.slice(T,T+R),cache:"immutable"}).then(function(k){for(var D=[],V=[],W=F?[]:null,Y=[],$=0;$<R;++$){var Q=k[$],et={value:S(Q),primKey:x[T+$]};!1!==M.call(et,et.value,et)&&(null==et.value?Y.push(x[T+$]):F||0===st(j(Q),j(et.value))?(V.push(et.value),F&&W.push(x[T+$])):(Y.push(x[T+$]),D.push(et.value)))}var er=yt(E)&&E.limit===1/0&&("function"!=typeof d||d===Et)&&{index:E.index,range:E.range};return Promise.resolve(0<D.length&&C.mutate({trans:I,type:"add",values:D}).then(function(d){for(var x in d.failures)Y.splice(parseInt(x),1);y(D.length,d)})).then(function(){return(0<V.length||er&&"object"==typeof d)&&C.mutate({trans:I,type:"put",keys:W,values:V,criteria:er,changeSpec:"function"!=typeof d&&d}).then(function(d){return y(V.length,d)})}).then(function(){return(0<Y.length||er&&d===Et)&&C.mutate({trans:I,type:"delete",keys:Y,criteria:er}).then(function(d){return y(Y.length,d)})}).then(function(){return x.length>T+R&&h(T+K)})})})(0).then(function(){if(0<V.length)throw new U("Error modifying one or more objects",V,W,Y);return x.length})})})},Pt.prototype.delete=function(){var d=this._ctx,x=d.range;return yt(d)&&(d.isPrimKey||3===x.type)?this._write(function(T){var E=d.table.core.schema.primaryKey;return d.table.core.count({trans:T,query:{index:E,range:x}}).then(function(E){return d.table.core.mutate({trans:T,type:"deleteRange",range:x}).then(function(d){var x=d.failures;if(d.lastResult,d.results,d=d.numFailures)throw new U("Could not delete some values",Object.keys(x).map(function(d){return x[d]}),E-d);return E-d})})}):this.modify(Et)},Pt);function Pt(){}var Et=function(d,x){return x.value=null};function Kt(d,x){return d<x?-1:d===x?0:1}function St(d,x){return x<d?-1:d===x?0:1}function jt(d,x,T){return(d=d instanceof eG?new d.Collection(d):d)._ctx.error=new(T||TypeError)(x),d}function At(d){return new d.Collection(d,function(){return qt("")}).limit(0)}function Ct(d,x,T,E){var I,R,k,M,C,D,F,j=T.length;if(!T.every(function(d){return"string"==typeof d}))return jt(d,eL);function t(d){I="next"===d?function(d){return d.toUpperCase()}:function(d){return d.toLowerCase()},R="next"===d?function(d){return d.toLowerCase()}:function(d){return d.toUpperCase()},k="next"===d?Kt:St;var x=T.map(function(d){return{lower:R(d),upper:I(d)}}).sort(function(d,x){return k(d.lower,x.lower)});M=x.map(function(d){return d.upper}),C=x.map(function(d){return d.lower}),F="next"===(D=d)?"":E}t("next"),(d=new d.Collection(d,function(){return Dt(M[0],C[j-1]+E)}))._ondirectionchange=function(d){t(d)};var K=0;return d._addAlgorithm(function(d,T,E){var I=d.key;if("string"!=typeof I)return!1;var V=R(I);if(x(V,C,K))return!0;for(var W=null,Y=K;Y<j;++Y){var $=function(d,x,T,E,I,R){for(var k=Math.min(d.length,E.length),M=-1,C=0;C<k;++C){var D=x[C];if(D!==E[C])return 0>I(d[C],T[C])?d.substr(0,C)+T[C]+T.substr(C+1):0>I(d[C],E[C])?d.substr(0,C)+E[C]+T.substr(C+1):0<=M?d.substr(0,M)+x[M]+T.substr(M+1):null;0>I(d[C],D)&&(M=C)}return k<E.length&&"next"===R?d+T.substr(d.length):k<d.length&&"prev"===R?d.substr(0,T.length):M<0?null:d.substr(0,M)+E[M]+T.substr(M+1)}(I,V,M[Y],C[Y],k,D);null===$&&null===W?K=Y+1:(null===W||0<k(W,$))&&(W=$)}return T(null!==W?function(){d.continue(W+F)}:E),!1}),d}function Dt(d,x,T,E){return{type:2,lower:d,upper:x,lowerOpen:T,upperOpen:E}}function qt(d){return{type:1,lower:d,upper:d}}var eG=(Object.defineProperty(Bt.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),Bt.prototype.between=function(d,x,T,E){T=!1!==T,E=!0===E;try{return 0<this._cmp(d,x)||0===this._cmp(d,x)&&(T||E)&&(!T||!E)?At(this):new this.Collection(this,function(){return Dt(d,x,!T,!E)})}catch(d){return jt(this,eM)}},Bt.prototype.equals=function(d){return null==d?jt(this,eM):new this.Collection(this,function(){return qt(d)})},Bt.prototype.above=function(d){return null==d?jt(this,eM):new this.Collection(this,function(){return Dt(d,void 0,!0)})},Bt.prototype.aboveOrEqual=function(d){return null==d?jt(this,eM):new this.Collection(this,function(){return Dt(d,void 0,!1)})},Bt.prototype.below=function(d){return null==d?jt(this,eM):new this.Collection(this,function(){return Dt(void 0,d,!1,!0)})},Bt.prototype.belowOrEqual=function(d){return null==d?jt(this,eM):new this.Collection(this,function(){return Dt(void 0,d)})},Bt.prototype.startsWith=function(d){return"string"!=typeof d?jt(this,eL):this.between(d,d+eS,!0,!0)},Bt.prototype.startsWithIgnoreCase=function(d){return""===d?this.startsWith(d):Ct(this,function(d,x){return 0===d.indexOf(x[0])},[d],eS)},Bt.prototype.equalsIgnoreCase=function(d){return Ct(this,function(d,x){return d===x[0]},[d],"")},Bt.prototype.anyOfIgnoreCase=function(){var d=B.apply($,arguments);return 0===d.length?At(this):Ct(this,function(d,x){return -1!==x.indexOf(d)},d,"")},Bt.prototype.startsWithAnyOfIgnoreCase=function(){var d=B.apply($,arguments);return 0===d.length?At(this):Ct(this,function(d,x){return x.some(function(x){return 0===d.indexOf(x)})},d,eS)},Bt.prototype.anyOf=function(){var d=this,x=B.apply($,arguments),T=this._cmp;try{x.sort(T)}catch(d){return jt(this,eM)}if(0===x.length)return At(this);var E=new this.Collection(this,function(){return Dt(x[0],x[x.length-1])});E._ondirectionchange=function(E){T="next"===E?d._ascending:d._descending,x.sort(T)};var I=0;return E._addAlgorithm(function(d,E,R){for(var k=d.key;0<T(k,x[I]);)if(++I===x.length)return E(R),!1;return 0===T(k,x[I])||(E(function(){d.continue(x[I])}),!1)}),E},Bt.prototype.notEqual=function(d){return this.inAnyRange([[-1/0,d],[d,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},Bt.prototype.noneOf=function(){var d=B.apply($,arguments);if(0===d.length)return new this.Collection(this);try{d.sort(this._ascending)}catch(d){return jt(this,eM)}var x=d.reduce(function(d,x){return d?d.concat([[d[d.length-1][1],x]]):[[-1/0,x]]},null);return x.push([d[d.length-1],this.db._maxKey]),this.inAnyRange(x,{includeLowers:!1,includeUppers:!1})},Bt.prototype.inAnyRange=function(d,x){var T=this,E=this._cmp,I=this._ascending,R=this._descending,k=this._min,M=this._max;if(0===d.length)return At(this);if(!d.every(function(d){return void 0!==d[0]&&void 0!==d[1]&&0>=I(d[0],d[1])}))return jt(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",ea.InvalidArgument);var C,D=!x||!1!==x.includeLowers,F=x&&!0===x.includeUppers,j=I;function h(d,x){return j(d[0],x[0])}try{(C=d.reduce(function(d,x){for(var T=0,I=d.length;T<I;++T){var R=d[T];if(0>E(x[0],R[1])&&0<E(x[1],R[0])){R[0]=k(R[0],x[0]),R[1]=M(R[1],x[1]);break}}return T===I&&d.push(x),d},[])).sort(h)}catch(d){return jt(this,eM)}var K=0,V=F?function(d){return 0<I(d,C[K][1])}:function(d){return 0<=I(d,C[K][1])},W=D?function(d){return 0<R(d,C[K][0])}:function(d){return 0<=R(d,C[K][0])},Y=V,d=new this.Collection(this,function(){return Dt(C[0][0],C[C.length-1][1],!D,!F)});return d._ondirectionchange=function(d){j="next"===d?(Y=V,I):(Y=W,R),C.sort(h)},d._addAlgorithm(function(d,x,E){for(var R=d.key;Y(R);)if(++K===C.length)return x(E),!1;return!V(R)&&!W(R)||(0===T._cmp(R,C[K][1])||0===T._cmp(R,C[K][0])||x(function(){j===I?d.continue(C[K][0]):d.continue(C[K][1])}),!1)}),d},Bt.prototype.startsWithAnyOf=function(){var d=B.apply($,arguments);return d.every(function(d){return"string"==typeof d})?0===d.length?At(this):this.inAnyRange(d.map(function(d){return[d,d+eS]})):jt(this,"startsWithAnyOf() only works with strings")},Bt);function Bt(){}function It(d){return qe(function(x){return Rt(x),d(x.target.error),!1})}function Rt(d){d.stopPropagation&&d.stopPropagation(),d.preventDefault&&d.preventDefault()}var eH="storagemutated",eq="x-storagemutated-1",eV=dt(null,eH),eX=(Ut.prototype._lock=function(){return y(!eb.global),++this._reculock,1!==this._reculock||eb.global||(eb.lockOwnerFor=this),this},Ut.prototype._unlock=function(){if(y(!eb.global),0==--this._reculock)for(eb.global||(eb.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var d=this._blockedFuncs.shift();try{$e(d[1],d[0])}catch(d){}}return this},Ut.prototype._locked=function(){return this._reculock&&eb.lockOwnerFor!==this},Ut.prototype.create=function(d){var x=this;if(!this.mode)return this;var T=this.db.idbdb,E=this.db._state.dbOpenError;if(y(!this.idbtrans),!d&&!T)switch(E&&E.name){case"DatabaseClosedError":throw new ea.DatabaseClosed(E);case"MissingAPIError":throw new ea.MissingAPI(E.message,E);default:throw new ea.OpenFailed(E)}if(!this.active)throw new ea.TransactionInactive;return y(null===this._completion._state),(d=this.idbtrans=d||(this.db.core||T).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=qe(function(T){Rt(T),x._reject(d.error)}),d.onabort=qe(function(T){Rt(T),x.active&&x._reject(new ea.Abort(d.error)),x.active=!1,x.on("abort").fire(T)}),d.oncomplete=qe(function(){x.active=!1,x._resolve(),"mutatedParts"in d&&eV.storagemutated.fire(d.mutatedParts)}),this},Ut.prototype._promise=function(d,x,T){var E=this;if("readwrite"===d&&"readwrite"!==this.mode)return ek(new ea.ReadOnly("Transaction is readonly"));if(!this.active)return ek(new ea.TransactionInactive);if(this._locked())return new _e(function(I,R){E._blockedFuncs.push([function(){E._promise(d,x,T).then(I,R)},eb])});if(T)return Ne(function(){var d=new _e(function(d,T){E._lock();var I=x(d,T,E);I&&I.then&&I.then(d,T)});return d.finally(function(){return E._unlock()}),d._lib=!0,d});var I=new _e(function(d,T){var I=x(d,T,E);I&&I.then&&I.then(d,T)});return I._lib=!0,I},Ut.prototype._root=function(){return this.parent?this.parent._root():this},Ut.prototype.waitFor=function(d){var x,T=this._root(),E=_e.resolve(d);T._waitingFor?T._waitingFor=T._waitingFor.then(function(){return E}):(T._waitingFor=E,T._waitingQueue=[],x=T.idbtrans.objectStore(T.storeNames[0]),function e(){for(++T._spinCount;T._waitingQueue.length;)T._waitingQueue.shift()();T._waitingFor&&(x.get(-1/0).onsuccess=e)}());var I=T._waitingFor;return new _e(function(d,x){E.then(function(x){return T._waitingQueue.push(qe(d.bind(null,x)))},function(d){return T._waitingQueue.push(qe(x.bind(null,d)))}).finally(function(){T._waitingFor===I&&(T._waitingFor=null)})})},Ut.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new ea.Abort))},Ut.prototype.table=function(d){var x=this._memoizedTables||(this._memoizedTables={});if(m(x,d))return x[d];var T=this.schema[d];if(!T)throw new ea.NotFound("Table "+d+" not part of transaction");return(T=new this.db.Table(d,T,this)).core=this.db.core.table(d),x[d]=T},Ut);function Ut(){}function zt(d,x,T,E,I,R,k){return{name:d,keyPath:x,unique:T,multi:E,auto:I,compound:R,src:(T&&!k?"&":"")+(E?"*":"")+(I?"++":"")+Vt(x)}}function Vt(d){return"string"==typeof d?d:d?"["+[].join.call(d,"+")+"]":""}function Wt(d,x,T){return{name:d,primKey:x,indexes:T,mappedClass:null,idxByName:T.reduce(function(d,x,T){return d[(T=[x.name,x])[0]]=T[1],d},{})}}var Yt=function(d){try{return d.only([[]]),Yt=function(){return[[]]},[[]]}catch(d){return Yt=function(){return eS},eS}};function $t(d){return null==d?function(){}:"string"==typeof d?1===d.split(".").length?function(x){return x[d]}:function(x){return O(x,d)}:function(x){return O(x,d)}}function Qt(d){return[].slice.call(d)}var ez=0;function Xt(d){return null==d?":id":"string"==typeof d?d:"[".concat(d.join("+"),"]")}function Zt(d,x){var T,I,R,k,M=x.db,x=(T=d._middlewares,I=d._deps,R=x,k=I.IDBKeyRange,I.indexedDB,{dbcore:(R=function(d,x,T){function _(d){if(3===d.type)return null;if(4===d.type)throw Error("Cannot convert never type to IDBKeyRange");var T=d.lower,E=d.upper,I=d.lowerOpen,d=d.upperOpen;return void 0===T?void 0===E?null:x.upperBound(E,!!d):void 0===E?x.lowerBound(T,!!I):x.bound(T,E,!!I,!!d)}var I,R,k=(I=T,R=Qt(d.objectStoreNames),{schema:{name:d.name,tables:R.map(function(d){return I.objectStore(d)}).map(function(d){var x=d.keyPath,T=d.autoIncrement,I=E(x),R={},T={name:d.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:null==x,compound:I,keyPath:x,autoIncrement:T,unique:!0,extractKey:$t(x)},indexes:Qt(d.indexNames).map(function(x){return d.index(x)}).map(function(d){var x=d.name,T=d.unique,I=d.multiEntry,d=d.keyPath,I={name:x,compound:E(d),keyPath:d,unique:T,multiEntry:I,extractKey:$t(d)};return R[Xt(d)]=I}),getIndexByKeyPath:function(d){return R[Xt(d)]}};return R[":id"]=T.primaryKey,null!=x&&(R[Xt(x)]=T.primaryKey),T})},hasGetAll:0<R.length&&"getAll"in I.objectStore(R[0])&&!("undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),T=k.schema,M=k.hasGetAll,k=T.tables.map(function(d){var x=d.name;return{name:x,schema:d,mutate:function(d){var T=d.trans,E=d.type,I=d.keys,R=d.values,k=d.range;return new Promise(function(d,M){d=qe(d);var C=T.objectStore(x),D=null==C.keyPath,F="put"===E||"add"===E;if(!F&&"delete"!==E&&"deleteRange"!==E)throw Error("Invalid operation type: "+E);var j,K=(I||R||{length:1}).length;if(I&&R&&I.length!==R.length)throw Error("Given keys array must have same length as given values array.");if(0===K)return d({numFailures:0,failures:{},results:[],lastResult:void 0});function u(d){++Y,Rt(d)}var V=[],W=[],Y=0;if("deleteRange"===E){if(4===k.type)return d({numFailures:Y,failures:W,results:[],lastResult:void 0});3===k.type?V.push(j=C.clear()):V.push(j=C.delete(_(k)))}else{var D=F?D?[R,I]:[R,null]:[I,null],$=D[0],Q=D[1];if(F)for(var et=0;et<K;++et)V.push(j=Q&&void 0!==Q[et]?C[E]($[et],Q[et]):C[E]($[et])),j.onerror=u;else for(et=0;et<K;++et)V.push(j=C[E]($[et])),j.onerror=u}function p(x){x=x.target.result,V.forEach(function(d,x){return null!=d.error&&(W[x]=d.error)}),d({numFailures:Y,failures:W,results:"delete"===E?I:V.map(function(d){return d.result}),lastResult:x})}j.onerror=function(d){u(d),p(d)},j.onsuccess=p})},getMany:function(d){var T=d.trans,E=d.keys;return new Promise(function(d,I){d=qe(d);for(var R,k=T.objectStore(x),M=E.length,C=Array(M),D=0,F=0,s=function(x){C[(x=x.target)._pos]=x.result,++F===D&&d(C)},j=It(I),K=0;K<M;++K)null!=E[K]&&((R=k.get(E[K]))._pos=K,R.onsuccess=s,R.onerror=j,++D);0===D&&d(C)})},get:function(d){var T=d.trans,E=d.key;return new Promise(function(d,I){d=qe(d);var R=T.objectStore(x).get(E);R.onsuccess=function(x){return d(x.target.result)},R.onerror=It(I)})},query:function(d){return new Promise(function(T,E){T=qe(T);var I,R,k,C=d.trans,D=d.values,F=d.limit,j=d.query,K=F===1/0?void 0:F,V=j.index,j=j.range,C=C.objectStore(x),V=V.isPrimaryKey?C:C.index(V.name),j=_(j);if(0===F)return T({result:[]});M?((K=D?V.getAll(j,K):V.getAllKeys(j,K)).onsuccess=function(d){return T({result:d.target.result})},K.onerror=It(E)):(I=0,R=!D&&"openKeyCursor"in V?V.openKeyCursor(j):V.openCursor(j),k=[],R.onsuccess=function(d){var x=R.result;return x?(k.push(D?x.value:x.primaryKey),++I===F?T({result:k}):void x.continue()):T({result:k})},R.onerror=It(E))})},openCursor:function(d){var T=d.trans,E=d.values,I=d.query,R=d.reverse,k=d.unique;return new Promise(function(d,M){d=qe(d);var C=I.index,D=I.range,F=T.objectStore(x),F=C.isPrimaryKey?F:F.index(C.name),C=R?k?"prevunique":"prev":k?"nextunique":"next",j=!E&&"openKeyCursor"in F?F.openKeyCursor(_(D),C):F.openCursor(_(D),C);j.onerror=It(M),j.onsuccess=qe(function(x){var E,I,R,k,C=j.result;C?(C.___id=++ez,C.done=!1,E=C.continue.bind(C),I=(I=C.continuePrimaryKey)&&I.bind(C),R=C.advance.bind(C),k=function(){throw Error("Cursor not stopped")},C.trans=T,C.stop=C.continue=C.continuePrimaryKey=C.advance=function(){throw Error("Cursor not started")},C.fail=qe(M),C.next=function(){var d=this,x=1;return this.start(function(){return x--?d.continue():d.stop()}).then(function(){return d})},C.start=function(d){function t(){if(j.result)try{d()}catch(d){C.fail(d)}else C.done=!0,C.start=function(){throw Error("Cursor behind last entry")},C.stop()}var x=new Promise(function(d,x){d=qe(d),j.onerror=It(x),C.fail=x,C.stop=function(x){C.stop=C.continue=C.continuePrimaryKey=C.advance=k,d(x)}});return j.onsuccess=qe(function(d){j.onsuccess=t,t()}),C.continue=E,C.continuePrimaryKey=I,C.advance=R,t(),x},d(C)):d(null)},M)})},count:function(d){var T=d.query,E=d.trans,I=T.index,R=T.range;return new Promise(function(d,T){var k=E.objectStore(x),M=I.isPrimaryKey?k:k.index(I.name),k=_(R),M=k?M.count(k):M.count();M.onsuccess=qe(function(x){return d(x.target.result)}),M.onerror=It(T)})}}}),C={};return k.forEach(function(d){return C[d.name]=d}),{stack:"dbcore",transaction:d.transaction.bind(d),table:function(d){if(!C[d])throw Error("Table '".concat(d,"' not found"));return C[d]},MIN_KEY:-1/0,MAX_KEY:Yt(x),schema:T}}(M,k,R),T.dbcore.reduce(function(d,x){return x=x.create,w(w({},d),x(d))},R))});d.core=x.dbcore,d.tables.forEach(function(x){var T=x.name;d.core.schema.tables.some(function(d){return d.name===T})&&(x.core=d.core.table(T),d[T]instanceof d.Table&&(d[T].core=x.core))})}function en(d,x,T,E){T.forEach(function(T){var R=E[T];x.forEach(function(x){var E=function e(d,x){return M(d,x)||(d=I(d))&&e(d,x)}(x,T);(!E||"value"in E&&void 0===E.value)&&(x===d.Transaction.prototype||x instanceof d.Transaction?l(x,T,{get:function(){return this.table(T)},set:function(d){k(this,T,{value:d,writable:!0,configurable:!0,enumerable:!0})}}):x[T]=new d.Table(T,R))})})}function tn(d,x){x.forEach(function(x){for(var T in x)x[T]instanceof d.Table&&delete x[T]})}function nn(d,x){return d._cfg.version-x._cfg.version}function an(d,x){var T,E={del:[],add:[],change:[]};for(T in d)x[T]||E.del.push(T);for(T in x){var I=d[T],R=x[T];if(I){var k={name:T,def:R,recreate:!1,del:[],add:[],change:[]};if(""+(I.primKey.keyPath||"")!=""+(R.primKey.keyPath||"")||I.primKey.auto!==R.primKey.auto)k.recreate=!0,E.change.push(k);else{var M=I.idxByName,C=R.idxByName,D=void 0;for(D in M)C[D]||k.del.push(D);for(D in C){var F=M[D],j=C[D];F?F.src!==j.src&&k.change.push(j):k.add.push(j)}(0<k.del.length||0<k.add.length||0<k.change.length)&&E.change.push(k)}}else E.add.push([T,R])}return E}function un(d,x,T,E){var I=d.db.createObjectStore(x,T.keyPath?{keyPath:T.keyPath,autoIncrement:T.auto}:{autoIncrement:T.auto});return E.forEach(function(d){return cn(I,d)}),I}function sn(d,T){x(d).forEach(function(x){T.db.objectStoreNames.contains(x)||(el&&console.debug("Dexie: Creating missing table",x),un(T,x,d[x].primKey,d[x].indexes))})}function cn(d,x){d.createIndex(x.name,x.keyPath,{unique:x.unique,multiEntry:x.multi})}function ln(d,x,T){var E={};return b(x.objectStoreNames,0).forEach(function(d){for(var x=T.objectStore(d),I=zt(Vt(C=x.keyPath),C||"",!0,!1,!!x.autoIncrement,C&&"string"!=typeof C,!0),R=[],k=0;k<x.indexNames.length;++k){var M=x.index(x.indexNames[k]),C=M.keyPath,M=zt(M.name,C,!!M.unique,!!M.multiEntry,!1,C&&"string"!=typeof C,!1);R.push(M)}E[d]=Wt(d,I,R)}),E}function fn(x,T,E){for(var I=E.db.objectStoreNames,R=0;R<I.length;++R){var k=I[R],M=E.objectStore(k);x._hasGetAll="getAll"in M;for(var C=0;C<M.indexNames.length;++C){var D=M.indexNames[C],F=M.index(D).keyPath,j="string"==typeof F?F:"["+b(F).join("+")+"]";!T[k]||(F=T[k].idxByName[j])&&(F.name=D,delete T[k].idxByName[j],T[k].idxByName[D]=F)}}"undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&d.WorkerGlobalScope&&d instanceof d.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(x._hasGetAll=!1)}function hn(d){return d.split(",").map(function(d,x){var T=(d=d.trim()).replace(/([&*]|\+\+)/g,""),I=/^\[/.test(T)?T.match(/^\[(.*)\]$/)[1].split("+"):T;return zt(T,I||null,/\&/.test(d),/\*/.test(d),/\+\+/.test(d),E(I),0===x)})}var eW=(pn.prototype._parseStoresSpec=function(d,T){x(d).forEach(function(x){if(null!==d[x]){var E=hn(d[x]),I=E.shift();if(I.unique=!0,I.multi)throw new ea.Schema("Primary key cannot be multi-valued");E.forEach(function(d){if(d.auto)throw new ea.Schema("Only primary key can be marked as autoIncrement (++)");if(!d.keyPath)throw new ea.Schema("Index must have a name and cannot be an empty string")}),T[x]=Wt(x,I,E)}})},pn.prototype.stores=function(d){var T=this.db;this._cfg.storesSource=this._cfg.storesSource?a(this._cfg.storesSource,d):d;var d=T._versions,E={},I={};return d.forEach(function(d){a(E,d._cfg.storesSource),I=d._cfg.dbschema={},d._parseStoresSpec(E,I)}),T._dbSchema=I,tn(T,[T._allTables,T,T.Transaction.prototype]),en(T,[T._allTables,T,T.Transaction.prototype,this._cfg.tables],x(I),I),T._storeNames=x(I),this},pn.prototype.upgrade=function(d){return this._cfg.contentUpgrade=re(this._cfg.contentUpgrade||G,d),this},pn);function pn(){}function yn(d,x){var T=d._dbNamesDB;return T||(T=d._dbNamesDB=new e3(eN,{addons:[],indexedDB:d,IDBKeyRange:x})).version(1).stores({dbnames:"name"}),T.table("dbnames")}function vn(d){return d&&"function"==typeof d.databases}function mn(d){return Ne(function(){return eb.letThrough=!0,d()})}function bn(d){return!("from"in d)}var gn=function(d,x){if(!this){var T=new gn;return d&&"d"in d&&a(T,d),T}a(this,arguments.length?{d:1,from:d,to:1<arguments.length?x:d}:{d:0})};function wn(d,x,T){var E=st(x,T);if(!isNaN(E)){if(0<E)throw RangeError();if(bn(d))return a(d,{from:x,to:T,d:1});var I=d.l,E=d.r;if(0>st(T,d.from))return I?wn(I,x,T):d.l={from:x,to:T,d:1,l:null,r:null},On(d);if(0<st(x,d.to))return E?wn(E,x,T):d.r={from:x,to:T,d:1,l:null,r:null},On(d);0>st(x,d.from)&&(d.from=x,d.l=null,d.d=E?E.d+1:1),0<st(T,d.to)&&(d.to=T,d.r=null,d.d=d.l?d.l.d+1:1),T=!d.r,I&&!d.l&&_n(d,I),E&&T&&_n(d,E)}}function _n(d,x){bn(x)||function e(d,x){var T=x.from,E=x.to,I=x.l,x=x.r;wn(d,T,E),I&&e(d,I),x&&e(d,x)}(d,x)}function xn(d,x){var T=kn(x),E=T.next();if(E.done)return!1;for(var I=E.value,R=kn(d),k=R.next(I.from),M=k.value;!E.done&&!k.done;){if(0>=st(M.from,I.to)&&0<=st(M.to,I.from))return!0;0>st(I.from,M.from)?I=(E=T.next(M.from)).value:M=(k=R.next(I.from)).value}return!1}function kn(d){var x=bn(d)?null:{s:0,n:d};return{next:function(d){for(var T=0<arguments.length;x;)switch(x.s){case 0:if(x.s=1,T)for(;x.n.l&&0>st(d,x.n.from);)x={up:x,n:x.n.l,s:1};else for(;x.n.l;)x={up:x,n:x.n.l,s:1};case 1:if(x.s=2,!T||0>=st(d,x.n.to))return{value:x.n,done:!1};case 2:if(x.n.r){x.s=3,x={up:x,n:x.n.r,s:0};continue}case 3:x=x.up}return{done:!0}}}}function On(d){var x,T,E=((null===(x=d.r)||void 0===x?void 0:x.d)||0)-((null===(T=d.l)||void 0===T?void 0:T.d)||0),I=1<E?"r":E<-1?"l":"";I&&(x="r"==I?"l":"r",T=w({},d),E=d[I],d.from=E.from,d.to=E.to,d[I]=E[I],T[I]=E[x],(d[x]=T).d=Pn(T)),d.d=Pn(d)}function Pn(d){var x=d.r,d=d.l;return(x?d?Math.max(x.d,d.d):x.d:d?d.d:0)+1}function En(d,T){return x(T).forEach(function(x){d[x]?_n(d[x],T[x]):d[x]=function e(d){var x,T,E={};for(x in d)m(d,x)&&(T=d[x],E[x]=!T||"object"!=typeof T||j.has(T.constructor)?T:e(T));return E}(T[x])}),d}function Kn(d,x){return d.all||x.all||Object.keys(d).some(function(T){return x[T]&&xn(x[T],d[T])})}r(gn.prototype,((er={add:function(d){return _n(this,d),this},addKey:function(d){return wn(this,d,d),this},addKeys:function(d){var x=this;return d.forEach(function(d){return wn(x,d,d)}),this}})[W]=function(){return kn(this)},er));var eY={},eZ={},e$=!1;function Cn(d){En(eZ,d),e$||(e$=!0,setTimeout(function(){e$=!1,Dn(eZ,(eZ={},!1))},0))}function Dn(d,x){void 0===x&&(x=!1);var T=new Set;if(d.all)for(var E=0,I=Object.values(eY);E<I.length;E++)qn(k=I[E],d,T,x);else for(var R in d){var k,M=/^idb\:\/\/(.*)\/(.*)\//.exec(R);M&&(R=M[1],M=M[2],(k=eY["idb://".concat(R,"/").concat(M)])&&qn(k,d,T,x))}T.forEach(function(d){return d()})}function qn(d,x,T,E){for(var I=[],R=0,k=Object.entries(d.queries.query);R<k.length;R++){for(var M=k[R],C=M[0],D=[],F=0,j=M[1];F<j.length;F++){var K=j[F];Kn(x,K.obsSet)?K.subscribers.forEach(function(d){return T.add(d)}):E&&D.push(K)}E&&I.push([C,D])}if(E)for(var V=0;V<I.length;V++){var W=I[V],C=W[0],D=W[1];d.queries.query[C]=D}}function Bn(d){function e(x){return d.next(x)}var x=n(e),T=n(function(x){return d.throw(x)});function n(d){return function(I){var R=d(I),I=R.value;return R.done?I:I&&"function"==typeof I.then?I.then(x,T):E(I)?Promise.all(I).then(x,T):x(I)}}return n(e)()}function In(d,x,T){for(var I=E(d)?d.slice():[d],R=0;R<T;++R)I.push(x);return I}var eQ={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(d){return w(w({},d),{table:function(x){var T=d.table(x),E=T.schema,I={},R=[];function c(d,x,T){var E=Xt(d),k=I[E]=I[E]||[],M=null==d?0:"string"==typeof d?1:d.length,C=0<x,C=w(w({},T),{name:C?"".concat(E,"(virtual-from:").concat(T.name,")"):T.name,lowLevelIndex:T,isVirtual:C,keyTail:x,keyLength:M,extractKey:$t(d),unique:!C&&T.unique});return k.push(C),C.isPrimaryKey||R.push(C),1<M&&c(2===M?d[0]:d.slice(0,M-1),x+1,T),k.sort(function(d,x){return d.keyTail-x.keyTail}),C}x=c(E.primaryKey.keyPath,0,E.primaryKey),I[":id"]=[x];for(var k=0,M=E.indexes;k<M.length;k++){var C=M[k];c(C.keyPath,0,C)}function l(x){var T,E=x.query.index;return E.isVirtual?w(w({},x),{query:{index:E.lowLevelIndex,range:(T=x.query.range,E=E.keyTail,{type:1===T.type?2:T.type,lower:In(T.lower,T.lowerOpen?d.MAX_KEY:d.MIN_KEY,E),lowerOpen:!0,upper:In(T.upper,T.upperOpen?d.MIN_KEY:d.MAX_KEY,E),upperOpen:!0})}}):x}return w(w({},T),{schema:w(w({},E),{primaryKey:x,indexes:R,getIndexByKeyPath:function(d){return(d=I[Xt(d)])&&d[0]}}),count:function(d){return T.count(l(d))},query:function(d){return T.query(l(d))},openCursor:function(x){var E=x.query.index,I=E.keyTail,R=E.isVirtual,k=E.keyLength;return R?T.openCursor(l(x)).then(function(T){return T&&Object.create(T,{continue:{value:function(E){null!=E?T.continue(In(E,x.reverse?d.MAX_KEY:d.MIN_KEY,I)):x.unique?T.continue(T.key.slice(0,k).concat(x.reverse?d.MIN_KEY:d.MAX_KEY,I)):T.continue()}},continuePrimaryKey:{value:function(x,E){T.continuePrimaryKey(In(x,d.MAX_KEY,I),E)}},primaryKey:{get:function(){return T.primaryKey}},key:{get:function(){var d=T.key;return 1===k?d[0]:d.slice(0,k)}},value:{get:function(){return T.value}}})}):T.openCursor(x)}})}})}};function Fn(d,T,E,I){return E=E||{},I=I||"",x(d).forEach(function(x){var R,k,M;m(T,x)?(R=d[x],k=T[x],"object"==typeof R&&"object"==typeof k&&R&&k?(M=A(R))!==A(k)?E[I+x]=T[x]:"Object"===M?Fn(R,k,E,I+x+"."):R!==k&&(E[I+x]=T[x]):R!==k&&(E[I+x]=T[x])):E[I+x]=void 0}),x(T).forEach(function(x){m(d,x)||(E[I+x]=T[x])}),E}function Mn(d,x){return"delete"===x.type?x.keys:x.keys||x.values.map(d.extractKey)}var eJ={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(d){return w(w({},d),{table:function(x){var T=d.table(x),E=T.schema.primaryKey;return w(w({},T),{mutate:function(d){var I=eb.trans,R=I.table(x).hook,k=R.deleting,M=R.creating,C=R.updating;switch(d.type){case"add":if(M.fire===G)break;return I._promise("readwrite",function(){return a(d)},!0);case"put":if(M.fire===G&&C.fire===G)break;return I._promise("readwrite",function(){return a(d)},!0);case"delete":if(k.fire===G)break;return I._promise("readwrite",function(){return a(d)},!0);case"deleteRange":if(k.fire===G)break;return I._promise("readwrite",function(){return function n(d,x,I){return T.query({trans:d,values:!1,query:{index:E,range:x},limit:I}).then(function(T){var E=T.result;return a({type:"delete",keys:E,trans:d}).then(function(T){return 0<T.numFailures?Promise.reject(T.failures[0]):E.length<I?{failures:[],numFailures:0,lastResult:void 0}:n(d,w(w({},x),{lower:E[E.length-1],lowerOpen:!0}),I)})})}(d.trans,d.range,1e4)},!0)}return T.mutate(d);function a(d){var x,I=eb.trans,R=d.keys||Mn(E,d);if(!R)throw Error("Keys missing");return"delete"!==(d="add"===d.type||"put"===d.type?w(w({},d),{keys:R}):w({},d)).type&&(d.values=i([],d.values,!0)),d.keys&&(d.keys=i([],d.keys,!0)),("add"===(x=d).type?Promise.resolve([]):T.getMany({trans:x.trans,keys:R,cache:"immutable"})).then(function(x){var D=R.map(function(T,R){var D,F,j,K=x[R],V={onerror:null,onsuccess:null};return"delete"===d.type?k.fire.call(V,T,K,I):"add"===d.type||void 0===K?(D=M.fire.call(V,T,d.values[R],I),null==T&&null!=D&&(d.keys[R]=T=D,E.outbound||P(d.values[R],E.keyPath,T))):(D=Fn(K,d.values[R]),(F=C.fire.call(V,D,T,K,I))&&(j=d.values[R],Object.keys(F).forEach(function(d){m(j,d)?j[d]=F[d]:P(j,d,F[d])}))),V});return T.mutate(d).then(function(T){for(var E=T.failures,I=T.results,k=T.numFailures,T=T.lastResult,M=0;M<R.length;++M){var C=(I||R)[M],F=D[M];null==C?F.onerror&&F.onerror(E[M]):F.onsuccess&&F.onsuccess("put"===d.type&&x[M]?d.values[M]:C)}return{failures:E,results:I,numFailures:k,lastResult:T}}).catch(function(d){return D.forEach(function(x){return x.onerror&&x.onerror(d)}),Promise.reject(d)})})}}})}})}};function Ln(d,x,T){try{if(!x||x.keys.length<d.length)return null;for(var E=[],I=0,R=0;I<x.keys.length&&R<d.length;++I)0===st(x.keys[I],d[R])&&(E.push(T?S(x.values[I]):x.values[I]),++R);return E.length===d.length?E:null}catch(d){return null}}var e0={stack:"dbcore",level:-1,create:function(d){return{table:function(x){var T=d.table(x);return w(w({},T),{getMany:function(d){if(!d.cache)return T.getMany(d);var x=Ln(d.keys,d.trans._cache,"clone"===d.cache);return x?_e.resolve(x):T.getMany(d).then(function(x){return d.trans._cache={keys:d.keys,values:"clone"===d.cache?S(x):x},x})},mutate:function(d){return"add"!==d.type&&(d.trans._cache=null),T.mutate(d)}})}}}};function zn(d,x){return"readonly"===d.trans.mode&&!!d.subscr&&!d.trans.explicit&&"disabled"!==d.trans.db._options.cache&&!x.schema.primaryKey.outbound}function Vn(d,x){switch(d){case"query":return x.values&&!x.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var e1={stack:"dbcore",level:0,name:"Observability",create:function(d){var T=d.schema.name,I=new gn(d.MIN_KEY,d.MAX_KEY);return w(w({},d),{transaction:function(x,T,E){if(eb.subscr&&"readonly"!==T)throw new ea.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(eb.querier));return d.transaction(x,T,E)},table:function(R){var k=d.table(R),M=k.schema,C=M.primaryKey,e=M.indexes,D=C.extractKey,F=C.outbound,j=C.autoIncrement&&e.filter(function(d){return d.compound&&d.keyPath.includes(C.keyPath)}),K=w(w({},k),{mutate:function(d){function o(d){return K[d="idb://".concat(T,"/").concat(R,"/").concat(d)]||(K[d]=new gn)}var x,D,F=d.trans,K=d.mutatedParts||(d.mutatedParts={}),V=o(""),W=o(":dels"),Y=d.type,$="deleteRange"===d.type?[d.range]:"delete"===d.type?[d.keys]:d.values.length<50?[Mn(C,d).filter(function(d){return d}),d.values]:[],Q=$[0],et=$[1],$=d.trans._cache;return E(Q)?(V.addKeys(Q),($="delete"===Y||Q.length===et.length?Ln(Q,$):null)||W.addKeys(Q),($||et)&&(x=$,D=et,M.indexes.forEach(function(d){var T=o(d.name||"");function r(x){return null!=x?d.extractKey(x):null}function i(x){return d.multiEntry&&E(x)?x.forEach(function(d){return T.addKey(d)}):T.addKey(x)}(x||D).forEach(function(d,T){var E=x&&r(x[T]),T=D&&r(D[T]);0!==st(E,T)&&(null!=E&&i(E),null!=T&&i(T))})}))):Q?(et={from:Q.lower,to:Q.upper},W.add(et),V.add(et)):(V.add(I),W.add(I),M.indexes.forEach(function(d){return o(d.name).add(I)})),k.mutate(d).then(function(x){return!Q||"add"!==d.type&&"put"!==d.type||(V.addKeys(x.results),j&&j.forEach(function(T){var E=d.values.map(function(d){return T.extractKey(d)}),I=T.keyPath.findIndex(function(d){return d===C.keyPath});x.results.forEach(function(d){return E[I]=d}),o(T.name).addKeys(E)})),F.mutatedParts=En(F.mutatedParts||{},K),x})}}),e=function(x){var T=x.query,x=T.index,T=T.range;return[x,new gn(null!==(x=T.lower)&&void 0!==x?x:d.MIN_KEY,null!==(T=T.upper)&&void 0!==T?T:d.MAX_KEY)]},V={get:function(d){return[C,new gn(d.key)]},getMany:function(d){return[C,(new gn).addKeys(d.keys)]},count:e,query:e,openCursor:e};return x(V).forEach(function(d){K[d]=function(x){var E=eb.subscr,M=!!E,C=zn(eb,k)&&Vn(d,x)?x.obsSet={}:E;if(M){var r=function(d){return C[d="idb://".concat(T,"/").concat(R,"/").concat(d)]||(C[d]=new gn)},j=r(""),K=r(":dels"),E=V[d](x),M=E[0],E=E[1];if(("query"===d&&M.isPrimaryKey&&!x.values?K:r(M.name||"")).add(E),!M.isPrimaryKey){if("count"!==d){var W="query"===d&&F&&x.values&&k.query(w(w({},x),{values:!1}));return k[d].apply(this,arguments).then(function(T){if("query"===d){if(F&&x.values)return W.then(function(d){return d=d.result,j.addKeys(d),T});var E=x.values?T.result.map(D):T.result;(x.values?j:K).addKeys(E)}else if("openCursor"===d){var I=x.values;return T&&Object.create(T,{key:{get:function(){return K.addKey(T.primaryKey),T.key}},primaryKey:{get:function(){var d=T.primaryKey;return K.addKey(d),d}},value:{get:function(){return I&&j.addKey(T.primaryKey),T.value}}})}return T})}K.add(I)}}return k[d].apply(this,arguments)}}),K}})}};function Yn(d,x,T){if(0===T.numFailures)return x;if("deleteRange"===x.type)return null;var I=x.keys?x.keys.length:"values"in x&&x.values?x.values.length:1;return T.numFailures===I?null:(E((x=w({},x)).keys)&&(x.keys=x.keys.filter(function(d,x){return!(x in T.failures)})),"values"in x&&E(x.values)&&(x.values=x.values.filter(function(d,x){return!(x in T.failures)})),x)}function $n(d,x){return(void 0===x.lower||(x.lowerOpen?0<st(d,x.lower):0<=st(d,x.lower)))&&(void 0===x.upper||(x.upperOpen?0>st(d,x.upper):0>=st(d,x.upper)))}function Qn(d,x,T,I,R,k){if(!T||0===T.length)return d;var M=x.query.index,C=M.multiEntry,D=x.query.range,F=I.schema.primaryKey.extractKey,j=M.extractKey,K=(M.lowLevelIndex||M).extractKey,T=T.reduce(function(d,T){var I=d,R="add"===T.type||"put"===T.type?T.values.filter(function(d){return d=j(d),C&&E(d)?d.some(function(d){return $n(d,D)}):$n(d,D)}).map(function(d){return d=S(d),k&&Object.freeze(d),d}):[];switch(T.type){case"add":I=d.concat(x.values?R:R.map(function(d){return F(d)}));break;case"put":var M=(new gn).addKeys(T.values.map(function(d){return F(d)})),I=d.filter(function(d){return d=x.values?F(d):d,!xn(new gn(d),M)}).concat(x.values?R:R.map(function(d){return F(d)}));break;case"delete":var K=(new gn).addKeys(T.keys);I=d.filter(function(d){return d=x.values?F(d):d,!xn(new gn(d),K)});break;case"deleteRange":var V=T.range;I=d.filter(function(d){return!$n(F(d),V)})}return I},d);return T===d?d:(T.sort(function(d,x){return st(K(d),K(x))||st(F(d),F(x))}),x.limit&&x.limit<1/0&&(T.length>x.limit?T.length=x.limit:d.length===x.limit&&T.length<x.limit&&(R.dirty=!0)),k?Object.freeze(T):T)}function Gn(d,x){return 0===st(d.lower,x.lower)&&0===st(d.upper,x.upper)&&!!d.lowerOpen==!!x.lowerOpen&&!!d.upperOpen==!!x.upperOpen}var e2={stack:"dbcore",level:0,name:"Cache",create:function(d){var x=d.schema.name;return w(w({},d),{transaction:function(T,E,I){var R,k,M=d.transaction(T,E,I);return"readwrite"===E&&(k=(R=new AbortController).signal,I=function(I){return function(){if(R.abort(),"readwrite"===E){for(var k=new Set,C=0;C<T.length;C++){var D=T[C],F=eY["idb://".concat(x,"/").concat(D)];if(F){var j=d.table(D),K=F.optimisticOps.filter(function(d){return d.trans===M});if(M._explicit&&I&&M.mutatedParts)for(var V=0,W=Object.values(F.queries.query);V<W.length;V++)for(var Y=0,$=(er=W[V]).slice();Y<$.length;Y++)Kn((ei=$[Y]).obsSet,M.mutatedParts)&&(q(er,ei),ei.subscribers.forEach(function(d){return k.add(d)}));else if(0<K.length){F.optimisticOps=F.optimisticOps.filter(function(d){return d.trans!==M});for(var Q=0,et=Object.values(F.queries.query);Q<et.length;Q++)for(var er,ei,eo,ea=0,es=(er=et[Q]).slice();ea<es.length;ea++)null!=(ei=es[ea]).res&&M.mutatedParts&&(I&&!ei.dirty?(eo=Object.isFrozen(ei.res),eo=Qn(ei.res,ei.req,K,j,ei,eo),ei.dirty?(q(er,ei),ei.subscribers.forEach(function(d){return k.add(d)})):eo!==ei.res&&(ei.res=eo,ei.promise=_e.resolve({result:eo}))):(ei.dirty&&q(er,ei),ei.subscribers.forEach(function(d){return k.add(d)})))}}}k.forEach(function(d){return d()})}}},M.addEventListener("abort",I(!1),{signal:k}),M.addEventListener("error",I(!1),{signal:k}),M.addEventListener("complete",I(!0),{signal:k})),M},table:function(T){var E=d.table(T),I=E.schema.primaryKey;return w(w({},E),{mutate:function(d){var R=eb.trans;if(I.outbound||"disabled"===R.db._options.cache||R.explicit)return E.mutate(d);var k=eY["idb://".concat(x,"/").concat(T)];return k?(R=E.mutate(d),("add"===d.type||"put"===d.type)&&(50<=d.values.length||Mn(I,d).some(function(d){return null==d}))?R.then(function(x){var T=Yn(0,w(w({},d),{values:d.values.map(function(d,T){var E,d=null!==(E=I.keyPath)&&void 0!==E&&E.includes(".")?S(d):w({},d);return P(d,I.keyPath,x.results[T]),d})}),x);k.optimisticOps.push(T),queueMicrotask(function(){return d.mutatedParts&&Cn(d.mutatedParts)})}):(k.optimisticOps.push(d),d.mutatedParts&&Cn(d.mutatedParts),R.then(function(x){0<x.numFailures&&(q(k.optimisticOps,d),(x=Yn(0,d,x))&&k.optimisticOps.push(x),d.mutatedParts&&Cn(d.mutatedParts))}),R.catch(function(){q(k.optimisticOps,d),d.mutatedParts&&Cn(d.mutatedParts)})),R):E.mutate(d)},query:function(d){if(!zn(eb,E)||!Vn("query",d))return E.query(d);var I,R,k="immutable"===(null===(F=eb.trans)||void 0===F?void 0:F.db._options.cache),M=eb,C=M.requery,D=M.signal,F=function(d,x,T,E){var I=eY["idb://".concat(d,"/").concat(x)];if(!I)return[];if(!(x=I.queries[T]))return[null,!1,I,null];var R=x[(E.query?E.query.index.name:null)||""];if(!R)return[null,!1,I,null];switch(T){case"query":var k=R.find(function(d){return d.req.limit===E.limit&&d.req.values===E.values&&Gn(d.req.query.range,E.query.range)});return k?[k,!0,I,R]:[R.find(function(d){var x,T;return("limit"in d.req?d.req.limit:1/0)>=E.limit&&(!E.values||d.req.values)&&(x=d.req.query.range,T=E.query.range,0>=function(d,x,T,E){if(void 0===d)return void 0!==x?-1:0;if(void 0===x)return 1;if(0===(x=st(d,x))){if(T&&E)return 0;if(T)return 1;if(E)return -1}return x}(x.lower,T.lower,x.lowerOpen,T.lowerOpen)&&0<=function(d,x,T,E){if(void 0===d)return void 0!==x?1:0;if(void 0===x)return -1;if(0===(x=st(d,x))){if(T&&E)return 0;if(T)return -1;if(E)return 1}return x}(x.upper,T.upper,x.upperOpen,T.upperOpen))}),!1,I,R];case"count":return[k=R.find(function(d){return Gn(d.req.query.range,E.query.range)}),!!k,I,R]}}(x,T,"query",d),j=F[0],M=F[1],K=F[2],V=F[3];return j&&M?j.obsSet=d.obsSet:(M=E.query(d).then(function(d){var x=d.result;if(j&&(j.res=x),k){for(var T=0,E=x.length;T<E;++T)Object.freeze(x[T]);Object.freeze(x)}else d.result=S(x);return d}).catch(function(d){return V&&j&&q(V,j),Promise.reject(d)}),j={obsSet:d.obsSet,promise:M,subscribers:new Set,type:"query",req:d,dirty:!1},V?V.push(j):(V=[j],(K=K||(eY["idb://".concat(x,"/").concat(T)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[d.query.index.name||""]=V)),I=j,R=V,I.subscribers.add(C),D.addEventListener("abort",function(){I.subscribers.delete(C),0===I.subscribers.size&&setTimeout(function(){0===I.subscribers.size&&q(R,I)},3e3)}),j.promise.then(function(x){return{result:Qn(x.result,d,null==K?void 0:K.optimisticOps,E,j,k)}})}})}})}};function Zn(d,x){return new Proxy(d,{get:function(d,T,E){return"db"===T?x:Reflect.get(d,T,E)}})}var e3=(tr.prototype.version=function(d){if(isNaN(d)||d<.1)throw new ea.Type("Given version is not a positive number");if(d=Math.round(10*d)/10,this.idbdb||this._state.isBeingOpened)throw new ea.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,d);var x=this._versions,T=x.filter(function(x){return x._cfg.version===d})[0];return T||(T=new this.Version(d),x.push(T),x.sort(nn),T.stores({}),this._state.autoSchema=!1,T)},tr.prototype._whenReady=function(d){var x=this;return this.idbdb&&(this._state.openComplete||eb.letThrough||this._vip)?d():new _e(function(d,T){if(x._state.openComplete)return T(new ea.DatabaseClosed(x._state.dbOpenError));if(!x._state.isBeingOpened){if(!x._state.autoOpen)return void T(new ea.DatabaseClosed);x.open().catch(G)}x._state.dbReadyPromise.then(d,T)}).then(d)},tr.prototype.use=function(d){var x=d.stack,T=d.create,E=d.level,I=d.name;return I&&this.unuse({stack:x,name:I}),(d=this._middlewares[x]||(this._middlewares[x]=[])).push({stack:x,create:T,level:null==E?10:E,name:I}),d.sort(function(d,x){return d.level-x.level}),this},tr.prototype.unuse=function(d){var x=d.stack,T=d.name,E=d.create;return x&&this._middlewares[x]&&(this._middlewares[x]=this._middlewares[x].filter(function(d){return E?d.create!==E:!!T&&d.name!==T})),this},tr.prototype.open=function(){var d=this;return $e(ev,function(){return function(d){var T=d._state,E=d._deps.indexedDB;if(T.isBeingOpened||d.idbdb)return T.dbReadyPromise.then(function(){return T.dbOpenError?ek(T.dbOpenError):d});T.isBeingOpened=!0,T.dbOpenError=null,T.openComplete=!1;var I=T.openCanceller,R=Math.round(10*d.verno),k=!1;function e(){if(T.openCanceller!==I)throw new ea.DatabaseClosed("db.open() was cancelled")}var M,C=T.dbReadyResolve,D=null,F=!1;return _e.race([I,("undefined"==typeof navigator?_e.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(d){function t(){return indexedDB.databases().finally(d)}M=setInterval(t,100),t()}).finally(function(){return clearInterval(M)}):Promise.resolve()).then(function y(){return new _e(function(I,M){if(e(),!E)throw new ea.MissingAPI;var C=d.name,j=T.autoSchema||!R?E.open(C):E.open(C,R);if(!j)throw new ea.MissingAPI;j.onerror=It(M),j.onblocked=qe(d._fireOnBlocked),j.onupgradeneeded=qe(function(I){var R,K,V,W,Y,$,et;D=j.transaction,T.autoSchema&&!d._options.allowEmptyDB?(j.onerror=Rt,D.abort(),j.result.close(),(R=E.deleteDatabase(C)).onsuccess=R.onerror=qe(function(){M(new ea.NoSuchDatabase("Database ".concat(C," doesnt exist")))})):(D.onerror=It(M),F=(I=I.oldVersion>0x4000000000000000?0:I.oldVersion)<1,d.idbdb=j.result,k&&function(d,x){sn(d._dbSchema,x),x.db.version%10!=0||x.objectStoreNames.contains("$meta")||x.db.createObjectStore("$meta").add(Math.ceil(x.db.version/10-1),"version");var T=ln(0,d.idbdb,x);fn(d,d._dbSchema,x);for(var E=0,I=an(T,d._dbSchema).change;E<I.length;E++){var R=function(d){if(d.change.length||d.recreate)return console.warn("Unable to patch indexes of table ".concat(d.name," because it has changes on the type of index or primary key.")),{value:void 0};var T=x.objectStore(d.name);d.add.forEach(function(x){el&&console.debug("Dexie upgrade patch: Creating missing index ".concat(d.name,".").concat(x.src)),cn(T,x)})}(I[E]);if("object"==typeof R)return R.value}}(d,D),K=I/10,V=D,W=d._dbSchema,V.objectStoreNames.contains("$meta")&&!W.$meta&&(W.$meta=Wt("$meta",hn("")[0],[]),d._storeNames.push("$meta")),(Y=d._createTransaction("readwrite",d._storeNames,W)).create(V),Y._completion.catch(M),$=Y._reject.bind(Y),et=eb.transless||eb,Ne(function(){return eb.trans=Y,eb.transless=et,0!==K?(Zt(d,V),(Y.storeNames.includes("$meta")?Y.table("$meta").get("version").then(function(d){return null!=d?d:K}):_e.resolve(K)).then(function(T){var E,I,R;return E=T,I=[],T=d._versions,R=d._dbSchema=ln(0,d.idbdb,V),0!==(T=T.filter(function(d){return d._cfg.version>=E})).length?(T.forEach(function(T){I.push(function(){var I=R,k=T._cfg.dbschema;fn(d,I,V),fn(d,k,V),R=d._dbSchema=k;var M=an(I,k);M.add.forEach(function(d){un(V,d[0],d[1].primKey,d[1].indexes)}),M.change.forEach(function(d){if(d.recreate)throw new ea.Upgrade("Not yet support for changing primary key");var x=V.objectStore(d.name);d.add.forEach(function(d){return cn(x,d)}),d.change.forEach(function(d){x.deleteIndex(d.name),cn(x,d)}),d.del.forEach(function(d){return x.deleteIndex(d)})});var C=T._cfg.contentUpgrade;if(C&&T._cfg.version>E){Zt(d,V),Y._memoizedTables={};var D=g(k);M.del.forEach(function(d){D[d]=I[d]}),tn(d,[d.Transaction.prototype]),en(d,[d.Transaction.prototype],x(D),D),Y.schema=D;var F,j=Q(C);return j&&Le(),M=_e.follow(function(){var d;(F=C(Y))&&j&&(d=Ue.bind(null,null),F.then(d,d))}),F&&"function"==typeof F.then?_e.resolve(F):M.then(function(){return F})}}),I.push(function(x){var E=T._cfg.dbschema;[].slice.call(x.db.objectStoreNames).forEach(function(d){return null==E[d]&&x.db.deleteObjectStore(d)}),tn(d,[d.Transaction.prototype]),en(d,[d.Transaction.prototype],d._storeNames,d._dbSchema),Y.schema=d._dbSchema}),I.push(function(x){d.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(d.idbdb.version/10)===T._cfg.version?(d.idbdb.deleteObjectStore("$meta"),delete d._dbSchema.$meta,d._storeNames=d._storeNames.filter(function(d){return"$meta"!==d})):x.objectStore("$meta").put(T._cfg.version,"version"))})}),(function e(){return I.length?_e.resolve(I.shift()(Y.idbtrans)).then(e):_e.resolve()})().then(function(){sn(R,V)})):_e.resolve()}).catch($)):(x(W).forEach(function(d){un(V,d,W[d].primKey,W[d].indexes)}),Zt(d,V),void _e.follow(function(){return d.on.populate.fire(Y)}).catch($))}))},M),j.onsuccess=qe(function(){D=null;var E,M,K,V=d.idbdb=j.result,W=b(V.objectStoreNames);if(0<W.length)try{var Y=V.transaction(1===W.length?W[0]:W,"readonly");if(T.autoSchema)E=V,M=Y,d.verno=E.version/10,M=d._dbSchema=ln(0,E,M),d._storeNames=b(E.objectStoreNames,0),en(d,[d._allTables],x(M),M);else if(fn(d,d._dbSchema,Y),((K=an(ln(0,(K=d).idbdb,Y),K._dbSchema)).add.length||K.change.some(function(d){return d.add.length||d.change.length}))&&!k)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),V.close(),R=V.version+1,k=!0,I(y());Zt(d,Y)}catch(d){}eC.push(d),V.onversionchange=qe(function(x){T.vcFired=!0,d.on("versionchange").fire(x)}),V.onclose=qe(function(x){d.on("close").fire(x)}),F&&(K=d._deps,Y=C,V=K.indexedDB,K=K.IDBKeyRange,vn(V)||Y===eN||yn(V,K).put({name:Y}).catch(G)),I()},M)}).catch(function(d){switch(null==d?void 0:d.name){case"UnknownError":if(0<T.PR1398_maxLoop)return T.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),y();break;case"VersionError":if(0<R)return R=0,y()}return _e.reject(d)})})]).then(function(){return e(),T.onReadyBeingFired=[],_e.resolve(mn(function(){return d.on.ready.fire(d.vip)})).then(function e(){if(0<T.onReadyBeingFired.length){var x=T.onReadyBeingFired.reduce(re,G);return T.onReadyBeingFired=[],_e.resolve(mn(function(){return x(d.vip)})).then(e)}})}).finally(function(){T.openCanceller===I&&(T.onReadyBeingFired=null,T.isBeingOpened=!1)}).catch(function(x){T.dbOpenError=x;try{D&&D.abort()}catch(d){}return I===T.openCanceller&&d._close(),ek(x)}).finally(function(){T.openComplete=!0,C()}).then(function(){var x;return F&&(x={},d.tables.forEach(function(T){T.schema.indexes.forEach(function(E){E.name&&(x["idb://".concat(d.name,"/").concat(T.name,"/").concat(E.name)]=new gn(-1/0,[[[]]]))}),x["idb://".concat(d.name,"/").concat(T.name,"/")]=x["idb://".concat(d.name,"/").concat(T.name,"/:dels")]=new gn(-1/0,[[[]]])}),eV(eH).fire(x),Dn(x,!0)),d})}(d)})},tr.prototype._close=function(){var d=this._state,x=eC.indexOf(this);if(0<=x&&eC.splice(x,1),this.idbdb){try{this.idbdb.close()}catch(d){}this.idbdb=null}d.isBeingOpened||(d.dbReadyPromise=new _e(function(x){d.dbReadyResolve=x}),d.openCanceller=new _e(function(x,T){d.cancelOpen=T}))},tr.prototype.close=function(d){var x=(void 0===d?{disableAutoOpen:!0}:d).disableAutoOpen,d=this._state;x?(d.isBeingOpened&&d.cancelOpen(new ea.DatabaseClosed),this._close(),d.autoOpen=!1,d.dbOpenError=new ea.DatabaseClosed):(this._close(),d.autoOpen=this._options.autoOpen||d.isBeingOpened,d.openComplete=!1,d.dbOpenError=null)},tr.prototype.delete=function(d){var x=this;void 0===d&&(d={disableAutoOpen:!0});var T=0<arguments.length&&"object"!=typeof arguments[0],E=this._state;return new _e(function(I,R){function e(){x.close(d);var T=x._deps.indexedDB.deleteDatabase(x.name);T.onsuccess=qe(function(){var d,T,E;d=x._deps,T=x.name,E=d.indexedDB,d=d.IDBKeyRange,vn(E)||T===eN||yn(E,d).delete(T).catch(G),I()}),T.onerror=It(R),T.onblocked=x._fireOnBlocked}if(T)throw new ea.InvalidArgument("Invalid closeOptions argument to db.delete()");E.isBeingOpened?E.dbReadyPromise.then(e):e()})},tr.prototype.backendDB=function(){return this.idbdb},tr.prototype.isOpen=function(){return null!==this.idbdb},tr.prototype.hasBeenClosed=function(){var d=this._state.dbOpenError;return d&&"DatabaseClosed"===d.name},tr.prototype.hasFailed=function(){return null!==this._state.dbOpenError},tr.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(tr.prototype,"tables",{get:function(){var d=this;return x(this._allTables).map(function(x){return d._allTables[x]})},enumerable:!1,configurable:!0}),tr.prototype.transaction=function(){var d=(function(d,x,T){var E=arguments.length;if(E<2)throw new ea.InvalidArgument("Too few arguments");for(var I=Array(E-1);--E;)I[E-1]=arguments[E];return T=I.pop(),[d,_(I),T]}).apply(this,arguments);return this._transaction.apply(this,d)},tr.prototype._transaction=function(d,x,T){var E=this,I=eb.trans;I&&I.db===this&&-1===d.indexOf("!")||(I=null);var R,k,M=-1!==d.indexOf("?");d=d.replace("!","").replace("?","");try{if(k=x.map(function(d){if(d=d instanceof E.Table?d.name:d,"string"!=typeof d)throw TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return d}),"r"==d||d===eD)R=eD;else{if("rw"!=d&&d!=eF)throw new ea.InvalidArgument("Invalid transaction mode: "+d);R=eF}if(I){if(I.mode===eD&&R===eF){if(!M)throw new ea.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");I=null}I&&k.forEach(function(d){if(I&&-1===I.storeNames.indexOf(d)){if(!M)throw new ea.SubTransaction("Table "+d+" not included in parent transaction.");I=null}}),M&&I&&!I.active&&(I=null)}}catch(d){return I?I._promise(null,function(x,T){T(d)}):ek(d)}var C=(function i(d,x,T,E,I){return _e.resolve().then(function(){var R=eb.transless||eb,k=d._createTransaction(x,T,d._dbSchema,E);if(k.explicit=!0,R={trans:k,transless:R},E)k.idbtrans=E.idbtrans;else try{k.create(),k.idbtrans._explicit=!0,d._state.PR1398_maxLoop=3}catch(E){return E.name===eo.InvalidState&&d.isOpen()&&0<--d._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),d.close({disableAutoOpen:!1}),d.open().then(function(){return i(d,x,T,null,I)})):ek(E)}var M,C=Q(I);return C&&Le(),R=_e.follow(function(){var d;(M=I.call(k,k))&&(C?(d=Ue.bind(null,null),M.then(d,d)):"function"==typeof M.next&&"function"==typeof M.throw&&(M=Bn(M)))},R),(M&&"function"==typeof M.then?_e.resolve(M).then(function(d){return k.active?d:ek(new ea.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):R.then(function(){return M})).then(function(d){return E&&k._resolve(),k._completion.then(function(){return d})}).catch(function(d){return k._reject(d),ek(d)})})}).bind(null,this,R,k,I,T);return I?I._promise(R,C,"lock"):eb.trans?$e(eb.transless,function(){return E._whenReady(C)}):this._whenReady(C)},tr.prototype.table=function(d){if(!m(this._allTables,d))throw new ea.InvalidTable("Table ".concat(d," does not exist"));return this._allTables[d]},tr);function tr(d,x){var T=this;this._middlewares={},this.verno=0;var E=tr.dependencies;this._options=x=w({addons:tr.addons,autoOpen:!0,indexedDB:E.indexedDB,IDBKeyRange:E.IDBKeyRange,cache:"cloned"},x),this._deps={indexedDB:x.indexedDB,IDBKeyRange:x.IDBKeyRange},E=x.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var I,R,k,M,C,D={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:G,dbReadyPromise:null,cancelOpen:G,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:x.autoOpen};D.dbReadyPromise=new _e(function(d){D.dbReadyResolve=d}),D.openCanceller=new _e(function(d,x){D.cancelOpen=x}),this._state=D,this.name=d,this.on=dt(this,"populate","blocked","versionchange","close",{ready:[re,G]}),this.on.ready.subscribe=p(this.on.ready.subscribe,function(d){return function(x,E){tr.vip(function(){var I=T._state;I.openComplete?(I.dbOpenError||_e.resolve().then(x),E&&d(x)):I.onReadyBeingFired?(I.onReadyBeingFired.push(x),E&&d(x)):(d(x),E||d(function e(){T.on.ready.unsubscribe(x),T.on.ready.unsubscribe(e)}))})}}),this.Collection=(I=this,pt(eU.prototype,function(d,x){this.db=I;var T=ej,E=null;if(x)try{T=x()}catch(d){E=d}var R=d._ctx,x=R.table,d=x.hook.reading.fire;this._ctx={table:x,index:R.index,isPrimKey:!R.index||x.schema.primKey.keyPath&&R.index===x.schema.primKey.name,range:T,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:E,or:R.or,valueMapper:d!==X?d:null}})),this.Table=(R=this,pt(eB.prototype,function(d,x,T){this.db=R,this._tx=T,this.name=d,this.schema=x,this.hook=R._allTables[d]?R._allTables[d].hook:dt(null,{creating:[Z,G],reading:[H,X],updating:[te,G],deleting:[ee,G]})})),this.Transaction=(k=this,pt(eX.prototype,function(d,x,T,E,I){var R=this;this.db=k,this.mode=d,this.storeNames=x,this.schema=T,this.chromeTransactionDurability=E,this.idbtrans=null,this.on=dt(this,"complete","error","abort"),this.parent=I||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new _e(function(d,x){R._resolve=d,R._reject=x}),this._completion.then(function(){R.active=!1,R.on.complete.fire()},function(d){var x=R.active;return R.active=!1,R.on.error.fire(d),R.parent?R.parent._reject(d):x&&R.idbtrans&&R.idbtrans.abort(),ek(d)})})),this.Version=(M=this,pt(eW.prototype,function(d){this.db=M,this._cfg={version:d,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(C=this,pt(eG.prototype,function(d,x,T){if(this.db=C,this._ctx={table:d,index:":id"===x?null:x,or:T},this._cmp=this._ascending=st,this._descending=function(d,x){return st(x,d)},this._max=function(d,x){return 0<st(d,x)?d:x},this._min=function(d,x){return 0>st(d,x)?d:x},this._IDBKeyRange=C._deps.IDBKeyRange,!this._IDBKeyRange)throw new ea.MissingAPI})),this.on("versionchange",function(d){0<d.newVersion?console.warn("Another connection wants to upgrade database '".concat(T.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(T.name,"'. Closing db now to resume the delete request.")),T.close({disableAutoOpen:!1})}),this.on("blocked",function(d){!d.newVersion||d.newVersion<d.oldVersion?console.warn("Dexie.delete('".concat(T.name,"') was blocked")):console.warn("Upgrade '".concat(T.name,"' blocked by other connection holding version ").concat(d.oldVersion/10))}),this._maxKey=Yt(x.IDBKeyRange),this._createTransaction=function(d,x,E,I){return new T.Transaction(d,x,E,T._options.chromeTransactionDurability,I)},this._fireOnBlocked=function(d){T.on("blocked").fire(d),eC.filter(function(d){return d.name===T.name&&d!==T&&!d._state.vcFired}).map(function(x){return x.on("versionchange").fire(d)})},this.use(e0),this.use(e2),this.use(e1),this.use(eQ),this.use(eJ);var F=new Proxy(this,{get:function(d,x,E){if("_vip"===x)return!0;if("table"===x)return function(d){return Zn(T.table(d),F)};var I=Reflect.get(d,x,E);return I instanceof eB?Zn(I,F):"tables"===x?I.map(function(d){return Zn(d,F)}):"_createTransaction"===x?function(){return Zn(I.apply(this,arguments),F)}:I}});this.vip=F,E.forEach(function(d){return d(T)})}var e4,er="undefined"!=typeof Symbol&&"observable"in Symbol?Symbol.observable:"@@observable",e8=(ir.prototype.subscribe=function(d,x,T){return this._subscribe(d&&"function"!=typeof d?d:{next:d,error:x,complete:T})},ir.prototype[er]=function(){return this},ir);function ir(d){this._subscribe=d}try{e4={indexedDB:d.indexedDB||d.mozIndexedDB||d.webkitIndexedDB||d.msIndexedDB,IDBKeyRange:d.IDBKeyRange||d.webkitIDBKeyRange}}catch(d){e4={indexedDB:null,IDBKeyRange:null}}function or(d){var x,T=!1,E=new e8(function(E){var I,R=Q(d),k=!1,M={},C={},D={get closed(){return k},unsubscribe:function(){k||(k=!0,I&&I.abort(),F&&eV.storagemutated.unsubscribe(f))}};E.start&&E.start(D);var F=!1,l=function(){return Ge(t)},f=function(d){En(M,d),Kn(C,M)&&l()},t=function(){var D,j;!k&&e4.indexedDB&&(M={},D={},I&&I.abort(),Promise.resolve(function(x){var T=je();try{R&&Le();var E=Ne(d,x);return E=R?E.finally(Ue):E}finally{T&&Ae()}}(j={subscr:D,signal:(I=new AbortController).signal,requery:l,querier:d,trans:null})).then(function(d){T=!0,x=d,k||j.signal.aborted||(M={},function(d){for(var x in d)if(m(d,x))return;return 1}(C=D)||F||(eV(eH,f),F=!0),Ge(function(){return!k&&E.next&&E.next(d)}))},function(d){T=!1,["DatabaseClosedError","AbortError"].includes(null==d?void 0:d.name)||k||Ge(function(){k||E.error&&E.error(d)})}))};return setTimeout(l,0),D});return E.hasValue=function(){return T},E.getValue=function(){return x},E}function ur(d){var x=e5;try{e5=!0,eV.storagemutated.fire(d),Dn(d,!0)}finally{e5=x}}r(e3,w(w({},eu),{delete:function(d){return new e3(d,{addons:[]}).delete()},exists:function(d){return new e3(d,{addons:[]}).open().then(function(d){return d.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(d){var x,T;try{return T=(x=e3.dependencies).indexedDB,x=x.IDBKeyRange,(vn(T)?Promise.resolve(T.databases()).then(function(d){return d.map(function(d){return d.name}).filter(function(d){return d!==eN})}):yn(T,x).toCollection().primaryKeys()).then(d)}catch(d){return ek(new ea.MissingAPI)}},defineClass:function(){return function(d){a(this,d)}},ignoreTransaction:function(d){return eb.trans?$e(eb.transless,d):d()},vip:mn,async:function(d){return function(){try{var x=Bn(d.apply(this,arguments));return x&&"function"==typeof x.then?x:_e.resolve(x)}catch(d){return ek(d)}}},spawn:function(d,x,T){try{var E=Bn(d.apply(T,x||[]));return E&&"function"==typeof E.then?E:_e.resolve(E)}catch(d){return ek(d)}},currentTransaction:{get:function(){return eb.trans||null}},waitFor:function(d,x){return x=_e.resolve("function"==typeof d?e3.ignoreTransaction(d):d).timeout(x||6e4),eb.trans?eb.trans.waitFor(x):x},Promise:_e,debug:{get:function(){return el},set:function(d){el=d}},derive:o,extend:a,props:r,override:p,Events:dt,on:eV,liveQuery:or,extendObservabilitySet:En,getByKeyPath:O,setByKeyPath:P,delByKeyPath:function(d,x){"string"==typeof x?P(d,x,void 0):"length"in x&&[].map.call(x,function(x){P(d,x,void 0)})},shallowClone:g,deepClone:S,getObjectDiff:Fn,cmp:st,asap:v,minKey:-1/0,addons:[],connections:eC,errnames:eo,dependencies:e4,cache:eY,semVer:"4.0.4",version:"4.0.4".split(".").map(function(d){return parseInt(d)}).reduce(function(d,x,T){return d+x/Math.pow(10,2*T)})})),e3.maxKey=Yt(e3.dependencies.IDBKeyRange),"undefined"!=typeof dispatchEvent&&"undefined"!=typeof addEventListener&&(eV(eH,function(d){e5||(d=new CustomEvent(eq,{detail:d}),e5=!0,dispatchEvent(d),e5=!1)}),addEventListener(eq,function(d){d=d.detail,e5||ur(d)}));var e6,e5=!1,lr=function(){};return"undefined"!=typeof BroadcastChannel&&((lr=function(){(e6=new BroadcastChannel(eq)).onmessage=function(d){return d.data&&ur(d.data)}})(),"function"==typeof e6.unref&&e6.unref(),eV(eH,function(d){e5||e6.postMessage(d)})),"undefined"!=typeof addEventListener&&(addEventListener("pagehide",function(d){if(!e3.disableBfCache&&d.persisted){el&&console.debug("Dexie: handling persisted pagehide"),null!=e6&&e6.close();for(var x=0;x<eC.length;x++)eC[x].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(d){!e3.disableBfCache&&d.persisted&&(el&&console.debug("Dexie: handling persisted pageshow"),lr(),ur({all:new gn(-1/0,[[]])}))})),_e.rejectionMapper=function(d,x){return!d||d instanceof N||d instanceof TypeError||d instanceof SyntaxError||!d.name||!es[d.name]?d:(x=new es[d.name](x||d.message,d),"stack"in d&&l(x,"stack",{get:function(){return this.inner.stack}}),x)},w(e3,Object.freeze({__proto__:null,Dexie:e3,liveQuery:or,Entity:ut,cmp:st,PropModSymbol:F,PropModification:eK,replacePrefix:function(d,x){return new eK({replacePrefix:[d,x]})},default:e3,RangeSet:gn,mergeRanges:_n,rangesOverlap:xn}),{default:e3}),e3}()},11752:function(d,x,T){d.exports=T(85612)},97498:function(d,x){"use strict";var T,E;Object.defineProperty(x,"__esModule",{value:!0}),function(d,x){for(var T in x)Object.defineProperty(d,T,{enumerable:!0,get:x[T]})}(x,{PrefetchKind:function(){return T},ACTION_REFRESH:function(){return I},ACTION_NAVIGATE:function(){return R},ACTION_RESTORE:function(){return k},ACTION_SERVER_PATCH:function(){return M},ACTION_PREFETCH:function(){return C},ACTION_FAST_REFRESH:function(){return D},ACTION_SERVER_ACTION:function(){return F}});let I="refresh",R="navigate",k="restore",M="server-patch",C="prefetch",D="fast-refresh",F="server-action";(E=T||(T={})).AUTO="auto",E.FULL="full",E.TEMPORARY="temporary",("function"==typeof x.default||"object"==typeof x.default&&null!==x.default)&&void 0===x.default.__esModule&&(Object.defineProperty(x.default,"__esModule",{value:!0}),Object.assign(x.default,x),d.exports=x.default)},10030:function(d,x,T){"use strict";function getDomainLocale(d,x,T,E){return!1}Object.defineProperty(x,"__esModule",{value:!0}),Object.defineProperty(x,"getDomainLocale",{enumerable:!0,get:function(){return getDomainLocale}}),T(22866),("function"==typeof x.default||"object"==typeof x.default&&null!==x.default)&&void 0===x.default.__esModule&&(Object.defineProperty(x.default,"__esModule",{value:!0}),Object.assign(x.default,x),d.exports=x.default)},65170:function(d,x,T){"use strict";Object.defineProperty(x,"__esModule",{value:!0}),Object.defineProperty(x,"default",{enumerable:!0,get:function(){return et}});let E=T(38754),I=E._(T(67294)),R=T(74450),k=T(92227),M=T(64364),C=T(10109),D=T(73607),F=T(11823),j=T(89031),K=T(40920),V=T(10030),W=T(77192),Y=T(97498),$=new Set;function prefetch(d,x,T,E,I,R){if(!R&&!(0,k.isLocalURL)(x))return;if(!E.bypassPrefetchedCheck){let I=void 0!==E.locale?E.locale:"locale"in d?d.locale:void 0,R=x+"%"+T+"%"+I;if($.has(R))return;$.add(R)}let M=R?d.prefetch(x,I):d.prefetch(x,T,E);Promise.resolve(M).catch(d=>{})}function formatStringOrUrl(d){return"string"==typeof d?d:(0,M.formatUrl)(d)}let Q=I.default.forwardRef(function(d,x){let T,E;let{href:M,as:$,children:Q,prefetch:et=null,passHref:er,replace:ei,shallow:eo,scroll:ea,locale:es,onClick:eu,onMouseEnter:el,onTouchStart:ec,legacyBehavior:ef=!1,...eh}=d;T=Q,ef&&("string"==typeof T||"number"==typeof T)&&(T=I.default.createElement("a",null,T));let ed=I.default.useContext(F.RouterContext),ep=I.default.useContext(j.AppRouterContext),em=null!=ed?ed:ep,ey=!ed,eg=!1!==et,ev=null===et?Y.PrefetchKind.AUTO:Y.PrefetchKind.FULL,{href:eb,as:ew}=I.default.useMemo(()=>{if(!ed){let d=formatStringOrUrl(M);return{href:d,as:$?formatStringOrUrl($):d}}let[d,x]=(0,R.resolveHref)(ed,M,!0);return{href:d,as:$?(0,R.resolveHref)(ed,$):x||d}},[ed,M,$]),ex=I.default.useRef(eb),eT=I.default.useRef(ew);ef&&(E=I.default.Children.only(T));let e_=ef?E&&"object"==typeof E&&E.ref:x,[eA,eE,eP]=(0,K.useIntersection)({rootMargin:"200px"}),eI=I.default.useCallback(d=>{(eT.current!==ew||ex.current!==eb)&&(eP(),eT.current=ew,ex.current=eb),eA(d),e_&&("function"==typeof e_?e_(d):"object"==typeof e_&&(e_.current=d))},[ew,e_,eb,eP,eA]);I.default.useEffect(()=>{em&&eE&&eg&&prefetch(em,eb,ew,{locale:es},{kind:ev},ey)},[ew,eb,eE,es,eg,null==ed?void 0:ed.locale,em,ey,ev]);let eR={ref:eI,onClick(d){ef||"function"!=typeof eu||eu(d),ef&&E.props&&"function"==typeof E.props.onClick&&E.props.onClick(d),em&&!d.defaultPrevented&&function(d,x,T,E,R,M,C,D,F,j){let{nodeName:K}=d.currentTarget,V="A"===K.toUpperCase();if(V&&(function(d){let x=d.currentTarget,T=x.getAttribute("target");return T&&"_self"!==T||d.metaKey||d.ctrlKey||d.shiftKey||d.altKey||d.nativeEvent&&2===d.nativeEvent.which}(d)||!F&&!(0,k.isLocalURL)(T)))return;d.preventDefault();let navigate=()=>{let d=null==C||C;"beforePopState"in x?x[R?"replace":"push"](T,E,{shallow:M,locale:D,scroll:d}):x[R?"replace":"push"](E||T,{forceOptimisticNavigation:!j,scroll:d})};F?I.default.startTransition(navigate):navigate()}(d,em,eb,ew,ei,eo,ea,es,ey,eg)},onMouseEnter(d){ef||"function"!=typeof el||el(d),ef&&E.props&&"function"==typeof E.props.onMouseEnter&&E.props.onMouseEnter(d),em&&(eg||!ey)&&prefetch(em,eb,ew,{locale:es,priority:!0,bypassPrefetchedCheck:!0},{kind:ev},ey)},onTouchStart(d){ef||"function"!=typeof ec||ec(d),ef&&E.props&&"function"==typeof E.props.onTouchStart&&E.props.onTouchStart(d),em&&(eg||!ey)&&prefetch(em,eb,ew,{locale:es,priority:!0,bypassPrefetchedCheck:!0},{kind:ev},ey)}};if((0,C.isAbsoluteUrl)(ew))eR.href=ew;else if(!ef||er||"a"===E.type&&!("href"in E.props)){let d=void 0!==es?es:null==ed?void 0:ed.locale,x=(null==ed?void 0:ed.isLocaleDomain)&&(0,V.getDomainLocale)(ew,d,null==ed?void 0:ed.locales,null==ed?void 0:ed.domainLocales);eR.href=x||(0,W.addBasePath)((0,D.addLocale)(ew,d,null==ed?void 0:ed.defaultLocale))}return ef?I.default.cloneElement(E,eR):I.default.createElement("a",{...eh,...eR},T)}),et=Q;("function"==typeof x.default||"object"==typeof x.default&&null!==x.default)&&void 0===x.default.__esModule&&(Object.defineProperty(x.default,"__esModule",{value:!0}),Object.assign(x.default,x),d.exports=x.default)},40920:function(d,x,T){"use strict";Object.defineProperty(x,"__esModule",{value:!0}),Object.defineProperty(x,"useIntersection",{enumerable:!0,get:function(){return useIntersection}});let E=T(67294),I=T(63436),R="function"==typeof IntersectionObserver,k=new Map,M=[];function useIntersection(d){let{rootRef:x,rootMargin:T,disabled:C}=d,D=C||!R,[F,j]=(0,E.useState)(!1),K=(0,E.useRef)(null),V=(0,E.useCallback)(d=>{K.current=d},[]);(0,E.useEffect)(()=>{if(R){if(D||F)return;let d=K.current;if(d&&d.tagName){let E=function(d,x,T){let{id:E,observer:I,elements:R}=function(d){let x;let T={root:d.root||null,margin:d.rootMargin||""},E=M.find(d=>d.root===T.root&&d.margin===T.margin);if(E&&(x=k.get(E)))return x;let I=new Map,R=new IntersectionObserver(d=>{d.forEach(d=>{let x=I.get(d.target),T=d.isIntersecting||d.intersectionRatio>0;x&&T&&x(T)})},d);return x={id:T,observer:R,elements:I},M.push(T),k.set(T,x),x}(T);return R.set(d,x),I.observe(d),function(){if(R.delete(d),I.unobserve(d),0===R.size){I.disconnect(),k.delete(E);let d=M.findIndex(d=>d.root===E.root&&d.margin===E.margin);d>-1&&M.splice(d,1)}}}(d,d=>d&&j(d),{root:null==x?void 0:x.current,rootMargin:T});return E}}else if(!F){let d=(0,I.requestIdleCallback)(()=>j(!0));return()=>(0,I.cancelIdleCallback)(d)}},[D,T,x,F,K.current]);let W=(0,E.useCallback)(()=>{j(!1)},[]);return[V,F,W]}("function"==typeof x.default||"object"==typeof x.default&&null!==x.default)&&void 0===x.default.__esModule&&(Object.defineProperty(x.default,"__esModule",{value:!0}),Object.assign(x.default,x),d.exports=x.default)},41664:function(d,x,T){d.exports=T(65170)},26285:function(d,x,T){"use strict";var E=T(22617);let I=Symbol.for("Dexie"),R=globalThis[I]||(globalThis[I]=E);if(E.semVer!==R.semVer)throw Error(`Two different versions of Dexie loaded in the same app: ${E.semVer} and ${R.semVer}`);let{liveQuery:k,mergeRanges:M,rangesOverlap:C,RangeSet:D,cmp:F,Entity:j,PropModSymbol:K,PropModification:V,replacePrefix:W}=R;x.ZP=R},69365:function(d,x,T){"use strict";T.d(x,{z:function(){return OrbitControls}});var E=T(99477);let I={type:"change"},R={type:"start"},k={type:"end"};let OrbitControls=class OrbitControls extends E.pBf{constructor(d,x){super(),this.object=d,this.domElement=x,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new E.Pa4,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:E.RsA.ROTATE,MIDDLE:E.RsA.DOLLY,RIGHT:E.RsA.PAN},this.touches={ONE:E.QmN.ROTATE,TWO:E.QmN.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return F.phi},this.getAzimuthalAngle=function(){return F.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(d){d.addEventListener("keydown",onKeyDown),this._domElementKeyEvents=d},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",onKeyDown),this._domElementKeyEvents=null},this.saveState=function(){T.target0.copy(T.target),T.position0.copy(T.object.position),T.zoom0=T.object.zoom},this.reset=function(){T.target.copy(T.target0),T.object.position.copy(T.position0),T.object.zoom=T.zoom0,T.object.updateProjectionMatrix(),T.dispatchEvent(I),T.update(),C=M.NONE},this.update=function(){let x=new E.Pa4,R=new E._fP().setFromUnitVectors(d.up,new E.Pa4(0,1,0)),k=R.clone().invert(),Y=new E.Pa4,$=new E._fP,Q=new E.Pa4,et=2*Math.PI;return function(){let d=T.object.position;x.copy(d).sub(T.target),x.applyQuaternion(R),F.setFromVector3(x),T.autoRotate&&C===M.NONE&&rotateLeft(2*Math.PI/60/60*T.autoRotateSpeed),T.enableDamping?(F.theta+=j.theta*T.dampingFactor,F.phi+=j.phi*T.dampingFactor):(F.theta+=j.theta,F.phi+=j.phi);let E=T.minAzimuthAngle,er=T.maxAzimuthAngle;return isFinite(E)&&isFinite(er)&&(E<-Math.PI?E+=et:E>Math.PI&&(E-=et),er<-Math.PI?er+=et:er>Math.PI&&(er-=et),E<=er?F.theta=Math.max(E,Math.min(er,F.theta)):F.theta=F.theta>(E+er)/2?Math.max(E,F.theta):Math.min(er,F.theta)),F.phi=Math.max(T.minPolarAngle,Math.min(T.maxPolarAngle,F.phi)),F.makeSafe(),F.radius*=K,F.radius=Math.max(T.minDistance,Math.min(T.maxDistance,F.radius)),!0===T.enableDamping?T.target.addScaledVector(V,T.dampingFactor):T.target.add(V),x.setFromSpherical(F),x.applyQuaternion(k),d.copy(T.target).add(x),T.object.lookAt(T.target),!0===T.enableDamping?(j.theta*=1-T.dampingFactor,j.phi*=1-T.dampingFactor,V.multiplyScalar(1-T.dampingFactor)):(j.set(0,0,0),V.set(0,0,0)),K=1,!!(W||Y.distanceToSquared(T.object.position)>D||8*(1-$.dot(T.object.quaternion))>D||Q.distanceToSquared(T.target)>0)&&(T.dispatchEvent(I),Y.copy(T.object.position),$.copy(T.object.quaternion),Q.copy(T.target),W=!1,!0)}}(),this.dispose=function(){T.domElement.removeEventListener("contextmenu",onContextMenu),T.domElement.removeEventListener("pointerdown",onPointerDown),T.domElement.removeEventListener("pointercancel",onPointerUp),T.domElement.removeEventListener("wheel",onMouseWheel),T.domElement.removeEventListener("pointermove",onPointerMove),T.domElement.removeEventListener("pointerup",onPointerUp),null!==T._domElementKeyEvents&&(T._domElementKeyEvents.removeEventListener("keydown",onKeyDown),T._domElementKeyEvents=null)};let T=this,M={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},C=M.NONE,D=1e-6,F=new E.$V,j=new E.$V,K=1,V=new E.Pa4,W=!1,Y=new E.FM8,$=new E.FM8,Q=new E.FM8,et=new E.FM8,er=new E.FM8,ei=new E.FM8,eo=new E.FM8,ea=new E.FM8,es=new E.FM8,eu=[],el={};function getZoomScale(){return Math.pow(.95,T.zoomSpeed)}function rotateLeft(d){j.theta-=d}function rotateUp(d){j.phi-=d}let ec=function(){let d=new E.Pa4;return function(x,T){d.setFromMatrixColumn(T,0),d.multiplyScalar(-x),V.add(d)}}(),ef=function(){let d=new E.Pa4;return function(x,E){!0===T.screenSpacePanning?d.setFromMatrixColumn(E,1):(d.setFromMatrixColumn(E,0),d.crossVectors(T.object.up,d)),d.multiplyScalar(x),V.add(d)}}(),eh=function(){let d=new E.Pa4;return function(x,E){let I=T.domElement;if(T.object.isPerspectiveCamera){let R=T.object.position;d.copy(R).sub(T.target);let k=d.length();ec(2*x*(k*=Math.tan(T.object.fov/2*Math.PI/180))/I.clientHeight,T.object.matrix),ef(2*E*k/I.clientHeight,T.object.matrix)}else T.object.isOrthographicCamera?(ec(x*(T.object.right-T.object.left)/T.object.zoom/I.clientWidth,T.object.matrix),ef(E*(T.object.top-T.object.bottom)/T.object.zoom/I.clientHeight,T.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),T.enablePan=!1)}}();function dollyOut(d){T.object.isPerspectiveCamera?K/=d:T.object.isOrthographicCamera?(T.object.zoom=Math.max(T.minZoom,Math.min(T.maxZoom,T.object.zoom*d)),T.object.updateProjectionMatrix(),W=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),T.enableZoom=!1)}function dollyIn(d){T.object.isPerspectiveCamera?K*=d:T.object.isOrthographicCamera?(T.object.zoom=Math.max(T.minZoom,Math.min(T.maxZoom,T.object.zoom/d)),T.object.updateProjectionMatrix(),W=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),T.enableZoom=!1)}function handleMouseDownRotate(d){Y.set(d.clientX,d.clientY)}function handleMouseDownPan(d){et.set(d.clientX,d.clientY)}function handleTouchStartRotate(){if(1===eu.length)Y.set(eu[0].pageX,eu[0].pageY);else{let d=.5*(eu[0].pageX+eu[1].pageX),x=.5*(eu[0].pageY+eu[1].pageY);Y.set(d,x)}}function handleTouchStartPan(){if(1===eu.length)et.set(eu[0].pageX,eu[0].pageY);else{let d=.5*(eu[0].pageX+eu[1].pageX),x=.5*(eu[0].pageY+eu[1].pageY);et.set(d,x)}}function handleTouchStartDolly(){let d=eu[0].pageX-eu[1].pageX,x=eu[0].pageY-eu[1].pageY;eo.set(0,Math.sqrt(d*d+x*x))}function handleTouchMoveRotate(d){if(1==eu.length)$.set(d.pageX,d.pageY);else{let x=getSecondPointerPosition(d),T=.5*(d.pageX+x.x),E=.5*(d.pageY+x.y);$.set(T,E)}Q.subVectors($,Y).multiplyScalar(T.rotateSpeed);let x=T.domElement;rotateLeft(2*Math.PI*Q.x/x.clientHeight),rotateUp(2*Math.PI*Q.y/x.clientHeight),Y.copy($)}function handleTouchMovePan(d){if(1===eu.length)er.set(d.pageX,d.pageY);else{let x=getSecondPointerPosition(d),T=.5*(d.pageX+x.x),E=.5*(d.pageY+x.y);er.set(T,E)}ei.subVectors(er,et).multiplyScalar(T.panSpeed),eh(ei.x,ei.y),et.copy(er)}function handleTouchMoveDolly(d){let x=getSecondPointerPosition(d),E=d.pageX-x.x,I=d.pageY-x.y;ea.set(0,Math.sqrt(E*E+I*I)),es.set(0,Math.pow(ea.y/eo.y,T.zoomSpeed)),dollyOut(es.y),eo.copy(ea)}function onPointerDown(d){!1!==T.enabled&&(0===eu.length&&(T.domElement.setPointerCapture(d.pointerId),T.domElement.addEventListener("pointermove",onPointerMove),T.domElement.addEventListener("pointerup",onPointerUp)),eu.push(d),"touch"===d.pointerType?function(d){switch(trackPointer(d),eu.length){case 1:switch(T.touches.ONE){case E.QmN.ROTATE:if(!1===T.enableRotate)return;handleTouchStartRotate(),C=M.TOUCH_ROTATE;break;case E.QmN.PAN:if(!1===T.enablePan)return;handleTouchStartPan(),C=M.TOUCH_PAN;break;default:C=M.NONE}break;case 2:switch(T.touches.TWO){case E.QmN.DOLLY_PAN:if(!1===T.enableZoom&&!1===T.enablePan)return;T.enableZoom&&handleTouchStartDolly(),T.enablePan&&handleTouchStartPan(),C=M.TOUCH_DOLLY_PAN;break;case E.QmN.DOLLY_ROTATE:if(!1===T.enableZoom&&!1===T.enableRotate)return;T.enableZoom&&handleTouchStartDolly(),T.enableRotate&&handleTouchStartRotate(),C=M.TOUCH_DOLLY_ROTATE;break;default:C=M.NONE}break;default:C=M.NONE}C!==M.NONE&&T.dispatchEvent(R)}(d):function(d){let x;switch(d.button){case 0:x=T.mouseButtons.LEFT;break;case 1:x=T.mouseButtons.MIDDLE;break;case 2:x=T.mouseButtons.RIGHT;break;default:x=-1}switch(x){case E.RsA.DOLLY:if(!1===T.enableZoom)return;eo.set(d.clientX,d.clientY),C=M.DOLLY;break;case E.RsA.ROTATE:if(d.ctrlKey||d.metaKey||d.shiftKey){if(!1===T.enablePan)return;handleMouseDownPan(d),C=M.PAN}else{if(!1===T.enableRotate)return;handleMouseDownRotate(d),C=M.ROTATE}break;case E.RsA.PAN:if(d.ctrlKey||d.metaKey||d.shiftKey){if(!1===T.enableRotate)return;handleMouseDownRotate(d),C=M.ROTATE}else{if(!1===T.enablePan)return;handleMouseDownPan(d),C=M.PAN}break;default:C=M.NONE}C!==M.NONE&&T.dispatchEvent(R)}(d))}function onPointerMove(d){!1!==T.enabled&&("touch"===d.pointerType?function(d){switch(trackPointer(d),C){case M.TOUCH_ROTATE:if(!1===T.enableRotate)return;handleTouchMoveRotate(d),T.update();break;case M.TOUCH_PAN:if(!1===T.enablePan)return;handleTouchMovePan(d),T.update();break;case M.TOUCH_DOLLY_PAN:if(!1===T.enableZoom&&!1===T.enablePan)return;T.enableZoom&&handleTouchMoveDolly(d),T.enablePan&&handleTouchMovePan(d),T.update();break;case M.TOUCH_DOLLY_ROTATE:if(!1===T.enableZoom&&!1===T.enableRotate)return;T.enableZoom&&handleTouchMoveDolly(d),T.enableRotate&&handleTouchMoveRotate(d),T.update();break;default:C=M.NONE}}(d):function(d){switch(C){case M.ROTATE:if(!1===T.enableRotate)return;!function(d){$.set(d.clientX,d.clientY),Q.subVectors($,Y).multiplyScalar(T.rotateSpeed);let x=T.domElement;rotateLeft(2*Math.PI*Q.x/x.clientHeight),rotateUp(2*Math.PI*Q.y/x.clientHeight),Y.copy($),T.update()}(d);break;case M.DOLLY:if(!1===T.enableZoom)return;ea.set(d.clientX,d.clientY),es.subVectors(ea,eo),es.y>0?dollyOut(getZoomScale()):es.y<0&&dollyIn(getZoomScale()),eo.copy(ea),T.update();break;case M.PAN:if(!1===T.enablePan)return;er.set(d.clientX,d.clientY),ei.subVectors(er,et).multiplyScalar(T.panSpeed),eh(ei.x,ei.y),et.copy(er),T.update()}}(d))}function onPointerUp(d){(function(d){delete el[d.pointerId];for(let x=0;x<eu.length;x++)if(eu[x].pointerId==d.pointerId){eu.splice(x,1);return}})(d),0===eu.length&&(T.domElement.releasePointerCapture(d.pointerId),T.domElement.removeEventListener("pointermove",onPointerMove),T.domElement.removeEventListener("pointerup",onPointerUp)),T.dispatchEvent(k),C=M.NONE}function onMouseWheel(d){!1!==T.enabled&&!1!==T.enableZoom&&C===M.NONE&&(d.preventDefault(),T.dispatchEvent(R),d.deltaY<0?dollyIn(getZoomScale()):d.deltaY>0&&dollyOut(getZoomScale()),T.update(),T.dispatchEvent(k))}function onKeyDown(d){!1!==T.enabled&&!1!==T.enablePan&&function(d){let x=!1;switch(d.code){case T.keys.UP:d.ctrlKey||d.metaKey||d.shiftKey?rotateUp(2*Math.PI*T.rotateSpeed/T.domElement.clientHeight):eh(0,T.keyPanSpeed),x=!0;break;case T.keys.BOTTOM:d.ctrlKey||d.metaKey||d.shiftKey?rotateUp(-2*Math.PI*T.rotateSpeed/T.domElement.clientHeight):eh(0,-T.keyPanSpeed),x=!0;break;case T.keys.LEFT:d.ctrlKey||d.metaKey||d.shiftKey?rotateLeft(2*Math.PI*T.rotateSpeed/T.domElement.clientHeight):eh(T.keyPanSpeed,0),x=!0;break;case T.keys.RIGHT:d.ctrlKey||d.metaKey||d.shiftKey?rotateLeft(-2*Math.PI*T.rotateSpeed/T.domElement.clientHeight):eh(-T.keyPanSpeed,0),x=!0}x&&(d.preventDefault(),T.update())}(d)}function onContextMenu(d){!1!==T.enabled&&d.preventDefault()}function trackPointer(d){let x=el[d.pointerId];void 0===x&&(x=new E.FM8,el[d.pointerId]=x),x.set(d.pageX,d.pageY)}function getSecondPointerPosition(d){let x=d.pointerId===eu[0].pointerId?eu[1]:eu[0];return el[x.pointerId]}T.domElement.addEventListener("contextmenu",onContextMenu),T.domElement.addEventListener("pointerdown",onPointerDown),T.domElement.addEventListener("pointercancel",onPointerUp),T.domElement.addEventListener("wheel",onMouseWheel,{passive:!1}),this.update()}}},61411:function(d,x,T){"use strict";let E,I,R;T.d(x,{y:function(){return FBXLoader}});var k=T(99477),M={},durl=function(d){return URL.createObjectURL(new Blob([d],{type:"text/javascript"}))},cwk=function(d){return new Worker(d)};try{URL.revokeObjectURL(durl(""))}catch(d){durl=function(d){return"data:application/javascript;charset=UTF-8,"+encodeURI(d)},cwk=function(d){return new Worker(d,{type:"module"})}}var C=Uint8Array,D=Uint16Array,F=Uint32Array,j=new C([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),K=new C([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),V=new C([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),freb=function(d,x){for(var T=new D(31),E=0;E<31;++E)T[E]=x+=1<<d[E-1];for(var I=new F(T[30]),E=1;E<30;++E)for(var R=T[E];R<T[E+1];++R)I[R]=R-T[E]<<5|E;return[T,I]},W=freb(j,2),Y=W[0],$=W[1];Y[28]=258,$[258]=28;for(var Q=freb(K,0),et=Q[0],er=Q[1],ei=new D(32768),eo=0;eo<32768;++eo){var ea=(43690&eo)>>>1|(21845&eo)<<1;ea=(61680&(ea=(52428&ea)>>>2|(13107&ea)<<2))>>>4|(3855&ea)<<4,ei[eo]=((65280&ea)>>>8|(255&ea)<<8)>>>1}for(var hMap=function(d,x,T){for(var E,I=d.length,R=0,k=new D(x);R<I;++R)++k[d[R]-1];var M=new D(x);for(R=0;R<x;++R)M[R]=M[R-1]+k[R-1]<<1;if(T){E=new D(1<<x);var C=15-x;for(R=0;R<I;++R)if(d[R])for(var F=R<<4|d[R],j=x-d[R],K=M[d[R]-1]++<<j,V=K|(1<<j)-1;K<=V;++K)E[ei[K]>>>C]=F}else for(R=0,E=new D(I);R<I;++R)d[R]&&(E[R]=ei[M[d[R]-1]++]>>>15-d[R]);return E},es=new C(288),eo=0;eo<144;++eo)es[eo]=8;for(var eo=144;eo<256;++eo)es[eo]=9;for(var eo=256;eo<280;++eo)es[eo]=7;for(var eo=280;eo<288;++eo)es[eo]=8;for(var eu=new C(32),eo=0;eo<32;++eo)eu[eo]=5;var el=hMap(es,9,1),ec=hMap(eu,5,1),max=function(d){for(var x=d[0],T=1;T<d.length;++T)d[T]>x&&(x=d[T]);return x},bits=function(d,x,T){var E=x/8|0;return(d[E]|d[E+1]<<8)>>(7&x)&T},bits16=function(d,x){var T=x/8|0;return(d[T]|d[T+1]<<8|d[T+2]<<16)>>(7&x)},shft=function(d){return(d/8|0)+(7&d&&1)},slc=function(d,x,T){(null==x||x<0)&&(x=0),(null==T||T>d.length)&&(T=d.length);var E=new(d instanceof D?D:d instanceof F?F:C)(T-x);return E.set(d.subarray(x,T)),E},inflt=function(d,x,T){var E=d.length;if(!E||T&&!T.l&&E<5)return x||new C(0);var I=!x||T,R=!T||T.i;T||(T={}),x||(x=new C(3*E));var cbuf=function(d){var T=x.length;if(d>T){var E=new C(Math.max(2*T,d));E.set(x),x=E}},k=T.f||0,M=T.p||0,D=T.b||0,F=T.l,W=T.d,$=T.m,Q=T.n,er=8*E;do{if(!F){T.f=k=bits(d,M,1);var ei=bits(d,M+1,3);if(M+=3,ei){if(1==ei)F=el,W=ec,$=9,Q=5;else if(2==ei){var eo=bits(d,M,31)+257,ea=bits(d,M+10,15)+4,es=eo+bits(d,M+5,31)+1;M+=14;for(var eu=new C(es),ef=new C(19),eh=0;eh<ea;++eh)ef[V[eh]]=bits(d,M+3*eh,7);M+=3*ea;for(var ed=max(ef),ep=(1<<ed)-1,em=hMap(ef,ed,1),eh=0;eh<es;){var ey=em[bits(d,M,ep)];M+=15&ey;var eg=ey>>>4;if(eg<16)eu[eh++]=eg;else{var ev=0,eb=0;for(16==eg?(eb=3+bits(d,M,3),M+=2,ev=eu[eh-1]):17==eg?(eb=3+bits(d,M,7),M+=3):18==eg&&(eb=11+bits(d,M,127),M+=7);eb--;)eu[eh++]=ev}}var ew=eu.subarray(0,eo),ex=eu.subarray(eo);$=max(ew),Q=max(ex),F=hMap(ew,$,1),W=hMap(ex,Q,1)}else throw"invalid block type"}else{var eg=shft(M)+4,eT=d[eg-4]|d[eg-3]<<8,e_=eg+eT;if(e_>E){if(R)throw"unexpected EOF";break}I&&cbuf(D+eT),x.set(d.subarray(eg,e_),D),T.b=D+=eT,T.p=M=8*e_;continue}if(M>er){if(R)throw"unexpected EOF";break}}I&&cbuf(D+131072);for(var eA=(1<<$)-1,eE=(1<<Q)-1,eP=M;;eP=M){var ev=F[bits16(d,M)&eA],eI=ev>>>4;if((M+=15&ev)>er){if(R)throw"unexpected EOF";break}if(!ev)throw"invalid length/literal";if(eI<256)x[D++]=eI;else if(256==eI){eP=M,F=null;break}else{var eR=eI-254;if(eI>264){var eh=eI-257,eO=j[eh];eR=bits(d,M,(1<<eO)-1)+Y[eh],M+=eO}var ek=W[bits16(d,M)&eE],eS=ek>>>4;if(!ek)throw"invalid distance";M+=15&ek;var ex=et[eS];if(eS>3){var eO=K[eS];ex+=bits16(d,M)&(1<<eO)-1,M+=eO}if(M>er){if(R)throw"unexpected EOF";break}I&&cbuf(D+131072);for(var eM=D+eR;D<eM;D+=4)x[D]=x[D-ex],x[D+1]=x[D+1-ex],x[D+2]=x[D+2-ex],x[D+3]=x[D+3-ex];D=eM}}T.l=F,T.p=eP,T.b=D,F&&(k=1,T.m=$,T.d=W,T.n=Q)}while(!k);return D==x.length?x:slc(x,0,D)},wbits=function(d,x,T){T<<=7&x;var E=x/8|0;d[E]|=T,d[E+1]|=T>>>8},wbits16=function(d,x,T){T<<=7&x;var E=x/8|0;d[E]|=T,d[E+1]|=T>>>8,d[E+2]|=T>>>16},hTree=function(d,x){for(var T=[],E=0;E<d.length;++E)d[E]&&T.push({s:E,f:d[E]});var I=T.length,R=T.slice();if(!I)return[eh,0];if(1==I){var k=new C(T[0].s+1);return k[T[0].s]=1,[k,1]}T.sort(function(d,x){return d.f-x.f}),T.push({s:-1,f:25001});var M=T[0],F=T[1],j=0,K=1,V=2;for(T[0]={s:-1,f:M.f+F.f,l:M,r:F};K!=I-1;)M=T[T[j].f<T[V].f?j++:V++],F=T[j!=K&&T[j].f<T[V].f?j++:V++],T[K++]={s:-1,f:M.f+F.f,l:M,r:F};for(var W=R[0].s,E=1;E<I;++E)R[E].s>W&&(W=R[E].s);var Y=new D(W+1),$=ln(T[K-1],Y,0);if($>x){var E=0,Q=0,et=$-x,er=1<<et;for(R.sort(function(d,x){return Y[x.s]-Y[d.s]||d.f-x.f});E<I;++E){var ei=R[E].s;if(Y[ei]>x)Q+=er-(1<<$-Y[ei]),Y[ei]=x;else break}for(Q>>>=et;Q>0;){var eo=R[E].s;Y[eo]<x?Q-=1<<x-Y[eo]++-1:++E}for(;E>=0&&Q;--E){var ea=R[E].s;Y[ea]==x&&(--Y[ea],++Q)}$=x}return[new C(Y),$]},ln=function(d,x,T){return -1==d.s?Math.max(ln(d.l,x,T+1),ln(d.r,x,T+1)):x[d.s]=T},lc=function(d){for(var x=d.length;x&&!d[--x];);for(var T=new D(++x),E=0,I=d[0],R=1,w=function(d){T[E++]=d},k=1;k<=x;++k)if(d[k]==I&&k!=x)++R;else{if(!I&&R>2){for(;R>138;R-=138)w(32754);R>2&&(w(R>10?R-11<<5|28690:R-3<<5|12305),R=0)}else if(R>3){for(w(I),--R;R>6;R-=6)w(8304);R>2&&(w(R-3<<5|8208),R=0)}for(;R--;)w(I);R=1,I=d[k]}return[T.subarray(0,E),x]},clen=function(d,x){for(var T=0,E=0;E<x.length;++E)T+=d[E]*x[E];return T},wfblk=function(d,x,T){var E=T.length,I=shft(x+2);d[I]=255&E,d[I+1]=E>>>8,d[I+2]=255^d[I],d[I+3]=255^d[I+1];for(var R=0;R<E;++R)d[I+R+4]=T[R];return(I+4+E)*8},wblk=function(d,x,T,E,I,R,k,M,C,F,W){wbits(x,W++,T),++I[256];for(var Y,$,Q,et,er=hTree(I,15),ei=er[0],eo=er[1],ea=hTree(R,15),el=ea[0],ec=ea[1],ef=lc(ei),eh=ef[0],ed=ef[1],ep=lc(el),em=ep[0],ey=ep[1],eg=new D(19),ev=0;ev<eh.length;++ev)eg[31&eh[ev]]++;for(var ev=0;ev<em.length;++ev)eg[31&em[ev]]++;for(var eb=hTree(eg,7),ew=eb[0],ex=eb[1],eT=19;eT>4&&!ew[V[eT-1]];--eT);var e_=F+5<<3,eA=clen(I,es)+clen(R,eu)+k,eE=clen(I,ei)+clen(R,el)+k+14+3*eT+clen(eg,ew)+(2*eg[16]+3*eg[17]+7*eg[18]);if(e_<=eA&&e_<=eE)return wfblk(x,W,d.subarray(C,C+F));if(wbits(x,W,1+(eE<eA)),W+=2,eE<eA){Y=hMap(ei,eo,0),$=ei,Q=hMap(el,ec,0),et=el;var eP=hMap(ew,ex,0);wbits(x,W,ed-257),wbits(x,W+5,ey-1),wbits(x,W+10,eT-4),W+=14;for(var ev=0;ev<eT;++ev)wbits(x,W+3*ev,ew[V[ev]]);W+=3*eT;for(var eI=[eh,em],eR=0;eR<2;++eR)for(var eO=eI[eR],ev=0;ev<eO.length;++ev){var ek=31&eO[ev];wbits(x,W,eP[ek]),W+=ew[ek],ek>15&&(wbits(x,W,eO[ev]>>>5&127),W+=eO[ev]>>>12)}}else Y=null,$=es,Q=null,et=eu;for(var ev=0;ev<M;++ev)if(E[ev]>255){var ek=E[ev]>>>18&31;wbits16(x,W,Y[ek+257]),W+=$[ek+257],ek>7&&(wbits(x,W,E[ev]>>>23&31),W+=j[ek]);var eS=31&E[ev];wbits16(x,W,Q[eS]),W+=et[eS],eS>3&&(wbits16(x,W,E[ev]>>>5&8191),W+=K[eS])}else wbits16(x,W,Y[E[ev]]),W+=$[E[ev]];return wbits16(x,W,Y[256]),W+$[256]},ef=new F([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),eh=new C(0),zlv=function(d){if((15&d[0])!=8||d[0]>>>4>7||(d[0]<<8|d[1])%31)throw"invalid zlib data";if(32&d[1])throw"invalid zlib data: preset dictionaries not supported"},ed="undefined"!=typeof TextDecoder&&new TextDecoder;try{ed.decode(eh,{stream:!0})}catch(d){}function findSpan(d,x,T){let E=T.length-d-1;if(x>=T[E])return E-1;if(x<=T[d])return d;let I=d,R=E,k=Math.floor((I+R)/2);for(;x<T[k]||x>=T[k+1];)x<T[k]?R=k:I=k,k=Math.floor((I+R)/2);return k}let NURBSCurve=class NURBSCurve extends k.Hyl{constructor(d,x,T,E,I){super(),this.degree=d,this.knots=x,this.controlPoints=[],this.startKnot=E||0,this.endKnot=I||this.knots.length-1;for(let d=0;d<T.length;++d){let x=T[d];this.controlPoints[d]=new k.Ltg(x.x,x.y,x.z,x.w)}}getPoint(d,x=new k.Pa4){let T=this.knots[this.startKnot]+d*(this.knots[this.endKnot]-this.knots[this.startKnot]),E=function(d,x,T,E){let I=findSpan(d,E,x),R=function(d,x,T,E){let I=[],R=[],k=[];I[0]=1;for(let M=1;M<=T;++M){R[M]=x-E[d+1-M],k[M]=E[d+M]-x;let T=0;for(let d=0;d<M;++d){let x=k[d+1],E=R[M-d],C=I[d]/(x+E);I[d]=T+x*C,T=E*C}I[M]=T}return I}(I,E,d,x),M=new k.Ltg(0,0,0,0);for(let x=0;x<=d;++x){let E=T[I-d+x],k=R[x],C=E.w*k;M.x+=E.x*C,M.y+=E.y*C,M.z+=E.z*C,M.w+=E.w*k}return M}(this.degree,this.knots,this.controlPoints,T);return 1!==E.w&&E.divideScalar(E.w),x.set(E.x,E.y,E.z)}getTangent(d,x=new k.Pa4){let T=this.knots[0]+d*(this.knots[this.knots.length-1]-this.knots[0]),E=function(d,x,T,E,I){let R=function(d,x,T,E,I){let R=I<d?I:d,M=[],C=findSpan(d,E,x),D=function(d,x,T,E,I){let R=[];for(let d=0;d<=T;++d)R[d]=0;let k=[];for(let d=0;d<=E;++d)k[d]=R.slice(0);let M=[];for(let d=0;d<=T;++d)M[d]=R.slice(0);M[0][0]=1;let C=R.slice(0),D=R.slice(0);for(let E=1;E<=T;++E){C[E]=x-I[d+1-E],D[E]=I[d+E]-x;let T=0;for(let d=0;d<E;++d){let x=D[d+1],I=C[E-d];M[E][d]=x+I;let R=M[d][E-1]/M[E][d];M[d][E]=T+x*R,T=I*R}M[E][E]=T}for(let d=0;d<=T;++d)k[0][d]=M[d][T];for(let d=0;d<=T;++d){let x=0,I=1,C=[];for(let d=0;d<=T;++d)C[d]=R.slice(0);C[0][0]=1;for(let R=1;R<=E;++R){let E=0,D=d-R,F=T-R;d>=R&&(C[I][0]=C[x][0]/M[F+1][D],E=C[I][0]*M[D][F]);let j=D>=-1?1:-D,K=d-1<=F?R-1:T-d;for(let d=j;d<=K;++d)C[I][d]=(C[x][d]-C[x][d-1])/M[F+1][D+d],E+=C[I][d]*M[D+d][F];d<=F&&(C[I][R]=-C[x][R-1]/M[F+1][d],E+=C[I][R]*M[d][F]),k[R][d]=E;let V=x;x=I,I=V}}let F=T;for(let d=1;d<=E;++d){for(let x=0;x<=T;++x)k[d][x]*=F;F*=T-d}return k}(C,E,d,R,x),F=[];for(let d=0;d<T.length;++d){let x=T[d].clone(),E=x.w;x.x*=E,x.y*=E,x.z*=E,F[d]=x}for(let x=0;x<=R;++x){let T=F[C-d].clone().multiplyScalar(D[x][0]);for(let E=1;E<=d;++E)T.add(F[C-d+E].clone().multiplyScalar(D[x][E]));M[x]=T}for(let d=R+1;d<=I+1;++d)M[d]=new k.Ltg(0,0,0);return M}(d,x,T,E,1);return function(d){let x=d.length,T=[],E=[];for(let I=0;I<x;++I){let x=d[I];T[I]=new k.Pa4(x.x,x.y,x.z),E[I]=x.w}let I=[];for(let d=0;d<x;++d){let x=T[d].clone();for(let T=1;T<=d;++T)x.sub(I[d-T].clone().multiplyScalar(function(d,x){let T=1;for(let x=2;x<=d;++x)T*=x;let E=1;for(let d=2;d<=x;++d)E*=d;for(let T=2;T<=d-x;++T)E*=T;return T/E}(d,T)*E[T]));I[d]=x.divideScalar(E[0])}return I}(R)}(this.degree,this.knots,this.controlPoints,T,0);return x.copy(E[1]).normalize(),x}};let FBXLoader=class FBXLoader extends k.aNw{constructor(d){super(d)}load(d,x,T,E){let I=this,R=""===I.path?k.Zp0.extractUrlBase(d):I.path,M=new k.hH6(this.manager);M.setPath(I.path),M.setResponseType("arraybuffer"),M.setRequestHeader(I.requestHeader),M.setWithCredentials(I.withCredentials),M.load(d,function(T){try{x(I.parse(T,R))}catch(x){E?E(x):console.error(x),I.manager.itemError(d)}},T,E)}parse(d,x){if(function(d){let x="Kaydara FBX Binary  \x00";return d.byteLength>=x.length&&x===convertArrayBufferToString(d,0,x.length)}(d))E=new BinaryParser().parse(d);else{let x=convertArrayBufferToString(d);if(!function(d){let x=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],T=0;for(let E=0;E<x.length;++E){let I=function(x){let E=d[x-1];return d=d.slice(T+x),T++,E}(1);if(I===x[E])return!1}return!0}(x))throw Error("THREE.FBXLoader: Unknown format.");if(7e3>getFbxVersion(x))throw Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+getFbxVersion(x));E=new TextParser().parse(x)}let T=new k.dpR(this.manager).setPath(this.resourcePath||x).setCrossOrigin(this.crossOrigin);return new FBXTreeParser(T,this.manager).parse(E)}};let FBXTreeParser=class FBXTreeParser{constructor(d,x){this.textureLoader=d,this.manager=x}parse(){I=this.parseConnections();let d=this.parseImages(),x=this.parseTextures(d),T=this.parseMaterials(x),E=this.parseDeformers(),k=new GeometryParser().parse(E);return this.parseScene(E,k,T),R}parseConnections(){let d=new Map;if("Connections"in E){let x=E.Connections.connections;x.forEach(function(x){let T=x[0],E=x[1],I=x[2];d.has(T)||d.set(T,{parents:[],children:[]}),d.get(T).parents.push({ID:E,relationship:I}),d.has(E)||d.set(E,{parents:[],children:[]}),d.get(E).children.push({ID:T,relationship:I})})}return d}parseImages(){let d={},x={};if("Video"in E.Objects){let T=E.Objects.Video;for(let E in T){let I=T[E],R=parseInt(E);if(d[R]=I.RelativeFilename||I.Filename,"Content"in I){let d=I.Content instanceof ArrayBuffer&&I.Content.byteLength>0,R="string"==typeof I.Content&&""!==I.Content;if(d||R){let d=this.parseImage(T[E]);x[I.RelativeFilename||I.Filename]=d}}}}for(let T in d){let E=d[T];void 0!==x[E]?d[T]=x[E]:d[T]=d[T].split("\\").pop()}return d}parseImage(d){let x;let T=d.Content,E=d.RelativeFilename||d.Filename,I=E.slice(E.lastIndexOf(".")+1).toLowerCase();switch(I){case"bmp":x="image/bmp";break;case"jpg":case"jpeg":x="image/jpeg";break;case"png":x="image/png";break;case"tif":x="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",E),x="image/tga";break;default:console.warn('FBXLoader: Image type "'+I+'" is not supported.');return}if("string"==typeof T)return"data:"+x+";base64,"+T;{let d=new Uint8Array(T);return window.URL.createObjectURL(new Blob([d],{type:x}))}}parseTextures(d){let x=new Map;if("Texture"in E.Objects){let T=E.Objects.Texture;for(let E in T){let I=this.parseTexture(T[E],d);x.set(parseInt(E),I)}}return x}parseTexture(d,x){let T=this.loadTexture(d,x);T.ID=d.id,T.name=d.attrName;let E=d.WrapModeU,I=d.WrapModeV,R=void 0!==E?E.value:0,M=void 0!==I?I.value:0;if(T.wrapS=0===R?k.rpg:k.uWy,T.wrapT=0===M?k.rpg:k.uWy,"Scaling"in d){let x=d.Scaling.value;T.repeat.x=x[0],T.repeat.y=x[1]}if("Translation"in d){let x=d.Translation.value;T.offset.x=x[0],T.offset.y=x[1]}return T}loadTexture(d,x){let T,E;let R=this.textureLoader.path,M=I.get(d.id).children;void 0!==M&&M.length>0&&void 0!==x[M[0].ID]&&(0===(T=x[M[0].ID]).indexOf("blob:")||0===T.indexOf("data:"))&&this.textureLoader.setPath(void 0);let C=d.FileName.slice(-3).toLowerCase();if("tga"===C){let x=this.manager.getHandler(".tga");null===x?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",d.RelativeFilename),E=new k.xEZ):(x.setPath(this.textureLoader.path),E=x.load(T))}else"psd"===C?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",d.RelativeFilename),E=new k.xEZ):E=this.textureLoader.load(T);return this.textureLoader.setPath(R),E}parseMaterials(d){let x=new Map;if("Material"in E.Objects){let T=E.Objects.Material;for(let E in T){let I=this.parseMaterial(T[E],d);null!==I&&x.set(parseInt(E),I)}}return x}parseMaterial(d,x){let T;let E=d.id,R=d.attrName,M=d.ShadingModel;if("object"==typeof M&&(M=M.value),!I.has(E))return null;let C=this.parseParameters(d,x,E);switch(M.toLowerCase()){case"phong":T=new k.xoR;break;case"lambert":T=new k.YBo;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',M),T=new k.xoR}return T.setValues(C),T.name=R,T}parseParameters(d,x,T){let E={};d.BumpFactor&&(E.bumpScale=d.BumpFactor.value),d.Diffuse?E.color=new k.Ilk().fromArray(d.Diffuse.value).convertSRGBToLinear():d.DiffuseColor&&("Color"===d.DiffuseColor.type||"ColorRGB"===d.DiffuseColor.type)&&(E.color=new k.Ilk().fromArray(d.DiffuseColor.value).convertSRGBToLinear()),d.DisplacementFactor&&(E.displacementScale=d.DisplacementFactor.value),d.Emissive?E.emissive=new k.Ilk().fromArray(d.Emissive.value).convertSRGBToLinear():d.EmissiveColor&&("Color"===d.EmissiveColor.type||"ColorRGB"===d.EmissiveColor.type)&&(E.emissive=new k.Ilk().fromArray(d.EmissiveColor.value).convertSRGBToLinear()),d.EmissiveFactor&&(E.emissiveIntensity=parseFloat(d.EmissiveFactor.value)),d.Opacity&&(E.opacity=parseFloat(d.Opacity.value)),E.opacity<1&&(E.transparent=!0),d.ReflectionFactor&&(E.reflectivity=d.ReflectionFactor.value),d.Shininess&&(E.shininess=d.Shininess.value),d.Specular?E.specular=new k.Ilk().fromArray(d.Specular.value).convertSRGBToLinear():d.SpecularColor&&"Color"===d.SpecularColor.type&&(E.specular=new k.Ilk().fromArray(d.SpecularColor.value).convertSRGBToLinear());let R=this;return I.get(T).children.forEach(function(d){let T=d.relationship;switch(T){case"Bump":E.bumpMap=R.getTexture(x,d.ID);break;case"Maya|TEX_ao_map":E.aoMap=R.getTexture(x,d.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":E.map=R.getTexture(x,d.ID),void 0!==E.map&&(E.map.colorSpace=k.KI_);break;case"DisplacementColor":E.displacementMap=R.getTexture(x,d.ID);break;case"EmissiveColor":E.emissiveMap=R.getTexture(x,d.ID),void 0!==E.emissiveMap&&(E.emissiveMap.colorSpace=k.KI_);break;case"NormalMap":case"Maya|TEX_normal_map":E.normalMap=R.getTexture(x,d.ID);break;case"ReflectionColor":E.envMap=R.getTexture(x,d.ID),void 0!==E.envMap&&(E.envMap.mapping=k.dSO,E.envMap.colorSpace=k.KI_);break;case"SpecularColor":E.specularMap=R.getTexture(x,d.ID),void 0!==E.specularMap&&(E.specularMap.colorSpace=k.KI_);break;case"TransparentColor":case"TransparencyFactor":E.alphaMap=R.getTexture(x,d.ID),E.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",T)}}),E}getTexture(d,x){return"LayeredTexture"in E.Objects&&x in E.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),x=I.get(x).children[0].ID),d.get(x)}parseDeformers(){let d={},x={};if("Deformer"in E.Objects){let T=E.Objects.Deformer;for(let E in T){let R=T[E],k=I.get(parseInt(E));if("Skin"===R.attrType){let x=this.parseSkeleton(k,T);x.ID=E,k.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),x.geometryID=k.parents[0].ID,d[E]=x}else if("BlendShape"===R.attrType){let d={id:E};d.rawTargets=this.parseMorphTargets(k,T),d.id=E,k.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),x[E]=d}}}return{skeletons:d,morphTargets:x}}parseSkeleton(d,x){let T=[];return d.children.forEach(function(d){let E=x[d.ID];if("Cluster"!==E.attrType)return;let I={ID:d.ID,indices:[],weights:[],transformLink:new k.yGw().fromArray(E.TransformLink.a)};"Indexes"in E&&(I.indices=E.Indexes.a,I.weights=E.Weights.a),T.push(I)}),{rawBones:T,bones:[]}}parseMorphTargets(d,x){let T=[];for(let E=0;E<d.children.length;E++){let R=d.children[E],k=x[R.ID],M={name:k.attrName,initialWeight:k.DeformPercent,id:k.id,fullWeights:k.FullWeights.a};if("BlendShapeChannel"!==k.attrType)return;M.geoID=I.get(parseInt(R.ID)).children.filter(function(d){return void 0===d.relationship})[0].ID,T.push(M)}return T}parseScene(d,x,T){R=new k.ZAu;let M=this.parseModels(d.skeletons,x,T),C=E.Objects.Model,D=this;M.forEach(function(d){let x=C[d.ID];D.setLookAtProperties(d,x);let T=I.get(d.ID).parents;T.forEach(function(x){let T=M.get(x.ID);void 0!==T&&T.add(d)}),null===d.parent&&R.add(d)}),this.bindSkeleton(d.skeletons,x,M),this.createAmbientLight(),R.traverse(function(d){if(d.userData.transformData){d.parent&&(d.userData.transformData.parentMatrix=d.parent.matrix,d.userData.transformData.parentMatrixWorld=d.parent.matrixWorld);let x=generateTransform(d.userData.transformData);d.applyMatrix4(x),d.updateWorldMatrix()}});let F=new AnimationParser().parse();1===R.children.length&&R.children[0].isGroup&&(R.children[0].animations=F,R=R.children[0]),R.animations=F}parseModels(d,x,T){let R=new Map,M=E.Objects.Model;for(let E in M){let C=parseInt(E),D=M[E],F=I.get(C),j=this.buildSkeleton(F,d,C,D.attrName);if(!j){switch(D.attrType){case"Camera":j=this.createCamera(F);break;case"Light":j=this.createLight(F);break;case"Mesh":j=this.createMesh(F,x,T);break;case"NurbsCurve":j=this.createCurve(F,x);break;case"LimbNode":case"Root":j=new k.N$j;break;default:j=new k.ZAu}j.name=D.attrName?k.iUV.sanitizeNodeName(D.attrName):"",j.ID=C}this.getTransformData(j,D),R.set(C,j)}return R}buildSkeleton(d,x,T,E){let I=null;return d.parents.forEach(function(d){for(let R in x){let M=x[R];M.rawBones.forEach(function(x,R){if(x.ID===d.ID){let d=I;(I=new k.N$j).matrixWorld.copy(x.transformLink),I.name=E?k.iUV.sanitizeNodeName(E):"",I.ID=T,M.bones[R]=I,null!==d&&I.add(d)}})}}),I}createCamera(d){let x,T;if(d.children.forEach(function(d){let x=E.Objects.NodeAttribute[d.ID];void 0!==x&&(T=x)}),void 0===T)x=new k.Tme;else{let d=0;void 0!==T.CameraProjectionType&&1===T.CameraProjectionType.value&&(d=1);let E=1;void 0!==T.NearPlane&&(E=T.NearPlane.value/1e3);let I=1e3;void 0!==T.FarPlane&&(I=T.FarPlane.value/1e3);let R=window.innerWidth,M=window.innerHeight;void 0!==T.AspectWidth&&void 0!==T.AspectHeight&&(R=T.AspectWidth.value,M=T.AspectHeight.value);let C=R/M,D=45;void 0!==T.FieldOfView&&(D=T.FieldOfView.value);let F=T.FocalLength?T.FocalLength.value:null;switch(d){case 0:x=new k.cPb(D,C,E,I),null!==F&&x.setFocalLength(F);break;case 1:x=new k.iKG(-R/2,R/2,M/2,-M/2,E,I);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+d+"."),x=new k.Tme}}return x}createLight(d){let x,T;if(d.children.forEach(function(d){let x=E.Objects.NodeAttribute[d.ID];void 0!==x&&(T=x)}),void 0===T)x=new k.Tme;else{let d;d=void 0===T.LightType?0:T.LightType.value;let E=16777215;void 0!==T.Color&&(E=new k.Ilk().fromArray(T.Color.value).convertSRGBToLinear());let I=void 0===T.Intensity?1:T.Intensity.value/100;void 0!==T.CastLightOnObject&&0===T.CastLightOnObject.value&&(I=0);let R=0;switch(void 0!==T.FarAttenuationEnd&&(R=void 0!==T.EnableFarAttenuation&&0===T.EnableFarAttenuation.value?0:T.FarAttenuationEnd.value),d){case 0:x=new k.cek(E,I,R,1);break;case 1:x=new k.Ox3(E,I);break;case 2:let M=Math.PI/3;void 0!==T.InnerAngle&&(M=k.M8C.degToRad(T.InnerAngle.value));let C=0;void 0!==T.OuterAngle&&(C=Math.max(C=k.M8C.degToRad(T.OuterAngle.value),1)),x=new k.PMe(E,I,R,M,C,1);break;default:console.warn("THREE.FBXLoader: Unknown light type "+T.LightType.value+", defaulting to a PointLight."),x=new k.cek(E,I)}void 0!==T.CastShadows&&1===T.CastShadows.value&&(x.castShadow=!0)}return x}createMesh(d,x,T){let E;let I=null,R=null,M=[];return d.children.forEach(function(d){x.has(d.ID)&&(I=x.get(d.ID)),T.has(d.ID)&&M.push(T.get(d.ID))}),M.length>1?R=M:M.length>0?R=M[0]:(R=new k.xoR({name:k.aNw.DEFAULT_MATERIAL_NAME,color:13421772}),M.push(R)),"color"in I.attributes&&M.forEach(function(d){d.vertexColors=!0}),I.FBX_Deformer?(E=new k.TUv(I,R)).normalizeSkinWeights():E=new k.Kj0(I,R),E}createCurve(d,x){let T=d.children.reduce(function(d,T){return x.has(T.ID)&&(d=x.get(T.ID)),d},null),E=new k.nls({name:k.aNw.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new k.x12(T,E)}getTransformData(d,x){let T={};"InheritType"in x&&(T.inheritType=parseInt(x.InheritType.value)),"RotationOrder"in x?T.eulerOrder=getEulerOrder(x.RotationOrder.value):T.eulerOrder="ZYX","Lcl_Translation"in x&&(T.translation=x.Lcl_Translation.value),"PreRotation"in x&&(T.preRotation=x.PreRotation.value),"Lcl_Rotation"in x&&(T.rotation=x.Lcl_Rotation.value),"PostRotation"in x&&(T.postRotation=x.PostRotation.value),"Lcl_Scaling"in x&&(T.scale=x.Lcl_Scaling.value),"ScalingOffset"in x&&(T.scalingOffset=x.ScalingOffset.value),"ScalingPivot"in x&&(T.scalingPivot=x.ScalingPivot.value),"RotationOffset"in x&&(T.rotationOffset=x.RotationOffset.value),"RotationPivot"in x&&(T.rotationPivot=x.RotationPivot.value),d.userData.transformData=T}setLookAtProperties(d,x){if("LookAtProperty"in x){let x=I.get(d.ID).children;x.forEach(function(x){if("LookAtProperty"===x.relationship){let T=E.Objects.Model[x.ID];if("Lcl_Translation"in T){let x=T.Lcl_Translation.value;void 0!==d.target?(d.target.position.fromArray(x),R.add(d.target)):d.lookAt(new k.Pa4().fromArray(x))}}})}}bindSkeleton(d,x,T){let E=this.parsePoseNodes();for(let R in d){let M=d[R],C=I.get(parseInt(M.ID)).parents;C.forEach(function(d){if(x.has(d.ID)){let x=d.ID,R=I.get(x);R.parents.forEach(function(d){if(T.has(d.ID)){let x=T.get(d.ID);x.bind(new k.OdW(M.bones),E[d.ID])}})}})}}parsePoseNodes(){let d={};if("Pose"in E.Objects){let x=E.Objects.Pose;for(let T in x)if("BindPose"===x[T].attrType&&x[T].NbPoseNodes>0){let E=x[T].PoseNode;Array.isArray(E)?E.forEach(function(x){d[x.Node]=new k.yGw().fromArray(x.Matrix.a)}):d[E.Node]=new k.yGw().fromArray(E.Matrix.a)}}return d}createAmbientLight(){if("GlobalSettings"in E&&"AmbientColor"in E.GlobalSettings){let d=E.GlobalSettings.AmbientColor.value,x=d[0],T=d[1],I=d[2];if(0!==x||0!==T||0!==I){let d=new k.Ilk(x,T,I).convertSRGBToLinear();R.add(new k.Mig(d,1))}}}};let GeometryParser=class GeometryParser{constructor(){this.negativeMaterialIndices=!1}parse(d){let x=new Map;if("Geometry"in E.Objects){let T=E.Objects.Geometry;for(let E in T){let R=I.get(parseInt(E)),k=this.parseGeometry(R,T[E],d);x.set(parseInt(E),k)}}return!0===this.negativeMaterialIndices&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),x}parseGeometry(d,x,T){switch(x.attrType){case"Mesh":return this.parseMeshGeometry(d,x,T);case"NurbsCurve":return this.parseNurbsGeometry(x)}}parseMeshGeometry(d,x,T){let I=T.skeletons,R=[],k=d.parents.map(function(d){return E.Objects.Model[d.ID]});if(0===k.length)return;let M=d.children.reduce(function(d,x){return void 0!==I[x.ID]&&(d=I[x.ID]),d},null);d.children.forEach(function(d){void 0!==T.morphTargets[d.ID]&&R.push(T.morphTargets[d.ID])});let C=k[0],D={};"RotationOrder"in C&&(D.eulerOrder=getEulerOrder(C.RotationOrder.value)),"InheritType"in C&&(D.inheritType=parseInt(C.InheritType.value)),"GeometricTranslation"in C&&(D.translation=C.GeometricTranslation.value),"GeometricRotation"in C&&(D.rotation=C.GeometricRotation.value),"GeometricScaling"in C&&(D.scale=C.GeometricScaling.value);let F=generateTransform(D);return this.genGeometry(x,M,R,F)}genGeometry(d,x,T,E){let I=new k.u9r;d.attrName&&(I.name=d.attrName);let R=this.parseGeoNode(d,x),M=this.genBuffers(R),C=new k.a$l(M.vertex,3);if(C.applyMatrix4(E),I.setAttribute("position",C),M.colors.length>0&&I.setAttribute("color",new k.a$l(M.colors,3)),x&&(I.setAttribute("skinIndex",new k.qlB(M.weightsIndices,4)),I.setAttribute("skinWeight",new k.a$l(M.vertexWeights,4)),I.FBX_Deformer=x),M.normal.length>0){let d=new k.Vkp().getNormalMatrix(E),x=new k.a$l(M.normal,3);x.applyNormalMatrix(d),I.setAttribute("normal",x)}if(M.uvs.forEach(function(d,x){let T=0===x?"uv":`uv${x}`;I.setAttribute(T,new k.a$l(M.uvs[x],2))}),R.material&&"AllSame"!==R.material.mappingType){let d=M.materialIndex[0],x=0;if(M.materialIndex.forEach(function(T,E){T!==d&&(I.addGroup(x,E-x,d),d=T,x=E)}),I.groups.length>0){let x=I.groups[I.groups.length-1],T=x.start+x.count;T!==M.materialIndex.length&&I.addGroup(T,M.materialIndex.length-T,d)}0===I.groups.length&&I.addGroup(0,M.materialIndex.length,M.materialIndex[0])}return this.addMorphTargets(I,d,T,E),I}parseGeoNode(d,x){let T={};if(T.vertexPositions=void 0!==d.Vertices?d.Vertices.a:[],T.vertexIndices=void 0!==d.PolygonVertexIndex?d.PolygonVertexIndex.a:[],d.LayerElementColor&&(T.color=this.parseVertexColors(d.LayerElementColor[0])),d.LayerElementMaterial&&(T.material=this.parseMaterialIndices(d.LayerElementMaterial[0])),d.LayerElementNormal&&(T.normal=this.parseNormals(d.LayerElementNormal[0])),d.LayerElementUV){T.uv=[];let x=0;for(;d.LayerElementUV[x];)d.LayerElementUV[x].UV&&T.uv.push(this.parseUVs(d.LayerElementUV[x])),x++}return T.weightTable={},null!==x&&(T.skeleton=x,x.rawBones.forEach(function(d,x){d.indices.forEach(function(E,I){void 0===T.weightTable[E]&&(T.weightTable[E]=[]),T.weightTable[E].push({id:x,weight:d.weights[I]})})})),T}genBuffers(d){let x={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},T=0,E=0,I=!1,R=[],k=[],M=[],C=[],D=[],F=[],j=this;return d.vertexIndices.forEach(function(K,V){let W;let Y=!1;K<0&&(K^=-1,Y=!0);let $=[],Q=[];if(R.push(3*K,3*K+1,3*K+2),d.color){let x=getData(V,T,K,d.color);M.push(x[0],x[1],x[2])}if(d.skeleton){if(void 0!==d.weightTable[K]&&d.weightTable[K].forEach(function(d){Q.push(d.weight),$.push(d.id)}),Q.length>4){I||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),I=!0);let d=[0,0,0,0],x=[0,0,0,0];Q.forEach(function(T,E){let I=T,R=$[E];x.forEach(function(x,T,E){if(I>x){E[T]=I,I=x;let k=d[T];d[T]=R,R=k}})}),$=d,Q=x}for(;Q.length<4;)Q.push(0),$.push(0);for(let d=0;d<4;++d)D.push(Q[d]),F.push($[d])}if(d.normal){let x=getData(V,T,K,d.normal);k.push(x[0],x[1],x[2])}d.material&&"AllSame"!==d.material.mappingType&&(W=getData(V,T,K,d.material)[0])<0&&(j.negativeMaterialIndices=!0,W=0),d.uv&&d.uv.forEach(function(d,x){let E=getData(V,T,K,d);void 0===C[x]&&(C[x]=[]),C[x].push(E[0]),C[x].push(E[1])}),E++,Y&&(E>4&&console.warn("THREE.FBXLoader: Polygons with more than four sides are not supported. Make sure to triangulate the geometry during export."),j.genFace(x,d,R,W,k,M,C,D,F,E),T++,E=0,R=[],k=[],M=[],C=[],D=[],F=[])}),x}genFace(d,x,T,E,I,R,k,M,C,D){for(let F=2;F<D;F++)d.vertex.push(x.vertexPositions[T[0]]),d.vertex.push(x.vertexPositions[T[1]]),d.vertex.push(x.vertexPositions[T[2]]),d.vertex.push(x.vertexPositions[T[(F-1)*3]]),d.vertex.push(x.vertexPositions[T[(F-1)*3+1]]),d.vertex.push(x.vertexPositions[T[(F-1)*3+2]]),d.vertex.push(x.vertexPositions[T[3*F]]),d.vertex.push(x.vertexPositions[T[3*F+1]]),d.vertex.push(x.vertexPositions[T[3*F+2]]),x.skeleton&&(d.vertexWeights.push(M[0]),d.vertexWeights.push(M[1]),d.vertexWeights.push(M[2]),d.vertexWeights.push(M[3]),d.vertexWeights.push(M[(F-1)*4]),d.vertexWeights.push(M[(F-1)*4+1]),d.vertexWeights.push(M[(F-1)*4+2]),d.vertexWeights.push(M[(F-1)*4+3]),d.vertexWeights.push(M[4*F]),d.vertexWeights.push(M[4*F+1]),d.vertexWeights.push(M[4*F+2]),d.vertexWeights.push(M[4*F+3]),d.weightsIndices.push(C[0]),d.weightsIndices.push(C[1]),d.weightsIndices.push(C[2]),d.weightsIndices.push(C[3]),d.weightsIndices.push(C[(F-1)*4]),d.weightsIndices.push(C[(F-1)*4+1]),d.weightsIndices.push(C[(F-1)*4+2]),d.weightsIndices.push(C[(F-1)*4+3]),d.weightsIndices.push(C[4*F]),d.weightsIndices.push(C[4*F+1]),d.weightsIndices.push(C[4*F+2]),d.weightsIndices.push(C[4*F+3])),x.color&&(d.colors.push(R[0]),d.colors.push(R[1]),d.colors.push(R[2]),d.colors.push(R[(F-1)*3]),d.colors.push(R[(F-1)*3+1]),d.colors.push(R[(F-1)*3+2]),d.colors.push(R[3*F]),d.colors.push(R[3*F+1]),d.colors.push(R[3*F+2])),x.material&&"AllSame"!==x.material.mappingType&&(d.materialIndex.push(E),d.materialIndex.push(E),d.materialIndex.push(E)),x.normal&&(d.normal.push(I[0]),d.normal.push(I[1]),d.normal.push(I[2]),d.normal.push(I[(F-1)*3]),d.normal.push(I[(F-1)*3+1]),d.normal.push(I[(F-1)*3+2]),d.normal.push(I[3*F]),d.normal.push(I[3*F+1]),d.normal.push(I[3*F+2])),x.uv&&x.uv.forEach(function(x,T){void 0===d.uvs[T]&&(d.uvs[T]=[]),d.uvs[T].push(k[T][0]),d.uvs[T].push(k[T][1]),d.uvs[T].push(k[T][(F-1)*2]),d.uvs[T].push(k[T][(F-1)*2+1]),d.uvs[T].push(k[T][2*F]),d.uvs[T].push(k[T][2*F+1])})}addMorphTargets(d,x,T,I){if(0===T.length)return;d.morphTargetsRelative=!0,d.morphAttributes.position=[];let R=this;T.forEach(function(T){T.rawTargets.forEach(function(T){let k=E.Objects.Geometry[T.geoID];void 0!==k&&R.genMorphGeometry(d,x,k,I,T.name)})})}genMorphGeometry(d,x,T,E,I){let R=void 0!==x.PolygonVertexIndex?x.PolygonVertexIndex.a:[],M=void 0!==T.Vertices?T.Vertices.a:[],C=void 0!==T.Indexes?T.Indexes.a:[],D=3*d.attributes.position.count,F=new Float32Array(D);for(let d=0;d<C.length;d++){let x=3*C[d];F[x]=M[3*d],F[x+1]=M[3*d+1],F[x+2]=M[3*d+2]}let j=this.genBuffers({vertexIndices:R,vertexPositions:F}),K=new k.a$l(j.vertex,3);K.name=I||T.attrName,K.applyMatrix4(E),d.morphAttributes.position.push(K)}parseNormals(d){let x=d.MappingInformationType,T=d.ReferenceInformationType,E=d.Normals.a,I=[];return"IndexToDirect"===T&&("NormalIndex"in d?I=d.NormalIndex.a:"NormalsIndex"in d&&(I=d.NormalsIndex.a)),{dataSize:3,buffer:E,indices:I,mappingType:x,referenceType:T}}parseUVs(d){let x=d.MappingInformationType,T=d.ReferenceInformationType,E=d.UV.a,I=[];return"IndexToDirect"===T&&(I=d.UVIndex.a),{dataSize:2,buffer:E,indices:I,mappingType:x,referenceType:T}}parseVertexColors(d){let x=d.MappingInformationType,T=d.ReferenceInformationType,E=d.Colors.a,I=[];"IndexToDirect"===T&&(I=d.ColorIndex.a);for(let d=0,x=new k.Ilk;d<E.length;d+=4)x.fromArray(E,d).convertSRGBToLinear().toArray(E,d);return{dataSize:4,buffer:E,indices:I,mappingType:x,referenceType:T}}parseMaterialIndices(d){let x=d.MappingInformationType,T=d.ReferenceInformationType;if("NoMappingInformation"===x)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:T};let E=d.Materials.a,I=[];for(let d=0;d<E.length;++d)I.push(d);return{dataSize:1,buffer:E,indices:I,mappingType:x,referenceType:T}}parseNurbsGeometry(d){let x,T;let E=parseInt(d.Order);if(isNaN(E))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",d.Order,d.id),new k.u9r;let I=E-1,R=d.KnotVector.a,M=[],C=d.Points.a;for(let d=0,x=C.length;d<x;d+=4)M.push(new k.Ltg().fromArray(C,d));if("Closed"===d.Form)M.push(M[0]);else if("Periodic"===d.Form){x=I,T=R.length-1-x;for(let d=0;d<I;++d)M.push(M[d])}let D=new NURBSCurve(I,R,M,x,T),F=D.getPoints(12*M.length);return new k.u9r().setFromPoints(F)}};let AnimationParser=class AnimationParser{parse(){let d=[],x=this.parseClips();if(void 0!==x)for(let T in x){let E=x[T],I=this.addClip(E);d.push(I)}return d}parseClips(){if(void 0===E.Objects.AnimationCurve)return;let d=this.parseAnimationCurveNodes();this.parseAnimationCurves(d);let x=this.parseAnimationLayers(d),T=this.parseAnimStacks(x);return T}parseAnimationCurveNodes(){let d=E.Objects.AnimationCurveNode,x=new Map;for(let T in d){let E=d[T];if(null!==E.attrName.match(/S|R|T|DeformPercent/)){let d={id:E.id,attr:E.attrName,curves:{}};x.set(d.id,d)}}return x}parseAnimationCurves(d){let x=E.Objects.AnimationCurve;for(let T in x){let E={id:x[T].id,times:x[T].KeyTime.a.map(convertFBXTimeToSeconds),values:x[T].KeyValueFloat.a},R=I.get(E.id);if(void 0!==R){let x=R.parents[0].ID,T=R.parents[0].relationship;T.match(/X/)?d.get(x).curves.x=E:T.match(/Y/)?d.get(x).curves.y=E:T.match(/Z/)?d.get(x).curves.z=E:T.match(/DeformPercent/)&&d.has(x)&&(d.get(x).curves.morph=E)}}}parseAnimationLayers(d){let x=E.Objects.AnimationLayer,T=new Map;for(let M in x){let x=[],C=I.get(parseInt(M));if(void 0!==C){let D=C.children;D.forEach(function(T,M){if(d.has(T.ID)){let C=d.get(T.ID);if(void 0!==C.curves.x||void 0!==C.curves.y||void 0!==C.curves.z){if(void 0===x[M]){let d=I.get(T.ID).parents.filter(function(d){return void 0!==d.relationship})[0].ID;if(void 0!==d){let I=E.Objects.Model[d.toString()];if(void 0===I){console.warn("THREE.FBXLoader: Encountered a unused curve.",T);return}let C={modelName:I.attrName?k.iUV.sanitizeNodeName(I.attrName):"",ID:I.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};R.traverse(function(d){d.ID===I.id&&(C.transform=d.matrix,d.userData.transformData&&(C.eulerOrder=d.userData.transformData.eulerOrder))}),C.transform||(C.transform=new k.yGw),"PreRotation"in I&&(C.preRotation=I.PreRotation.value),"PostRotation"in I&&(C.postRotation=I.PostRotation.value),x[M]=C}}x[M]&&(x[M][C.attr]=C)}else if(void 0!==C.curves.morph){if(void 0===x[M]){let d=I.get(T.ID).parents.filter(function(d){return void 0!==d.relationship})[0].ID,R=I.get(d).parents[0].ID,C=I.get(R).parents[0].ID,D=I.get(C).parents[0].ID,F=E.Objects.Model[D],j={modelName:F.attrName?k.iUV.sanitizeNodeName(F.attrName):"",morphName:E.Objects.Deformer[d].attrName};x[M]=j}x[M][C.attr]=C}}}),T.set(parseInt(M),x)}}return T}parseAnimStacks(d){let x=E.Objects.AnimationStack,T={};for(let E in x){let R=I.get(parseInt(E)).children;R.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");let k=d.get(R[0].ID);T[E]={name:x[E].attrName,layer:k}}return T}addClip(d){let x=[],T=this;return d.layer.forEach(function(d){x=x.concat(T.generateTracks(d))}),new k.m7l(d.name,-1,x)}generateTracks(d){let x=[],T=new k.Pa4,E=new k._fP,I=new k.Pa4;if(d.transform&&d.transform.decompose(T,E,I),T=T.toArray(),E=new k.USm().setFromQuaternion(E,d.eulerOrder).toArray(),I=I.toArray(),void 0!==d.T&&Object.keys(d.T.curves).length>0){let E=this.generateVectorTrack(d.modelName,d.T.curves,T,"position");void 0!==E&&x.push(E)}if(void 0!==d.R&&Object.keys(d.R.curves).length>0){let T=this.generateRotationTrack(d.modelName,d.R.curves,E,d.preRotation,d.postRotation,d.eulerOrder);void 0!==T&&x.push(T)}if(void 0!==d.S&&Object.keys(d.S.curves).length>0){let T=this.generateVectorTrack(d.modelName,d.S.curves,I,"scale");void 0!==T&&x.push(T)}if(void 0!==d.DeformPercent){let T=this.generateMorphTrack(d);void 0!==T&&x.push(T)}return x}generateVectorTrack(d,x,T,E){let I=this.getTimesForAllAxes(x),R=this.getKeyframeTrackValues(I,x,T);return new k.yC1(d+"."+E,I,R)}generateRotationTrack(d,x,T,E,I,R){void 0!==x.x&&(this.interpolateRotations(x.x),x.x.values=x.x.values.map(k.M8C.degToRad)),void 0!==x.y&&(this.interpolateRotations(x.y),x.y.values=x.y.values.map(k.M8C.degToRad)),void 0!==x.z&&(this.interpolateRotations(x.z),x.z.values=x.z.values.map(k.M8C.degToRad));let M=this.getTimesForAllAxes(x),C=this.getKeyframeTrackValues(M,x,T);void 0!==E&&((E=E.map(k.M8C.degToRad)).push(R),E=new k.USm().fromArray(E),E=new k._fP().setFromEuler(E)),void 0!==I&&((I=I.map(k.M8C.degToRad)).push(R),I=new k.USm().fromArray(I),I=new k._fP().setFromEuler(I).invert());let D=new k._fP,F=new k.USm,j=[];for(let d=0;d<C.length;d+=3)F.set(C[d],C[d+1],C[d+2],R),D.setFromEuler(F),void 0!==E&&D.premultiply(E),void 0!==I&&D.multiply(I),D.toArray(j,d/3*4);return new k.iLg(d+".quaternion",M,j)}generateMorphTrack(d){let x=d.DeformPercent.curves.morph,T=x.values.map(function(d){return d/100}),E=R.getObjectByName(d.modelName).morphTargetDictionary[d.morphName];return new k.dUE(d.modelName+".morphTargetInfluences["+E+"]",x.times,T)}getTimesForAllAxes(d){let x=[];if(void 0!==d.x&&(x=x.concat(d.x.times)),void 0!==d.y&&(x=x.concat(d.y.times)),void 0!==d.z&&(x=x.concat(d.z.times)),(x=x.sort(function(d,x){return d-x})).length>1){let d=1,T=x[0];for(let E=1;E<x.length;E++){let I=x[E];I!==T&&(x[d]=I,T=I,d++)}x=x.slice(0,d)}return x}getKeyframeTrackValues(d,x,T){let E=[],I=-1,R=-1,k=-1;return d.forEach(function(d){if(x.x&&(I=x.x.times.indexOf(d)),x.y&&(R=x.y.times.indexOf(d)),x.z&&(k=x.z.times.indexOf(d)),-1!==I){let d=x.x.values[I];E.push(d),T[0]=d}else E.push(T[0]);if(-1!==R){let d=x.y.values[R];E.push(d),T[1]=d}else E.push(T[1]);if(-1!==k){let d=x.z.values[k];E.push(d),T[2]=d}else E.push(T[2])}),E}interpolateRotations(d){for(let x=1;x<d.values.length;x++){let T=d.values[x-1],E=d.values[x]-T,I=Math.abs(E);if(I>=180){let R=I/180,k=E/R,M=T+k,C=d.times[x-1],D=d.times[x]-C,F=D/R,j=C+F,K=[],V=[];for(;j<d.times[x];)K.push(j),j+=F,V.push(M),M+=k;d.times=inject(d.times,x,K),d.values=inject(d.values,x,V)}}}};let TextParser=class TextParser{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(d){this.nodeStack.push(d),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(d,x){this.currentProp=d,this.currentPropName=x}parse(d){this.currentIndent=0,this.allNodes=new FBXTree,this.nodeStack=[],this.currentProp=[],this.currentPropName="";let x=this,T=d.split(/[\r\n]+/);return T.forEach(function(d,E){let I=d.match(/^[\s\t]*;/),R=d.match(/^[\s\t]*$/);if(I||R)return;let k=d.match("^\\t{"+x.currentIndent+"}(\\w+):(.*){",""),M=d.match("^\\t{"+x.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),C=d.match("^\\t{"+(x.currentIndent-1)+"}}");k?x.parseNodeBegin(d,k):M?x.parseNodeProperty(d,M,T[++E]):C?x.popStack():d.match(/^[^\s\t}]/)&&x.parseNodePropertyContinued(d)}),this.allNodes}parseNodeBegin(d,x){let T=x[1].trim().replace(/^"/,"").replace(/"$/,""),E=x[2].split(",").map(function(d){return d.trim().replace(/^"/,"").replace(/"$/,"")}),I={name:T},R=this.parseNodeAttr(E),k=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(T,I):T in k?("PoseNode"===T?k.PoseNode.push(I):void 0!==k[T].id&&(k[T]={},k[T][k[T].id]=k[T]),""!==R.id&&(k[T][R.id]=I)):"number"==typeof R.id?(k[T]={},k[T][R.id]=I):"Properties70"!==T&&("PoseNode"===T?k[T]=[I]:k[T]=I),"number"==typeof R.id&&(I.id=R.id),""!==R.name&&(I.attrName=R.name),""!==R.type&&(I.attrType=R.type),this.pushStack(I)}parseNodeAttr(d){let x=d[0];""!==d[0]&&isNaN(x=parseInt(d[0]))&&(x=d[0]);let T="",E="";return d.length>1&&(T=d[1].replace(/^(\w+)::/,""),E=d[2]),{id:x,name:T,type:E}}parseNodeProperty(d,x,T){let E=x[1].replace(/^"/,"").replace(/"$/,"").trim(),I=x[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===E&&","===I&&(I=T.replace(/"/g,"").replace(/,$/,"").trim());let R=this.getCurrentNode(),k=R.name;if("Properties70"===k){this.parseNodeSpecialProperty(d,E,I);return}if("C"===E){let d=I.split(",").slice(1),x=parseInt(d[0]),T=parseInt(d[1]),k=I.split(",").slice(3);k=k.map(function(d){return d.trim().replace(/^"/,"")}),E="connections",function(d,x){for(let T=0,E=d.length,I=x.length;T<I;T++,E++)d[E]=x[T]}(I=[x,T],k),void 0===R[E]&&(R[E]=[])}"Node"===E&&(R.id=I),E in R&&Array.isArray(R[E])?R[E].push(I):"a"!==E?R[E]=I:R.a=I,this.setCurrentProp(R,E),"a"===E&&","!==I.slice(-1)&&(R.a=parseNumberArray(I))}parseNodePropertyContinued(d){let x=this.getCurrentNode();x.a+=d,","!==d.slice(-1)&&(x.a=parseNumberArray(x.a))}parseNodeSpecialProperty(d,x,T){let E=T.split('",').map(function(d){return d.trim().replace(/^\"/,"").replace(/\s/,"_")}),I=E[0],R=E[1],k=E[2],M=E[3],C=E[4];switch(R){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":C=parseFloat(C);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":C=parseNumberArray(C)}this.getPrevNode()[I]={type:R,type2:k,flag:M,value:C},this.setCurrentProp(this.getPrevNode(),I)}};let BinaryParser=class BinaryParser{parse(d){let x=new BinaryReader(d);x.skip(23);let T=x.getUint32();if(T<6400)throw Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+T);let E=new FBXTree;for(;!this.endOfContent(x);){let d=this.parseNode(x,T);null!==d&&E.add(d.name,d)}return E}endOfContent(d){return d.size()%16==0?(d.getOffset()+160+16&-16)>=d.size():d.getOffset()+160+16>=d.size()}parseNode(d,x){let T={},E=x>=7500?d.getUint64():d.getUint32(),I=x>=7500?d.getUint64():d.getUint32();x>=7500?d.getUint64():d.getUint32();let R=d.getUint8(),k=d.getString(R);if(0===E)return null;let M=[];for(let x=0;x<I;x++)M.push(this.parseProperty(d));let C=M.length>0?M[0]:"",D=M.length>1?M[1]:"",F=M.length>2?M[2]:"";for(T.singleProperty=1===I&&d.getOffset()===E;E>d.getOffset();){let E=this.parseNode(d,x);null!==E&&this.parseSubNode(k,T,E)}return T.propertyList=M,"number"==typeof C&&(T.id=C),""!==D&&(T.attrName=D),""!==F&&(T.attrType=F),""!==k&&(T.name=k),T}parseSubNode(d,x,T){if(!0===T.singleProperty){let d=T.propertyList[0];Array.isArray(d)?(x[T.name]=T,T.a=d):x[T.name]=d}else if("Connections"===d&&"C"===T.name){let d=[];T.propertyList.forEach(function(x,T){0!==T&&d.push(x)}),void 0===x.connections&&(x.connections=[]),x.connections.push(d)}else if("Properties70"===T.name){let d=Object.keys(T);d.forEach(function(d){x[d]=T[d]})}else if("Properties70"===d&&"P"===T.name){let d,E=T.propertyList[0],I=T.propertyList[1],R=T.propertyList[2],k=T.propertyList[3];0===E.indexOf("Lcl ")&&(E=E.replace("Lcl ","Lcl_")),0===I.indexOf("Lcl ")&&(I=I.replace("Lcl ","Lcl_")),d="Color"===I||"ColorRGB"===I||"Vector"===I||"Vector3D"===I||0===I.indexOf("Lcl_")?[T.propertyList[4],T.propertyList[5],T.propertyList[6]]:T.propertyList[4],x[E]={type:I,type2:R,flag:k,value:d}}else void 0===x[T.name]?"number"==typeof T.id?(x[T.name]={},x[T.name][T.id]=T):x[T.name]=T:"PoseNode"===T.name?(Array.isArray(x[T.name])||(x[T.name]=[x[T.name]]),x[T.name].push(T)):void 0===x[T.name][T.id]&&(x[T.name][T.id]=T)}parseProperty(d){let x;let T=d.getString(1);switch(T){case"C":return d.getBoolean();case"D":return d.getFloat64();case"F":return d.getFloat32();case"I":return d.getInt32();case"L":return d.getInt64();case"R":return x=d.getUint32(),d.getArrayBuffer(x);case"S":return x=d.getUint32(),d.getString(x);case"Y":return d.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var E;let I=d.getUint32(),R=d.getUint32(),k=d.getUint32();if(0===R)switch(T){case"b":case"c":return d.getBooleanArray(I);case"d":return d.getFloat64Array(I);case"f":return d.getFloat32Array(I);case"i":return d.getInt32Array(I);case"l":return d.getInt64Array(I)}let M=inflt((zlv(E=new Uint8Array(d.getArrayBuffer(k))),E.subarray(2,-4)),void 0),C=new BinaryReader(M.buffer);switch(T){case"b":case"c":return C.getBooleanArray(I);case"d":return C.getFloat64Array(I);case"f":return C.getFloat32Array(I);case"i":return C.getInt32Array(I);case"l":return C.getInt64Array(I)}break;default:throw Error("THREE.FBXLoader: Unknown property type "+T)}}};let BinaryReader=class BinaryReader{constructor(d,x){this.dv=new DataView(d),this.offset=0,this.littleEndian=void 0===x||x,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(d){this.offset+=d}getBoolean(){return(1&this.getUint8())==1}getBooleanArray(d){let x=[];for(let T=0;T<d;T++)x.push(this.getBoolean());return x}getUint8(){let d=this.dv.getUint8(this.offset);return this.offset+=1,d}getInt16(){let d=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,d}getInt32(){let d=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,d}getInt32Array(d){let x=[];for(let T=0;T<d;T++)x.push(this.getInt32());return x}getUint32(){let d=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,d}getInt64(){let d,x;return(this.littleEndian?(d=this.getUint32(),x=this.getUint32()):(x=this.getUint32(),d=this.getUint32()),2147483648&x)?(x=4294967295&~x,4294967295==(d=4294967295&~d)&&(x=x+1&4294967295),-(4294967296*x+(d=d+1&4294967295))):4294967296*x+d}getInt64Array(d){let x=[];for(let T=0;T<d;T++)x.push(this.getInt64());return x}getUint64(){let d,x;return this.littleEndian?(d=this.getUint32(),x=this.getUint32()):(x=this.getUint32(),d=this.getUint32()),4294967296*x+d}getFloat32(){let d=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,d}getFloat32Array(d){let x=[];for(let T=0;T<d;T++)x.push(this.getFloat32());return x}getFloat64(){let d=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,d}getFloat64Array(d){let x=[];for(let T=0;T<d;T++)x.push(this.getFloat64());return x}getArrayBuffer(d){let x=this.dv.buffer.slice(this.offset,this.offset+d);return this.offset+=d,x}getString(d){let x=this.offset,T=new Uint8Array(this.dv.buffer,x,d);this.skip(d);let E=T.indexOf(0);return E>=0&&(T=new Uint8Array(this.dv.buffer,x,E)),this._textDecoder.decode(T)}};let FBXTree=class FBXTree{add(d,x){this[d]=x}};function getFbxVersion(d){let x=d.match(/FBXVersion: (\d+)/);if(x){let d=parseInt(x[1]);return d}throw Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function convertFBXTimeToSeconds(d){return d/46186158e3}let ep=[];function getData(d,x,T,E){let I;switch(E.mappingType){case"ByPolygonVertex":I=d;break;case"ByPolygon":I=x;break;case"ByVertice":I=T;break;case"AllSame":I=E.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+E.mappingType)}"IndexToDirect"===E.referenceType&&(I=E.indices[I]);let R=I*E.dataSize,k=R+E.dataSize;return function(d,x,T,E){for(let I=T,R=0;I<E;I++,R++)d[R]=x[I];return d}(ep,E.buffer,R,k)}let em=new k.USm,ey=new k.Pa4;function generateTransform(d){let x=new k.yGw,T=new k.yGw,E=new k.yGw,I=new k.yGw,R=new k.yGw,M=new k.yGw,C=new k.yGw,D=new k.yGw,F=new k.yGw,j=new k.yGw,K=new k.yGw,V=new k.yGw,W=d.inheritType?d.inheritType:0;if(d.translation&&x.setPosition(ey.fromArray(d.translation)),d.preRotation){let x=d.preRotation.map(k.M8C.degToRad);x.push(d.eulerOrder||k.USm.DEFAULT_ORDER),T.makeRotationFromEuler(em.fromArray(x))}if(d.rotation){let x=d.rotation.map(k.M8C.degToRad);x.push(d.eulerOrder||k.USm.DEFAULT_ORDER),E.makeRotationFromEuler(em.fromArray(x))}if(d.postRotation){let x=d.postRotation.map(k.M8C.degToRad);x.push(d.eulerOrder||k.USm.DEFAULT_ORDER),I.makeRotationFromEuler(em.fromArray(x)),I.invert()}d.scale&&R.scale(ey.fromArray(d.scale)),d.scalingOffset&&C.setPosition(ey.fromArray(d.scalingOffset)),d.scalingPivot&&M.setPosition(ey.fromArray(d.scalingPivot)),d.rotationOffset&&D.setPosition(ey.fromArray(d.rotationOffset)),d.rotationPivot&&F.setPosition(ey.fromArray(d.rotationPivot)),d.parentMatrixWorld&&(K.copy(d.parentMatrix),j.copy(d.parentMatrixWorld));let Y=T.clone().multiply(E).multiply(I),$=new k.yGw;$.extractRotation(j);let Q=new k.yGw;Q.copyPosition(j);let et=Q.clone().invert().multiply(j),er=$.clone().invert().multiply(et),ei=new k.yGw;if(0===W)ei.copy($).multiply(Y).multiply(er).multiply(R);else if(1===W)ei.copy($).multiply(er).multiply(Y).multiply(R);else{let d=new k.yGw().scale(new k.Pa4().setFromMatrixScale(K)),x=d.clone().invert(),T=er.clone().multiply(x);ei.copy($).multiply(Y).multiply(T).multiply(R)}let eo=F.clone().invert(),ea=M.clone().invert(),es=x.clone().multiply(D).multiply(F).multiply(T).multiply(E).multiply(I).multiply(eo).multiply(C).multiply(M).multiply(R).multiply(ea),eu=new k.yGw().copyPosition(es),el=j.clone().multiply(eu);return V.copyPosition(el),(es=V.clone().multiply(ei)).premultiply(j.invert()),es}function getEulerOrder(d){return 6===(d=d||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),"ZYX"):["ZYX","YZX","XZY","ZXY","YXZ","XYZ"][d]}function parseNumberArray(d){let x=d.split(",").map(function(d){return parseFloat(d)});return x}function convertArrayBufferToString(d,x,T){return void 0===x&&(x=0),void 0===T&&(T=d.byteLength),new TextDecoder().decode(new Uint8Array(d,x,T))}function inject(d,x,T){return d.slice(0,x).concat(T).concat(d.slice(x))}},77836:function(d,x,T){"use strict";T.d(x,{E:function(){return GLTFLoader}});var E=T(99477);function toTrianglesDrawMode(d,x){if(x===E.WwZ)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),d;if(x!==E.z$h&&x!==E.UlW)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",x),d;{let T=d.getIndex();if(null===T){let x=[],E=d.getAttribute("position");if(void 0===E)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),d;for(let d=0;d<E.count;d++)x.push(d);d.setIndex(x),T=d.getIndex()}let I=T.count-2,R=[];if(x===E.z$h)for(let d=1;d<=I;d++)R.push(T.getX(0)),R.push(T.getX(d)),R.push(T.getX(d+1));else for(let d=0;d<I;d++)d%2==0?(R.push(T.getX(d)),R.push(T.getX(d+1)),R.push(T.getX(d+2))):(R.push(T.getX(d+2)),R.push(T.getX(d+1)),R.push(T.getX(d)));R.length/3!==I&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");let k=d.clone();return k.setIndex(R),k.clearGroups(),k}}let GLTFLoader=class GLTFLoader extends E.aNw{constructor(d){super(d),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(d){return new GLTFMaterialsClearcoatExtension(d)}),this.register(function(d){return new GLTFTextureBasisUExtension(d)}),this.register(function(d){return new GLTFTextureWebPExtension(d)}),this.register(function(d){return new GLTFTextureAVIFExtension(d)}),this.register(function(d){return new GLTFMaterialsSheenExtension(d)}),this.register(function(d){return new GLTFMaterialsTransmissionExtension(d)}),this.register(function(d){return new GLTFMaterialsVolumeExtension(d)}),this.register(function(d){return new GLTFMaterialsIorExtension(d)}),this.register(function(d){return new GLTFMaterialsEmissiveStrengthExtension(d)}),this.register(function(d){return new GLTFMaterialsSpecularExtension(d)}),this.register(function(d){return new GLTFMaterialsIridescenceExtension(d)}),this.register(function(d){return new GLTFMaterialsAnisotropyExtension(d)}),this.register(function(d){return new GLTFLightsExtension(d)}),this.register(function(d){return new GLTFMeshoptCompression(d)}),this.register(function(d){return new GLTFMeshGpuInstancing(d)})}load(d,x,T,I){let R;let k=this;R=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:E.Zp0.extractUrlBase(d),this.manager.itemStart(d);let _onError=function(x){I?I(x):console.error(x),k.manager.itemError(d),k.manager.itemEnd(d)},M=new E.hH6(this.manager);M.setPath(this.path),M.setResponseType("arraybuffer"),M.setRequestHeader(this.requestHeader),M.setWithCredentials(this.withCredentials),M.load(d,function(T){try{k.parse(T,R,function(T){x(T),k.manager.itemEnd(d)},_onError)}catch(d){_onError(d)}},T,_onError)}setDRACOLoader(d){return this.dracoLoader=d,this}setDDSLoader(){throw Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(d){return this.ktx2Loader=d,this}setMeshoptDecoder(d){return this.meshoptDecoder=d,this}register(d){return -1===this.pluginCallbacks.indexOf(d)&&this.pluginCallbacks.push(d),this}unregister(d){return -1!==this.pluginCallbacks.indexOf(d)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(d),1),this}parse(d,x,T,E){let k;let M={},C={},D=new TextDecoder;if("string"==typeof d)k=JSON.parse(d);else if(d instanceof ArrayBuffer){let x=D.decode(new Uint8Array(d,0,4));if(x===R){try{M[I.KHR_BINARY_GLTF]=new GLTFBinaryExtension(d)}catch(d){E&&E(d);return}k=JSON.parse(M[I.KHR_BINARY_GLTF].content)}else k=JSON.parse(D.decode(d))}else k=d;if(void 0===k.asset||k.asset.version[0]<2){E&&E(Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}let F=new GLTFParser(k,{path:x||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});F.fileLoader.setRequestHeader(this.requestHeader);for(let d=0;d<this.pluginCallbacks.length;d++){let x=this.pluginCallbacks[d](F);C[x.name]=x,M[x.name]=!0}if(k.extensionsUsed)for(let d=0;d<k.extensionsUsed.length;++d){let x=k.extensionsUsed[d],T=k.extensionsRequired||[];switch(x){case I.KHR_MATERIALS_UNLIT:M[x]=new GLTFMaterialsUnlitExtension;break;case I.KHR_DRACO_MESH_COMPRESSION:M[x]=new GLTFDracoMeshCompressionExtension(k,this.dracoLoader);break;case I.KHR_TEXTURE_TRANSFORM:M[x]=new GLTFTextureTransformExtension;break;case I.KHR_MESH_QUANTIZATION:M[x]=new GLTFMeshQuantizationExtension;break;default:T.indexOf(x)>=0&&void 0===C[x]&&console.warn('THREE.GLTFLoader: Unknown extension "'+x+'".')}}F.setExtensions(M),F.setPlugins(C),F.parse(T,E)}parseAsync(d,x){let T=this;return new Promise(function(E,I){T.parse(d,x,E,I)})}};function GLTFRegistry(){let d={};return{get:function(x){return d[x]},add:function(x,T){d[x]=T},remove:function(x){delete d[x]},removeAll:function(){d={}}}}let I={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};let GLTFLightsExtension=class GLTFLightsExtension{constructor(d){this.parser=d,this.name=I.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){let d=this.parser,x=this.parser.json.nodes||[];for(let T=0,E=x.length;T<E;T++){let E=x[T];E.extensions&&E.extensions[this.name]&&void 0!==E.extensions[this.name].light&&d._addNodeRef(this.cache,E.extensions[this.name].light)}}_loadLight(d){let x;let T=this.parser,I="light:"+d,R=T.cache.get(I);if(R)return R;let k=T.json,M=k.extensions&&k.extensions[this.name]||{},C=M.lights||[],D=C[d],F=new E.Ilk(16777215);void 0!==D.color&&F.fromArray(D.color);let j=void 0!==D.range?D.range:0;switch(D.type){case"directional":(x=new E.Ox3(F)).target.position.set(0,0,-1),x.add(x.target);break;case"point":(x=new E.cek(F)).distance=j;break;case"spot":(x=new E.PMe(F)).distance=j,D.spot=D.spot||{},D.spot.innerConeAngle=void 0!==D.spot.innerConeAngle?D.spot.innerConeAngle:0,D.spot.outerConeAngle=void 0!==D.spot.outerConeAngle?D.spot.outerConeAngle:Math.PI/4,x.angle=D.spot.outerConeAngle,x.penumbra=1-D.spot.innerConeAngle/D.spot.outerConeAngle,x.target.position.set(0,0,-1),x.add(x.target);break;default:throw Error("THREE.GLTFLoader: Unexpected light type: "+D.type)}return x.position.set(0,0,0),x.decay=2,assignExtrasToUserData(x,D),void 0!==D.intensity&&(x.intensity=D.intensity),x.name=T.createUniqueName(D.name||"light_"+d),R=Promise.resolve(x),T.cache.add(I,R),R}getDependency(d,x){if("light"===d)return this._loadLight(x)}createNodeAttachment(d){let x=this,T=this.parser,E=T.json,I=E.nodes[d],R=I.extensions&&I.extensions[this.name]||{},k=R.light;return void 0===k?null:this._loadLight(k).then(function(d){return T._getNodeRef(x.cache,k,d)})}};let GLTFMaterialsUnlitExtension=class GLTFMaterialsUnlitExtension{constructor(){this.name=I.KHR_MATERIALS_UNLIT}getMaterialType(){return E.vBJ}extendParams(d,x,T){let I=[];d.color=new E.Ilk(1,1,1),d.opacity=1;let R=x.pbrMetallicRoughness;if(R){if(Array.isArray(R.baseColorFactor)){let x=R.baseColorFactor;d.color.fromArray(x),d.opacity=x[3]}void 0!==R.baseColorTexture&&I.push(T.assignTexture(d,"map",R.baseColorTexture,E.KI_))}return Promise.all(I)}};let GLTFMaterialsEmissiveStrengthExtension=class GLTFMaterialsEmissiveStrengthExtension{constructor(d){this.parser=d,this.name=I.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(d,x){let T=this.parser,E=T.json.materials[d];if(!E.extensions||!E.extensions[this.name])return Promise.resolve();let I=E.extensions[this.name].emissiveStrength;return void 0!==I&&(x.emissiveIntensity=I),Promise.resolve()}};let GLTFMaterialsClearcoatExtension=class GLTFMaterialsClearcoatExtension{constructor(d){this.parser=d,this.name=I.KHR_MATERIALS_CLEARCOAT}getMaterialType(d){let x=this.parser,T=x.json.materials[d];return T.extensions&&T.extensions[this.name]?E.EJi:null}extendMaterialParams(d,x){let T=this.parser,I=T.json.materials[d];if(!I.extensions||!I.extensions[this.name])return Promise.resolve();let R=[],k=I.extensions[this.name];if(void 0!==k.clearcoatFactor&&(x.clearcoat=k.clearcoatFactor),void 0!==k.clearcoatTexture&&R.push(T.assignTexture(x,"clearcoatMap",k.clearcoatTexture)),void 0!==k.clearcoatRoughnessFactor&&(x.clearcoatRoughness=k.clearcoatRoughnessFactor),void 0!==k.clearcoatRoughnessTexture&&R.push(T.assignTexture(x,"clearcoatRoughnessMap",k.clearcoatRoughnessTexture)),void 0!==k.clearcoatNormalTexture&&(R.push(T.assignTexture(x,"clearcoatNormalMap",k.clearcoatNormalTexture)),void 0!==k.clearcoatNormalTexture.scale)){let d=k.clearcoatNormalTexture.scale;x.clearcoatNormalScale=new E.FM8(d,d)}return Promise.all(R)}};let GLTFMaterialsIridescenceExtension=class GLTFMaterialsIridescenceExtension{constructor(d){this.parser=d,this.name=I.KHR_MATERIALS_IRIDESCENCE}getMaterialType(d){let x=this.parser,T=x.json.materials[d];return T.extensions&&T.extensions[this.name]?E.EJi:null}extendMaterialParams(d,x){let T=this.parser,E=T.json.materials[d];if(!E.extensions||!E.extensions[this.name])return Promise.resolve();let I=[],R=E.extensions[this.name];return void 0!==R.iridescenceFactor&&(x.iridescence=R.iridescenceFactor),void 0!==R.iridescenceTexture&&I.push(T.assignTexture(x,"iridescenceMap",R.iridescenceTexture)),void 0!==R.iridescenceIor&&(x.iridescenceIOR=R.iridescenceIor),void 0===x.iridescenceThicknessRange&&(x.iridescenceThicknessRange=[100,400]),void 0!==R.iridescenceThicknessMinimum&&(x.iridescenceThicknessRange[0]=R.iridescenceThicknessMinimum),void 0!==R.iridescenceThicknessMaximum&&(x.iridescenceThicknessRange[1]=R.iridescenceThicknessMaximum),void 0!==R.iridescenceThicknessTexture&&I.push(T.assignTexture(x,"iridescenceThicknessMap",R.iridescenceThicknessTexture)),Promise.all(I)}};let GLTFMaterialsSheenExtension=class GLTFMaterialsSheenExtension{constructor(d){this.parser=d,this.name=I.KHR_MATERIALS_SHEEN}getMaterialType(d){let x=this.parser,T=x.json.materials[d];return T.extensions&&T.extensions[this.name]?E.EJi:null}extendMaterialParams(d,x){let T=this.parser,I=T.json.materials[d];if(!I.extensions||!I.extensions[this.name])return Promise.resolve();let R=[];x.sheenColor=new E.Ilk(0,0,0),x.sheenRoughness=0,x.sheen=1;let k=I.extensions[this.name];return void 0!==k.sheenColorFactor&&x.sheenColor.fromArray(k.sheenColorFactor),void 0!==k.sheenRoughnessFactor&&(x.sheenRoughness=k.sheenRoughnessFactor),void 0!==k.sheenColorTexture&&R.push(T.assignTexture(x,"sheenColorMap",k.sheenColorTexture,E.KI_)),void 0!==k.sheenRoughnessTexture&&R.push(T.assignTexture(x,"sheenRoughnessMap",k.sheenRoughnessTexture)),Promise.all(R)}};let GLTFMaterialsTransmissionExtension=class GLTFMaterialsTransmissionExtension{constructor(d){this.parser=d,this.name=I.KHR_MATERIALS_TRANSMISSION}getMaterialType(d){let x=this.parser,T=x.json.materials[d];return T.extensions&&T.extensions[this.name]?E.EJi:null}extendMaterialParams(d,x){let T=this.parser,E=T.json.materials[d];if(!E.extensions||!E.extensions[this.name])return Promise.resolve();let I=[],R=E.extensions[this.name];return void 0!==R.transmissionFactor&&(x.transmission=R.transmissionFactor),void 0!==R.transmissionTexture&&I.push(T.assignTexture(x,"transmissionMap",R.transmissionTexture)),Promise.all(I)}};let GLTFMaterialsVolumeExtension=class GLTFMaterialsVolumeExtension{constructor(d){this.parser=d,this.name=I.KHR_MATERIALS_VOLUME}getMaterialType(d){let x=this.parser,T=x.json.materials[d];return T.extensions&&T.extensions[this.name]?E.EJi:null}extendMaterialParams(d,x){let T=this.parser,I=T.json.materials[d];if(!I.extensions||!I.extensions[this.name])return Promise.resolve();let R=[],k=I.extensions[this.name];x.thickness=void 0!==k.thicknessFactor?k.thicknessFactor:0,void 0!==k.thicknessTexture&&R.push(T.assignTexture(x,"thicknessMap",k.thicknessTexture)),x.attenuationDistance=k.attenuationDistance||1/0;let M=k.attenuationColor||[1,1,1];return x.attenuationColor=new E.Ilk(M[0],M[1],M[2]),Promise.all(R)}};let GLTFMaterialsIorExtension=class GLTFMaterialsIorExtension{constructor(d){this.parser=d,this.name=I.KHR_MATERIALS_IOR}getMaterialType(d){let x=this.parser,T=x.json.materials[d];return T.extensions&&T.extensions[this.name]?E.EJi:null}extendMaterialParams(d,x){let T=this.parser,E=T.json.materials[d];if(!E.extensions||!E.extensions[this.name])return Promise.resolve();let I=E.extensions[this.name];return x.ior=void 0!==I.ior?I.ior:1.5,Promise.resolve()}};let GLTFMaterialsSpecularExtension=class GLTFMaterialsSpecularExtension{constructor(d){this.parser=d,this.name=I.KHR_MATERIALS_SPECULAR}getMaterialType(d){let x=this.parser,T=x.json.materials[d];return T.extensions&&T.extensions[this.name]?E.EJi:null}extendMaterialParams(d,x){let T=this.parser,I=T.json.materials[d];if(!I.extensions||!I.extensions[this.name])return Promise.resolve();let R=[],k=I.extensions[this.name];x.specularIntensity=void 0!==k.specularFactor?k.specularFactor:1,void 0!==k.specularTexture&&R.push(T.assignTexture(x,"specularIntensityMap",k.specularTexture));let M=k.specularColorFactor||[1,1,1];return x.specularColor=new E.Ilk(M[0],M[1],M[2]),void 0!==k.specularColorTexture&&R.push(T.assignTexture(x,"specularColorMap",k.specularColorTexture,E.KI_)),Promise.all(R)}};let GLTFMaterialsAnisotropyExtension=class GLTFMaterialsAnisotropyExtension{constructor(d){this.parser=d,this.name=I.KHR_MATERIALS_ANISOTROPY}getMaterialType(d){let x=this.parser,T=x.json.materials[d];return T.extensions&&T.extensions[this.name]?E.EJi:null}extendMaterialParams(d,x){let T=this.parser,E=T.json.materials[d];if(!E.extensions||!E.extensions[this.name])return Promise.resolve();let I=[],R=E.extensions[this.name];return void 0!==R.anisotropyStrength&&(x.anisotropy=R.anisotropyStrength),void 0!==R.anisotropyRotation&&(x.anisotropyRotation=R.anisotropyRotation),void 0!==R.anisotropyTexture&&I.push(T.assignTexture(x,"anisotropyMap",R.anisotropyTexture)),Promise.all(I)}};let GLTFTextureBasisUExtension=class GLTFTextureBasisUExtension{constructor(d){this.parser=d,this.name=I.KHR_TEXTURE_BASISU}loadTexture(d){let x=this.parser,T=x.json,E=T.textures[d];if(!E.extensions||!E.extensions[this.name])return null;let I=E.extensions[this.name],R=x.options.ktx2Loader;if(!R){if(!(T.extensionsRequired&&T.extensionsRequired.indexOf(this.name)>=0))return null;throw Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures")}return x.loadTextureImage(d,I.source,R)}};let GLTFTextureWebPExtension=class GLTFTextureWebPExtension{constructor(d){this.parser=d,this.name=I.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(d){let x=this.name,T=this.parser,E=T.json,I=E.textures[d];if(!I.extensions||!I.extensions[x])return null;let R=I.extensions[x],k=E.images[R.source],M=T.textureLoader;if(k.uri){let d=T.options.manager.getHandler(k.uri);null!==d&&(M=d)}return this.detectSupport().then(function(I){if(I)return T.loadTextureImage(d,R.source,M);if(E.extensionsRequired&&E.extensionsRequired.indexOf(x)>=0)throw Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return T.loadTexture(d)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(d){let x=new Image;x.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",x.onload=x.onerror=function(){d(1===x.height)}})),this.isSupported}};let GLTFTextureAVIFExtension=class GLTFTextureAVIFExtension{constructor(d){this.parser=d,this.name=I.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(d){let x=this.name,T=this.parser,E=T.json,I=E.textures[d];if(!I.extensions||!I.extensions[x])return null;let R=I.extensions[x],k=E.images[R.source],M=T.textureLoader;if(k.uri){let d=T.options.manager.getHandler(k.uri);null!==d&&(M=d)}return this.detectSupport().then(function(I){if(I)return T.loadTextureImage(d,R.source,M);if(E.extensionsRequired&&E.extensionsRequired.indexOf(x)>=0)throw Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return T.loadTexture(d)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(d){let x=new Image;x.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",x.onload=x.onerror=function(){d(1===x.height)}})),this.isSupported}};let GLTFMeshoptCompression=class GLTFMeshoptCompression{constructor(d){this.name=I.EXT_MESHOPT_COMPRESSION,this.parser=d}loadBufferView(d){let x=this.parser.json,T=x.bufferViews[d];if(!T.extensions||!T.extensions[this.name])return null;{let d=T.extensions[this.name],E=this.parser.getDependency("buffer",d.buffer),I=this.parser.options.meshoptDecoder;if(!I||!I.supported){if(!(x.extensionsRequired&&x.extensionsRequired.indexOf(this.name)>=0))return null;throw Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files")}return E.then(function(x){let T=d.byteOffset||0,E=d.byteLength||0,R=d.count,k=d.byteStride,M=new Uint8Array(x,T,E);return I.decodeGltfBufferAsync?I.decodeGltfBufferAsync(R,k,M,d.mode,d.filter).then(function(d){return d.buffer}):I.ready.then(function(){let x=new ArrayBuffer(R*k);return I.decodeGltfBuffer(new Uint8Array(x),R,k,M,d.mode,d.filter),x})})}}};let GLTFMeshGpuInstancing=class GLTFMeshGpuInstancing{constructor(d){this.name=I.EXT_MESH_GPU_INSTANCING,this.parser=d}createNodeMesh(d){let x=this.parser.json,T=x.nodes[d];if(!T.extensions||!T.extensions[this.name]||void 0===T.mesh)return null;let I=x.meshes[T.mesh];for(let d of I.primitives)if(d.mode!==C.TRIANGLES&&d.mode!==C.TRIANGLE_STRIP&&d.mode!==C.TRIANGLE_FAN&&void 0!==d.mode)return null;let R=T.extensions[this.name],k=R.attributes,M=[],D={};for(let d in k)M.push(this.parser.getDependency("accessor",k[d]).then(x=>(D[d]=x,D[d])));return M.length<1?null:(M.push(this.parser.createNodeMesh(d)),Promise.all(M).then(d=>{let x=d.pop(),T=x.isGroup?x.children:[x],I=d[0].count,R=[];for(let d of T){let x=new E.yGw,T=new E.Pa4,k=new E._fP,M=new E.Pa4(1,1,1),C=new E.SPe(d.geometry,d.material,I);for(let d=0;d<I;d++)D.TRANSLATION&&T.fromBufferAttribute(D.TRANSLATION,d),D.ROTATION&&k.fromBufferAttribute(D.ROTATION,d),D.SCALE&&M.fromBufferAttribute(D.SCALE,d),C.setMatrixAt(d,x.compose(T,k,M));for(let x in D)"TRANSLATION"!==x&&"ROTATION"!==x&&"SCALE"!==x&&d.geometry.setAttribute(x,D[x]);E.Tme.prototype.copy.call(C,d),this.parser.assignFinalMaterial(C),R.push(C)}return x.isGroup?(x.clear(),x.add(...R),x):R[0]}))}};let R="glTF",k={JSON:1313821514,BIN:5130562};let GLTFBinaryExtension=class GLTFBinaryExtension{constructor(d){this.name=I.KHR_BINARY_GLTF,this.content=null,this.body=null;let x=new DataView(d,0,12),T=new TextDecoder;if(this.header={magic:T.decode(new Uint8Array(d.slice(0,4))),version:x.getUint32(4,!0),length:x.getUint32(8,!0)},this.header.magic!==R)throw Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw Error("THREE.GLTFLoader: Legacy binary file detected.");let E=this.header.length-12,M=new DataView(d,12),C=0;for(;C<E;){let x=M.getUint32(C,!0);C+=4;let E=M.getUint32(C,!0);if(C+=4,E===k.JSON){let E=new Uint8Array(d,12+C,x);this.content=T.decode(E)}else if(E===k.BIN){let T=12+C;this.body=d.slice(T,T+x)}C+=x}if(null===this.content)throw Error("THREE.GLTFLoader: JSON content not found.")}};let GLTFDracoMeshCompressionExtension=class GLTFDracoMeshCompressionExtension{constructor(d,x){if(!x)throw Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=I.KHR_DRACO_MESH_COMPRESSION,this.json=d,this.dracoLoader=x,this.dracoLoader.preload()}decodePrimitive(d,x){let T=this.json,E=this.dracoLoader,I=d.extensions[this.name].bufferView,R=d.extensions[this.name].attributes,k={},M={},C={};for(let d in R){let x=V[d]||d.toLowerCase();k[x]=R[d]}for(let x in d.attributes){let E=V[x]||x.toLowerCase();if(void 0!==R[x]){let I=T.accessors[d.attributes[x]],R=D[I.componentType];C[E]=R.name,M[E]=!0===I.normalized}}return x.getDependency("bufferView",I).then(function(d){return new Promise(function(x){E.decodeDracoFile(d,function(d){for(let x in d.attributes){let T=d.attributes[x],E=M[x];void 0!==E&&(T.normalized=E)}x(d)},k,C)})})}};let GLTFTextureTransformExtension=class GLTFTextureTransformExtension{constructor(){this.name=I.KHR_TEXTURE_TRANSFORM}extendTexture(d,x){return(void 0===x.texCoord||x.texCoord===d.channel)&&void 0===x.offset&&void 0===x.rotation&&void 0===x.scale||(d=d.clone(),void 0!==x.texCoord&&(d.channel=x.texCoord),void 0!==x.offset&&d.offset.fromArray(x.offset),void 0!==x.rotation&&(d.rotation=x.rotation),void 0!==x.scale&&d.repeat.fromArray(x.scale),d.needsUpdate=!0),d}};let GLTFMeshQuantizationExtension=class GLTFMeshQuantizationExtension{constructor(){this.name=I.KHR_MESH_QUANTIZATION}};let GLTFCubicSplineInterpolant=class GLTFCubicSplineInterpolant extends E._C8{constructor(d,x,T,E){super(d,x,T,E)}copySampleValue_(d){let x=this.resultBuffer,T=this.sampleValues,E=this.valueSize,I=d*E*3+E;for(let d=0;d!==E;d++)x[d]=T[I+d];return x}interpolate_(d,x,T,E){let I=this.resultBuffer,R=this.sampleValues,k=this.valueSize,M=2*k,C=3*k,D=E-x,F=(T-x)/D,j=F*F,K=j*F,V=d*C,W=V-C,Y=-2*K+3*j,$=K-j,Q=1-Y,et=$-j+F;for(let d=0;d!==k;d++){let x=R[W+d+k],T=R[W+d+M]*D,E=R[V+d+k],C=R[V+d]*D;I[d]=Q*x+et*T+Y*E+$*C}return I}};let M=new E._fP;let GLTFCubicSplineQuaternionInterpolant=class GLTFCubicSplineQuaternionInterpolant extends GLTFCubicSplineInterpolant{interpolate_(d,x,T,E){let I=super.interpolate_(d,x,T,E);return M.fromArray(I).normalize().toArray(I),I}};let C={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},D={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},F={9728:E.TyD,9729:E.wem,9984:E.YLQ,9985:E.qyh,9986:E.aH4,9987:E.D1R},j={33071:E.uWy,33648:E.OoA,10497:E.rpg},K={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},V={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},W={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Y={CUBICSPLINE:void 0,LINEAR:E.NMF,STEP:E.Syv},$={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function addUnknownExtensionsToUserData(d,x,T){for(let E in T.extensions)void 0===d[E]&&(x.userData.gltfExtensions=x.userData.gltfExtensions||{},x.userData.gltfExtensions[E]=T.extensions[E])}function assignExtrasToUserData(d,x){void 0!==x.extras&&("object"==typeof x.extras?Object.assign(d.userData,x.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+x.extras))}function createAttributesKey(d){let x="",T=Object.keys(d).sort();for(let E=0,I=T.length;E<I;E++)x+=T[E]+":"+d[T[E]]+";";return x}function getNormalizedComponentScale(d){switch(d){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}let Q=new E.yGw;let GLTFParser=class GLTFParser{constructor(d={},x={}){this.json=d,this.extensions={},this.plugins={},this.options=x,this.cache=new GLTFRegistry,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let T=!1,I=!1,R=-1;"undefined"!=typeof navigator&&(T=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),R=(I=navigator.userAgent.indexOf("Firefox")>-1)?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),"undefined"==typeof createImageBitmap||T||I&&R<98?this.textureLoader=new E.dpR(this.options.manager):this.textureLoader=new E.QRU(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new E.hH6(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(d){this.extensions=d}setPlugins(d){this.plugins=d}parse(d,x){let T=this,E=this.json,I=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(d){return d._markDefs&&d._markDefs()}),Promise.all(this._invokeAll(function(d){return d.beforeRoot&&d.beforeRoot()})).then(function(){return Promise.all([T.getDependencies("scene"),T.getDependencies("animation"),T.getDependencies("camera")])}).then(function(x){let R={scene:x[0][E.scene||0],scenes:x[0],animations:x[1],cameras:x[2],asset:E.asset,parser:T,userData:{}};addUnknownExtensionsToUserData(I,R,E),assignExtrasToUserData(R,E),Promise.all(T._invokeAll(function(d){return d.afterRoot&&d.afterRoot(R)})).then(function(){d(R)})}).catch(x)}_markDefs(){let d=this.json.nodes||[],x=this.json.skins||[],T=this.json.meshes||[];for(let T=0,E=x.length;T<E;T++){let E=x[T].joints;for(let x=0,T=E.length;x<T;x++)d[E[x]].isBone=!0}for(let x=0,E=d.length;x<E;x++){let E=d[x];void 0!==E.mesh&&(this._addNodeRef(this.meshCache,E.mesh),void 0!==E.skin&&(T[E.mesh].isSkinnedMesh=!0)),void 0!==E.camera&&this._addNodeRef(this.cameraCache,E.camera)}}_addNodeRef(d,x){void 0!==x&&(void 0===d.refs[x]&&(d.refs[x]=d.uses[x]=0),d.refs[x]++)}_getNodeRef(d,x,T){if(d.refs[x]<=1)return T;let E=T.clone(),updateMappings=(d,x)=>{let T=this.associations.get(d);for(let[E,I]of(null!=T&&this.associations.set(x,T),d.children.entries()))updateMappings(I,x.children[E])};return updateMappings(T,E),E.name+="_instance_"+d.uses[x]++,E}_invokeOne(d){let x=Object.values(this.plugins);x.push(this);for(let T=0;T<x.length;T++){let E=d(x[T]);if(E)return E}return null}_invokeAll(d){let x=Object.values(this.plugins);x.unshift(this);let T=[];for(let E=0;E<x.length;E++){let I=d(x[E]);I&&T.push(I)}return T}getDependency(d,x){let T=d+":"+x,E=this.cache.get(T);if(!E){switch(d){case"scene":E=this.loadScene(x);break;case"node":E=this._invokeOne(function(d){return d.loadNode&&d.loadNode(x)});break;case"mesh":E=this._invokeOne(function(d){return d.loadMesh&&d.loadMesh(x)});break;case"accessor":E=this.loadAccessor(x);break;case"bufferView":E=this._invokeOne(function(d){return d.loadBufferView&&d.loadBufferView(x)});break;case"buffer":E=this.loadBuffer(x);break;case"material":E=this._invokeOne(function(d){return d.loadMaterial&&d.loadMaterial(x)});break;case"texture":E=this._invokeOne(function(d){return d.loadTexture&&d.loadTexture(x)});break;case"skin":E=this.loadSkin(x);break;case"animation":E=this._invokeOne(function(d){return d.loadAnimation&&d.loadAnimation(x)});break;case"camera":E=this.loadCamera(x);break;default:if(!(E=this._invokeOne(function(T){return T!=this&&T.getDependency&&T.getDependency(d,x)})))throw Error("Unknown type: "+d)}this.cache.add(T,E)}return E}getDependencies(d){let x=this.cache.get(d);if(!x){let T=this,E=this.json[d+("mesh"===d?"es":"s")]||[];x=Promise.all(E.map(function(x,E){return T.getDependency(d,E)})),this.cache.add(d,x)}return x}loadBuffer(d){let x=this.json.buffers[d],T=this.fileLoader;if(x.type&&"arraybuffer"!==x.type)throw Error("THREE.GLTFLoader: "+x.type+" buffer type is not supported.");if(void 0===x.uri&&0===d)return Promise.resolve(this.extensions[I.KHR_BINARY_GLTF].body);let R=this.options;return new Promise(function(d,I){T.load(E.Zp0.resolveURL(x.uri,R.path),d,void 0,function(){I(Error('THREE.GLTFLoader: Failed to load buffer "'+x.uri+'".'))})})}loadBufferView(d){let x=this.json.bufferViews[d];return this.getDependency("buffer",x.buffer).then(function(d){let T=x.byteLength||0,E=x.byteOffset||0;return d.slice(E,E+T)})}loadAccessor(d){let x=this,T=this.json,I=this.json.accessors[d];if(void 0===I.bufferView&&void 0===I.sparse){let d=K[I.type],x=D[I.componentType],T=!0===I.normalized,R=new x(I.count*d);return Promise.resolve(new E.TlE(R,d,T))}let R=[];return void 0!==I.bufferView?R.push(this.getDependency("bufferView",I.bufferView)):R.push(null),void 0!==I.sparse&&(R.push(this.getDependency("bufferView",I.sparse.indices.bufferView)),R.push(this.getDependency("bufferView",I.sparse.values.bufferView))),Promise.all(R).then(function(d){let R,k;let M=d[0],C=K[I.type],F=D[I.componentType],j=F.BYTES_PER_ELEMENT,V=j*C,W=I.byteOffset||0,Y=void 0!==I.bufferView?T.bufferViews[I.bufferView].byteStride:void 0,$=!0===I.normalized;if(Y&&Y!==V){let d=Math.floor(W/Y),T="InterleavedBuffer:"+I.bufferView+":"+I.componentType+":"+d+":"+I.count,D=x.cache.get(T);D||(R=new F(M,d*Y,I.count*Y/j),D=new E.vpT(R,Y/j),x.cache.add(T,D)),k=new E.kB5(D,C,W%Y/j,$)}else R=null===M?new F(I.count*C):new F(M,W,I.count*C),k=new E.TlE(R,C,$);if(void 0!==I.sparse){let x=K.SCALAR,T=D[I.sparse.indices.componentType],R=I.sparse.indices.byteOffset||0,j=I.sparse.values.byteOffset||0,V=new T(d[1],R,I.sparse.count*x),W=new F(d[2],j,I.sparse.count*C);null!==M&&(k=new E.TlE(k.array.slice(),k.itemSize,k.normalized));for(let d=0,x=V.length;d<x;d++){let x=V[d];if(k.setX(x,W[d*C]),C>=2&&k.setY(x,W[d*C+1]),C>=3&&k.setZ(x,W[d*C+2]),C>=4&&k.setW(x,W[d*C+3]),C>=5)throw Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return k})}loadTexture(d){let x=this.json,T=this.options,E=x.textures[d],I=E.source,R=x.images[I],k=this.textureLoader;if(R.uri){let d=T.manager.getHandler(R.uri);null!==d&&(k=d)}return this.loadTextureImage(d,I,k)}loadTextureImage(d,x,T){let I=this,R=this.json,k=R.textures[d],M=R.images[x],C=(M.uri||M.bufferView)+":"+k.sampler;if(this.textureCache[C])return this.textureCache[C];let D=this.loadImageSource(x,T).then(function(x){x.flipY=!1,x.name=k.name||M.name||"",""===x.name&&"string"==typeof M.uri&&!1===M.uri.startsWith("data:image/")&&(x.name=M.uri);let T=R.samplers||{},C=T[k.sampler]||{};return x.magFilter=F[C.magFilter]||E.wem,x.minFilter=F[C.minFilter]||E.D1R,x.wrapS=j[C.wrapS]||E.rpg,x.wrapT=j[C.wrapT]||E.rpg,I.associations.set(x,{textures:d}),x}).catch(function(){return null});return this.textureCache[C]=D,D}loadImageSource(d,x){let T=this.json,I=this.options;if(void 0!==this.sourceCache[d])return this.sourceCache[d].then(d=>d.clone());let R=T.images[d],k=self.URL||self.webkitURL,M=R.uri||"",C=!1;if(void 0!==R.bufferView)M=this.getDependency("bufferView",R.bufferView).then(function(d){C=!0;let x=new Blob([d],{type:R.mimeType});return M=k.createObjectURL(x)});else if(void 0===R.uri)throw Error("THREE.GLTFLoader: Image "+d+" is missing URI and bufferView");let D=Promise.resolve(M).then(function(d){return new Promise(function(T,R){let k=T;!0===x.isImageBitmapLoader&&(k=function(d){let x=new E.xEZ(d);x.needsUpdate=!0,T(x)}),x.load(E.Zp0.resolveURL(d,I.path),k,void 0,R)})}).then(function(d){var x;return!0===C&&k.revokeObjectURL(M),d.userData.mimeType=R.mimeType||((x=R.uri).search(/\.jpe?g($|\?)/i)>0||0===x.search(/^data\:image\/jpeg/)?"image/jpeg":x.search(/\.webp($|\?)/i)>0||0===x.search(/^data\:image\/webp/)?"image/webp":"image/png"),d}).catch(function(d){throw console.error("THREE.GLTFLoader: Couldn't load texture",M),d});return this.sourceCache[d]=D,D}assignTexture(d,x,T,E){let R=this;return this.getDependency("texture",T.index).then(function(k){if(!k)return null;if(void 0!==T.texCoord&&T.texCoord>0&&((k=k.clone()).channel=T.texCoord),R.extensions[I.KHR_TEXTURE_TRANSFORM]){let d=void 0!==T.extensions?T.extensions[I.KHR_TEXTURE_TRANSFORM]:void 0;if(d){let x=R.associations.get(k);k=R.extensions[I.KHR_TEXTURE_TRANSFORM].extendTexture(k,d),R.associations.set(k,x)}}return void 0!==E&&(k.colorSpace=E),d[x]=k,k})}assignFinalMaterial(d){let x=d.geometry,T=d.material,I=void 0===x.attributes.tangent,R=void 0!==x.attributes.color,k=void 0===x.attributes.normal;if(d.isPoints){let d="PointsMaterial:"+T.uuid,x=this.cache.get(d);x||(x=new E.UY4,E.F5T.prototype.copy.call(x,T),x.color.copy(T.color),x.map=T.map,x.sizeAttenuation=!1,this.cache.add(d,x)),T=x}else if(d.isLine){let d="LineBasicMaterial:"+T.uuid,x=this.cache.get(d);x||(x=new E.nls,E.F5T.prototype.copy.call(x,T),x.color.copy(T.color),x.map=T.map,this.cache.add(d,x)),T=x}if(I||R||k){let d="ClonedMaterial:"+T.uuid+":";I&&(d+="derivative-tangents:"),R&&(d+="vertex-colors:"),k&&(d+="flat-shading:");let x=this.cache.get(d);x||(x=T.clone(),R&&(x.vertexColors=!0),k&&(x.flatShading=!0),I&&(x.normalScale&&(x.normalScale.y*=-1),x.clearcoatNormalScale&&(x.clearcoatNormalScale.y*=-1)),this.cache.add(d,x),this.associations.set(x,this.associations.get(T))),T=x}d.material=T}getMaterialType(){return E.Wid}loadMaterial(d){let x;let T=this,R=this.json,k=this.extensions,M=R.materials[d],C={},D=M.extensions||{},F=[];if(D[I.KHR_MATERIALS_UNLIT]){let d=k[I.KHR_MATERIALS_UNLIT];x=d.getMaterialType(),F.push(d.extendParams(C,M,T))}else{let I=M.pbrMetallicRoughness||{};if(C.color=new E.Ilk(1,1,1),C.opacity=1,Array.isArray(I.baseColorFactor)){let d=I.baseColorFactor;C.color.fromArray(d),C.opacity=d[3]}void 0!==I.baseColorTexture&&F.push(T.assignTexture(C,"map",I.baseColorTexture,E.KI_)),C.metalness=void 0!==I.metallicFactor?I.metallicFactor:1,C.roughness=void 0!==I.roughnessFactor?I.roughnessFactor:1,void 0!==I.metallicRoughnessTexture&&(F.push(T.assignTexture(C,"metalnessMap",I.metallicRoughnessTexture)),F.push(T.assignTexture(C,"roughnessMap",I.metallicRoughnessTexture))),x=this._invokeOne(function(x){return x.getMaterialType&&x.getMaterialType(d)}),F.push(Promise.all(this._invokeAll(function(x){return x.extendMaterialParams&&x.extendMaterialParams(d,C)})))}!0===M.doubleSided&&(C.side=E.ehD);let j=M.alphaMode||$.OPAQUE;if(j===$.BLEND?(C.transparent=!0,C.depthWrite=!1):(C.transparent=!1,j===$.MASK&&(C.alphaTest=void 0!==M.alphaCutoff?M.alphaCutoff:.5)),void 0!==M.normalTexture&&x!==E.vBJ&&(F.push(T.assignTexture(C,"normalMap",M.normalTexture)),C.normalScale=new E.FM8(1,1),void 0!==M.normalTexture.scale)){let d=M.normalTexture.scale;C.normalScale.set(d,d)}return void 0!==M.occlusionTexture&&x!==E.vBJ&&(F.push(T.assignTexture(C,"aoMap",M.occlusionTexture)),void 0!==M.occlusionTexture.strength&&(C.aoMapIntensity=M.occlusionTexture.strength)),void 0!==M.emissiveFactor&&x!==E.vBJ&&(C.emissive=new E.Ilk().fromArray(M.emissiveFactor)),void 0!==M.emissiveTexture&&x!==E.vBJ&&F.push(T.assignTexture(C,"emissiveMap",M.emissiveTexture,E.KI_)),Promise.all(F).then(function(){let E=new x(C);return M.name&&(E.name=M.name),assignExtrasToUserData(E,M),T.associations.set(E,{materials:d}),M.extensions&&addUnknownExtensionsToUserData(k,E,M),E})}createUniqueName(d){let x=E.iUV.sanitizeNodeName(d||"");return x in this.nodeNamesUsed?x+"_"+ ++this.nodeNamesUsed[x]:(this.nodeNamesUsed[x]=0,x)}loadGeometries(d){let x=this,T=this.extensions,R=this.primitiveCache,k=[];for(let M=0,C=d.length;M<C;M++){let C=d[M],D=function(d){let x;let T=d.extensions&&d.extensions[I.KHR_DRACO_MESH_COMPRESSION];if(x=T?"draco:"+T.bufferView+":"+T.indices+":"+createAttributesKey(T.attributes):d.indices+":"+createAttributesKey(d.attributes)+":"+d.mode,void 0!==d.targets)for(let T=0,E=d.targets.length;T<E;T++)x+=":"+createAttributesKey(d.targets[T]);return x}(C),F=R[D];if(F)k.push(F.promise);else{let d;d=C.extensions&&C.extensions[I.KHR_DRACO_MESH_COMPRESSION]?function(d){return T[I.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(d,x).then(function(T){return addPrimitiveAttributes(T,d,x)})}(C):addPrimitiveAttributes(new E.u9r,C,x),R[D]={primitive:C,promise:d},k.push(d)}}return Promise.all(k)}loadMesh(d){let x=this,T=this.json,I=this.extensions,R=T.meshes[d],k=R.primitives,M=[];for(let d=0,x=k.length;d<x;d++){var D;let x=void 0===k[d].material?(void 0===(D=this.cache).DefaultMaterial&&(D.DefaultMaterial=new E.Wid({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:E.Wl3})),D.DefaultMaterial):this.getDependency("material",k[d].material);M.push(x)}return M.push(x.loadGeometries(k)),Promise.all(M).then(function(T){let M=T.slice(0,T.length-1),D=T[T.length-1],F=[];for(let T=0,j=D.length;T<j;T++){let j;let K=D[T],V=k[T],W=M[T];if(V.mode===C.TRIANGLES||V.mode===C.TRIANGLE_STRIP||V.mode===C.TRIANGLE_FAN||void 0===V.mode)!0===(j=!0===R.isSkinnedMesh?new E.TUv(K,W):new E.Kj0(K,W)).isSkinnedMesh&&j.normalizeSkinWeights(),V.mode===C.TRIANGLE_STRIP?j.geometry=toTrianglesDrawMode(j.geometry,E.UlW):V.mode===C.TRIANGLE_FAN&&(j.geometry=toTrianglesDrawMode(j.geometry,E.z$h));else if(V.mode===C.LINES)j=new E.ejS(K,W);else if(V.mode===C.LINE_STRIP)j=new E.x12(K,W);else if(V.mode===C.LINE_LOOP)j=new E.blk(K,W);else if(V.mode===C.POINTS)j=new E.woe(K,W);else throw Error("THREE.GLTFLoader: Primitive mode unsupported: "+V.mode);Object.keys(j.geometry.morphAttributes).length>0&&function(d,x){if(d.updateMorphTargets(),void 0!==x.weights)for(let T=0,E=x.weights.length;T<E;T++)d.morphTargetInfluences[T]=x.weights[T];if(x.extras&&Array.isArray(x.extras.targetNames)){let T=x.extras.targetNames;if(d.morphTargetInfluences.length===T.length){d.morphTargetDictionary={};for(let x=0,E=T.length;x<E;x++)d.morphTargetDictionary[T[x]]=x}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}(j,R),j.name=x.createUniqueName(R.name||"mesh_"+d),assignExtrasToUserData(j,R),V.extensions&&addUnknownExtensionsToUserData(I,j,V),x.assignFinalMaterial(j),F.push(j)}for(let T=0,E=F.length;T<E;T++)x.associations.set(F[T],{meshes:d,primitives:T});if(1===F.length)return R.extensions&&addUnknownExtensionsToUserData(I,F[0],R),F[0];let j=new E.ZAu;R.extensions&&addUnknownExtensionsToUserData(I,j,R),x.associations.set(j,{meshes:d});for(let d=0,x=F.length;d<x;d++)j.add(F[d]);return j})}loadCamera(d){let x;let T=this.json.cameras[d],I=T[T.type];if(!I){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return"perspective"===T.type?x=new E.cPb(E.M8C.radToDeg(I.yfov),I.aspectRatio||1,I.znear||1,I.zfar||2e6):"orthographic"===T.type&&(x=new E.iKG(-I.xmag,I.xmag,I.ymag,-I.ymag,I.znear,I.zfar)),T.name&&(x.name=this.createUniqueName(T.name)),assignExtrasToUserData(x,T),Promise.resolve(x)}loadSkin(d){let x=this.json.skins[d],T=[];for(let d=0,E=x.joints.length;d<E;d++)T.push(this._loadNodeShallow(x.joints[d]));return void 0!==x.inverseBindMatrices?T.push(this.getDependency("accessor",x.inverseBindMatrices)):T.push(null),Promise.all(T).then(function(d){let T=d.pop(),I=[],R=[];for(let k=0,M=d.length;k<M;k++){let M=d[k];if(M){I.push(M);let d=new E.yGw;null!==T&&d.fromArray(T.array,16*k),R.push(d)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',x.joints[k])}return new E.OdW(I,R)})}loadAnimation(d){let x=this.json,T=this,I=x.animations[d],R=I.name?I.name:"animation_"+d,k=[],M=[],C=[],D=[],F=[];for(let d=0,x=I.channels.length;d<x;d++){let x=I.channels[d],T=I.samplers[x.sampler],E=x.target,R=E.node,j=void 0!==I.parameters?I.parameters[T.input]:T.input,K=void 0!==I.parameters?I.parameters[T.output]:T.output;void 0!==E.node&&(k.push(this.getDependency("node",R)),M.push(this.getDependency("accessor",j)),C.push(this.getDependency("accessor",K)),D.push(T),F.push(E))}return Promise.all([Promise.all(k),Promise.all(M),Promise.all(C),Promise.all(D),Promise.all(F)]).then(function(d){let x=d[0],I=d[1],k=d[2],M=d[3],C=d[4],D=[];for(let d=0,E=x.length;d<E;d++){let E=x[d],R=I[d],F=k[d],j=M[d],K=C[d];if(void 0===E)continue;E.updateMatrix&&(E.updateMatrix(),E.matrixAutoUpdate=!0);let V=T._createAnimationTracks(E,R,F,j,K);if(V)for(let d=0;d<V.length;d++)D.push(V[d])}return new E.m7l(R,void 0,D)})}createNodeMesh(d){let x=this.json,T=this,E=x.nodes[d];return void 0===E.mesh?null:T.getDependency("mesh",E.mesh).then(function(d){let x=T._getNodeRef(T.meshCache,E.mesh,d);return void 0!==E.weights&&x.traverse(function(d){if(d.isMesh)for(let x=0,T=E.weights.length;x<T;x++)d.morphTargetInfluences[x]=E.weights[x]}),x})}loadNode(d){let x=this.json,T=x.nodes[d],E=this._loadNodeShallow(d),I=[],R=T.children||[];for(let d=0,x=R.length;d<x;d++)I.push(this.getDependency("node",R[d]));let k=void 0===T.skin?Promise.resolve(null):this.getDependency("skin",T.skin);return Promise.all([E,Promise.all(I),k]).then(function(d){let x=d[0],T=d[1],E=d[2];null!==E&&x.traverse(function(d){d.isSkinnedMesh&&d.bind(E,Q)});for(let d=0,E=T.length;d<E;d++)x.add(T[d]);return x})}_loadNodeShallow(d){let x=this.json,T=this.extensions,I=this;if(void 0!==this.nodeCache[d])return this.nodeCache[d];let R=x.nodes[d],k=R.name?I.createUniqueName(R.name):"",M=[],C=I._invokeOne(function(x){return x.createNodeMesh&&x.createNodeMesh(d)});return C&&M.push(C),void 0!==R.camera&&M.push(I.getDependency("camera",R.camera).then(function(d){return I._getNodeRef(I.cameraCache,R.camera,d)})),I._invokeAll(function(x){return x.createNodeAttachment&&x.createNodeAttachment(d)}).forEach(function(d){M.push(d)}),this.nodeCache[d]=Promise.all(M).then(function(x){let M;if((M=!0===R.isBone?new E.N$j:x.length>1?new E.ZAu:1===x.length?x[0]:new E.Tme)!==x[0])for(let d=0,T=x.length;d<T;d++)M.add(x[d]);if(R.name&&(M.userData.name=R.name,M.name=k),assignExtrasToUserData(M,R),R.extensions&&addUnknownExtensionsToUserData(T,M,R),void 0!==R.matrix){let d=new E.yGw;d.fromArray(R.matrix),M.applyMatrix4(d)}else void 0!==R.translation&&M.position.fromArray(R.translation),void 0!==R.rotation&&M.quaternion.fromArray(R.rotation),void 0!==R.scale&&M.scale.fromArray(R.scale);return I.associations.has(M)||I.associations.set(M,{}),I.associations.get(M).nodes=d,M}),this.nodeCache[d]}loadScene(d){let x=this.extensions,T=this.json.scenes[d],I=this,R=new E.ZAu;T.name&&(R.name=I.createUniqueName(T.name)),assignExtrasToUserData(R,T),T.extensions&&addUnknownExtensionsToUserData(x,R,T);let k=T.nodes||[],M=[];for(let d=0,x=k.length;d<x;d++)M.push(I.getDependency("node",k[d]));return Promise.all(M).then(function(d){for(let x=0,T=d.length;x<T;x++)R.add(d[x]);return I.associations=(d=>{let x=new Map;for(let[d,T]of I.associations)(d instanceof E.F5T||d instanceof E.xEZ)&&x.set(d,T);return d.traverse(d=>{let T=I.associations.get(d);null!=T&&x.set(d,T)}),x})(R),R})}_createAnimationTracks(d,x,T,I,R){let k;let M=[],C=d.name?d.name:d.uuid,D=[];switch(W[R.path]===W.weights?d.traverse(function(d){d.morphTargetInfluences&&D.push(d.name?d.name:d.uuid)}):D.push(C),W[R.path]){case W.weights:k=E.dUE;break;case W.rotation:k=E.iLg;break;case W.position:case W.scale:default:switch(T.itemSize){case 1:k=E.dUE;break;case 2:case 3:k=E.yC1}}let F=void 0!==I.interpolation?Y[I.interpolation]:E.NMF,j=this._getArrayFromAccessor(T);for(let d=0,T=D.length;d<T;d++){let T=new k(D[d]+"."+W[R.path],x.array,j,F);"CUBICSPLINE"===F&&this._createCubicSplineTrackInterpolant(T),M.push(T)}return M}_getArrayFromAccessor(d){let x=d.array;if(d.normalized){let d=getNormalizedComponentScale(x.constructor),T=new Float32Array(x.length);for(let E=0,I=x.length;E<I;E++)T[E]=x[E]*d;x=T}return x}_createCubicSplineTrackInterpolant(d){d.createInterpolant=function(d){let x=this instanceof E.iLg?GLTFCubicSplineQuaternionInterpolant:GLTFCubicSplineInterpolant;return new x(this.times,this.values,this.getValueSize()/3,d)},d.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}};function addPrimitiveAttributes(d,x,T){let I=x.attributes,R=[];for(let x in I){let E=V[x]||x.toLowerCase();E in d.attributes||R.push(function(x,E){return T.getDependency("accessor",x).then(function(x){d.setAttribute(E,x)})}(I[x],E))}if(void 0!==x.indices&&!d.index){let E=T.getDependency("accessor",x.indices).then(function(x){d.setIndex(x)});R.push(E)}return assignExtrasToUserData(d,x),!function(d,x,T){let I=x.attributes,R=new E.ZzF;if(void 0===I.POSITION)return;{let d=T.json.accessors[I.POSITION],x=d.min,k=d.max;if(void 0!==x&&void 0!==k){if(R.set(new E.Pa4(x[0],x[1],x[2]),new E.Pa4(k[0],k[1],k[2])),d.normalized){let x=getNormalizedComponentScale(D[d.componentType]);R.min.multiplyScalar(x),R.max.multiplyScalar(x)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}let k=x.targets;if(void 0!==k){let d=new E.Pa4,x=new E.Pa4;for(let E=0,I=k.length;E<I;E++){let I=k[E];if(void 0!==I.POSITION){let E=T.json.accessors[I.POSITION],R=E.min,k=E.max;if(void 0!==R&&void 0!==k){if(x.setX(Math.max(Math.abs(R[0]),Math.abs(k[0]))),x.setY(Math.max(Math.abs(R[1]),Math.abs(k[1]))),x.setZ(Math.max(Math.abs(R[2]),Math.abs(k[2]))),E.normalized){let d=getNormalizedComponentScale(D[E.componentType]);x.multiplyScalar(d)}d.max(x)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}R.expandByVector(d)}d.boundingBox=R;let M=new E.aLr;R.getCenter(M.center),M.radius=R.min.distanceTo(R.max)/2,d.boundingSphere=M}(d,x,T),Promise.all(R).then(function(){return void 0!==x.targets?function(d,x,T){let E=!1,I=!1,R=!1;for(let d=0,T=x.length;d<T;d++){let T=x[d];if(void 0!==T.POSITION&&(E=!0),void 0!==T.NORMAL&&(I=!0),void 0!==T.COLOR_0&&(R=!0),E&&I&&R)break}if(!E&&!I&&!R)return Promise.resolve(d);let k=[],M=[],C=[];for(let D=0,F=x.length;D<F;D++){let F=x[D];if(E){let x=void 0!==F.POSITION?T.getDependency("accessor",F.POSITION):d.attributes.position;k.push(x)}if(I){let x=void 0!==F.NORMAL?T.getDependency("accessor",F.NORMAL):d.attributes.normal;M.push(x)}if(R){let x=void 0!==F.COLOR_0?T.getDependency("accessor",F.COLOR_0):d.attributes.color;C.push(x)}}return Promise.all([Promise.all(k),Promise.all(M),Promise.all(C)]).then(function(x){let T=x[0],k=x[1],M=x[2];return E&&(d.morphAttributes.position=T),I&&(d.morphAttributes.normal=k),R&&(d.morphAttributes.color=M),d.morphTargetsRelative=!0,d})}(d,x.targets,T):d})}}}]);